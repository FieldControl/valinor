<div class="kb-board-header">
  <button
    mat-mini-fab
    [routerLink]="['/boards']"
    color="secondary"
    aria-label="Voltar aos quadros"
  >
    <mat-icon>chevron_left</mat-icon>
  </button>

  <h1 class="kb-board-title">{{ board()?.name }}</h1>
</div>

<div
  cdkDropListGroup
  cdkDropList
  cdkDropListOrientation="horizontal"
  (cdkDropListDropped)="onSwimlaneChange($event)"
  class="swimlanes-wrapper"
>
  @for (swimlane of board()?.swimlanes; track swimlane) {
    <div class="swimlane" cdkDrag>
      <div class="swimlane-header" cdkDragHandle>
        <h2>{{ swimlane.name }}</h2>
        <div>
          <button
            color="primary"
            mat-stroked-button
            (click)="editSwimlane(swimlane)"
          >
            Editar
          </button>
        </div>
      </div>

      <div class="swimlane-inner">
        <div
          class="swimlane-inner__dragzone"
          cdkDropList
          cdkDropListOrientation="vertical"
          [cdkDropListData]="swimlane.cards"
          (cdkDropListDropped)="onCardChange($event, swimlane)"
        >
          @for (card of swimlane.cards; track card) {
            <button
              class="swimlane__card"
              (click)="addOrEditCard(swimlane, card)"
              cdkDrag
            >
              {{ card.name }}
            </button>
          }
        </div>
      </div>
      <button (click)="addOrEditCard(swimlane)" mat-button color="primary">
        ➕ Adicionar cartão
      </button>
    </div>
  }

  <!-- Nova Swimlane -->
  <div class="swimlane">
    <h2>Nova coluna</h2>
    <div class="swimlane-inner">
      <form [formGroup]="swimlaneForm">
        <mat-form-field appearance="fill">
          <mat-label>Nome</mat-label>
          <input matInput formControlName="name" placeholder="Ex. A fazer" />
          @if (!swimlaneForm.controls.name.hasError('required')) {
            <mat-error>Digite um nome válido</mat-error>
          }
        </mat-form-field>
        <br />
        <button (click)="addSwimlane()" color="primary" mat-flat-button>
          Criar coluna
        </button>
      </form>
    </div>
  </div>
</div>
