import{_registerComponent as t,registerVersion as e,_getProvider as n,getApp as s,_removeServiceInstance as r,SDK_VERSION as i}from"https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";const o=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++s)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const r=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,u=a?t[e+2]:0,c=r>>2,h=(3&r)<<4|o>>4;let l=(15&o)<<2|u>>6,d=63&u;a||(d=64,i||(l=64)),s.push(n[c],n[h],n[l],n[d])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(o(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[s++]=String.fromCharCode(55296+(i>>10)),e[s++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==i||null==o||null==a)throw new u;const c=r<<2|i>>4;if(s.push(c),64!==o){const t=i<<4&240|o>>2;if(s.push(t),64!==a){const t=o<<6&192|a;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class u extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(t){return function(t){const e=o(t);return a.encodeByteArray(e,!0)}(t).replace(/\./g,"")};const h=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,l=()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return a.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)},d=()=>{try{return h()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||l()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},f=t=>{const e=(t=>{var e,n;return null===(n=null===(e=d())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),s]:[e.substring(0,n),s]};function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function g(){return!function(){var t;const e=null===(t=d())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class p extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,y.prototype.create)}}class y{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],i=r?function(t,e){return t.replace(w,((t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${i} (${s}).`;return new p(s,o,n)}}const w=/\{\$([^}]+)}/g;function v(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const n=t[r],i=e[r];if(I(n)&&I(i)){if(!v(n,i))return!1}else if(n!==i)return!1}for(const t of s)if(!n.includes(t))return!1;return!0}function I(t){return null!==t&&"object"==typeof t}function T(t){return t&&t._delegate?t._delegate:t}class b{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}var E;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(E||(E={}));const S={debug:E.DEBUG,verbose:E.VERBOSE,info:E.INFO,warn:E.WARN,error:E.ERROR,silent:E.SILENT},_=E.INFO,A={[E.DEBUG]:"log",[E.VERBOSE]:"log",[E.INFO]:"info",[E.WARN]:"warn",[E.ERROR]:"error"},x=(t,e,...n)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),r=A[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${s}]  ${t.name}:`,...n)};var D,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=N||{},k=C||self;function R(){}function M(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var O="closure_uid_"+(1e9*Math.random()>>>0),F=0;function V(t,e,n){return t.call.apply(t.bind,arguments)}function P(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function U(t,e,n){return(U=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?V:P).apply(null,arguments)}function q(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function B(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Wb=function(t,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.prototype[n].apply(t,r)}}function K(){this.s=this.s,this.o=this.o}K.prototype.s=!1,K.prototype.na=function(){var t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,O)&&t[O]||(t[O]=++F))},K.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function j(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function $(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(M(n)){const e=t.length||0,s=n.length||0;t.length=e+s;for(let r=0;r<s;r++)t[e+r]=n[r]}else t.push(n)}}function Q(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Q.prototype.h=function(){this.defaultPrevented=!0};var z=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{k.addEventListener("test",R,e),k.removeEventListener("test",R,e)}catch(t){}return t}();function H(t){return/^[\s\xa0]*$/.test(t)}var W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return t<e?-1:t>e?1:0}function Y(){var t=k.navigator;return t&&(t=t.userAgent)?t:""}function J(t){return-1!=Y().indexOf(t)}function Z(t){return Z[" "](t),t}Z[" "]=R;var tt,et,nt=J("Opera"),st=J("Trident")||J("MSIE"),rt=J("Edge"),it=rt||st,ot=J("Gecko")&&!(-1!=Y().toLowerCase().indexOf("webkit")&&!J("Edge"))&&!(J("Trident")||J("MSIE"))&&!J("Edge"),at=-1!=Y().toLowerCase().indexOf("webkit")&&!J("Edge");function ut(){var t=k.document;return t?t.documentMode:void 0}t:{var ct="",ht=(et=Y(),ot?/rv:([^\);]+)(\)|;)/.exec(et):rt?/Edge\/([\d\.]+)/.exec(et):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(et):at?/WebKit\/(\S+)/.exec(et):nt?/(?:Version)[ \/]?(\S+)/.exec(et):void 0);if(ht&&(ct=ht?ht[1]:""),st){var lt=ut();if(null!=lt&&lt>parseFloat(ct)){tt=String(lt);break t}}tt=ct}var dt,ft={};function mt(){return function(t){var e=ft;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}((function(){let t=0;const e=W(String(tt)).split("."),n=W("9").split("."),s=Math.max(e.length,n.length);for(let o=0;0==t&&o<s;o++){var r=e[o]||"",i=n[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==r[0].length&&0==i[0].length)break;t=X(0==r[1].length?0:parseInt(r[1],10),0==i[1].length?0:parseInt(i[1],10))||X(0==r[2].length,0==i[2].length)||X(r[2],i[2]),r=r[3],i=i[3]}while(0==t)}return 0<=t}))}if(k.document&&st){var gt=ut();dt=gt||(parseInt(tt,10)||void 0)}else dt=void 0;var pt=dt;function yt(t,e){if(Q.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ot){t:{try{Z(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:wt[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&yt.X.h.call(this)}}B(yt,Q);var wt={2:"touch",3:"pen",4:"mouse"};yt.prototype.h=function(){yt.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var vt="closure_listenable_"+(1e6*Math.random()|0),It=0;function Tt(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ha=r,this.key=++It,this.ba=this.ea=!1}function bt(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function Et(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function St(t){const e={};for(const n in t)e[n]=t[n];return e}const _t="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function At(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<_t.length;e++)n=_t[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function xt(t){this.src=t,this.g={},this.h=0}function Dt(t,e){var n=e.type;if(n in t.g){var s,r=t.g[n],i=G(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(bt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Ct(t,e,n,s){for(var r=0;r<t.length;++r){var i=t[r];if(!i.ba&&i.listener==e&&i.capture==!!n&&i.ha==s)return r}return-1}xt.prototype.add=function(t,e,n,s,r){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=Ct(t,e,s,r);return-1<o?(e=t[o],n||(e.ea=!1)):((e=new Tt(e,this.src,i,!!s,r)).ea=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),kt={};function Rt(t,e,n,s,r){if(s&&s.once)return Lt(t,e,n,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Rt(t,e[i],n,s,r);return null}return n=Bt(n),t&&t[vt]?t.N(e,n,L(s)?!!s.capture:!!s,r):Mt(t,e,n,!1,s,r)}function Mt(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");var o=L(r)?!!r.capture:!!r,a=Ut(t);if(a||(t[Nt]=a=new xt(t)),(n=a.add(e,n,s,o,i)).proxy)return n;if(s=function(){function t(n){return e.call(t.src,t.listener,n)}const e=Pt;return t}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)z||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function Lt(t,e,n,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Lt(t,e[i],n,s,r);return null}return n=Bt(n),t&&t[vt]?t.O(e,n,L(s)?!!s.capture:!!s,r):Mt(t,e,n,!0,s,r)}function Ot(t,e,n,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)Ot(t,e[i],n,s,r);else s=L(s)?!!s.capture:!!s,n=Bt(n),t&&t[vt]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=Ct(i=t.g[e],n,s,r))&&(bt(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--)))):t&&(t=Ut(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Ct(e,n,s,r)),(n=-1<t?e[t]:null)&&Ft(n))}function Ft(t){if("number"!=typeof t&&t&&!t.ba){var e=t.src;if(e&&e[vt])Dt(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Vt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Ut(e))?(Dt(n,t),0==n.h&&(n.src=null,e[Nt]=null)):bt(t)}}}function Vt(t){return t in kt?kt[t]:kt[t]="on"+t}function Pt(t,e){if(t.ba)t=!0;else{e=new yt(e,this);var n=t.listener,s=t.ha||t.src;t.ea&&Ft(t),t=n.call(s,e)}return t}function Ut(t){return(t=t[Nt])instanceof xt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bt(t){return"function"==typeof t?t:(t[qt]||(t[qt]=function(e){return t.handleEvent(e)}),t[qt])}function Kt(){K.call(this),this.i=new xt(this),this.P=this,this.I=null}function Gt(t,e){var n,s=t.I;if(s)for(n=[];s;s=s.I)n.push(s);if(t=t.P,s=e.type||e,"string"==typeof e)e=new Q(e,t);else if(e instanceof Q)e.target=e.target||t;else{var r=e;At(e=new Q(s,t),r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];r=jt(o,s,!0,e)&&r}if(r=jt(o=e.g=t,s,!0,e)&&r,r=jt(o,s,!1,e)&&r,n)for(i=0;i<n.length;i++)r=jt(o=e.g=n[i],s,!1,e)&&r}function jt(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ba&&o.capture==n){var a=o.listener,u=o.ha||o.src;o.ea&&Dt(t.i,o),r=!1!==a.call(u,s)&&r}}return r&&!s.defaultPrevented}B(Kt,K),Kt.prototype[vt]=!0,Kt.prototype.removeEventListener=function(t,e,n,s){Ot(this,t,e,n,s)},Kt.prototype.M=function(){if(Kt.X.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],s=0;s<n.length;s++)bt(n[s]);delete e.g[t],e.h--}}this.I=null},Kt.prototype.N=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},Kt.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};var $t=k.JSON.stringify;function Qt(){var t=Zt;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var zt,Ht=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Wt),(t=>t.reset()));class Wt{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Xt(t){k.setTimeout((()=>{throw t}),0)}function Yt(t,e){zt||function(){var t=k.Promise.resolve(void 0);zt=function(){t.then(te)}}(),Jt||(zt(),Jt=!0),Zt.add(t,e)}var Jt=!1,Zt=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ht.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function te(){for(var t;t=Qt();){try{t.h.call(t.g)}catch(t){Xt(t)}var e=Ht;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Jt=!1}function ee(t,e){Kt.call(this),this.h=t||1,this.g=e||k,this.j=U(this.lb,this),this.l=Date.now()}function ne(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}function se(t,e,n){if("function"==typeof t)n&&(t=U(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=U(t.handleEvent,t)}return 2147483647<Number(e)?-1:k.setTimeout(t,e||0)}function re(t){t.g=se((()=>{t.g=null,t.i&&(t.i=!1,re(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}B(ee,Kt),(D=ee.prototype).ca=!1,D.R=null,D.lb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Gt(this,"tick"),this.ca&&(ne(this),this.start()))}},D.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},D.M=function(){ee.X.M.call(this),ne(this),delete this.g};class ie extends K{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:re(this)}M(){super.M(),this.g&&(k.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oe(t){K.call(this),this.h=t,this.g={}}B(oe,K);var ae=[];function ue(t,e,n,s){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var r=0;r<n.length;r++){var i=Rt(e,n[r],s||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function ce(t){Et(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Ft(t)}),t),t.g={}}function he(){this.g=!0}function le(t,e,n,s){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return $t(n)}catch(t){return e}}(t,n)+(s?" "+s:"")}))}oe.prototype.M=function(){oe.X.M.call(this),ce(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},he.prototype.Aa=function(){this.g=!1},he.prototype.info=function(){};var de={},fe=null;function me(){return fe=fe||new Kt}function ge(t){Q.call(this,de.Pa,t)}function pe(t){const e=me();Gt(e,new ge(e))}function ye(t,e){Q.call(this,de.STAT_EVENT,t),this.stat=e}function we(t){const e=me();Gt(e,new ye(e,t))}function ve(t,e){Q.call(this,de.Qa,t),this.size=e}function Ie(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return k.setTimeout((function(){t()}),e)}de.Pa="serverreachability",B(ge,Q),de.STAT_EVENT="statevent",B(ye,Q),de.Qa="timingevent",B(ve,Q);var Te={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},be={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Ee(){}function Se(t){return t.h||(t.h=t.i())}function _e(){}Ee.prototype.h=null;var Ae,xe={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function De(){Q.call(this,"d")}function Ce(){Q.call(this,"c")}function Ne(){}function ke(t,e,n,s){this.l=t,this.j=e,this.m=n,this.U=s||1,this.S=new oe(this),this.O=Me,t=it?125:void 0,this.T=new ee(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Re}function Re(){this.i=null,this.g="",this.h=!1}B(De,Q),B(Ce,Q),B(Ne,Ee),Ne.prototype.g=function(){return new XMLHttpRequest},Ne.prototype.i=function(){return{}},Ae=new Ne;var Me=45e3,Le={},Oe={};function Fe(t,e,n){t.K=1,t.v=en(Xe(e)),t.s=n,t.P=!0,Ve(t,null)}function Ve(t,e){t.F=Date.now(),Be(t),t.A=Xe(t.v);var n=t.A,s=t.U;Array.isArray(s)||(s=[String(s)]),gn(n.i,"t",s),t.C=0,n=t.l.H,t.h=new Re,t.g=ms(t.l,n?e:null,!t.s),0<t.N&&(t.L=new ie(U(t.La,t,t.g),t.N)),ue(t.S,t.g,"readystatechange",t.ib),e=t.H?St(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),pe(),function(t,e,n,s,r,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+c+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.U,t.s)}function Pe(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Da)}function Ue(t,e,n){let s,r=!0;for(;!t.I&&t.C<n.length;){if(s=qe(t,n),s==Oe){4==e&&(t.o=4,we(14),r=!1),le(t.j,t.m,null,"[Incomplete Response]");break}if(s==Le){t.o=4,we(15),le(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}le(t.j,t.m,s,null),Qe(t,s)}Pe(t)&&s!=Oe&&s!=Le&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,we(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.$&&(t.$=!0,(e=t.l).g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),os(e),e.K=!0,we(11))):(le(t.j,t.m,n,"[Invalid Chunked Response]"),$e(t),je(t))}function qe(t,e){var n=t.C,s=e.indexOf("\n",n);return-1==s?Oe:(n=Number(e.substring(n,s)),isNaN(n)?Le:(s+=1)+n>e.length?Oe:(e=e.substr(s,n),t.C=s+n,e))}function Be(t){t.V=Date.now()+t.O,Ke(t,t.O)}function Ke(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ie(U(t.gb,t),e)}function Ge(t){t.B&&(k.clearTimeout(t.B),t.B=null)}function je(t){0==t.l.G||t.I||cs(t.l,t)}function $e(t){Ge(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,ne(t.T),ce(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Qe(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Tn(n.h,t)))if(!t.J&&Tn(n.h,t)&&3==n.G){try{var s=n.Fa.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;us(n),Jn(n)}is(n),we(18)}}else n.Ba=r[1],0<n.Ba-n.T&&37500>r[2]&&n.L&&0==n.A&&!n.v&&(n.v=Ie(U(n.cb,n),6e3));if(1>=In(n.h)&&n.ja){try{n.ja()}catch(t){}n.ja=void 0}}else ls(n,11)}else if((t.J||n.g==t)&&us(n),!H(e))for(r=n.Fa.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.I=c[1],n.ka=c[2];const e=c[3];null!=e&&(n.ma=e,n.j.info("VER="+n.ma));const r=c[4];null!=r&&(n.Ca=r,n.j.info("SVER="+n.Ca));const h=c[5];null!=h&&"number"==typeof h&&0<h&&(s=1.5*h,n.J=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=s.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(bn(i,i.h),i.h=null))}if(s.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.za=t,tn(s.F,s.D,t))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=t;if((s=n).sa=fs(s,s.H?s.ka:null,s.V),o.J){En(s.h,o);var a=o,u=s.J;u&&a.setTimeout(u),a.B&&(Ge(a),Be(a)),s.g=o}else rs(s);0<n.i.length&&ts(n)}else"stop"!=c[0]&&"close"!=c[0]||ls(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?ls(n,7):Yn(n):"noop"!=c[0]&&n.l&&n.l.wa(c),n.A=0)}pe()}catch(t){}}function ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(M(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.oa&&"function"==typeof t.oa)return t.oa();if(!t.W||"function"!=typeof t.W){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(M(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const s in t)e[n++]=s;return e}}}(t),s=function(t){if(t.W&&"function"==typeof t.W)return t.W();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(M(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t),r=s.length,i=0;i<r;i++)e.call(void 0,s[i],n&&n[i],t)}(D=ke.prototype).setTimeout=function(t){this.O=t},D.ib=function(t){t=t.target;const e=this.L;e&&3==$n(t)?e.l():this.La(t)},D.La=function(t){try{if(t==this.g)t:{const h=$n(this.g);var e=this.g.Ea();this.g.aa();if(!(3>h)&&(3!=h||it||this.g&&(this.h.h||this.g.fa()||Qn(this.g)))){this.I||4!=h||7==e||pe(),Ge(this);var n=this.g.aa();this.Y=n;e:if(Pe(this)){var s=Qn(this.g);t="";var r=s.length,i=4==$n(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$e(this),je(this);var o="";break e}this.h.i=new k.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(t,e,n,s,r,i,o){t.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.U,h,n),this.i){if(this.Z&&!this.J){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(a)){var c=a;break e}}c=null}if(!(n=c)){this.i=!1,this.o=3,we(12),$e(this),je(this);break t}le(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Qe(this,n)}this.P?(Ue(this,h,o),it&&this.i&&3==h&&(ue(this.S,this.T,"tick",this.hb),this.T.start())):(le(this.j,this.m,o,null),Qe(this,o)),4==h&&$e(this),this.i&&!this.I&&(4==h?cs(this.l,this):(this.i=!1,Be(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,we(12)):(this.o=0,we(13)),$e(this),je(this)}}}catch(t){}},D.hb=function(){if(this.g){var t=$n(this.g),e=this.g.fa();this.C<e.length&&(Ge(this),Ue(this,t,e),this.i&&4!=t&&Be(this))}},D.cancel=function(){this.I=!0,$e(this)},D.gb=function(){this.B=null;const t=Date.now();0<=t-this.V?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(pe(),we(17)),$e(this),this.o=2,je(this)):Ke(this,this.V-t)};var He=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function We(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof We){this.h=void 0!==e?e:t.h,Ye(this,t.j),this.s=t.s,this.g=t.g,Je(this,t.m),this.l=t.l,e=t.i;var n=new ln;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Ze(this,n),this.o=t.o}else t&&(n=String(t).match(He))?(this.h=!!e,Ye(this,n[1]||"",!0),this.s=nn(n[2]||""),this.g=nn(n[3]||"",!0),Je(this,n[4]),this.l=nn(n[5]||"",!0),Ze(this,n[6]||"",!0),this.o=nn(n[7]||"")):(this.h=!!e,this.i=new ln(null,this.h))}function Xe(t){return new We(t)}function Ye(t,e,n){t.j=n?nn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Je(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ze(t,e,n){e instanceof ln?(t.i=e,function(t,e){e&&!t.j&&(dn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(fn(this,e),gn(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=sn(e,cn)),t.i=new ln(e,t.h))}function tn(t,e,n){t.i.set(e,n)}function en(t){return tn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function sn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,rn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function rn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}We.prototype.toString=function(){var t=[],e=this.j;e&&t.push(sn(e,on,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(sn(e,on,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(sn(n,"/"==n.charAt(0)?un:an,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",sn(n,hn)),t.join("")};var on=/[#\/\?@]/g,an=/[#\?:]/g,un=/[#\?]/g,cn=/[#\?@]/g,hn=/#/g;function ln(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function dn(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),r=null;if(0<=s){var i=t[n].substring(0,s);r=t[n].substring(s+1)}else i=t[n];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function fn(t,e){dn(t),e=pn(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function mn(t,e){return dn(t),e=pn(t,e),t.g.has(e)}function gn(t,e,n){fn(t,e),0<n.length&&(t.i=null,t.g.set(pn(t,e),j(n)),t.h+=n.length)}function pn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(D=ln.prototype).add=function(t,e){dn(this),this.i=null,t=pn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},D.forEach=function(t,e){dn(this),this.g.forEach((function(n,s){n.forEach((function(n){t.call(e,n,s,this)}),this)}),this)},D.oa=function(){dn(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){const r=t[s];for(let t=0;t<r.length;t++)n.push(e[s])}return n},D.W=function(t){dn(this);let e=[];if("string"==typeof t)mn(this,t)&&(e=e.concat(this.g.get(pn(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},D.set=function(t,e){return dn(this),this.i=null,mn(this,t=pn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},D.get=function(t,e){return t&&0<(t=this.W(t)).length?String(t[0]):e},D.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];const i=encodeURIComponent(String(s)),o=this.W(s);for(s=0;s<o.length;s++){var r=i;""!==o[s]&&(r+="="+encodeURIComponent(String(o[s]))),t.push(r)}}return this.i=t.join("&")};function yn(t){this.l=t||wn,k.PerformanceNavigationTiming?t=0<(t=k.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(k.g&&k.g.Ga&&k.g.Ga()&&k.g.Ga().$b),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wn=10;function vn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function In(t){return t.h?1:t.g?t.g.size:0}function Tn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function bn(t,e){t.g?t.g.add(e):t.h=e}function En(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Sn(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return j(t.i)}function _n(){}function An(){this.g=new _n}function xn(t,e,n){const s=n||"";try{ze(t,(function(t,n){let r=t;L(t)&&(r=$t(t)),e.push(s+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function Dn(t,e,n,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch(t){}}function Cn(t){this.l=t.ac||null,this.j=t.jb||!1}function Nn(t,e){Kt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=kn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}yn.prototype.cancel=function(){if(this.i=Sn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},_n.prototype.stringify=function(t){return k.JSON.stringify(t,void 0)},_n.prototype.parse=function(t){return k.JSON.parse(t,void 0)},B(Cn,Ee),Cn.prototype.g=function(){return new Nn(this.l,this.j)},Cn.prototype.i=function(t){return function(){return t}}({}),B(Nn,Kt);var kn=0;function Rn(t){t.j.read().then(t.Ta.bind(t)).catch(t.ga.bind(t))}function Mn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Ln(t)}function Ln(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(D=Nn.prototype).open=function(t,e){if(this.readyState!=kn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Ln(this)},D.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||k).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},D.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mn(this)),this.readyState=kn},D.Wa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Ln(this)),this.g&&(this.readyState=3,Ln(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==k.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Rn(this)}else t.text().then(this.Va.bind(this),this.ga.bind(this))},D.Ta=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Mn(this):Ln(this),3==this.readyState&&Rn(this)}},D.Va=function(t){this.g&&(this.response=this.responseText=t,Mn(this))},D.Ua=function(t){this.g&&(this.response=t,Mn(this))},D.ga=function(){this.g&&Mn(this)},D.setRequestHeader=function(t,e){this.v.append(t,e)},D.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},D.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Nn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var On=k.JSON.parse;function Fn(t){Kt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Vn,this.K=this.L=!1}B(Fn,Kt);var Vn="",Pn=/^https?$/i,Un=["POST","PUT"];function qn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Bn(t),Gn(t)}function Bn(t){t.D||(t.D=!0,Gt(t,"complete"),Gt(t,"error"))}function Kn(t){if(t.h&&void 0!==N&&(!t.C[1]||4!=$n(t)||2!=t.aa()))if(t.v&&4==$n(t))se(t.Ha,0,t);else if(Gt(t,"readystatechange"),4==$n(t)){t.h=!1;try{const a=t.aa();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===a){var r=String(t.H).match(He)[1]||null;if(!r&&k.self&&k.self.location){var i=k.self.location.protocol;r=i.substr(0,i.length-1)}s=!Pn.test(r?r.toLowerCase():"")}n=s}if(n)Gt(t,"complete"),Gt(t,"success");else{t.m=6;try{var o=2<$n(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.aa()+"]",Bn(t)}}finally{Gn(t)}}}function Gn(t,e){if(t.g){jn(t);const n=t.g,s=t.C[0]?R:null;t.g=null,t.C=null,e||Gt(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function jn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(k.clearTimeout(t.A),t.A=null)}function $n(t){return t.g?t.g.readyState:0}function Qn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Vn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function zn(t){let e="";return Et(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Hn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=zn(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):tn(t,e,n))}function Wn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Xn(t){this.Ca=0,this.i=[],this.j=new he,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Wn("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Wn("baseRetryDelayMs",5e3,t),this.bb=Wn("retryDelaySeedMs",1e4,t),this.$a=Wn("forwardChannelMaxRetries",2,t),this.ta=Wn("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Zb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new yn(t&&t.concurrentRequestLimit),this.Fa=new An,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=t&&t.Xb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Yn(t){if(Zn(t),3==t.G){var e=t.U++,n=Xe(t.F);tn(n,"SID",t.I),tn(n,"RID",e),tn(n,"TYPE","terminate"),ns(t,n),(e=new ke(t,t.j,e,void 0)).K=2,e.v=en(Xe(n)),n=!1,k.navigator&&k.navigator.sendBeacon&&(n=k.navigator.sendBeacon(e.v.toString(),"")),!n&&k.Image&&((new Image).src=e.v,n=!0),n||(e.g=ms(e.l,null),e.g.da(e.v)),e.F=Date.now(),Be(e)}ds(t)}function Jn(t){t.g&&(os(t),t.g.cancel(),t.g=null)}function Zn(t){Jn(t),t.u&&(k.clearTimeout(t.u),t.u=null),us(t),t.h.cancel(),t.m&&("number"==typeof t.m&&k.clearTimeout(t.m),t.m=null)}function ts(t){vn(t.h)||t.m||(t.m=!0,Yt(t.Ja,t),t.C=0)}function es(t,e){var n;n=e?e.m:t.U++;const s=Xe(t.F);tn(s,"SID",t.I),tn(s,"RID",n),tn(s,"AID",t.T),ns(t,s),t.o&&t.s&&Hn(s,t.o,t.s),n=new ke(t,t.j,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=ss(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),bn(t.h,n),Fe(n,s,e)}function ns(t,e){t.ia&&Et(t.ia,(function(t,n){tn(e,n,t)})),t.l&&ze({},(function(t,n){tn(e,n,t)}))}function ss(t,e,n){n=Math.min(t.i.length,n);var s=t.l?U(t.l.Ra,t.l,t):null;t:{var r=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=r[o].h;const a=r[o].g;if(n-=e,0>n)e=Math.max(0,r[o].h-100),i=!1;else try{xn(a,t,"req"+n+"_")}catch(t){s&&s(a)}}if(i){s=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,s}function rs(t){t.g||t.u||(t.Z=1,Yt(t.Ia,t),t.A=0)}function is(t){return!(t.g||t.u||3<=t.A)&&(t.Z++,t.u=Ie(U(t.Ia,t),hs(t,t.A)),t.A++,!0)}function os(t){null!=t.B&&(k.clearTimeout(t.B),t.B=null)}function as(t){t.g=new ke(t,t.j,"rpc",t.Z),null===t.o&&(t.g.H=t.s),t.g.N=0;var e=Xe(t.sa);tn(e,"RID","rpc"),tn(e,"SID",t.I),tn(e,"CI",t.L?"0":"1"),tn(e,"AID",t.T),tn(e,"TYPE","xmlhttp"),ns(t,e),t.o&&t.s&&Hn(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=en(Xe(e)),n.s=null,n.P=!0,Ve(n,t)}function us(t){null!=t.v&&(k.clearTimeout(t.v),t.v=null)}function cs(t,e){var n=null;if(t.g==e){us(t),os(t),t.g=null;var s=2}else{if(!Tn(t.h,e))return;n=e.D,En(t.h,e),s=1}if(0!=t.G)if(t.pa=e.Y,e.i)if(1==s){n=e.s?e.s.length:0,e=Date.now()-e.F;var r=t.C;Gt(s=me(),new ve(s,n)),ts(t)}else rs(t);else if(3==(r=e.o)||0==r&&0<t.pa||!(1==s&&function(t,e){return!(In(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.C>=(t.Za?0:t.$a)||(t.m=Ie(U(t.Ja,t,e),hs(t,t.C)),t.C++,0)))}(t,e)||2==s&&is(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),r){case 1:ls(t,5);break;case 4:ls(t,10);break;case 3:ls(t,6);break;default:ls(t,2)}}function hs(t,e){let n=t.Xa+Math.floor(Math.random()*t.bb);return t.l||(n*=2),n*e}function ls(t,e){if(t.j.info("Error code "+e),2==e){var n=null;t.l&&(n=null);var s=U(t.kb,t);n||(n=new We("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||Ye(n,"https"),en(n)),function(t,e){const n=new he;if(k.Image){const s=new Image;s.onload=q(Dn,n,s,"TestLoadImage: loaded",!0,e),s.onerror=q(Dn,n,s,"TestLoadImage: error",!1,e),s.onabort=q(Dn,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=q(Dn,n,s,"TestLoadImage: timeout",!1,e),k.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=t}else e(!1)}(n.toString(),s)}else we(2);t.G=0,t.l&&t.l.va(e),ds(t),Zn(t)}function ds(t){if(t.G=0,t.la=[],t.l){const e=Sn(t.h);0==e.length&&0==t.i.length||($(t.la,e),$(t.la,t.i),t.h.i.length=0,j(t.i),t.i.length=0),t.l.ua()}}function fs(t,e,n){var s=n instanceof We?Xe(n):new We(n,void 0);if(""!=s.g)e&&(s.g=e+"."+s.g),Je(s,s.m);else{var r=k.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var i=new We(null,void 0);s&&Ye(i,s),e&&(i.g=e),r&&Je(i,r),n&&(i.l=n),s=i}return n=t.D,e=t.za,n&&e&&tn(s,n,e),tn(s,"VER",t.ma),ns(t,s),s}function ms(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Da&&!t.ra?new Fn(new Cn({jb:!0})):new Fn(t.ra)).Ka(t.H),e}function gs(){}function ps(){if(st&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function ys(t,e){Kt.call(this),this.g=new Xn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Yb)&&!H(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Is(this)}function ws(t){De.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function vs(){Ce.call(this),this.status=1}function Is(t){this.g=t}(D=Fn.prototype).Ka=function(t){this.L=t},D.da=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ae.g(),this.C=this.u?Se(this.u):Se(Ae),this.g.onreadystatechange=U(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void qn(this,t)}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const t of s.keys())n.set(t,s.get(t))}s=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=k.FormData&&t instanceof k.FormData,!(0<=G(Un,e))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{jn(this),0<this.B&&((this.K=function(t){return st&&mt()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=U(this.qa,this)):this.A=se(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){qn(this,t)}},D.qa=function(){void 0!==N&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Gt(this,"timeout"),this.abort(8))},D.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Gt(this,"complete"),Gt(this,"abort"),Gn(this))},D.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gn(this,!0)),Fn.X.M.call(this)},D.Ha=function(){this.s||(this.F||this.v||this.l?Kn(this):this.fb())},D.fb=function(){Kn(this)},D.aa=function(){try{return 2<$n(this)?this.g.status:-1}catch(t){return-1}},D.fa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},D.Sa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),On(e)}},D.Ea=function(){return this.m},D.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(D=Xn.prototype).ma=8,D.G=1,D.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const r=new ke(this,this.j,t,void 0);let i=this.s;if(this.S&&(i?(i=St(i),At(i,this.S)):i=this.S),null!==this.o||this.N||(r.H=i,i=null),this.O)t:{for(var e=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=ss(this,r,e),tn(n=Xe(this.F),"RID",t),tn(n,"CVER",22),this.D&&tn(n,"X-HTTP-Session-Id",this.D),ns(this,n),i&&(this.N?e="headers="+encodeURIComponent(String(zn(i)))+"&"+e:this.o&&Hn(n,this.o,i)),bn(this.h,r),this.Ya&&tn(n,"TYPE","init"),this.O?(tn(n,"$req",e),tn(n,"SID","null"),r.Z=!0,Fe(r,n,null)):Fe(r,n,e),this.G=2}}else 3==this.G&&(t?es(this,t):0==this.i.length||vn(this.h)||es(this))},D.Ia=function(){if(this.u=null,as(this),this.$&&!(this.K||null==this.g||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=Ie(U(this.eb,this),t)}},D.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,we(10),Jn(this),as(this))},D.cb=function(){null!=this.v&&(this.v=null,Jn(this),is(this),we(19))},D.kb=function(t){t?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))},(D=gs.prototype).xa=function(){},D.wa=function(){},D.va=function(){},D.ua=function(){},D.Ra=function(){},ps.prototype.g=function(t,e){return new ys(t,e)},B(ys,Kt),ys.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;we(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=fs(t,null,t.V),ts(t)},ys.prototype.close=function(){Yn(this.g)},ys.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=$t(t),t=n);e.i.push(new class{constructor(t,e){this.h=t,this.g=e}}(e.ab++,t)),3==e.G&&ts(e)},ys.prototype.M=function(){this.g.l=null,delete this.j,Yn(this.g),delete this.g,ys.X.M.call(this)},B(ws,De),B(vs,Ce),B(Is,gs),Is.prototype.xa=function(){Gt(this.g,"a")},Is.prototype.wa=function(t){Gt(this.g,new ws(t))},Is.prototype.va=function(t){Gt(this.g,new vs)},Is.prototype.ua=function(){Gt(this.g,"b")},ps.prototype.createWebChannel=ps.prototype.g,ys.prototype.send=ys.prototype.u,ys.prototype.open=ys.prototype.m,ys.prototype.close=ys.prototype.close,Te.NO_ERROR=0,Te.TIMEOUT=8,Te.HTTP_ERROR=6,be.COMPLETE="complete",_e.EventType=xe,xe.OPEN="a",xe.CLOSE="b",xe.ERROR="c",xe.MESSAGE="d",Kt.prototype.listen=Kt.prototype.N,Fn.prototype.listenOnce=Fn.prototype.O,Fn.prototype.getLastError=Fn.prototype.Oa,Fn.prototype.getLastErrorCode=Fn.prototype.Ea,Fn.prototype.getStatus=Fn.prototype.aa,Fn.prototype.getResponseJson=Fn.prototype.Sa,Fn.prototype.getResponseText=Fn.prototype.fa,Fn.prototype.send=Fn.prototype.da,Fn.prototype.setWithCredentials=Fn.prototype.Ka;var Ts=Te,bs=be,Es=de,Ss=10,_s=11,As=Cn,xs=_e,Ds=Fn;const Cs="@firebase/firestore";class Ns{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ns.UNAUTHENTICATED=new Ns(null),Ns.GOOGLE_CREDENTIALS=new Ns("google-credentials-uid"),Ns.FIRST_PARTY=new Ns("first-party-uid"),Ns.MOCK_USER=new Ns("mock-user");let ks="9.17.2";const Rs=new class{constructor(t){this.name=t,this._logLevel=_,this._logHandler=x,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in E))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?S[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,E.DEBUG,...t),this._logHandler(this,E.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,E.VERBOSE,...t),this._logHandler(this,E.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,E.INFO,...t),this._logHandler(this,E.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,E.WARN,...t),this._logHandler(this,E.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,E.ERROR,...t),this._logHandler(this,E.ERROR,...t)}}("@firebase/firestore");function Ms(){return Rs.logLevel}function Ls(t){Rs.setLogLevel(t)}function Os(t,...e){if(Rs.logLevel<=E.DEBUG){const n=e.map(Ps);Rs.debug(`Firestore (${ks}): ${t}`,...n)}}function Fs(t,...e){if(Rs.logLevel<=E.ERROR){const n=e.map(Ps);Rs.error(`Firestore (${ks}): ${t}`,...n)}}function Vs(t,...e){if(Rs.logLevel<=E.WARN){const n=e.map(Ps);Rs.warn(`Firestore (${ks}): ${t}`,...n)}}function Ps(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Us(t="Unexpected state"){const e=`FIRESTORE (${ks}) INTERNAL ASSERTION FAILED: `+t;throw Fs(e),new Error(e)}function qs(t,e){t||Us()}function Bs(t,e){t||Us()}function Ks(t,e){return t}const Gs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class js extends p{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class $s{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Qs{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class zs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Ns.UNAUTHENTICATED)))}shutdown(){}}class Hs{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Ws{constructor(t){this.t=t,this.currentUser=Ns.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new $s;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new $s,t.enqueueRetryable((()=>s(this.currentUser)))};const i=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{Os("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Os("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new $s)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Os("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(qs("string"==typeof e.accessToken),new Qs(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return qs(null===t||"string"==typeof t),new Ns(t)}}class Xs{constructor(t,e,n,s){this.h=t,this.l=e,this.m=n,this.g=s,this.type="FirstParty",this.user=Ns.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(qs(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.p.set("Authorization",t),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Ys{constructor(t,e,n,s){this.h=t,this.l=e,this.m=n,this.g=s}getToken(){return Promise.resolve(new Xs(this.h,this.l,this.m,this.g))}start(t,e){t.enqueueRetryable((()=>e(Ns.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Js{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zs{constructor(t){this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,e){const n=t=>{null!=t.error&&Os("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.A;return this.A=t.token,Os("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{Os("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.T.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.T.getImmediate({optional:!0});t?s(t):Os("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(qs("string"==typeof t.token),this.A=t.token,new Js(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class tr{getToken(){return Promise.resolve(new Js(""))}invalidateToken(){}start(t,e){}shutdown(){}}function er(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class nr{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=er(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<e&&(n+=t.charAt(s[r]%t.length))}return n}}function sr(t,e){return t<e?-1:t>e?1:0}function rr(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function ir(t){return t+"\0"}class or{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new js(Gs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new js(Gs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new js(Gs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new js(Gs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return or.fromMillis(Date.now())}static fromDate(t){return or.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new or(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?sr(this.nanoseconds,t.nanoseconds):sr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ar{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ar(t)}static min(){return new ar(new or(0,0))}static max(){return new ar(new or(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ur{constructor(t,e,n){void 0===e?e=0:e>t.length&&Us(),void 0===n?n=t.length-e:n>t.length-e&&Us(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ur.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ur?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),r=e.get(s);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class cr extends ur{construct(t,e,n){return new cr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new js(Gs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new cr(e)}static emptyPath(){return new cr([])}}const hr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class lr extends ur{construct(t,e,n){return new lr(t,e,n)}static isValidIdentifier(t){return hr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),lr.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new lr(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const r=()=>{if(0===n.length)throw new js(Gs.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new js(Gs.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new js(Gs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(i=!i,s++):"."!==e||i?(n+=e,s++):(r(),s++)}if(r(),i)throw new js(Gs.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new lr(e)}static emptyPath(){return new lr([])}}class dr{constructor(t){this.path=t}static fromPath(t){return new dr(cr.fromString(t))}static fromName(t){return new dr(cr.fromString(t).popFirst(5))}static empty(){return new dr(cr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===cr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return cr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new dr(new cr(t.slice()))}}class fr{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function mr(t){return t.fields.find((t=>2===t.kind))}function gr(t){return t.fields.filter((t=>2!==t.kind))}function pr(t,e){let n=sr(t.collectionGroup,e.collectionGroup);if(0!==n)return n;for(let s=0;s<Math.min(t.fields.length,e.fields.length);++s)if(n=wr(t.fields[s],e.fields[s]),0!==n)return n;return sr(t.fields.length,e.fields.length)}fr.UNKNOWN_ID=-1;class yr{constructor(t,e){this.fieldPath=t,this.kind=e}}function wr(t,e){const n=lr.comparator(t.fieldPath,e.fieldPath);return 0!==n?n:sr(t.kind,e.kind)}class vr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new vr(0,br.min())}}function Ir(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,r=ar.fromTimestamp(1e9===s?new or(n+1,0):new or(n,s));return new br(r,dr.empty(),e)}function Tr(t){return new br(t.readTime,t.key,-1)}class br{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new br(ar.min(),dr.empty(),-1)}static max(){return new br(ar.max(),dr.empty(),-1)}}function Er(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=dr.comparator(t.documentKey,e.documentKey),0!==n?n:sr(t.largestBatchId,e.largestBatchId))}const Sr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _r{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Ar(t){if(t.code!==Gs.FAILED_PRECONDITION||t.message!==Sr)throw t;Os("LocalStore","Unexpectedly lost primary lease")}class xr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Us(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new xr(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof xr?e:xr.resolve(e)}catch(t){return xr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):xr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):xr.reject(e)}static resolve(t){return new xr(((e,n)=>{e(t)}))}static reject(t){return new xr(((e,n)=>{n(t)}))}static waitFor(t){return new xr(((e,n)=>{let s=0,r=0,i=!1;t.forEach((t=>{++s,t.next((()=>{++r,i&&r===s&&e()}),(t=>n(t)))})),i=!0,r===s&&e()}))}static or(t){let e=xr.resolve(!1);for(const n of t)e=e.next((t=>t?xr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new xr(((n,s)=>{const r=t.length,i=new Array(r);let o=0;for(let a=0;a<r;a++){const u=a;e(t[u]).next((t=>{i[u]=t,++o,o===r&&n(i)}),(t=>s(t)))}}))}static doWhile(t,e){return new xr(((n,s)=>{const r=()=>{!0===t()?e().next((()=>{r()}),s):n()};r()}))}}class Dr{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.v=new $s,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{e.error?this.v.reject(new kr(t,e.error)):this.v.resolve()},this.transaction.onerror=e=>{const n=Fr(e.target.error);this.v.reject(new kr(t,n))}}static open(t,e,n,s){try{return new Dr(e,t.transaction(s,n))}catch(t){throw new kr(e,t)}}get P(){return this.v.promise}abort(t){t&&this.v.reject(t),this.aborted||(Os("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Mr(e)}}class Cr{constructor(t,e,n){this.name=t,this.version=e,this.S=n,12.2===Cr.D(m())&&Fs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Os("SimpleDb","Removing database:",t),Lr(window.indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}())return!1;if(Cr.N())return!0;const t=m(),e=Cr.D(t),n=0<e&&e<10,s=Cr.k(t),r=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static N(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.O)}static M(t,e){return t.store(e)}static D(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(t){return this.db||(Os("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new kr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new js(Gs.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new js(Gs.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new kr(t,s))},s.onupgradeneeded=t=>{Os("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.S.$(e,s.transaction,t.oldVersion,this.version).next((()=>{Os("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const r="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.F(t);const e=Dr.open(this.db,t,r?"readonly":"readwrite",n),i=s(e).next((t=>(e.V(),t))).catch((t=>(e.abort(t),xr.reject(t)))).toPromise();return i.catch((()=>{})),await e.P,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(Os("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Nr{constructor(t){this.q=t,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(t){this.q=t}done(){this.U=!0}j(t){this.K=t}delete(){return Lr(this.q.delete())}}class kr extends js{constructor(t,e){super(Gs.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Rr(t){return"IndexedDbTransactionError"===t.name}class Mr{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Os("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Os("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Lr(n)}add(t){return Os("SimpleDb","ADD",this.store.name,t,t),Lr(this.store.add(t))}get(t){return Lr(this.store.get(t)).next((e=>(void 0===e&&(e=null),Os("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Os("SimpleDb","DELETE",this.store.name,t),Lr(this.store.delete(t))}count(){return Os("SimpleDb","COUNT",this.store.name),Lr(this.store.count())}W(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.H(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new xr(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}J(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new xr(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}Y(t,e){Os("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.Z=!1;const s=this.cursor(n);return this.H(s,((t,e,n)=>n.delete()))}X(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.H(s,e)}tt(t){const e=this.cursor({});return new xr(((n,s)=>{e.onerror=t=>{const e=Fr(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}H(t,e){const n=[];return new xr(((s,r)=>{t.onerror=t=>{r(t.target.error)},t.onsuccess=t=>{const r=t.target.result;if(!r)return void s();const i=new Nr(r),o=e(r.primaryKey,r.value,i);if(o instanceof xr){const t=o.catch((t=>(i.done(),xr.reject(t))));n.push(t)}i.isDone?s():null===i.G?r.continue():r.continue(i.G)}})).next((()=>xr.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.Z?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Lr(t){return new xr(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Fr(t.target.error);n(e)}}))}let Or=!1;function Fr(t){const e=Cr.D(m());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new js("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Or||(Or=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Vr{constructor(t,e){this.asyncQueue=t,this.et=e,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(t){Os("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{Os("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(t){Rr(t)?Os("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await Ar(t)}await this.nt(6e4)}))}}class Pr{constructor(t,e){this.localStore=t,this.persistence=e}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.it(e,t)))}it(t,e){const n=new Set;let s=e,r=!0;return xr.doWhile((()=>!0===r&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return Os("IndexBackiller",`Processing collection: ${e}`),this.rt(t,e,s).next((t=>{s-=t,n.add(e)}));r=!1})))).next((()=>e-s))}rt(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next((n=>{const r=n.changes;return this.localStore.indexManager.updateIndexEntries(t,r).next((()=>this.ot(s,n))).next((n=>(Os("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>r.size))}))))}ot(t,e){let n=t;return e.changes.forEach(((t,e)=>{const s=Tr(e);Er(s,n)>0&&(n=s)})),new br(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class Ur{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ut(t),this.ct=t=>e.writeSequenceNumber(t))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}Ur.at=-1;const qr=/^[_a-zA-Z][_a-zA-Z0-9]*(?:\.[_a-zA-Z][_a-zA-Z0-9]*)*$/;class Br{constructor(t){this.alias=t}static ht(t){return qr.test(t)}canonicalString(){let t=this.alias.replace(/\\/g,"\\\\").replace(/`/g,"\\`");return Br.ht(t)||(t="`"+t+"`"),t}}class Kr{constructor(t,e,n){this.alias=t,this.lt=e,this.fieldPath=n}}class Gr{constructor(t,e,n,s,r,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class jr{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new jr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof jr&&t.projectId===this.projectId&&t.database===this.database}}function $r(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Qr(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zr(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Hr(t){return null==t}function Wr(t){return 0===t&&1/t==-1/0}function Xr(t){return"number"==typeof t&&Number.isInteger(t)&&!Wr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Yr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function Jr(){return"undefined"!=typeof atob}class Zr{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw t instanceof DOMException?new Yr("Invalid base64 string: "+t):t}}(t);return new Zr(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Zr(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return sr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Zr.EMPTY_BYTE_STRING=new Zr("");const ti=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ei(t){if(qs(!!t),"string"==typeof t){let e=0;const n=ti.exec(t);if(qs(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ni(t.seconds),nanos:ni(t.nanos)}}function ni(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function si(t){return"string"==typeof t?Zr.fromBase64String(t):Zr.fromUint8Array(t)}function ri(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ii(t){const e=t.mapValue.fields.__previous_value__;return ri(e)?ii(e):e}function oi(t){const e=ei(t.mapValue.fields.__local_write_time__.timestampValue);return new or(e.seconds,e.nanos)}const ai={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ui={nullValue:"NULL_VALUE"};function ci(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ri(t)?4:Ei(t)?9007199254740991:10:Us()}function hi(t,e){if(t===e)return!0;const n=ci(t);if(n!==ci(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return oi(t).isEqual(oi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ei(t.timestampValue),s=ei(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return si(t.bytesValue).isEqual(si(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ni(t.geoPointValue.latitude)===ni(e.geoPointValue.latitude)&&ni(t.geoPointValue.longitude)===ni(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ni(t.integerValue)===ni(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ni(t.doubleValue),s=ni(e.doubleValue);return n===s?Wr(n)===Wr(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return rr(t.arrayValue.values||[],e.arrayValue.values||[],hi);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if($r(n)!==$r(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!hi(n[t],s[t])))return!1;return!0}(t,e);default:return Us()}}function li(t,e){return void 0!==(t.values||[]).find((t=>hi(t,e)))}function di(t,e){if(t===e)return 0;const n=ci(t),s=ci(e);if(n!==s)return sr(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return sr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ni(t.integerValue||t.doubleValue),s=ni(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return fi(t.timestampValue,e.timestampValue);case 4:return fi(oi(t),oi(e));case 5:return sr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=si(t),s=si(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=sr(n[t],s[t]);if(0!==e)return e}return sr(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=sr(ni(t.latitude),ni(e.latitude));return 0!==n?n:sr(ni(t.longitude),ni(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=di(n[t],s[t]);if(e)return e}return sr(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===ai.mapValue&&e===ai.mapValue)return 0;if(t===ai.mapValue)return 1;if(e===ai.mapValue)return-1;const n=t.fields||{},s=Object.keys(n),r=e.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let t=0;t<s.length&&t<i.length;++t){const e=sr(s[t],i[t]);if(0!==e)return e;const o=di(n[s[t]],r[i[t]]);if(0!==o)return o}return sr(s.length,i.length)}(t.mapValue,e.mapValue);default:throw Us()}}function fi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return sr(t,e);const n=ei(t),s=ei(e),r=sr(n.seconds,s.seconds);return 0!==r?r:sr(n.nanos,s.nanos)}function mi(t){return gi(t)}function gi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=ei(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?si(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,dr.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=gi(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const r of e)s?s=!1:n+=",",n+=`${r}:${gi(t.fields[r])}`;return n+"}"}(t.mapValue):Us();var e,n}function pi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function yi(t){return!!t&&"integerValue"in t}function wi(t){return!!t&&"arrayValue"in t}function vi(t){return!!t&&"nullValue"in t}function Ii(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ti(t){return!!t&&"mapValue"in t}function bi(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Qr(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=bi(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=bi(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Ei(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function Si(t){return"nullValue"in t?ui:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?pi(jr.empty(),dr.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:Us()}function _i(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?pi(jr.empty(),dr.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?ai:Us()}function Ai(t,e){const n=di(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function xi(t,e){const n=di(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}class Di{constructor(t,e){this.position=t,this.inclusive=e}}function Ci(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(s=i.field.isKeyField()?dr.comparator(dr.fromName(o.referenceValue),n.key):di(o,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function Ni(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!hi(t.position[n],e.position[n]))return!1;return!0}class ki{}class Ri extends ki{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Ki(t,e,n):"array-contains"===e?new Qi(t,n):"in"===e?new zi(t,n):"not-in"===e?new Hi(t,n):"array-contains-any"===e?new Wi(t,n):new Ri(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Gi(t,n):new ji(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(di(e,this.value)):null!==e&&ci(this.value)===ci(e)&&this.matchesComparison(di(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Us()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Mi extends ki{constructor(t,e){super(),this.filters=t,this.op=e,this.ft=null}static create(t,e){return new Mi(t,e)}matches(t){return Li(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ft||(this.ft=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.dt((t=>t.isInequality()));return null!==t?t.field:null}dt(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function Li(t){return"and"===t.op}function Oi(t){return"or"===t.op}function Fi(t){return Vi(t)&&Li(t)}function Vi(t){for(const e of t.filters)if(e instanceof Mi)return!1;return!0}function Pi(t){if(t instanceof Ri)return t.field.canonicalString()+t.op.toString()+mi(t.value);if(Fi(t))return t.filters.map((t=>Pi(t))).join(",");{const e=t.filters.map((t=>Pi(t))).join(",");return`${t.op}(${e})`}}function Ui(t,e){return t instanceof Ri?function(t,e){return e instanceof Ri&&t.op===e.op&&t.field.isEqual(e.field)&&hi(t.value,e.value)}(t,e):t instanceof Mi?function(t,e){return e instanceof Mi&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,s)=>t&&Ui(n,e.filters[s])),!0)}(t,e):void Us()}function qi(t,e){const n=t.filters.concat(e);return Mi.create(n,t.op)}function Bi(t){return t instanceof Ri?function(t){return`${t.field.canonicalString()} ${t.op} ${mi(t.value)}`}(t):t instanceof Mi?function(t){return t.op.toString()+" {"+t.getFilters().map(Bi).join(" ,")+"}"}(t):"Filter"}class Ki extends Ri{constructor(t,e,n){super(t,e,n),this.key=dr.fromName(n.referenceValue)}matches(t){const e=dr.comparator(t.key,this.key);return this.matchesComparison(e)}}class Gi extends Ri{constructor(t,e){super(t,"in",e),this.keys=$i("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class ji extends Ri{constructor(t,e){super(t,"not-in",e),this.keys=$i("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function $i(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>dr.fromName(t.referenceValue)))}class Qi extends Ri{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return wi(e)&&li(e.arrayValue,this.value)}}class zi extends Ri{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&li(this.value.arrayValue,e)}}class Hi extends Ri{constructor(t,e){super(t,"not-in",e)}matches(t){if(li(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!li(this.value.arrayValue,e)}}class Wi extends Ri{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!wi(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>li(this.value.arrayValue,t)))}}class Xi{constructor(t,e="asc"){this.field=t,this.dir=e}}function Yi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Ji{constructor(t,e){this.comparator=t,this.root=e||to.EMPTY}insert(t,e){return new Ji(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,to.BLACK,null,null))}remove(t){return new Ji(this.comparator,this.root.remove(t,this.comparator).copy(null,null,to.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Zi(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Zi(this.root,t,this.comparator,!1)}getReverseIterator(){return new Zi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Zi(this.root,t,this.comparator,!0)}}class Zi{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&s&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class to{constructor(t,e,n,s,r){this.key=t,this.value=e,this.color=null!=n?n:to.RED,this.left=null!=s?s:to.EMPTY,this.right=null!=r?r:to.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,r){return new to(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const r=n(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===r?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return to.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return to.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,to.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,to.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Us();if(this.right.isRed())throw Us();const t=this.left.check();if(t!==this.right.check())throw Us();return t+(this.isRed()?0:1)}}to.EMPTY=null,to.RED=!0,to.BLACK=!1,to.EMPTY=new class{constructor(){this.size=0}get key(){throw Us()}get value(){throw Us()}get color(){throw Us()}get left(){throw Us()}get right(){throw Us()}copy(t,e,n,s,r){return this}insert(t,e,n){return new to(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class eo{constructor(t){this.comparator=t,this.data=new Ji(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new no(this.data.getIterator())}getIteratorFrom(t){return new no(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof eo))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new eo(this.comparator);return e.data=t,e}}class no{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function so(t){return t.hasNext()?t.getNext():void 0}class ro{constructor(t){this.fields=t,t.sort(lr.comparator)}static empty(){return new ro([])}unionWith(t){let e=new eo(lr.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new ro(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return rr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class io{constructor(t){this.value=t}static empty(){return new io({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ti(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=bi(e)}setAll(t){let e=lr.emptyPath(),n={},s=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=r.popLast()}t?n[r.lastSegment()]=bi(t):s.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,s)}delete(t){const e=this.field(t.popLast());Ti(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return hi(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Ti(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Qr(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new io(bi(this.value))}}function oo(t){const e=[];return Qr(t.fields,((t,n)=>{const s=new lr([t]);if(Ti(n)){const t=oo(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new ro(e)}class ao{constructor(t,e,n,s,r,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=o}static newInvalidDocument(t){return new ao(t,0,ar.min(),ar.min(),ar.min(),io.empty(),0)}static newFoundDocument(t,e,n,s){return new ao(t,1,e,ar.min(),n,s,0)}static newNoDocument(t,e){return new ao(t,2,e,ar.min(),ar.min(),io.empty(),0)}static newUnknownDocument(t,e){return new ao(t,3,e,ar.min(),ar.min(),io.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ar.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=io.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=io.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ar.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ao&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ao(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class uo{constructor(t,e=null,n=[],s=[],r=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this._t=null}}function co(t,e=null,n=[],s=[],r=null,i=null,o=null){return new uo(t,e,n,s,r,i,o)}function ho(t){const e=Ks(t);if(null===e._t){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Pi(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Hr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>mi(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>mi(t))).join(",")),e._t=t}return e._t}function lo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Yi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Ui(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ni(t.startAt,e.startAt)&&Ni(t.endAt,e.endAt)}function fo(t){return dr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function mo(t,e){return t.filters.filter((t=>t instanceof Ri&&t.field.isEqual(e)))}function go(t,e,n){let s=ui,r=!0;for(const n of mo(t,e)){let t=ui,e=!0;switch(n.op){case"<":case"<=":t=Si(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=ui}Ai({value:s,inclusive:r},{value:t,inclusive:e})<0&&(s=t,r=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];Ai({value:s,inclusive:r},{value:t,inclusive:n.inclusive})<0&&(s=t,r=n.inclusive);break}return{value:s,inclusive:r}}function po(t,e,n){let s=ai,r=!0;for(const n of mo(t,e)){let t=ai,e=!0;switch(n.op){case">=":case">":t=_i(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=ai}xi({value:s,inclusive:r},{value:t,inclusive:e})>0&&(s=t,r=e)}if(null!==n)for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const t=n.position[i];xi({value:s,inclusive:r},{value:t,inclusive:n.inclusive})>0&&(s=t,r=n.inclusive);break}return{value:s,inclusive:r}}class yo{constructor(t,e=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.wt=null,this.gt=null,this.startAt,this.endAt}}function wo(t,e,n,s,r,i,o,a){return new yo(t,e,n,s,r,i,o,a)}function vo(t){return new yo(t)}function Io(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function To(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function bo(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Eo(t){return null!==t.collectionGroup}function So(t){const e=Ks(t);if(null===e.wt){e.wt=[];const t=bo(e),n=To(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new Xi(t)),e.wt.push(new Xi(lr.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Xi(lr.keyField(),t))}}}return e.wt}function _o(t){const e=Ks(t);if(!e.gt)if("F"===e.limitType)e.gt=co(e.path,e.collectionGroup,So(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of So(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Xi(n.field,e))}const n=e.endAt?new Di(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new Di(e.startAt.position,e.startAt.inclusive):null;e.gt=co(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.gt}function Ao(t,e){e.getFirstInequalityField(),bo(t);const n=t.filters.concat([e]);return new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function xo(t,e,n){return new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Do(t,e){return lo(_o(t),_o(e))&&t.limitType===e.limitType}function Co(t){return`${ho(_o(t))}|lt:${t.limitType}`}function No(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Bi(t))).join(", ")}]`),Hr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>mi(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>mi(t))).join(",")),`Target(${e})`}(_o(t))}; limitType=${t.limitType})`}function ko(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):dr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of So(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=Ci(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,So(t),e))&&!(t.endAt&&!function(t,e,n){const s=Ci(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,So(t),e))}(t,e)}function Ro(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Mo(t){return(e,n)=>{let s=!1;for(const r of So(t)){const t=Lo(r,e,n);if(0!==t)return t;s=s||r.field.isKeyField()}return 0}}function Lo(t,e,n){const s=t.field.isKeyField()?dr.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),r=n.data.field(t);return null!==s&&null!==r?di(s,r):Us()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Us()}}function Oo(t,e){if(t.yt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wr(e)?"-0":e}}function Fo(t){return{integerValue:""+t}}function Vo(t,e){return Xr(e)?Fo(e):Oo(t,e)}class Po{constructor(){this._=void 0}}function Uo(t,e,n){return t instanceof Ko?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Go?jo(t,e):t instanceof $o?Qo(t,e):function(t,e){const n=Bo(t,e),s=Ho(n)+Ho(t.It);return yi(n)&&yi(t.It)?Fo(s):Oo(t.Tt,s)}(t,e)}function qo(t,e,n){return t instanceof Go?jo(t,e):t instanceof $o?Qo(t,e):n}function Bo(t,e){return t instanceof zo?yi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Ko extends Po{}class Go extends Po{constructor(t){super(),this.elements=t}}function jo(t,e){const n=Wo(e);for(const e of t.elements)n.some((t=>hi(t,e)))||n.push(e);return{arrayValue:{values:n}}}class $o extends Po{constructor(t){super(),this.elements=t}}function Qo(t,e){let n=Wo(e);for(const e of t.elements)n=n.filter((t=>!hi(t,e)));return{arrayValue:{values:n}}}class zo extends Po{constructor(t,e){super(),this.Tt=t,this.It=e}}function Ho(t){return ni(t.integerValue||t.doubleValue)}function Wo(t){return wi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Xo{constructor(t,e){this.field=t,this.transform=e}}class Yo{constructor(t,e){this.version=t,this.transformResults=e}}class Jo{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Jo}static exists(t){return new Jo(void 0,t)}static updateTime(t){return new Jo(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Zo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ta{}function ea(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new la(t.key,Jo.none()):new oa(t.key,t.data,Jo.none());{const n=t.data,s=io.empty();let r=new eo(lr.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),r=r.add(t)}return new aa(t.key,s,new ro(r.toArray()),Jo.none())}}function na(t,e,n){t instanceof oa?function(t,e,n){const s=t.value.clone(),r=ca(t.fieldTransforms,e,n.transformResults);s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof aa?function(t,e,n){if(!Zo(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=ca(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(ua(t)),r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function sa(t,e,n,s){return t instanceof oa?function(t,e,n,s){if(!Zo(t.precondition,e))return n;const r=t.value.clone(),i=ha(t.fieldTransforms,s,e);return r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,s):t instanceof aa?function(t,e,n,s){if(!Zo(t.precondition,e))return n;const r=ha(t.fieldTransforms,s,e),i=e.data;return i.setAll(ua(t)),i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){return Zo(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function ra(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),r=Bo(s.transform,t||null);null!=r&&(null===n&&(n=io.empty()),n.set(s.field,r))}return n||null}function ia(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&rr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Go&&e instanceof Go||t instanceof $o&&e instanceof $o?rr(t.elements,e.elements,hi):t instanceof zo&&e instanceof zo?hi(t.It,e.It):t instanceof Ko&&e instanceof Ko}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class oa extends ta{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class aa extends ta{constructor(t,e,n,s,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function ua(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function ca(t,e,n){const s=new Map;qs(t.length===n.length);for(let r=0;r<n.length;r++){const i=t[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,qo(o,a,n[r]))}return s}function ha(t,e,n){const s=new Map;for(const r of t){const t=r.transform,i=n.data.field(r.field);s.set(r.field,Uo(t,i,e))}return s}class la extends ta{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class da extends ta{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class fa{constructor(t){this.count=t}}var ma,ga;function pa(t){switch(t){default:return Us();case Gs.CANCELLED:case Gs.UNKNOWN:case Gs.DEADLINE_EXCEEDED:case Gs.RESOURCE_EXHAUSTED:case Gs.INTERNAL:case Gs.UNAVAILABLE:case Gs.UNAUTHENTICATED:return!1;case Gs.INVALID_ARGUMENT:case Gs.NOT_FOUND:case Gs.ALREADY_EXISTS:case Gs.PERMISSION_DENIED:case Gs.FAILED_PRECONDITION:case Gs.ABORTED:case Gs.OUT_OF_RANGE:case Gs.UNIMPLEMENTED:case Gs.DATA_LOSS:return!0}}function ya(t){if(void 0===t)return Fs("GRPC error has no .code"),Gs.UNKNOWN;switch(t){case ma.OK:return Gs.OK;case ma.CANCELLED:return Gs.CANCELLED;case ma.UNKNOWN:return Gs.UNKNOWN;case ma.DEADLINE_EXCEEDED:return Gs.DEADLINE_EXCEEDED;case ma.RESOURCE_EXHAUSTED:return Gs.RESOURCE_EXHAUSTED;case ma.INTERNAL:return Gs.INTERNAL;case ma.UNAVAILABLE:return Gs.UNAVAILABLE;case ma.UNAUTHENTICATED:return Gs.UNAUTHENTICATED;case ma.INVALID_ARGUMENT:return Gs.INVALID_ARGUMENT;case ma.NOT_FOUND:return Gs.NOT_FOUND;case ma.ALREADY_EXISTS:return Gs.ALREADY_EXISTS;case ma.PERMISSION_DENIED:return Gs.PERMISSION_DENIED;case ma.FAILED_PRECONDITION:return Gs.FAILED_PRECONDITION;case ma.ABORTED:return Gs.ABORTED;case ma.OUT_OF_RANGE:return Gs.OUT_OF_RANGE;case ma.UNIMPLEMENTED:return Gs.UNIMPLEMENTED;case ma.DATA_LOSS:return Gs.DATA_LOSS;default:return Us()}}(ga=ma||(ma={}))[ga.OK=0]="OK",ga[ga.CANCELLED=1]="CANCELLED",ga[ga.UNKNOWN=2]="UNKNOWN",ga[ga.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ga[ga.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ga[ga.NOT_FOUND=5]="NOT_FOUND",ga[ga.ALREADY_EXISTS=6]="ALREADY_EXISTS",ga[ga.PERMISSION_DENIED=7]="PERMISSION_DENIED",ga[ga.UNAUTHENTICATED=16]="UNAUTHENTICATED",ga[ga.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ga[ga.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ga[ga.ABORTED=10]="ABORTED",ga[ga.OUT_OF_RANGE=11]="OUT_OF_RANGE",ga[ga.UNIMPLEMENTED=12]="UNIMPLEMENTED",ga[ga.INTERNAL=13]="INTERNAL",ga[ga.UNAVAILABLE=14]="UNAVAILABLE",ga[ga.DATA_LOSS=15]="DATA_LOSS";class wa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Qr(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return zr(this.inner)}size(){return this.innerSize}}const va=new Ji(dr.comparator);function Ia(){return va}const Ta=new Ji(dr.comparator);function ba(...t){let e=Ta;for(const n of t)e=e.insert(n.key,n);return e}function Ea(t){let e=Ta;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Sa(){return Aa()}function _a(){return Aa()}function Aa(){return new wa((t=>t.toString()),((t,e)=>t.isEqual(e)))}const xa=new Ji(dr.comparator),Da=new eo(dr.comparator);function Ca(...t){let e=Da;for(const n of t)e=e.add(n);return e}const Na=new eo(sr);function ka(){return Na}class Ra{constructor(t,e,n,s,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Ma.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Ra(ar.min(),s,ka(),Ia(),Ca())}}class Ma{constructor(t,e,n,s,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Ma(n,e,Ca(),Ca(),Ca())}}class La{constructor(t,e,n,s){this.Et=t,this.removedTargetIds=e,this.key=n,this.At=s}}class Oa{constructor(t,e){this.targetId=t,this.Rt=e}}class Fa{constructor(t,e,n=Zr.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Va{constructor(){this.bt=0,this.vt=qa(),this.Pt=Zr.EMPTY_BYTE_STRING,this.Vt=!1,this.St=!0}get current(){return this.Vt}get resumeToken(){return this.Pt}get Dt(){return 0!==this.bt}get Ct(){return this.St}xt(t){t.approximateByteSize()>0&&(this.St=!0,this.Pt=t)}Nt(){let t=Ca(),e=Ca(),n=Ca();return this.vt.forEach(((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Us()}})),new Ma(this.Pt,this.Vt,t,e,n)}kt(){this.St=!1,this.vt=qa()}Ot(t,e){this.St=!0,this.vt=this.vt.insert(t,e)}Mt(t){this.St=!0,this.vt=this.vt.remove(t)}Ft(){this.bt+=1}$t(){this.bt-=1}Bt(){this.St=!0,this.Vt=!0}}class Pa{constructor(t){this.Lt=t,this.qt=new Map,this.Ut=Ia(),this.Kt=Ua(),this.Gt=new eo(sr)}Qt(t){for(const e of t.Et)t.At&&t.At.isFoundDocument()?this.jt(e,t.At):this.zt(e,t.key,t.At);for(const e of t.removedTargetIds)this.zt(e,t.key,t.At)}Wt(t){this.forEachTarget(t,(e=>{const n=this.Ht(e);switch(t.state){case 0:this.Jt(e)&&n.xt(t.resumeToken);break;case 1:n.$t(),n.Dt||n.kt(),n.xt(t.resumeToken);break;case 2:n.$t(),n.Dt||this.removeTarget(e);break;case 3:this.Jt(e)&&(n.Bt(),n.xt(t.resumeToken));break;case 4:this.Jt(e)&&(this.Yt(e),n.xt(t.resumeToken));break;default:Us()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.qt.forEach(((t,n)=>{this.Jt(n)&&e(n)}))}Zt(t){const e=t.targetId,n=t.Rt.count,s=this.Xt(e);if(s){const t=s.target;if(fo(t))if(0===n){const n=new dr(t.path);this.zt(e,n,ao.newNoDocument(n,ar.min()))}else qs(1===n);else this.te(e)!==n&&(this.Yt(e),this.Gt=this.Gt.add(e))}}ee(t){const e=new Map;this.qt.forEach(((n,s)=>{const r=this.Xt(s);if(r){if(n.current&&fo(r.target)){const e=new dr(r.target.path);null!==this.Ut.get(e)||this.ne(s,e)||this.zt(s,e,ao.newNoDocument(e,t))}n.Ct&&(e.set(s,n.Nt()),n.kt())}}));let n=Ca();this.Kt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.Xt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.Ut.forEach(((e,n)=>n.setReadTime(t)));const s=new Ra(t,e,this.Gt,this.Ut,n);return this.Ut=Ia(),this.Kt=Ua(),this.Gt=new eo(sr),s}jt(t,e){if(!this.Jt(t))return;const n=this.ne(t,e.key)?2:0;this.Ht(t).Ot(e.key,n),this.Ut=this.Ut.insert(e.key,e),this.Kt=this.Kt.insert(e.key,this.se(e.key).add(t))}zt(t,e,n){if(!this.Jt(t))return;const s=this.Ht(t);this.ne(t,e)?s.Ot(e,1):s.Mt(e),this.Kt=this.Kt.insert(e,this.se(e).delete(t)),n&&(this.Ut=this.Ut.insert(e,n))}removeTarget(t){this.qt.delete(t)}te(t){const e=this.Ht(t).Nt();return this.Lt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ft(t){this.Ht(t).Ft()}Ht(t){let e=this.qt.get(t);return e||(e=new Va,this.qt.set(t,e)),e}se(t){let e=this.Kt.get(t);return e||(e=new eo(sr),this.Kt=this.Kt.insert(t,e)),e}Jt(t){const e=null!==this.Xt(t);return e||Os("WatchChangeAggregator","Detected inactive target",t),e}Xt(t){const e=this.qt.get(t);return e&&e.Dt?null:this.Lt.ie(t)}Yt(t){this.qt.set(t,new Va),this.Lt.getRemoteKeysForTarget(t).forEach((e=>{this.zt(t,e,null)}))}ne(t,e){return this.Lt.getRemoteKeysForTarget(t).has(e)}}function Ua(){return new Ji(dr.comparator)}function qa(){return new Ji(dr.comparator)}const Ba={asc:"ASCENDING",desc:"DESCENDING"},Ka={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ga={and:"AND",or:"OR"};class ja{constructor(t,e){this.databaseId=t,this.yt=e}}function $a(t,e){return t.yt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Qa(t,e){return t.yt?e.toBase64():e.toUint8Array()}function za(t,e){return $a(t,e.toTimestamp())}function Ha(t){return qs(!!t),ar.fromTimestamp(function(t){const e=ei(t);return new or(e.seconds,e.nanos)}(t))}function Wa(t,e){return function(t){return new cr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Xa(t){const e=cr.fromString(t);return qs(wu(e)),e}function Ya(t,e){return Wa(t.databaseId,e.path)}function Ja(t,e){const n=Xa(e);if(n.get(1)!==t.databaseId.projectId)throw new js(Gs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new js(Gs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new dr(nu(n))}function Za(t,e){return Wa(t.databaseId,e)}function tu(t){const e=Xa(t);return 4===e.length?cr.emptyPath():nu(e)}function eu(t){return new cr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function nu(t){return qs(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function su(t,e,n){return{name:Ya(t,e),fields:n.value.mapValue.fields}}function ru(t,e,n){const s=Ja(t,e.name),r=Ha(e.updateTime),i=e.createTime?Ha(e.createTime):ar.min(),o=new io({mapValue:{fields:e.fields}}),a=ao.newFoundDocument(s,r,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function iu(t,e){let n;if(e instanceof oa)n={update:su(t,e.key,e.value)};else if(e instanceof la)n={delete:Ya(t,e.key)};else if(e instanceof aa)n={update:su(t,e.key,e.data),updateMask:yu(e.fieldMask)};else{if(!(e instanceof da))return Us();n={verify:Ya(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ko)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Go)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof $o)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof zo)return{fieldPath:e.field.canonicalString(),increment:n.It};throw Us()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:za(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Us()}(t,e.precondition)),n}function ou(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Jo.updateTime(Ha(t.updateTime)):void 0!==t.exists?Jo.exists(t.exists):Jo.none()}(e.currentDocument):Jo.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)qs("REQUEST_TIME"===e.setToServerValue),n=new Ko;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Go(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new $o(t)}else"increment"in e?n=new zo(t,e.increment):Us();const s=lr.fromServerFormat(e.fieldPath);return new Xo(s,n)}(t,e))):[];if(e.update){e.update.name;const r=Ja(t,e.update.name),i=new io({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new ro(e.map((t=>lr.fromServerFormat(t))))}(e.updateMask);return new aa(r,i,t,n,s)}return new oa(r,i,n,s)}if(e.delete){const s=Ja(t,e.delete);return new la(s,n)}if(e.verify){const s=Ja(t,e.verify);return new da(s,n)}return Us()}function au(t,e){return{documents:[Za(t,e.path)]}}function uu(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=Za(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Za(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const r=function(t){if(0!==t.length)return pu(Mi.create(t,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:mu(t.field),direction:lu(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.yt||Hr(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function cu(t){let e=tu(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){qs(1===s);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=hu(t);return e instanceof Mi&&Fi(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Xi(gu(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Hr(e)?null:e}(n.limit));let u=null;n.startAt&&(u=function(t){const e=!!t.before,n=t.values||[];return new Di(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new Di(n,e)}(n.endAt)),wo(e,r,o,i,a,"F",u,c)}function hu(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=gu(t.unaryFilter.field);return Ri.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=gu(t.unaryFilter.field);return Ri.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=gu(t.unaryFilter.field);return Ri.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=gu(t.unaryFilter.field);return Ri.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Us()}}(t):void 0!==t.fieldFilter?function(t){return Ri.create(gu(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Us()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Mi.create(t.compositeFilter.filters.map((t=>hu(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Us()}}(t.compositeFilter.op))}(t):Us()}function lu(t){return Ba[t]}function du(t){return Ka[t]}function fu(t){return Ga[t]}function mu(t){return{fieldPath:t.canonicalString()}}function gu(t){return lr.fromServerFormat(t.fieldPath)}function pu(t){return t instanceof Ri?function(t){if("=="===t.op){if(Ii(t.value))return{unaryFilter:{field:mu(t.field),op:"IS_NAN"}};if(vi(t.value))return{unaryFilter:{field:mu(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ii(t.value))return{unaryFilter:{field:mu(t.field),op:"IS_NOT_NAN"}};if(vi(t.value))return{unaryFilter:{field:mu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mu(t.field),op:du(t.op),value:t.value}}}(t):t instanceof Mi?function(t){const e=t.getFilters().map((t=>pu(t)));return 1===e.length?e[0]:{compositeFilter:{op:fu(t.op),filters:e}}}(t):Us()}function yu(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function wu(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function vu(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Tu(e)),e=Iu(t.get(n),e);return Tu(e)}function Iu(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function Tu(t){return t+""}function bu(t){const e=t.length;if(qs(e>=2),2===e)return qs(""===t.charAt(0)&&""===t.charAt(1)),cr.emptyPath();const n=e-2,s=[];let r="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&Us(),t.charAt(e+1)){case"":const n=t.substring(i,e);let o;0===r.length?o=n:(r+=n,o=r,r=""),s.push(o);break;case"":r+=t.substring(i,e),r+="\0";break;case"":r+=t.substring(i,e+1);break;default:Us()}i=e+2}return new cr(s)}const Eu=["userId","batchId"];function Su(t,e){return[t,vu(e)]}function _u(t,e,n){return[t,vu(e),n]}const Au={},xu=["prefixPath","collectionGroup","readTime","documentId"],Du=["prefixPath","collectionGroup","documentId"],Cu=["collectionGroup","readTime","prefixPath","documentId"],Nu=["canonicalId","targetId"],ku=["targetId","path"],Ru=["path","targetId"],Mu=["collectionId","parent"],Lu=["indexId","uid"],Ou=["uid","sequenceNumber"],Fu=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Vu=["indexId","uid","orderedDocumentKey"],Pu=["userId","collectionPath","documentId"],Uu=["userId","collectionPath","largestBatchId"],qu=["userId","collectionGroup","largestBatchId"],Bu=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ku=[...Bu,"documentOverlays"],Gu=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ju=Gu,$u=[...ju,"indexConfiguration","indexState","indexEntries"];class Qu extends _r{constructor(t,e){super(),this.re=t,this.currentSequenceNumber=e}}function zu(t,e){const n=Ks(t);return Cr.M(n.re,e)}class Hu{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&na(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=sa(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=sa(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=_a();return this.mutations.forEach((s=>{const r=t.get(s.key),i=r.overlayedDocument;let o=this.applyToLocalView(i,r.mutatedFields);o=e.has(s.key)?null:o;const a=ea(i,o);null!==a&&n.set(s.key,a),i.isValidDocument()||i.convertToNoDocument(ar.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Ca())}isEqual(t){return this.batchId===t.batchId&&rr(this.mutations,t.mutations,((t,e)=>ia(t,e)))&&rr(this.baseMutations,t.baseMutations,((t,e)=>ia(t,e)))}}class Wu{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){qs(t.mutations.length===n.length);let s=xa;const r=t.mutations;for(let t=0;t<r.length;t++)s=s.insert(r[t].key,n[t].version);return new Wu(t,e,n,s)}}class Xu{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Yu{constructor(t,e,n,s,r=ar.min(),i=ar.min(),o=Zr.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new Yu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Yu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Yu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Ju{constructor(t){this.oe=t}}function Zu(t,e){const n=e.key,s={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:tc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(t,e){return{name:Ya(t,e.key),fields:e.data.value.mapValue.fields,updateTime:$a(t,e.version.toTimestamp()),createTime:$a(t,e.createTime.toTimestamp())}}(t.oe,e);else if(e.isNoDocument())s.noDocument={path:n.path.toArray(),readTime:ec(e.version)};else{if(!e.isUnknownDocument())return Us();s.unknownDocument={path:n.path.toArray(),version:ec(e.version)}}return s}function tc(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ec(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function nc(t){const e=new or(t.seconds,t.nanoseconds);return ar.fromTimestamp(e)}function sc(t,e){const n=(e.baseMutations||[]).map((e=>ou(t.oe,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>ou(t.oe,e))),r=or.fromMillis(e.localWriteTimeMs);return new Hu(e.batchId,r,n,s)}function rc(t){const e=nc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?nc(t.lastLimboFreeSnapshotVersion):ar.min();let s;var r;return void 0!==t.query.documents?(qs(1===(r=t.query).documents.length),s=_o(vo(tu(r.documents[0])))):s=function(t){return _o(cu(t))}(t.query),new Yu(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Zr.fromBase64String(t.resumeToken))}function ic(t,e){const n=ec(e.snapshotVersion),s=ec(e.lastLimboFreeSnapshotVersion);let r;r=fo(e.target)?au(t.oe,e.target):uu(t.oe,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ho(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function oc(t){const e=cu({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?xo(e,e.limit,"L"):e}function ac(t,e){return new Xu(e.largestBatchId,ou(t.oe,e.overlayMutation))}function uc(t,e){const n=e.path.lastSegment();return[t,vu(e.path.popLast()),n]}function cc(t,e,n,s){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:ec(s.readTime),documentKey:vu(s.documentKey.path),largestBatchId:s.largestBatchId}}class hc{getBundleMetadata(t,e){return lc(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:nc(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return lc(t).put({bundleId:(n=e).id,createTime:ec(Ha(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return dc(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:oc(e.bundledQuery),readTime:nc(e.readTime)};var e}))}saveNamedQuery(t,e){return dc(t).put(function(t){return{name:t.name,readTime:ec(Ha(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function lc(t){return zu(t,"bundles")}function dc(t){return zu(t,"namedQueries")}class fc{constructor(t,e){this.Tt=t,this.userId=e}static ue(t,e){const n=e.uid||"";return new fc(t,n)}getOverlay(t,e){return mc(t).get(uc(this.userId,e)).next((t=>t?ac(this.Tt,t):null))}getOverlays(t,e){const n=Sa();return xr.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const s=[];return n.forEach(((n,r)=>{const i=new Xu(e,r);s.push(this.ce(t,i))})),xr.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((t=>s.add(vu(t.getCollectionPath()))));const r=[];return s.forEach((e=>{const s=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);r.push(mc(t).Y("collectionPathOverlayIndex",s))})),xr.waitFor(r)}getOverlaysForCollection(t,e,n){const s=Sa(),r=vu(e),i=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return mc(t).W("collectionPathOverlayIndex",i).next((t=>{for(const e of t){const t=ac(this.Tt,e);s.set(t.getKey(),t)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const r=Sa();let i;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return mc(t).X({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=ac(this.Tt,e);r.size()<s||o.largestBatchId===i?(r.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>r))}ce(t,e){return mc(t).put(function(t,e,n){const[s,r,i]=uc(e,n.mutation.key);return{userId:e,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:iu(t.oe,n.mutation)}}(this.Tt,this.userId,e))}}function mc(t){return zu(t,"documentOverlays")}class gc{constructor(){}ae(t,e){this.he(t,e),e.le()}he(t,e){if("nullValue"in t)this.fe(e,5);else if("booleanValue"in t)this.fe(e,10),e.de(t.booleanValue?1:0);else if("integerValue"in t)this.fe(e,15),e.de(ni(t.integerValue));else if("doubleValue"in t){const n=ni(t.doubleValue);isNaN(n)?this.fe(e,13):(this.fe(e,15),Wr(n)?e.de(0):e.de(n))}else if("timestampValue"in t){const n=t.timestampValue;this.fe(e,20),"string"==typeof n?e._e(n):(e._e(`${n.seconds||""}`),e.de(n.nanos||0))}else if("stringValue"in t)this.we(t.stringValue,e),this.me(e);else if("bytesValue"in t)this.fe(e,30),e.ge(si(t.bytesValue)),this.me(e);else if("referenceValue"in t)this.ye(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.fe(e,45),e.de(n.latitude||0),e.de(n.longitude||0)}else"mapValue"in t?Ei(t)?this.fe(e,Number.MAX_SAFE_INTEGER):(this.pe(t.mapValue,e),this.me(e)):"arrayValue"in t?(this.Ie(t.arrayValue,e),this.me(e)):Us()}we(t,e){this.fe(e,25),this.Te(t,e)}Te(t,e){e._e(t)}pe(t,e){const n=t.fields||{};this.fe(e,55);for(const t of Object.keys(n))this.we(t,e),this.he(n[t],e)}Ie(t,e){const n=t.values||[];this.fe(e,50);for(const t of n)this.he(t,e)}ye(t,e){this.fe(e,37),dr.fromName(t).path.forEach((t=>{this.fe(e,60),this.Te(t,e)}))}fe(t,e){t.de(e)}me(t){t.de(2)}}function pc(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function yc(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const s=pc(255&t[n]);if(e+=s,8!==s)break}return e}(t);return Math.ceil(e/8)}gc.Ee=new gc;class wc{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ae(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Re(n.value),n=e.next();this.be()}ve(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Pe(n.value),n=e.next();this.Ve()}Se(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Re(t);else if(t<2048)this.Re(960|t>>>6),this.Re(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Re(480|t>>>12),this.Re(128|63&t>>>6),this.Re(128|63&t);else{const t=e.codePointAt(0);this.Re(240|t>>>18),this.Re(128|63&t>>>12),this.Re(128|63&t>>>6),this.Re(128|63&t)}}this.be()}De(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Pe(t);else if(t<2048)this.Pe(960|t>>>6),this.Pe(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Pe(480|t>>>12),this.Pe(128|63&t>>>6),this.Pe(128|63&t);else{const t=e.codePointAt(0);this.Pe(240|t>>>18),this.Pe(128|63&t>>>12),this.Pe(128|63&t>>>6),this.Pe(128|63&t)}}this.Ve()}Ce(t){const e=this.xe(t),n=yc(e);this.Ne(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}ke(t){const e=this.xe(t),n=yc(e);this.Ne(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}Oe(){this.Me(255),this.Me(255)}Fe(){this.$e(255),this.$e(255)}reset(){this.position=0}seed(t){this.Ne(t.length),this.buffer.set(t,this.position),this.position+=t.length}Be(){return this.buffer.slice(0,this.position)}xe(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}Re(t){const e=255&t;0===e?(this.Me(0),this.Me(255)):255===e?(this.Me(255),this.Me(0)):this.Me(e)}Pe(t){const e=255&t;0===e?(this.$e(0),this.$e(255)):255===e?(this.$e(255),this.$e(0)):this.$e(t)}be(){this.Me(0),this.Me(1)}Ve(){this.$e(0),this.$e(1)}Me(t){this.Ne(1),this.buffer[this.position++]=t}$e(t){this.Ne(1),this.buffer[this.position++]=~t}Ne(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class vc{constructor(t){this.Le=t}ge(t){this.Le.Ae(t)}_e(t){this.Le.Se(t)}de(t){this.Le.Ce(t)}le(){this.Le.Oe()}}class Ic{constructor(t){this.Le=t}ge(t){this.Le.ve(t)}_e(t){this.Le.De(t)}de(t){this.Le.ke(t)}le(){this.Le.Fe()}}class Tc{constructor(){this.Le=new wc,this.qe=new vc(this.Le),this.Ue=new Ic(this.Le)}seed(t){this.Le.seed(t)}Ke(t){return 0===t?this.qe:this.Ue}Be(){return this.Le.Be()}reset(){this.Le.reset()}}class bc{constructor(t,e,n,s){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=s}Ge(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new bc(this.indexId,this.documentKey,this.arrayValue,n)}}function Ec(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=Sc(t.arrayValue,e.arrayValue),0!==n?n:(n=Sc(t.directionalValue,e.directionalValue),0!==n?n:dr.comparator(t.documentKey,e.documentKey)))}function Sc(t,e){for(let n=0;n<t.length&&n<e.length;++n){const s=t[n]-e[n];if(0!==s)return s}return t.length-e.length}class _c{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Qe=t.orderBy,this.je=[];for(const e of t.filters){const t=e;t.isInequality()?this.ze=t:this.je.push(t)}}We(t){qs(t.collectionGroup===this.collectionId);const e=mr(t);if(void 0!==e&&!this.He(e))return!1;const n=gr(t);let s=0,r=0;for(;s<n.length&&this.He(n[s]);++s);if(s===n.length)return!0;if(void 0!==this.ze){const t=n[s];if(!this.Je(this.ze,t)||!this.Ye(this.Qe[r++],t))return!1;++s}for(;s<n.length;++s){const t=n[s];if(r>=this.Qe.length||!this.Ye(this.Qe[r++],t))return!1}return!0}He(t){for(const e of this.je)if(this.Je(e,t))return!0;return!1}Je(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}Ye(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}function Ac(t){var e,n;if(qs(t instanceof Ri||t instanceof Mi),t instanceof Ri){if(t instanceof zi){const s=(null===(n=null===(e=t.value.arrayValue)||void 0===e?void 0:e.values)||void 0===n?void 0:n.map((e=>Ri.create(t.field,"==",e))))||[];return Mi.create(s,"or")}return t}const s=t.filters.map((t=>Ac(t)));return Mi.create(s,t.op)}function xc(t){if(0===t.getFilters().length)return[];const e=kc(Ac(t));return qs(Nc(e)),Dc(e)||Cc(e)?[e]:e.getFilters()}function Dc(t){return t instanceof Ri}function Cc(t){return t instanceof Mi&&Fi(t)}function Nc(t){return Dc(t)||Cc(t)||function(t){if(t instanceof Mi&&Oi(t)){for(const e of t.getFilters())if(!Dc(e)&&!Cc(e))return!1;return!0}return!1}(t)}function kc(t){if(qs(t instanceof Ri||t instanceof Mi),t instanceof Ri)return t;if(1===t.filters.length)return kc(t.filters[0]);const e=t.filters.map((t=>kc(t)));let n=Mi.create(e,t.op);return n=Lc(n),Nc(n)?n:(qs(n instanceof Mi),qs(Li(n)),qs(n.filters.length>1),n.filters.reduce(((t,e)=>Rc(t,e))))}function Rc(t,e){let n;return qs(t instanceof Ri||t instanceof Mi),qs(e instanceof Ri||e instanceof Mi),n=t instanceof Ri?e instanceof Ri?function(t,e){return Mi.create([t,e],"and")}(t,e):Mc(t,e):e instanceof Ri?Mc(e,t):function(t,e){if(qs(t.filters.length>0&&e.filters.length>0),Li(t)&&Li(e))return qi(t,e.getFilters());const n=Oi(t)?t:e,s=Oi(t)?e:t,r=n.filters.map((t=>Rc(t,s)));return Mi.create(r,"or")}(t,e),Lc(n)}function Mc(t,e){if(Li(e))return qi(e,t.getFilters());{const n=e.filters.map((e=>Rc(t,e)));return Mi.create(n,"or")}}function Lc(t){if(qs(t instanceof Ri||t instanceof Mi),t instanceof Ri)return t;const e=t.getFilters();if(1===e.length)return Lc(e[0]);if(Vi(t))return t;const n=e.map((t=>Lc(t))),s=[];return n.forEach((e=>{e instanceof Ri?s.push(e):e instanceof Mi&&(e.op===t.op?s.push(...e.filters):s.push(e))})),1===s.length?s[0]:Mi.create(s,t.op)}class Oc{constructor(){this.Ze=new Fc}addToCollectionParentIndex(t,e){return this.Ze.add(e),xr.resolve()}getCollectionParents(t,e){return xr.resolve(this.Ze.getEntries(e))}addFieldIndex(t,e){return xr.resolve()}deleteFieldIndex(t,e){return xr.resolve()}getDocumentsMatchingTarget(t,e){return xr.resolve(null)}getIndexType(t,e){return xr.resolve(0)}getFieldIndexes(t,e){return xr.resolve([])}getNextCollectionGroupToUpdate(t){return xr.resolve(null)}getMinOffset(t,e){return xr.resolve(br.min())}getMinOffsetFromCollectionGroup(t,e){return xr.resolve(br.min())}updateCollectionGroup(t,e,n){return xr.resolve()}updateIndexEntries(t,e){return xr.resolve()}}class Fc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new eo(cr.comparator),r=!s.has(n);return this.index[e]=s.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new eo(cr.comparator)).toArray()}}const Vc=new Uint8Array(0);class Pc{constructor(t,e){this.user=t,this.databaseId=e,this.Xe=new Fc,this.tn=new wa((t=>ho(t)),((t,e)=>lo(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.Xe.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.Xe.add(e)}));const r={collectionId:n,parent:vu(s)};return Uc(t).put(r)}return xr.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[ir(e),""],!1,!0);return Uc(t).W(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(bu(s.parent))}return n}))}addFieldIndex(t,e){const n=Bc(t),s=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete s.indexId;const r=n.add(s);if(e.indexState){const n=Kc(t);return r.next((t=>{n.put(cc(t,this.user,e.indexState.sequenceNumber,e.indexState.offset))}))}return r.next()}deleteFieldIndex(t,e){const n=Bc(t),s=Kc(t),r=qc(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=qc(t);let s=!0;const r=new Map;return xr.forEach(this.en(e),(e=>this.nn(t,e).next((t=>{s&&(s=!!t),r.set(e,t)})))).next((()=>{if(s){let t=Ca();const s=[];return xr.forEach(r,((r,i)=>{var o;Os("IndexedDbIndexManager",`Using index ${o=r,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${ho(e)}`);const a=function(t,e){const n=mr(e);if(void 0===n)return null;for(const e of mo(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(i,r),u=function(t,e){const n=new Map;for(const s of gr(e))for(const e of mo(t,s.fieldPath))switch(e.op){case"==":case"in":n.set(s.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(s.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(i,r),c=function(t,e){const n=[];let s=!0;for(const r of gr(e)){const e=0===r.kind?go(t,r.fieldPath,t.startAt):po(t,r.fieldPath,t.startAt);n.push(e.value),s&&(s=e.inclusive)}return new Di(n,s)}(i,r),h=function(t,e){const n=[];let s=!0;for(const r of gr(e)){const e=0===r.kind?po(t,r.fieldPath,t.endAt):go(t,r.fieldPath,t.endAt);n.push(e.value),s&&(s=e.inclusive)}return new Di(n,s)}(i,r),l=this.sn(r,i,c),d=this.sn(r,i,h),f=this.rn(r,i,u),m=this.on(r.indexId,a,l,c.inclusive,d,h.inclusive,f);return xr.forEach(m,(r=>n.J(r,e.limit).next((e=>{e.forEach((e=>{const n=dr.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),s.push(n))}))}))))})).next((()=>s))}return xr.resolve(null)}))}en(t){let e=this.tn.get(t);return e||(e=0===t.filters.length?[t]:xc(Mi.create(t.filters,"and")).map((e=>co(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt))),this.tn.set(t,e),e)}on(t,e,n,s,r,i,o){const a=(null!=e?e.length:1)*Math.max(n.length,r.length),u=a/(null!=e?e.length:1),c=[];for(let h=0;h<a;++h){const a=e?this.un(e[h/u]):Vc,l=this.cn(t,a,n[h%u],s),d=this.an(t,a,r[h%u],i),f=o.map((e=>this.cn(t,a,e,!0)));c.push(...this.createRange(l,d,f))}return c}cn(t,e,n,s){const r=new bc(t,dr.empty(),e,n);return s?r:r.Ge()}an(t,e,n,s){const r=new bc(t,dr.empty(),e,n);return s?r.Ge():r}nn(t,e){const n=new _c(e),s=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((t=>{let e=null;for(const s of t)n.We(s)&&(!e||s.fields.length>e.fields.length)&&(e=s);return e}))}getIndexType(t,e){let n=2;const s=this.en(e);return xr.forEach(s,(e=>this.nn(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new eo(lr.comparator),n=!1;for(const s of t.filters)for(const t of s.getFlattenedFilters())t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field));for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>function(t){return null!==t.limit}(e)&&s.length>1&&2===n?1:n))}hn(t,e){const n=new Tc;for(const s of gr(t)){const t=e.data.field(s.fieldPath);if(null==t)return null;const r=n.Ke(s.kind);gc.Ee.ae(t,r)}return n.Be()}un(t){const e=new Tc;return gc.Ee.ae(t,e.Ke(0)),e.Be()}ln(t,e){const n=new Tc;return gc.Ee.ae(pi(this.databaseId,e),n.Ke(function(t){const e=gr(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Be()}rn(t,e,n){if(null===n)return[];let s=[];s.push(new Tc);let r=0;for(const i of gr(t)){const t=n[r++];for(const n of s)if(this.fn(e,i.fieldPath)&&wi(t))s=this.dn(s,i,t);else{const e=n.Ke(i.kind);gc.Ee.ae(t,e)}}return this._n(s)}sn(t,e,n){return this.rn(t,e,n.position)}_n(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Be();return e}dn(t,e,n){const s=[...t],r=[];for(const t of n.arrayValue.values||[])for(const n of s){const s=new Tc;s.seed(n.Be()),gc.Ee.ae(t,s.Ke(e.kind)),r.push(s)}return r}fn(t,e){return!!t.filters.find((t=>t instanceof Ri&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=Bc(t),s=Kc(t);return(e?n.W("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.W()).next((t=>{const e=[];return xr.forEach(t,(t=>s.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new vr(e.sequenceNumber,new br(nc(e.readTime),new dr(bu(e.documentKey)),e.largestBatchId)):vr.empty(),s=t.fields.map((([t,e])=>new yr(lr.fromServerFormat(t),e)));return new fr(t.indexId,t.collectionGroup,s,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:sr(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=Bc(t),r=Kc(t);return this.wn(t).next((t=>s.W("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>xr.forEach(e,(e=>r.put(cc(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return xr.forEach(e,((e,s)=>{const r=n.get(e.collectionGroup);return(r?xr.resolve(r):this.getFieldIndexes(t,e.collectionGroup)).next((r=>(n.set(e.collectionGroup,r),xr.forEach(r,(n=>this.mn(t,e,n).next((e=>{const r=this.gn(s,n);return e.isEqual(r)?xr.resolve():this.yn(t,s,n,e,r)})))))))}))}pn(t,e,n,s){return qc(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.ln(n,e.key),documentKey:e.key.path.toArray()})}In(t,e,n,s){return qc(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.ln(n,e.key),e.key.path.toArray()])}mn(t,e,n){const s=qc(t);let r=new eo(Ec);return s.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.ln(n,e)])},((t,s)=>{r=r.add(new bc(n.indexId,e,s.arrayValue,s.directionalValue))})).next((()=>r))}gn(t,e){let n=new eo(Ec);const s=this.hn(e,t);if(null==s)return n;const r=mr(e);if(null!=r){const i=t.data.field(r.fieldPath);if(wi(i))for(const r of i.arrayValue.values||[])n=n.add(new bc(e.indexId,t.key,this.un(r),s))}else n=n.add(new bc(e.indexId,t.key,Vc,s));return n}yn(t,e,n,s,r){Os("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const i=[];return function(t,e,n,s,r){const i=t.getIterator(),o=e.getIterator();let a=so(i),u=so(o);for(;a||u;){let t=!1,e=!1;if(a&&u){const s=n(a,u);s<0?e=!0:s>0&&(t=!0)}else null!=a?e=!0:t=!0;t?(s(u),u=so(o)):e?(r(a),a=so(i)):(a=so(i),u=so(o))}}(s,r,Ec,(s=>{i.push(this.pn(t,e,n,s))}),(s=>{i.push(this.In(t,e,n,s))})),xr.waitFor(i)}wn(t){let e=1;return Kc(t).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,s)=>{s.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>Ec(t,e))).filter(((t,e,n)=>!e||0!==Ec(t,n[e-1])));const s=[];s.push(t);for(const r of n){const n=Ec(r,t),i=Ec(r,e);if(0===n)s[0]=t.Ge();else if(n>0&&i<0)s.push(r),s.push(r.Ge());else if(i>0)break}s.push(e);const r=[];for(let t=0;t<s.length;t+=2){if(this.Tn(s[t],s[t+1]))return[];const e=[s[t].indexId,this.uid,s[t].arrayValue,s[t].directionalValue,Vc,[]],n=[s[t+1].indexId,this.uid,s[t+1].arrayValue,s[t+1].directionalValue,Vc,[]];r.push(IDBKeyRange.bound(e,n))}return r}Tn(t,e){return Ec(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Gc)}getMinOffset(t,e){return xr.mapArray(this.en(e),(e=>this.nn(t,e).next((t=>t||Us())))).next(Gc)}}function Uc(t){return zu(t,"collectionParents")}function qc(t){return zu(t,"indexEntries")}function Bc(t){return zu(t,"indexConfiguration")}function Kc(t){return zu(t,"indexState")}function Gc(t){qs(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let s=1;s<t.length;s++){const r=t[s].indexState.offset;Er(r,e)<0&&(e=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new br(e.readTime,e.documentKey,n)}const jc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class $c{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new $c(t,$c.DEFAULT_COLLECTION_PERCENTILE,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Qc(t,e,n){const s=t.store("mutations"),r=t.store("documentMutations"),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const u=s.X({range:o},((t,e,n)=>(a++,n.delete())));i.push(u.next((()=>{qs(1===a)})));const c=[];for(const t of n.mutations){const s=_u(e,t.key.path,n.batchId);i.push(r.delete(s)),c.push(t.key)}return xr.waitFor(i).next((()=>c))}function zc(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Us();e=t.noDocument}return JSON.stringify(e).length}$c.DEFAULT_COLLECTION_PERCENTILE=10,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$c.DEFAULT=new $c(41943040,$c.DEFAULT_COLLECTION_PERCENTILE,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$c.DISABLED=new $c(-1,0,0);class Hc{constructor(t,e,n,s){this.userId=t,this.Tt=e,this.indexManager=n,this.referenceDelegate=s,this.En={}}static ue(t,e,n,s){qs(""!==t.uid);const r=t.isAuthenticated()?t.uid:"";return new Hc(r,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xc(t).X({index:"userMutationsIndex",range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const r=Yc(t),i=Xc(t);return i.add({}).next((o=>{qs("number"==typeof o);const a=new Hu(o,e,n,s),u=function(t,e,n){const s=n.baseMutations.map((e=>iu(t.oe,e))),r=n.mutations.map((e=>iu(t.oe,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:s,mutations:r}}(this.Tt,this.userId,a),c=[];let h=new eo(((t,e)=>sr(t.canonicalString(),e.canonicalString())));for(const t of s){const e=_u(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),c.push(i.put(u)),c.push(r.put(e,Au))}return h.forEach((e=>{c.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.En[o]=a.keys()})),xr.waitFor(c).next((()=>a))}))}lookupMutationBatch(t,e){return Xc(t).get(e).next((t=>t?(qs(t.userId===this.userId),sc(this.Tt,t)):null))}An(t,e){return this.En[e]?xr.resolve(this.En[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.En[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let r=null;return Xc(t).X({index:"userMutationsIndex",range:s},((t,e,s)=>{e.userId===this.userId&&(qs(e.batchId>=n),r=sc(this.Tt,e)),s.done()})).next((()=>r))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Xc(t).X({index:"userMutationsIndex",range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xc(t).W("userMutationsIndex",e).next((t=>t.map((t=>sc(this.Tt,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Su(this.userId,e.path),s=IDBKeyRange.lowerBound(n),r=[];return Yc(t).X({range:s},((n,s,i)=>{const[o,a,u]=n,c=bu(a);if(o===this.userId&&e.path.isEqual(c))return Xc(t).get(u).next((t=>{if(!t)throw Us();qs(t.userId===this.userId),r.push(sc(this.Tt,t))}));i.done()})).next((()=>r))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new eo(sr);const s=[];return e.forEach((e=>{const r=Su(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=Yc(t).X({range:i},((t,s,r)=>{const[i,o,a]=t,u=bu(o);i===this.userId&&e.path.isEqual(u)?n=n.add(a):r.done()}));s.push(o)})),xr.waitFor(s).next((()=>this.Rn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,r=Su(this.userId,n),i=IDBKeyRange.lowerBound(r);let o=new eo(sr);return Yc(t).X({range:i},((t,e,r)=>{const[i,a,u]=t,c=bu(a);i===this.userId&&n.isPrefixOf(c)?c.length===s&&(o=o.add(u)):r.done()})).next((()=>this.Rn(t,o)))}Rn(t,e){const n=[],s=[];return e.forEach((e=>{s.push(Xc(t).get(e).next((t=>{if(null===t)throw Us();qs(t.userId===this.userId),n.push(sc(this.Tt,t))})))})),xr.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return Qc(t.re,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.bn(e.batchId)})),xr.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}bn(t){delete this.En[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return xr.resolve();const n=IDBKeyRange.lowerBound([this.userId]),s=[];return Yc(t).X({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=bu(t[1]);s.push(e)}else n.done()})).next((()=>{qs(0===s.length)}))}))}containsKey(t,e){return Wc(t,this.userId,e)}vn(t){return Jc(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Wc(t,e,n){const s=Su(e,n.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return Yc(t).X({range:i,Z:!0},((t,n,s)=>{const[i,a,u]=t;i===e&&a===r&&(o=!0),s.done()})).next((()=>o))}function Xc(t){return zu(t,"mutations")}function Yc(t){return zu(t,"documentMutations")}function Jc(t){return zu(t,"mutationQueues")}class Zc{constructor(t){this.Pn=t}next(){return this.Pn+=2,this.Pn}static Vn(){return new Zc(0)}static Sn(){return new Zc(-1)}}class th{constructor(t,e){this.referenceDelegate=t,this.Tt=e}allocateTargetId(t){return this.Dn(t).next((e=>{const n=new Zc(e.highestTargetId);return e.highestTargetId=n.next(),this.Cn(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Dn(t).next((t=>ar.fromTimestamp(new or(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Dn(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Dn(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Cn(t,s))))}addTargetData(t,e){return this.xn(t,e).next((()=>this.Dn(t).next((n=>(n.targetCount+=1,this.Nn(e,n),this.Cn(t,n))))))}updateTargetData(t,e){return this.xn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>eh(t).delete(e.targetId))).next((()=>this.Dn(t))).next((e=>(qs(e.targetCount>0),e.targetCount-=1,this.Cn(t,e))))}removeTargets(t,e,n){let s=0;const r=[];return eh(t).X(((i,o)=>{const a=rc(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,r.push(this.removeTargetData(t,a)))})).next((()=>xr.waitFor(r))).next((()=>s))}forEachTarget(t,e){return eh(t).X(((t,n)=>{const s=rc(n);e(s)}))}Dn(t){return nh(t).get("targetGlobalKey").next((t=>(qs(null!==t),t)))}Cn(t,e){return nh(t).put("targetGlobalKey",e)}xn(t,e){return eh(t).put(ic(this.Tt,e))}Nn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Dn(t).next((t=>t.targetCount))}getTargetData(t,e){const n=ho(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let r=null;return eh(t).X({range:s,index:"queryTargetsIndex"},((t,n,s)=>{const i=rc(n);lo(e,i.target)&&(r=i,s.done())})).next((()=>r))}addMatchingKeys(t,e,n){const s=[],r=sh(t);return e.forEach((e=>{const i=vu(e.path);s.push(r.put({targetId:n,path:i})),s.push(this.referenceDelegate.addReference(t,n,e))})),xr.waitFor(s)}removeMatchingKeys(t,e,n){const s=sh(t);return xr.forEach(e,(e=>{const r=vu(e.path);return xr.waitFor([s.delete([n,r]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=sh(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=sh(t);let r=Ca();return s.X({range:n,Z:!0},((t,e,n)=>{const s=bu(t[1]),i=new dr(s);r=r.add(i)})).next((()=>r))}containsKey(t,e){const n=vu(e.path),s=IDBKeyRange.bound([n],[ir(n)],!1,!0);let r=0;return sh(t).X({index:"documentTargetsIndex",Z:!0,range:s},(([t,e],n,s)=>{0!==t&&(r++,s.done())})).next((()=>r>0))}ie(t,e){return eh(t).get(e).next((t=>t?rc(t):null))}}function eh(t){return zu(t,"targets")}function nh(t){return zu(t,"targetGlobal")}function sh(t){return zu(t,"targetDocuments")}function rh([t,e],[n,s]){const r=sr(t,n);return 0===r?sr(e,s):r}class ih{constructor(t){this.kn=t,this.buffer=new eo(rh),this.On=0}Mn(){return++this.On}Fn(t){const e=[t,this.Mn()];if(this.buffer.size<this.kn)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();rh(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class oh{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.$n=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Bn(6e4)}stop(){this.$n&&(this.$n.cancel(),this.$n=null)}get started(){return null!==this.$n}Bn(t){Os("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.$n=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.$n=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Rr(t)?Os("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Ar(t)}await this.Bn(3e5)}))}}class ah{constructor(t,e){this.Ln=t,this.params=e}calculateTargetCount(t,e){return this.Ln.qn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return xr.resolve(Ur.at);const n=new ih(e);return this.Ln.forEachTarget(t,(t=>n.Fn(t.sequenceNumber))).next((()=>this.Ln.Un(t,(t=>n.Fn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.Ln.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Ln.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Os("LruGarbageCollector","Garbage collection skipped; disabled"),xr.resolve(jc)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(Os("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),jc):this.Kn(t,e)))}getCacheSize(t){return this.Ln.getCacheSize(t)}Kn(t,e){let n,s,r,i,o,a,u;const c=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(Os("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,i=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(r=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),Ms()<=E.DEBUG&&Os("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-c}ms\n\tDetermined least recently used ${s} in `+(o-i)+"ms\n"+`\tRemoved ${r} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-c}ms`),xr.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:t}))))}}class uh{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new ah(t,e)}(this,e)}qn(t){const e=this.Gn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Gn(t){let e=0;return this.Un(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Un(t,e){return this.Qn(t,((t,n)=>e(n)))}addReference(t,e,n){return ch(t,n)}removeReference(t,e,n){return ch(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return ch(t,e)}jn(t,e){return function(t,e){let n=!1;return Jc(t).tt((s=>Wc(t,s,e).next((t=>(t&&(n=!0),xr.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let r=0;return this.Qn(t,((i,o)=>{if(o<=e){const e=this.jn(t,i).next((e=>{if(!e)return r++,n.getEntry(t,i).next((()=>(n.removeEntry(i,ar.min()),sh(t).delete([0,vu(i.path)]))))}));s.push(e)}})).next((()=>xr.waitFor(s))).next((()=>n.apply(t))).next((()=>r))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return ch(t,e)}Qn(t,e){const n=sh(t);let s,r=Ur.at;return n.X({index:"documentTargetsIndex"},(([t,n],{path:i,sequenceNumber:o})=>{0===t?(r!==Ur.at&&e(new dr(bu(s)),r),r=o,s=i):r=Ur.at})).next((()=>{r!==Ur.at&&e(new dr(bu(s)),r)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function ch(t,e){return sh(t).put(function(t,e){return{targetId:0,path:vu(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}class hh{constructor(){this.changes=new wa((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ao.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?xr.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class lh{constructor(t){this.Tt=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return gh(t).put(n)}removeEntry(t,e,n){return gh(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],tc(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.zn(t,n))))}getEntry(t,e){let n=ao.newInvalidDocument(e);return gh(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(ph(e))},((t,s)=>{n=this.Wn(e,s)})).next((()=>n))}Hn(t,e){let n={size:0,document:ao.newInvalidDocument(e)};return gh(t).X({index:"documentKeyIndex",range:IDBKeyRange.only(ph(e))},((t,s)=>{n={document:this.Wn(e,s),size:zc(s)}})).next((()=>n))}getEntries(t,e){let n=Ia();return this.Jn(t,e,((t,e)=>{const s=this.Wn(t,e);n=n.insert(t,s)})).next((()=>n))}Yn(t,e){let n=Ia(),s=new Ji(dr.comparator);return this.Jn(t,e,((t,e)=>{const r=this.Wn(t,e);n=n.insert(t,r),s=s.insert(t,zc(e))})).next((()=>({documents:n,Zn:s})))}Jn(t,e,n){if(e.isEmpty())return xr.resolve();let s=new eo(wh);e.forEach((t=>s=s.add(t)));const r=IDBKeyRange.bound(ph(s.first()),ph(s.last())),i=s.getIterator();let o=i.getNext();return gh(t).X({index:"documentKeyIndex",range:r},((t,e,s)=>{const r=dr.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&wh(o,r)<0;)n(o,null),o=i.getNext();o&&o.isEqual(r)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?s.j(ph(o)):s.done()})).next((()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(t,e,n,s){const r=e.path,i=[r.popLast().toArray(),r.lastSegment(),tc(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return gh(t).W(IDBKeyRange.bound(i,o,!0)).next((t=>{let n=Ia();for(const r of t){const t=this.Wn(dr.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);t.isFoundDocument()&&(ko(e,t)||s.has(t.key))&&(n=n.insert(t.key,t))}return n}))}getAllFromCollectionGroup(t,e,n,s){let r=Ia();const i=yh(e,n),o=yh(e,br.max());return gh(t).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(i,o,!0)},((t,e,n)=>{const i=this.Wn(dr.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);r=r.insert(i.key,i),r.size===s&&n.done()})).next((()=>r))}newChangeBuffer(t){return new fh(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return mh(t).get("remoteDocumentGlobalKey").next((t=>(qs(!!t),t)))}zn(t,e){return mh(t).put("remoteDocumentGlobalKey",e)}Wn(t,e){if(e){const t=function(t,e){let n;if(e.document)n=ru(t.oe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=dr.fromSegments(e.noDocument.path),s=nc(e.noDocument.readTime);n=ao.newNoDocument(t,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Us();{const t=dr.fromSegments(e.unknownDocument.path),s=nc(e.unknownDocument.version);n=ao.newUnknownDocument(t,s)}}return e.readTime&&n.setReadTime(function(t){const e=new or(t[0],t[1]);return ar.fromTimestamp(e)}(e.readTime)),n}(this.Tt,e);if(!t.isNoDocument()||!t.version.isEqual(ar.min()))return t}return ao.newInvalidDocument(t)}}function dh(t){return new lh(t)}class fh extends hh{constructor(t,e){super(),this.Xn=t,this.trackRemovals=e,this.ts=new wa((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new eo(((t,e)=>sr(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((r,i)=>{const o=this.ts.get(r);if(e.push(this.Xn.removeEntry(t,r,o.readTime)),i.isValidDocument()){const a=Zu(this.Xn.Tt,i);s=s.add(r.path.popLast());const u=zc(a);n+=u-o.size,e.push(this.Xn.addEntry(t,r,a))}else if(n-=o.size,this.trackRemovals){const n=Zu(this.Xn.Tt,i.convertToNoDocument(ar.min()));e.push(this.Xn.addEntry(t,r,n))}})),s.forEach((n=>{e.push(this.Xn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.Xn.updateMetadata(t,n)),xr.waitFor(e)}getFromCache(t,e){return this.Xn.Hn(t,e).next((t=>(this.ts.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.Xn.Yn(t,e).next((({documents:t,Zn:e})=>(e.forEach(((e,n)=>{this.ts.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function mh(t){return zu(t,"remoteDocumentGlobal")}function gh(t){return zu(t,"remoteDocumentsV14")}function ph(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yh(t,e){const n=e.documentKey.path.toArray();return[t,tc(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function wh(t,e){const n=t.path.toArray(),s=e.path.toArray();let r=0;for(let t=0;t<n.length-2&&t<s.length-2;++t)if(r=sr(n[t],s[t]),r)return r;return r=sr(n.length,s.length),r||(r=sr(n[n.length-2],s[s.length-2]),r||sr(n[n.length-1],s[s.length-1]))}class vh{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ih{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&sa(n.mutation,t,ro.empty(),or.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Ca()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Ca()){const s=Sa();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=ba();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Sa();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Ca())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let r=Ia();const i=Aa(),o=Aa();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof aa)?r=r.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),sa(o.mutation,e,o.mutation.getFieldMask(),or.now())):i.set(e.key,ro.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new vh(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Aa();let s=new Ji(((t,e)=>t-e)),r=Ca();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||ro.empty();o=r.applyToLocalView(i,o),n.set(t,o);const a=(s.get(r.batchId)||Ca()).add(t);s=s.insert(r.batchId,a)}))})).next((()=>{const i=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,u=s.value,c=_a();u.forEach((t=>{if(!r.has(t)){const s=ea(e.get(t),n.get(t));null!==s&&c.set(t,s),r=r.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,c))}return xr.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return dr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Eo(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-r.size):xr.resolve(Sa());let o=-1,a=r;return i.next((e=>xr.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?xr.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,Ca()))).next((t=>({batchId:o,changes:Ea(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new dr(e)).next((t=>{let e=ba();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const s=e.collectionGroup;let r=ba();return this.indexManager.getCollectionParents(t,s).next((i=>xr.forEach(i,(i=>{const o=function(t,e){return new yo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(s));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s)))).next((t=>{s.forEach(((e,n)=>{const s=n.getKey();null===t.get(s)&&(t=t.insert(s,ao.newInvalidDocument(s)))}));let n=ba();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&sa(i.mutation,r,ro.empty(),or.now()),ko(e,r)&&(n=n.insert(t,r))})),n}))}}class Th{constructor(t){this.Tt=t,this.es=new Map,this.ns=new Map}getBundleMetadata(t,e){return xr.resolve(this.es.get(e))}saveBundleMetadata(t,e){var n;return this.es.set(e.id,{id:(n=e).id,version:n.version,createTime:Ha(n.createTime)}),xr.resolve()}getNamedQuery(t,e){return xr.resolve(this.ns.get(e))}saveNamedQuery(t,e){return this.ns.set(e.name,function(t){return{name:t.name,query:oc(t.bundledQuery),readTime:Ha(t.readTime)}}(e)),xr.resolve()}}class bh{constructor(){this.overlays=new Ji(dr.comparator),this.ss=new Map}getOverlay(t,e){return xr.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Sa();return xr.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.ce(t,e,s)})),xr.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.ss.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.ss.delete(n)),xr.resolve()}getOverlaysForCollection(t,e,n){const s=Sa(),r=e.length+1,i=new dr(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===r&&t.largestBatchId>n&&s.set(t.getKey(),t)}return xr.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let r=new Ji(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=Sa(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Sa(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return xr.resolve(o)}ce(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.ss.get(s.largestBatchId).delete(n.key);this.ss.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Xu(e,n));let r=this.ss.get(e);void 0===r&&(r=Ca(),this.ss.set(e,r)),this.ss.set(e,r.add(n.key))}}class Eh{constructor(){this.rs=new eo(Sh.os),this.us=new eo(Sh.cs)}isEmpty(){return this.rs.isEmpty()}addReference(t,e){const n=new Sh(t,e);this.rs=this.rs.add(n),this.us=this.us.add(n)}hs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ls(new Sh(t,e))}fs(t,e){t.forEach((t=>this.removeReference(t,e)))}ds(t){const e=new dr(new cr([])),n=new Sh(e,t),s=new Sh(e,t+1),r=[];return this.us.forEachInRange([n,s],(t=>{this.ls(t),r.push(t.key)})),r}_s(){this.rs.forEach((t=>this.ls(t)))}ls(t){this.rs=this.rs.delete(t),this.us=this.us.delete(t)}ws(t){const e=new dr(new cr([])),n=new Sh(e,t),s=new Sh(e,t+1);let r=Ca();return this.us.forEachInRange([n,s],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new Sh(t,0),n=this.rs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Sh{constructor(t,e){this.key=t,this.gs=e}static os(t,e){return dr.comparator(t.key,e.key)||sr(t.gs,e.gs)}static cs(t,e){return sr(t.gs,e.gs)||dr.comparator(t.key,e.key)}}class _h{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.ys=1,this.ps=new eo(Sh.os)}checkEmpty(t){return xr.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const r=this.ys;this.ys++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Hu(r,e,n,s);this.mutationQueue.push(i);for(const e of s)this.ps=this.ps.add(new Sh(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return xr.resolve(i)}lookupMutationBatch(t,e){return xr.resolve(this.Is(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.Ts(n),r=s<0?0:s;return xr.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return xr.resolve(0===this.mutationQueue.length?-1:this.ys-1)}getAllMutationBatches(t){return xr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Sh(e,0),s=new Sh(e,Number.POSITIVE_INFINITY),r=[];return this.ps.forEachInRange([n,s],(t=>{const e=this.Is(t.gs);r.push(e)})),xr.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new eo(sr);return e.forEach((t=>{const e=new Sh(t,0),s=new Sh(t,Number.POSITIVE_INFINITY);this.ps.forEachInRange([e,s],(t=>{n=n.add(t.gs)}))})),xr.resolve(this.Es(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let r=n;dr.isDocumentKey(r)||(r=r.child(""));const i=new Sh(new dr(r),0);let o=new eo(sr);return this.ps.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.gs)),!0)}),i),xr.resolve(this.Es(o))}Es(t){const e=[];return t.forEach((t=>{const n=this.Is(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){qs(0===this.As(e.batchId,"removed")),this.mutationQueue.shift();let n=this.ps;return xr.forEach(e.mutations,(s=>{const r=new Sh(s.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ps=n}))}bn(t){}containsKey(t,e){const n=new Sh(e,0),s=this.ps.firstAfterOrEqual(n);return xr.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,xr.resolve()}As(t,e){return this.Ts(t)}Ts(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Is(t){const e=this.Ts(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Ah{constructor(t){this.Rs=t,this.docs=new Ji(dr.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),r=s?s.size:0,i=this.Rs(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return xr.resolve(n?n.document.mutableCopy():ao.newInvalidDocument(e))}getEntries(t,e){let n=Ia();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():ao.newInvalidDocument(t))})),xr.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let r=Ia();const i=e.path,o=new dr(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||Er(Tr(o),n)<=0||(s.has(o.key)||ko(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return xr.resolve(r)}getAllFromCollectionGroup(t,e,n,s){Us()}bs(t,e){return xr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new xh(this)}getSize(t){return xr.resolve(this.size)}}class xh extends hh{constructor(t){super(),this.Xn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Xn.addEntry(t,s)):this.Xn.removeEntry(n)})),xr.waitFor(e)}getFromCache(t,e){return this.Xn.getEntry(t,e)}getAllFromCache(t,e){return this.Xn.getEntries(t,e)}}class Dh{constructor(t){this.persistence=t,this.vs=new wa((t=>ho(t)),lo),this.lastRemoteSnapshotVersion=ar.min(),this.highestTargetId=0,this.Ps=0,this.Vs=new Eh,this.targetCount=0,this.Ss=Zc.Vn()}forEachTarget(t,e){return this.vs.forEach(((t,n)=>e(n))),xr.resolve()}getLastRemoteSnapshotVersion(t){return xr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return xr.resolve(this.Ps)}allocateTargetId(t){return this.highestTargetId=this.Ss.next(),xr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ps&&(this.Ps=e),xr.resolve()}xn(t){this.vs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ss=new Zc(e),this.highestTargetId=e),t.sequenceNumber>this.Ps&&(this.Ps=t.sequenceNumber)}addTargetData(t,e){return this.xn(e),this.targetCount+=1,xr.resolve()}updateTargetData(t,e){return this.xn(e),xr.resolve()}removeTargetData(t,e){return this.vs.delete(e.target),this.Vs.ds(e.targetId),this.targetCount-=1,xr.resolve()}removeTargets(t,e,n){let s=0;const r=[];return this.vs.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.vs.delete(i),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),xr.waitFor(r).next((()=>s))}getTargetCount(t){return xr.resolve(this.targetCount)}getTargetData(t,e){const n=this.vs.get(e)||null;return xr.resolve(n)}addMatchingKeys(t,e,n){return this.Vs.hs(e,n),xr.resolve()}removeMatchingKeys(t,e,n){this.Vs.fs(e,n);const s=this.persistence.referenceDelegate,r=[];return s&&e.forEach((e=>{r.push(s.markPotentiallyOrphaned(t,e))})),xr.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.Vs.ds(e),xr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Vs.ws(e);return xr.resolve(n)}containsKey(t,e){return xr.resolve(this.Vs.containsKey(e))}}class Ch{constructor(t,e){this.Ds={},this.overlays={},this.Cs=new Ur(0),this.xs=!1,this.xs=!0,this.referenceDelegate=t(this),this.Ns=new Dh(this),this.indexManager=new Oc,this.remoteDocumentCache=function(t){return new Ah(t)}((t=>this.referenceDelegate.ks(t))),this.Tt=new Ju(e),this.Os=new Th(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new bh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Ds[t.toKey()];return n||(n=new _h(e,this.referenceDelegate),this.Ds[t.toKey()]=n),n}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Os}runTransaction(t,e,n){Os("MemoryPersistence","Starting transaction:",t);const s=new Nh(this.Cs.next());return this.referenceDelegate.Ms(),n(s).next((t=>this.referenceDelegate.Fs(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}$s(t,e){return xr.or(Object.values(this.Ds).map((n=>()=>n.containsKey(t,e))))}}class Nh extends _r{constructor(t){super(),this.currentSequenceNumber=t}}class kh{constructor(t){this.persistence=t,this.Bs=new Eh,this.Ls=null}static qs(t){return new kh(t)}get Us(){if(this.Ls)return this.Ls;throw Us()}addReference(t,e,n){return this.Bs.addReference(n,e),this.Us.delete(n.toString()),xr.resolve()}removeReference(t,e,n){return this.Bs.removeReference(n,e),this.Us.add(n.toString()),xr.resolve()}markPotentiallyOrphaned(t,e){return this.Us.add(e.toString()),xr.resolve()}removeTarget(t,e){this.Bs.ds(e.targetId).forEach((t=>this.Us.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Us.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ms(){this.Ls=new Set}Fs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return xr.forEach(this.Us,(n=>{const s=dr.fromPath(n);return this.Ks(t,s).next((t=>{t||e.removeEntry(s,ar.min())}))})).next((()=>(this.Ls=null,e.apply(t))))}updateLimboDocument(t,e){return this.Ks(t,e).next((t=>{t?this.Us.delete(e.toString()):this.Us.add(e.toString())}))}ks(t){return 0}Ks(t,e){return xr.or([()=>xr.resolve(this.Bs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.$s(t,e)])}}class Rh{constructor(t){this.Tt=t}$(t,e,n,s){const r=new Dr("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"}),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Eu,{unique:!0}),t.createObjectStore("documentMutations")}(t),Mh(t),function(t){t.createObjectStore("remoteDocuments")}(t));let i=xr.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),Mh(t)),i=i.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ar.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(r)))),n<4&&s>=4&&(0!==n&&(i=i.next((()=>function(t,e){return e.store("mutations").W().next((n=>{t.deleteObjectStore("mutations"),t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Eu,{unique:!0});const s=e.store("mutations"),r=n.map((t=>s.put(t)));return xr.waitFor(r)}))}(t,r)))),i=i.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&s>=5&&(i=i.next((()=>this.Gs(r)))),n<6&&s>=6&&(i=i.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Qs(r))))),n<7&&s>=7&&(i=i.next((()=>this.js(r)))),n<8&&s>=8&&(i=i.next((()=>this.zs(t,r)))),n<9&&s>=9&&(i=i.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&s>=10&&(i=i.next((()=>this.Ws(r)))),n<11&&s>=11&&(i=i.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&s>=12&&(i=i.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:Pu});e.createIndex("collectionPathOverlayIndex",Uu,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",qu,{unique:!1})}(t)}))),n<13&&s>=13&&(i=i.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:xu});e.createIndex("documentKeyIndex",Du),e.createIndex("collectionGroupIndex",Cu)}(t))).next((()=>this.Hs(t,r))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&s>=14&&(i=i.next((()=>this.Js(t,r)))),n<15&&s>=15&&(i=i.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),t.createObjectStore("indexState",{keyPath:Lu}).createIndex("sequenceNumberIndex",Ou,{unique:!1}),t.createObjectStore("indexEntries",{keyPath:Fu}).createIndex("documentKeyIndex",Vu,{unique:!1})}(t)))),i}Qs(t){let e=0;return t.store("remoteDocuments").X(((t,n)=>{e+=zc(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Gs(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.W().next((e=>xr.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",s).next((n=>xr.forEach(n,(n=>{qs(n.userId===e.userId);const s=sc(this.Tt,n);return Qc(t,e.userId,s).next((()=>{}))}))))}))))}js(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const s=[];return n.X(((n,r)=>{const i=new cr(n),o=function(t){return[0,vu(t)]}(i);s.push(e.get(o).next((n=>n?xr.resolve():(n=>e.put({targetId:0,path:vu(n),sequenceNumber:t.highestListenSequenceNumber}))(i))))})).next((()=>xr.waitFor(s)))}))}zs(t,e){t.createObjectStore("collectionParents",{keyPath:Mu});const n=e.store("collectionParents"),s=new Fc,r=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:vu(s)})}};return e.store("remoteDocuments").X({Z:!0},((t,e)=>{const n=new cr(t);return r(n.popLast())})).next((()=>e.store("documentMutations").X({Z:!0},(([t,e,n],s)=>{const i=bu(e);return r(i.popLast())}))))}Ws(t){const e=t.store("targets");return e.X(((t,n)=>{const s=rc(n),r=ic(this.Tt,s);return e.put(r)}))}Hs(t,e){const n=e.store("remoteDocuments"),s=[];return n.X(((t,n)=>{const r=e.store("remoteDocumentsV14"),i=(o=n,o.document?new dr(cr.fromString(o.document.name).popFirst(5)):o.noDocument?dr.fromSegments(o.noDocument.path):o.unknownDocument?dr.fromSegments(o.unknownDocument.path):Us()).path.toArray();var o;const a={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};s.push(r.put(a))})).next((()=>xr.waitFor(s)))}Js(t,e){const n=e.store("mutations"),s=dh(this.Tt),r=new Ch(kh.qs,this.Tt.oe);return n.W().next((t=>{const n=new Map;return t.forEach((t=>{var e;let s=null!==(e=n.get(t.userId))&&void 0!==e?e:Ca();sc(this.Tt,t).keys().forEach((t=>s=s.add(t))),n.set(t.userId,s)})),xr.forEach(n,((t,n)=>{const i=new Ns(n),o=fc.ue(this.Tt,i),a=r.getIndexManager(i),u=Hc.ue(i,this.Tt,a,r.referenceDelegate);return new Ih(s,u,o,a).recalculateAndSaveOverlaysForDocumentKeys(new Qu(e,Ur.at),t).next()}))}))}}function Mh(t){t.createObjectStore("targetDocuments",{keyPath:ku}).createIndex("documentTargetsIndex",Ru,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Nu,{unique:!0}),t.createObjectStore("targetGlobal")}const Lh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Oh{constructor(t,e,n,s,r,i,o,a,u,c,h=15){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Ys=r,this.window=i,this.document=o,this.Zs=u,this.Xs=c,this.ti=h,this.Cs=null,this.xs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ei=null,this.inForeground=!1,this.ni=null,this.si=null,this.ii=Number.NEGATIVE_INFINITY,this.ri=t=>Promise.resolve(),!Oh.C())throw new js(Gs.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uh(this,s),this.oi=e+"main",this.Tt=new Ju(a),this.ui=new Cr(this.oi,this.ti,new Rh(this.Tt)),this.Ns=new th(this.referenceDelegate,this.Tt),this.remoteDocumentCache=dh(this.Tt),this.Os=new hc,this.window&&this.window.localStorage?this.ci=this.window.localStorage:(this.ci=null,!1===c&&Fs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new js(Gs.FAILED_PRECONDITION,Lh);return this.hi(),this.li(),this.fi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Ns.getHighestSequenceNumber(t)))})).then((t=>{this.Cs=new Ur(t,this.Zs)})).then((()=>{this.xs=!0})).catch((t=>(this.ui&&this.ui.close(),Promise.reject(t))))}di(t){return this.ri=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ui.L((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Ys.enqueueAndForget((async()=>{this.started&&await this.ai()})))}ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Vh(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this._i(t).next((t=>{t||(this.isPrimary=!1,this.Ys.enqueueRetryable((()=>this.ri(!1))))}))})).next((()=>this.wi(t))).next((e=>this.isPrimary&&!e?this.mi(t).next((()=>!1)):!!e&&this.gi(t).next((()=>!0)))))).catch((t=>{if(Rr(t))return Os("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Os("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Ys.enqueueRetryable((()=>this.ri(t))),this.isPrimary=t}))}_i(t){return Fh(t).get("owner").next((t=>xr.resolve(this.yi(t))))}pi(t){return Vh(t).delete(this.clientId)}async Ii(){if(this.isPrimary&&!this.Ti(this.ii,18e5)){this.ii=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=zu(t,"clientMetadata");return e.W().next((t=>{const n=this.Ei(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return xr.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.ci)for(const e of t)this.ci.removeItem(this.Ai(e.clientId))}}fi(){this.si=this.Ys.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ai().then((()=>this.Ii())).then((()=>this.fi()))))}yi(t){return!!t&&t.ownerId===this.clientId}wi(t){return this.Xs?xr.resolve(!0):Fh(t).get("owner").next((e=>{if(null!==e&&this.Ti(e.leaseTimestampMs,5e3)&&!this.Ri(e.ownerId)){if(this.yi(e)&&this.networkEnabled)return!0;if(!this.yi(e)){if(!e.allowTabSynchronization)throw new js(Gs.FAILED_PRECONDITION,Lh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vh(t).W().next((t=>void 0===this.Ei(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&Os("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.xs=!1,this.bi(),this.si&&(this.si.cancel(),this.si=null),this.vi(),this.Pi(),await this.ui.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new Qu(t,Ur.at);return this.mi(e).next((()=>this.pi(e)))})),this.ui.close(),this.Vi()}Ei(t,e){return t.filter((t=>this.Ti(t.updateTimeMs,e)&&!this.Ri(t.clientId)))}Si(){return this.runTransaction("getActiveClients","readonly",(t=>Vh(t).W().next((t=>this.Ei(t,18e5).map((t=>t.clientId))))))}get started(){return this.xs}getMutationQueue(t,e){return Hc.ue(t,this.Tt,e,this.referenceDelegate)}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Pc(t,this.Tt.oe.databaseId)}getDocumentOverlayCache(t){return fc.ue(this.Tt,t)}getBundleCache(){return this.Os}runTransaction(t,e,n){Os("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite",r=15===(i=this.ti)?$u:14===i?ju:13===i?Gu:12===i?Ku:11===i?Bu:void Us();var i;let o;return this.ui.runTransaction(t,s,r,(s=>(o=new Qu(s,this.Cs?this.Cs.next():Ur.at),"readwrite-primary"===e?this._i(o).next((t=>!!t||this.wi(o))).next((e=>{if(!e)throw Fs(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ys.enqueueRetryable((()=>this.ri(!1))),new js(Gs.FAILED_PRECONDITION,Sr);return n(o)})).next((t=>this.gi(o).next((()=>t)))):this.Di(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}Di(t){return Fh(t).get("owner").next((t=>{if(null!==t&&this.Ti(t.leaseTimestampMs,5e3)&&!this.Ri(t.ownerId)&&!this.yi(t)&&!(this.Xs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new js(Gs.FAILED_PRECONDITION,Lh)}))}gi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Fh(t).put("owner",e)}static C(){return Cr.C()}mi(t){const e=Fh(t);return e.get("owner").next((t=>this.yi(t)?(Os("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):xr.resolve()))}Ti(t,e){const n=Date.now();return!(t<n-e||t>n&&(Fs(`Detected an update time that is in the future: ${t} > ${n}`),1))}hi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ni=()=>{this.Ys.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ai())))},this.document.addEventListener("visibilitychange",this.ni),this.inForeground="visible"===this.document.visibilityState)}vi(){this.ni&&(this.document.removeEventListener("visibilitychange",this.ni),this.ni=null)}li(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ei=()=>{this.bi(),g()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Ys.enterRestrictedMode(!0),this.Ys.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ei))}Pi(){this.ei&&(this.window.removeEventListener("pagehide",this.ei),this.ei=null)}Ri(t){var e;try{const n=null!==(null===(e=this.ci)||void 0===e?void 0:e.getItem(this.Ai(t)));return Os("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Fs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}bi(){if(this.ci)try{this.ci.setItem(this.Ai(this.clientId),String(Date.now()))}catch(t){Fs("Failed to set zombie client id.",t)}}Vi(){if(this.ci)try{this.ci.removeItem(this.Ai(this.clientId))}catch(t){}}Ai(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Fh(t){return zu(t,"owner")}function Vh(t){return zu(t,"clientMetadata")}function Ph(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Uh{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Ci=n,this.xi=s}static Ni(t,e){let n=Ca(),s=Ca();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Uh(t,e.fromCache,n,s)}}class qh{constructor(){this.ki=!1}initialize(t,e){this.Oi=t,this.indexManager=e,this.ki=!0}getDocumentsMatchingQuery(t,e,n,s){return this.Mi(t,e).next((r=>r||this.Fi(t,e,s,n))).next((n=>n||this.$i(t,e)))}Mi(t,e){if(Io(e))return xr.resolve(null);let n=_o(e);return this.indexManager.getIndexType(t,n).next((s=>0===s?null:(null!==e.limit&&1===s&&(e=xo(e,null,"F"),n=_o(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((s=>{const r=Ca(...s);return this.Oi.getDocuments(t,r).next((s=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Bi(e,s);return this.Li(e,i,r,n.readTime)?this.Mi(t,xo(e,null,"F")):this.qi(t,i,e,n)}))))})))))}Fi(t,e,n,s){return Io(e)||s.isEqual(ar.min())?this.$i(t,e):this.Oi.getDocuments(t,n).next((r=>{const i=this.Bi(e,r);return this.Li(e,i,n,s)?this.$i(t,e):(Ms()<=E.DEBUG&&Os("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),No(e)),this.qi(t,i,e,Ir(s,-1)))}))}Bi(t,e){let n=new eo(Mo(t));return e.forEach(((e,s)=>{ko(t,s)&&(n=n.add(s))})),n}Li(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}$i(t,e){return Ms()<=E.DEBUG&&Os("QueryEngine","Using full collection scan to execute query:",No(e)),this.Oi.getDocumentsMatchingQuery(t,e,br.min())}qi(t,e,n,s){return this.Oi.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Bh{constructor(t,e,n,s){this.persistence=t,this.Ui=e,this.Tt=s,this.Ki=new Ji(sr),this.Gi=new wa((t=>ho(t)),lo),this.Qi=new Map,this.ji=t.getRemoteDocumentCache(),this.Ns=t.getTargetCache(),this.Os=t.getBundleCache(),this.zi(n)}zi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ih(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ki)))}}function Kh(t,e,n,s){return new Bh(t,e,n,s)}async function Gh(t,e){const n=Ks(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((r=>(s=r,n.zi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],i=[];let o=Ca();for(const t of s){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Wi:t,removedBatchIds:r,addedBatchIds:i})))}))}))}function jh(t){const e=Ks(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ns.getLastRemoteSnapshotVersion(t)))}function $h(t,e,n){let s=Ca(),r=Ca();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=Ia();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(ar.min())?(e.removeEntry(n,i.readTime),s=s.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),s=s.insert(n,i)):Os("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{Hi:s,Ji:r}}))}function Qh(t,e){const n=Ks(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function zh(t,e){const n=Ks(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Ns.getTargetData(t,e).next((r=>r?(s=r,xr.resolve(s)):n.Ns.allocateTargetId(t).next((r=>(s=new Yu(e,r,0,t.currentSequenceNumber),n.Ns.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Ki.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ki=n.Ki.insert(t.targetId,t),n.Gi.set(e,t.targetId)),t}))}async function Hh(t,e,n){const s=Ks(t),r=s.Ki.get(e),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,(t=>s.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!Rr(t))throw t;Os("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ki=s.Ki.remove(e),s.Gi.delete(r.target)}function Wh(t,e,n){const s=Ks(t);let r=ar.min(),i=Ca();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=Ks(t),r=s.Gi.get(n);return void 0!==r?xr.resolve(s.Ki.get(r)):s.Ns.getTargetData(e,n)}(s,t,_o(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,s.Ns.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>s.Ui.getDocumentsMatchingQuery(t,e,n?r:ar.min(),n?i:Ca()))).next((t=>(Jh(s,Ro(e),t),{documents:t,Yi:i})))))}function Xh(t,e){const n=Ks(t),s=Ks(n.Ns),r=n.Ki.get(e);return r?Promise.resolve(r.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.ie(t,e).next((t=>t?t.target:null))))}function Yh(t,e){const n=Ks(t),s=n.Qi.get(e)||ar.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.ji.getAllFromCollectionGroup(t,e,Ir(s,-1),Number.MAX_SAFE_INTEGER))).then((t=>(Jh(n,e,t),t)))}function Jh(t,e,n){let s=t.Qi.get(e)||ar.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.Qi.set(e,s)}async function Zh(t,e,n=Ca()){const s=await zh(t,_o(oc(e.bundledQuery))),r=Ks(t);return r.persistence.runTransaction("Save named query","readwrite",(t=>{const i=Ha(e.readTime);if(s.snapshotVersion.compareTo(i)>=0)return r.Os.saveNamedQuery(t,e);const o=s.withResumeToken(Zr.EMPTY_BYTE_STRING,i);return r.Ki=r.Ki.insert(o.targetId,o),r.Ns.updateTargetData(t,o).next((()=>r.Ns.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>r.Ns.addMatchingKeys(t,n,s.targetId))).next((()=>r.Os.saveNamedQuery(t,e)))}))}function tl(t,e){return`firestore_clients_${t}_${e}`}function el(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function nl(t,e){return`firestore_targets_${t}_${e}`}class sl{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static er(t,e,n){const s=JSON.parse(n);let r,i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return i&&s.error&&(i="string"==typeof s.error.message&&"string"==typeof s.error.code,i&&(r=new js(s.error.code,s.error.message))),i?new sl(t,e,s.state,r):(Fs("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}nr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class rl{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static er(t,e){const n=JSON.parse(e);let s,r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code,r&&(s=new js(n.error.code,n.error.message))),r?new rl(t,n.state,s):(Fs("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}nr(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class il{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static er(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,r=ka();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Xr(n.activeTargetIds[t]),r=r.add(n.activeTargetIds[t]);return s?new il(t,r):(Fs("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class ol{constructor(t,e){this.clientId=t,this.onlineState=e}static er(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new ol(e.clientId,e.onlineState):(Fs("SharedClientState",`Failed to parse online state: ${t}`),null)}}class al{constructor(){this.activeTargetIds=ka()}sr(t){this.activeTargetIds=this.activeTargetIds.add(t)}ir(t){this.activeTargetIds=this.activeTargetIds.delete(t)}nr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ul{constructor(t,e,n,s,r){this.window=t,this.Ys=e,this.persistenceKey=n,this.rr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ur=this.cr.bind(this),this.ar=new Ji(sr),this.started=!1,this.hr=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.lr=tl(this.persistenceKey,this.rr),this.dr=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.ar=this.ar.insert(this.rr,new al),this._r=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.wr=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.mr=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.gr=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.yr=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.ur)}static C(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Si();for(const e of t){if(e===this.rr)continue;const t=this.getItem(tl(this.persistenceKey,e));if(t){const n=il.er(e,t);n&&(this.ar=this.ar.insert(n.clientId,n))}}this.pr();const e=this.storage.getItem(this.gr);if(e){const t=this.Ir(e);t&&this.Tr(t)}for(const t of this.hr)this.cr(t);this.hr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.dr,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Er(this.ar)}isActiveQueryTarget(t){let e=!1;return this.ar.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Ar(t,"pending")}updateMutationState(t,e,n){this.Ar(t,e,n),this.Rr(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(nl(this.persistenceKey,t));if(n){const s=rl.er(t,n);s&&(e=s.state)}}return this.br.sr(t),this.pr(),e}removeLocalQueryTarget(t){this.br.ir(t),this.pr()}isLocalQueryTarget(t){return this.br.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(nl(this.persistenceKey,t))}updateQueryState(t,e,n){this.vr(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Rr(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Pr(t)}notifyBundleLoaded(t){this.Vr(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ur),this.removeItem(this.lr),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return Os("SharedClientState","READ",t,e),e}setItem(t,e){Os("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Os("SharedClientState","REMOVE",t),this.storage.removeItem(t)}cr(t){const e=t;if(e.storageArea===this.storage){if(Os("SharedClientState","EVENT",e.key,e.newValue),e.key===this.lr)return void Fs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ys.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this._r.test(e.key)){if(null==e.newValue){const t=this.Sr(e.key);return this.Dr(t,null)}{const t=this.Cr(e.key,e.newValue);if(t)return this.Dr(t.clientId,t)}}else if(this.wr.test(e.key)){if(null!==e.newValue){const t=this.Nr(e.key,e.newValue);if(t)return this.kr(t)}}else if(this.mr.test(e.key)){if(null!==e.newValue){const t=this.Or(e.key,e.newValue);if(t)return this.Mr(t)}}else if(e.key===this.gr){if(null!==e.newValue){const t=this.Ir(e.newValue);if(t)return this.Tr(t)}}else if(e.key===this.dr){const t=function(t){let e=Ur.at;if(null!=t)try{const n=JSON.parse(t);qs("number"==typeof n),e=n}catch(t){Fs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Ur.at&&this.sequenceNumberHandler(t)}else if(e.key===this.yr){const t=this.Fr(e.newValue);await Promise.all(t.map((t=>this.syncEngine.$r(t))))}}else this.hr.push(e)}))}}get br(){return this.ar.get(this.rr)}pr(){this.setItem(this.lr,this.br.nr())}Ar(t,e,n){const s=new sl(this.currentUser,t,e,n),r=el(this.persistenceKey,this.currentUser,t);this.setItem(r,s.nr())}Rr(t){const e=el(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Pr(t){const e={clientId:this.rr,onlineState:t};this.storage.setItem(this.gr,JSON.stringify(e))}vr(t,e,n){const s=nl(this.persistenceKey,t),r=new rl(t,e,n);this.setItem(s,r.nr())}Vr(t){const e=JSON.stringify(Array.from(t));this.setItem(this.yr,e)}Sr(t){const e=this._r.exec(t);return e?e[1]:null}Cr(t,e){const n=this.Sr(t);return il.er(n,e)}Nr(t,e){const n=this.wr.exec(t),s=Number(n[1]),r=void 0!==n[2]?n[2]:null;return sl.er(new Ns(r),s,e)}Or(t,e){const n=this.mr.exec(t),s=Number(n[1]);return rl.er(s,e)}Ir(t){return ol.er(t)}Fr(t){return JSON.parse(t)}async kr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Br(t.batchId,t.state,t.error);Os("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}Mr(t){return this.syncEngine.Lr(t.targetId,t.state,t.error)}Dr(t,e){const n=e?this.ar.insert(t,e):this.ar.remove(t),s=this.Er(this.ar),r=this.Er(n),i=[],o=[];return r.forEach((t=>{s.has(t)||i.push(t)})),s.forEach((t=>{r.has(t)||o.push(t)})),this.syncEngine.qr(i,o).then((()=>{this.ar=n}))}Tr(t){this.ar.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Er(t){let e=ka();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class cl{constructor(){this.Ur=new al,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Ur.sr(t),this.Kr[t]||"not-current"}updateQueryState(t,e,n){this.Kr[t]=e}removeLocalQueryTarget(t){this.Ur.ir(t)}isLocalQueryTarget(t){return this.Ur.activeTargetIds.has(t)}clearQueryState(t){delete this.Kr[t]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(t){return this.Ur.activeTargetIds.has(t)}start(){return this.Ur=new al,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class hl{Gr(t){}shutdown(){}}class ll{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(t){this.Hr.push(t)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){Os("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Hr)t(0)}Wr(){Os("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Hr)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const dl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class fl{constructor(t){this.Yr=t.Yr,this.Zr=t.Zr}Xr(t){this.eo=t}no(t){this.so=t}onMessage(t){this.io=t}close(){this.Zr()}send(t){this.Yr(t)}ro(){this.eo()}oo(t){this.so(t)}uo(t){this.io(t)}}class ml extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.co=e+"://"+t.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(t,e,n,s,r){const i=this.fo(t,e);Os("RestConnection","Sending: ",i,n);const o={};return this._o(o,s,r),this.wo(t,i,o,n).then((t=>(Os("RestConnection","Received: ",t),t)),(e=>{throw Vs("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}mo(t,e,n,s,r,i){return this.lo(t,e,n,s,r)}_o(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+ks,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}fo(t,e){const n=dl[t];return`${this.co}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}wo(t,e,n,s){return new Promise(((r,i)=>{const o=new Ds;o.setWithCredentials(!0),o.listenOnce(bs.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Ts.NO_ERROR:const e=o.getResponseJson();Os("Connection","XHR received:",JSON.stringify(e)),r(e);break;case Ts.TIMEOUT:Os("Connection",'RPC "'+t+'" timed out'),i(new js(Gs.DEADLINE_EXCEEDED,"Request time out"));break;case Ts.HTTP_ERROR:const n=o.getStatus();if(Os("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){let t=o.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Gs).indexOf(e)>=0?e:Gs.UNKNOWN}(e.status);i(new js(t,e.message))}else i(new js(Gs.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new js(Gs.UNAVAILABLE,"Connection failed."));break;default:Us()}}finally{Os("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(s);o.send(e,"POST",a,n,15)}))}yo(t,e,n){const s=[this.co,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new ps,i=me(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new As({})),this._o(o.initMessageHeaders,e,n),o.encodeInitMessageHeaders=!0;const a=s.join("");Os("Connection","Creating WebChannel: "+a,o);const u=r.createWebChannel(a,o);let c=!1,h=!1;const l=new fl({Yr:t=>{h?Os("Connection","Not sending because WebChannel is closed:",t):(c||(Os("Connection","Opening WebChannel transport."),u.open(),c=!0),Os("Connection","WebChannel sending:",t),u.send(t))},Zr:()=>u.close()}),d=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return d(u,xs.EventType.OPEN,(()=>{h||Os("Connection","WebChannel transport opened.")})),d(u,xs.EventType.CLOSE,(()=>{h||(h=!0,Os("Connection","WebChannel transport closed"),l.oo())})),d(u,xs.EventType.ERROR,(t=>{h||(h=!0,Vs("Connection","WebChannel transport errored:",t),l.oo(new js(Gs.UNAVAILABLE,"The operation could not be completed")))})),d(u,xs.EventType.MESSAGE,(t=>{var e;if(!h){const n=t.data[0];qs(!!n);const s=n,r=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(r){Os("Connection","WebChannel received error:",r);const t=r.status;let e=function(t){const e=ma[t];if(void 0!==e)return ya(e)}(t),n=r.message;void 0===e&&(e=Gs.INTERNAL,n="Unknown error status: "+t+" with message "+r.message),h=!0,l.oo(new js(e,n)),u.close()}else Os("Connection","WebChannel received:",n),l.uo(n)}})),d(i,Es.STAT_EVENT,(t=>{t.stat===Ss?Os("Connection","Detected buffering proxy"):t.stat===_s&&Os("Connection","Detected no buffering proxy")})),setTimeout((()=>{l.ro()}),0),l}}function gl(){return"undefined"!=typeof window?window:null}function pl(){return"undefined"!=typeof document?document:null}function yl(t){return new ja(t,!0)}class wl{constructor(t,e,n=1e3,s=1.5,r=6e4){this.Ys=t,this.timerId=e,this.po=n,this.Io=s,this.To=r,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}bo(){this.Eo=this.To}vo(t){this.cancel();const e=Math.floor(this.Eo+this.Po()),n=Math.max(0,Date.now()-this.Ro),s=Math.max(0,e-n);s>0&&Os("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Eo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,s,(()=>(this.Ro=Date.now(),t()))),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}Po(){return(Math.random()-.5)*this.Eo}}class vl{constructor(t,e,n,s,r,i,o,a){this.Ys=t,this.So=n,this.Do=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new wl(t,e)}Oo(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Fo()}async stop(){this.Oo()&&await this.close(0)}$o(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&null===this.xo&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,(()=>this.Lo())))}qo(t){this.Uo(),this.stream.send(t)}async Lo(){if(this.Mo())return this.close(0)}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}async close(t,e){this.Uo(),this.Ko(),this.ko.cancel(),this.Co++,4!==t?this.ko.reset():e&&e.code===Gs.RESOURCE_EXHAUSTED?(Fs(e.toString()),Fs("Using maximum backoff delay to prevent overloading the backend."),this.ko.bo()):e&&e.code===Gs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Go(),this.stream.close(),this.stream=null),this.state=t,await this.listener.no(e)}Go(){}auth(){this.state=1;const t=this.Qo(this.Co),e=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Co===e&&this.jo(t,n)}),(e=>{t((()=>{const t=new js(Gs.UNKNOWN,"Fetching auth token failed: "+e.message);return this.zo(t)}))}))}jo(t,e){const n=this.Qo(this.Co);this.stream=this.Wo(t,e),this.stream.Xr((()=>{n((()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,(()=>(this.Mo()&&(this.state=3),Promise.resolve()))),this.listener.Xr())))})),this.stream.no((t=>{n((()=>this.zo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Fo(){this.state=5,this.ko.vo((async()=>{this.state=0,this.start()}))}zo(t){return Os("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Qo(t){return e=>{this.Ys.enqueueAndForget((()=>this.Co===t?e():(Os("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Il extends vl{constructor(t,e,n,s,r,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,i),this.Tt=r}Wo(t,e){return this.connection.yo("Listen",t,e)}onMessage(t){this.ko.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Us()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(t,e){return t.yt?(qs(void 0===e||"string"==typeof e),Zr.fromBase64String(e||"")):(qs(void 0===e||e instanceof Uint8Array),Zr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Gs.UNKNOWN:ya(t.code);return new js(e,t.message||"")}(o);n=new Fa(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ja(t,s.document.name),i=Ha(s.document.updateTime),o=s.document.createTime?Ha(s.document.createTime):ar.min(),a=new io({mapValue:{fields:s.document.fields}}),u=ao.newFoundDocument(r,i,o,a),c=s.targetIds||[],h=s.removedTargetIds||[];n=new La(c,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Ja(t,s.document),i=s.readTime?Ha(s.readTime):ar.min(),o=ao.newNoDocument(r,i),a=s.removedTargetIds||[];n=new La([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Ja(t,s.document),i=s.removedTargetIds||[];n=new La([],i,r,null)}else{if(!("filter"in e))return Us();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,r=new fa(s),i=t.targetId;n=new Oa(i,r)}}return n}(this.Tt,t),n=function(t){if(!("targetChange"in t))return ar.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ar.min():e.readTime?Ha(e.readTime):ar.min()}(t);return this.listener.Ho(e,n)}Jo(t){const e={};e.database=eu(this.Tt),e.addTarget=function(t,e){let n;const s=e.target;return n=fo(s)?{documents:au(t,s)}:{query:uu(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Qa(t,e.resumeToken):e.snapshotVersion.compareTo(ar.min())>0&&(n.readTime=$a(t,e.snapshotVersion.toTimestamp())),n}(this.Tt,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Us()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.Tt,t);n&&(e.labels=n),this.qo(e)}Yo(t){const e={};e.database=eu(this.Tt),e.removeTarget=t,this.qo(e)}}class Tl extends vl{constructor(t,e,n,s,r,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,i),this.Tt=r,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(t,e){return this.connection.yo("Write",t,e)}onMessage(t){if(qs(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Zo){this.ko.reset();const e=function(t,e){return t&&t.length>0?(qs(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ha(t.updateTime):Ha(e);return n.isEqual(ar.min())&&(n=Ha(e)),new Yo(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ha(t.commitTime);return this.listener.eu(n,e)}return qs(!t.writeResults||0===t.writeResults.length),this.Zo=!0,this.listener.nu()}su(){const t={};t.database=eu(this.Tt),this.qo(t)}tu(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>iu(this.Tt,t)))};this.qo(e)}}class bl extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.Tt=s,this.iu=!1}ru(){if(this.iu)throw new js(Gs.FAILED_PRECONDITION,"The client has already been terminated.")}lo(t,e,n){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.lo(t,e,n,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Gs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new js(Gs.UNKNOWN,t.toString())}))}mo(t,e,n,s){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.mo(t,e,n,r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Gs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new js(Gs.UNKNOWN,t.toString())}))}terminate(){this.iu=!0}}class El{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){0===this.ou&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve()))))}fu(t){"Online"===this.state?this.hu("Unknown"):(this.ou++,this.ou>=1&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.hu("Offline")))}set(t){this.du(),this.ou=0,"Online"===t&&(this.cu=!1),this.hu(t)}hu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}lu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(Fs(e),this.cu=!1):Os("OnlineStateTracker",e)}du(){null!==this.uu&&(this.uu.cancel(),this.uu=null)}}class Sl{constructor(t,e,n,s,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=r,this.yu.Gr((t=>{n.enqueueAndForget((async()=>{Ml(this)&&(Os("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ks(t);e.mu.add(4),await Al(e),e.pu.set("Unknown"),e.mu.delete(4),await _l(e)}(this))}))})),this.pu=new El(n,s)}}async function _l(t){if(Ml(t))for(const e of t.gu)await e(!0)}async function Al(t){for(const e of t.gu)await e(!1)}function xl(t,e){const n=Ks(t);n.wu.has(e.targetId)||(n.wu.set(e.targetId,e),Rl(n)?kl(n):Yl(n).Mo()&&Cl(n,e))}function Dl(t,e){const n=Ks(t),s=Yl(n);n.wu.delete(e),s.Mo()&&Nl(n,e),0===n.wu.size&&(s.Mo()?s.Bo():Ml(n)&&n.pu.set("Unknown"))}function Cl(t,e){t.Iu.Ft(e.targetId),Yl(t).Jo(e)}function Nl(t,e){t.Iu.Ft(e),Yl(t).Yo(e)}function kl(t){t.Iu=new Pa({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ie:e=>t.wu.get(e)||null}),Yl(t).start(),t.pu.au()}function Rl(t){return Ml(t)&&!Yl(t).Oo()&&t.wu.size>0}function Ml(t){return 0===Ks(t).mu.size}function Ll(t){t.Iu=void 0}async function Ol(t){t.wu.forEach(((e,n)=>{Cl(t,e)}))}async function Fl(t,e){Ll(t),Rl(t)?(t.pu.fu(e),kl(t)):t.pu.set("Unknown")}async function Vl(t,e,n){if(t.pu.set("Online"),e instanceof Fa&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.wu.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.wu.delete(s),t.Iu.removeTarget(s))}(t,e)}catch(n){Os("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Pl(t,n)}else if(e instanceof La?t.Iu.Qt(e):e instanceof Oa?t.Iu.Zt(e):t.Iu.Wt(e),!n.isEqual(ar.min()))try{const e=await jh(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Iu.ee(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.wu.get(s);r&&t.wu.set(s,r.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.wu.get(e);if(!n)return;t.wu.set(e,n.withResumeToken(Zr.EMPTY_BYTE_STRING,n.snapshotVersion)),Nl(t,e);const s=new Yu(n.target,e,1,n.sequenceNumber);Cl(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Os("RemoteStore","Failed to raise snapshot:",e),await Pl(t,e)}}async function Pl(t,e,n){if(!Rr(e))throw e;t.mu.add(1),await Al(t),t.pu.set("Offline"),n||(n=()=>jh(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Os("RemoteStore","Retrying IndexedDB access"),await n(),t.mu.delete(1),await _l(t)}))}function Ul(t,e){return e().catch((n=>Pl(t,n,e)))}async function ql(t){const e=Ks(t),n=Jl(e);let s=e._u.length>0?e._u[e._u.length-1].batchId:-1;for(;Bl(e);)try{const t=await Qh(e.localStore,s);if(null===t){0===e._u.length&&n.Bo();break}s=t.batchId,Kl(e,t)}catch(t){await Pl(e,t)}Gl(e)&&jl(e)}function Bl(t){return Ml(t)&&t._u.length<10}function Kl(t,e){t._u.push(e);const n=Jl(t);n.Mo()&&n.Xo&&n.tu(e.mutations)}function Gl(t){return Ml(t)&&!Jl(t).Oo()&&t._u.length>0}function jl(t){Jl(t).start()}async function $l(t){Jl(t).su()}async function Ql(t){const e=Jl(t);for(const n of t._u)e.tu(n.mutations)}async function zl(t,e,n){const s=t._u.shift(),r=Wu.from(s,e,n);await Ul(t,(()=>t.remoteSyncer.applySuccessfulWrite(r))),await ql(t)}async function Hl(t,e){e&&Jl(t).Xo&&await async function(t,e){if(pa(n=e.code)&&n!==Gs.ABORTED){const n=t._u.shift();Jl(t).$o(),await Ul(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await ql(t)}var n}(t,e),Gl(t)&&jl(t)}async function Wl(t,e){const n=Ks(t);n.asyncQueue.verifyOperationInProgress(),Os("RemoteStore","RemoteStore received new credentials");const s=Ml(n);n.mu.add(3),await Al(n),s&&n.pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.mu.delete(3),await _l(n)}async function Xl(t,e){const n=Ks(t);e?(n.mu.delete(2),await _l(n)):e||(n.mu.add(2),await Al(n),n.pu.set("Unknown"))}function Yl(t){return t.Tu||(t.Tu=function(t,e,n){const s=Ks(t);return s.ru(),new Il(e,s.connection,s.authCredentials,s.appCheckCredentials,s.Tt,n)}(t.datastore,t.asyncQueue,{Xr:Ol.bind(null,t),no:Fl.bind(null,t),Ho:Vl.bind(null,t)}),t.gu.push((async e=>{e?(t.Tu.$o(),Rl(t)?kl(t):t.pu.set("Unknown")):(await t.Tu.stop(),Ll(t))}))),t.Tu}function Jl(t){return t.Eu||(t.Eu=function(t,e,n){const s=Ks(t);return s.ru(),new Tl(e,s.connection,s.authCredentials,s.appCheckCredentials,s.Tt,n)}(t.datastore,t.asyncQueue,{Xr:$l.bind(null,t),no:Hl.bind(null,t),nu:Ql.bind(null,t),eu:zl.bind(null,t)}),t.gu.push((async e=>{e?(t.Eu.$o(),await ql(t)):(await t.Eu.stop(),t._u.length>0&&(Os("RemoteStore",`Stopping write stream with ${t._u.length} pending writes`),t._u=[]))}))),t.Eu}class Zl{constructor(t,e,n,s,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new $s,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,r){const i=Date.now()+n,o=new Zl(t,e,i,s,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new js(Gs.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function td(t,e){if(Fs("AsyncQueue",`${e}: ${t}`),Rr(t))return new js(Gs.UNAVAILABLE,`${e}: ${t}`);throw t}class ed{constructor(t){this.comparator=t?(e,n)=>t(e,n)||dr.comparator(e.key,n.key):(t,e)=>dr.comparator(t.key,e.key),this.keyedMap=ba(),this.sortedSet=new Ji(this.comparator)}static emptySet(t){return new ed(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof ed))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new ed;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class nd{constructor(){this.Au=new Ji(dr.comparator)}track(t){const e=t.doc.key,n=this.Au.get(e);n?0!==t.type&&3===n.type?this.Au=this.Au.insert(e,t):3===t.type&&1!==n.type?this.Au=this.Au.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Au=this.Au.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Au=this.Au.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Au=this.Au.remove(e):1===t.type&&2===n.type?this.Au=this.Au.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Au=this.Au.insert(e,{type:2,doc:t.doc}):Us():this.Au=this.Au.insert(e,t)}Ru(){const t=[];return this.Au.inorderTraversal(((e,n)=>{t.push(n)})),t}}class sd{constructor(t,e,n,s,r,i,o,a,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=u}static fromInitialDocuments(t,e,n,s,r){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new sd(t,e,ed.emptySet(e),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Do(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class rd{constructor(){this.bu=void 0,this.listeners=[]}}class id{constructor(){this.queries=new wa((t=>Co(t)),Do),this.onlineState="Unknown",this.vu=new Set}}async function od(t,e){const n=Ks(t),s=e.query;let r=!1,i=n.queries.get(s);if(i||(r=!0,i=new rd),r)try{i.bu=await n.onListen(s)}catch(t){const n=td(t,`Initialization of query '${No(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,i),i.listeners.push(e),e.Pu(n.onlineState),i.bu&&e.Vu(i.bu)&&hd(n)}async function ad(t,e){const n=Ks(t),s=e.query;let r=!1;const i=n.queries.get(s);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),r=0===i.listeners.length)}if(r)return n.queries.delete(s),n.onUnlisten(s)}function ud(t,e){const n=Ks(t);let s=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.listeners)e.Vu(t)&&(s=!0);r.bu=t}}s&&hd(n)}function cd(t,e,n){const s=Ks(t),r=s.queries.get(e);if(r)for(const t of r.listeners)t.onError(n);s.queries.delete(e)}function hd(t){t.vu.forEach((t=>{t.next()}))}class ld{constructor(t,e,n){this.query=t,this.Su=e,this.Du=!1,this.Cu=null,this.onlineState="Unknown",this.options=n||{}}Vu(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new sd(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Du?this.xu(t)&&(this.Su.next(t),e=!0):this.Nu(t,this.onlineState)&&(this.ku(t),e=!0),this.Cu=t,e}onError(t){this.Su.error(t)}Pu(t){this.onlineState=t;let e=!1;return this.Cu&&!this.Du&&this.Nu(this.Cu,t)&&(this.ku(this.Cu),e=!0),e}Nu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ou||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}xu(t){if(t.docChanges.length>0)return!0;const e=this.Cu&&this.Cu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ku(t){t=sd.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Du=!0,this.Su.next(t)}}class dd{constructor(t,e){this.Mu=t,this.byteLength=e}Fu(){return"metadata"in this.Mu}}class fd{constructor(t){this.Tt=t}Zi(t){return Ja(this.Tt,t)}Xi(t){return t.metadata.exists?ru(this.Tt,t.document,!1):ao.newNoDocument(this.Zi(t.metadata.name),this.tr(t.metadata.readTime))}tr(t){return Ha(t)}}class md{constructor(t,e,n){this.$u=t,this.localStore=e,this.Tt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=gd(t)}Bu(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.Mu.namedQuery)this.queries.push(t.Mu.namedQuery);else if(t.Mu.documentMetadata){this.documents.push({metadata:t.Mu.documentMetadata}),t.Mu.documentMetadata.exists||++e;const n=cr.fromString(t.Mu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.Mu.document&&(this.documents[this.documents.length-1].document=t.Mu.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Lu(t){const e=new Map,n=new fd(this.Tt);for(const s of t)if(s.metadata.queries){const t=n.Zi(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||Ca()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const r=Ks(t);let i=Ca(),o=Ia();for(const t of n){const n=e.Zi(t.metadata.name);t.document&&(i=i.add(n));const s=e.Xi(t);s.setReadTime(e.tr(t.metadata.readTime)),o=o.insert(n,s)}const a=r.ji.newChangeBuffer({trackRemovals:!0}),u=await zh(r,function(t){return _o(vo(cr.fromString(`__bundle__/docs/${t}`)))}(s));return r.persistence.runTransaction("Apply bundle documents","readwrite",(t=>$h(t,a,o).next((e=>(a.apply(t),e))).next((e=>r.Ns.removeMatchingKeysForTargetId(t,u.targetId).next((()=>r.Ns.addMatchingKeys(t,i,u.targetId))).next((()=>r.localDocuments.getLocalViewOfDocuments(t,e.Hi,e.Ji))).next((()=>e.Hi))))))}(this.localStore,new fd(this.Tt),this.documents,this.$u.id),e=this.Lu(this.documents);for(const t of this.queries)await Zh(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,qu:this.collectionGroups,Uu:t}}}function gd(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class pd{constructor(t){this.key=t}}class yd{constructor(t){this.key=t}}class wd{constructor(t,e){this.query=t,this.Ku=e,this.Gu=null,this.hasCachedResults=!1,this.current=!1,this.Qu=Ca(),this.mutatedKeys=Ca(),this.ju=Mo(t),this.zu=new ed(this.ju)}get Wu(){return this.Ku}Hu(t,e){const n=e?e.Ju:new nd,s=e?e.zu:this.zu;let r=e?e.mutatedKeys:this.mutatedKeys,i=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,u="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const c=s.get(t),h=ko(this.query,e)?e:null,l=!!c&&this.mutatedKeys.has(c.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;c&&h?c.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Yu(c,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ju(h,a)>0||u&&this.ju(h,u)<0)&&(o=!0)):!c&&h?(n.track({type:0,doc:h}),f=!0):c&&!h&&(n.track({type:1,doc:c}),f=!0,(a||u)&&(o=!0)),f&&(h?(i=i.add(h),r=d?r.add(t):r.delete(t)):(i=i.delete(t),r=r.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{zu:i,Ju:n,Li:o,mutatedKeys:r}}Yu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.zu;this.zu=t.zu,this.mutatedKeys=t.mutatedKeys;const r=t.Ju.Ru();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Us()}};return n(t)-n(e)}(t.type,e.type)||this.ju(t.doc,e.doc))),this.Zu(n);const i=e?this.Xu():[],o=0===this.Qu.size&&this.current?1:0,a=o!==this.Gu;return this.Gu=o,0!==r.length||a?{snapshot:new sd(this.query,t.zu,s,r,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),tc:i}:{tc:i}}Pu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({zu:this.zu,Ju:new nd,mutatedKeys:this.mutatedKeys,Li:!1},!1)):{tc:[]}}ec(t){return!this.Ku.has(t)&&!!this.zu.has(t)&&!this.zu.get(t).hasLocalMutations}Zu(t){t&&(t.addedDocuments.forEach((t=>this.Ku=this.Ku.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ku=this.Ku.delete(t))),this.current=t.current)}Xu(){if(!this.current)return[];const t=this.Qu;this.Qu=Ca(),this.zu.forEach((t=>{this.ec(t.key)&&(this.Qu=this.Qu.add(t.key))}));const e=[];return t.forEach((t=>{this.Qu.has(t)||e.push(new yd(t))})),this.Qu.forEach((n=>{t.has(n)||e.push(new pd(n))})),e}nc(t){this.Ku=t.Yi,this.Qu=Ca();const e=this.Hu(t.documents);return this.applyChanges(e,!0)}sc(){return sd.fromInitialDocuments(this.query,this.zu,this.mutatedKeys,0===this.Gu,this.hasCachedResults)}}class vd{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Id{constructor(t){this.key=t,this.ic=!1}}class Td{constructor(t,e,n,s,r,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.rc={},this.oc=new wa((t=>Co(t)),Do),this.uc=new Map,this.cc=new Set,this.ac=new Ji(dr.comparator),this.hc=new Map,this.lc=new Eh,this.fc={},this.dc=new Map,this._c=Zc.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return!0===this.wc}}async function bd(t,e){const n=Hd(t);let s,r;const i=n.oc.get(e);if(i)s=i.targetId,n.sharedClientState.addLocalQueryTarget(s),r=i.view.sc();else{const t=await zh(n.localStore,_o(e));n.isPrimaryClient&&xl(n.remoteStore,t);const i=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,r=await Ed(n,e,s,"current"===i,t.resumeToken)}return r}async function Ed(t,e,n,s,r){t.mc=(e,n,s)=>async function(t,e,n,s){let r=e.view.Hu(n);r.Li&&(r=await Wh(t.localStore,e.query,!1).then((({documents:t})=>e.view.Hu(t,r))));const i=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(r,t.isPrimaryClient,i);return Ld(t,e.targetId,o.tc),o.snapshot}(t,e,n,s);const i=await Wh(t.localStore,e,!0),o=new wd(e,i.Yi),a=o.Hu(i.documents),u=Ma.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState,r),c=o.applyChanges(a,t.isPrimaryClient,u);Ld(t,n,c.tc);const h=new vd(e,n,o);return t.oc.set(e,h),t.uc.has(n)?t.uc.get(n).push(e):t.uc.set(n,[e]),c.snapshot}async function Sd(t,e){const n=Ks(t),s=n.oc.get(e),r=n.uc.get(s.targetId);if(r.length>1)return n.uc.set(s.targetId,r.filter((t=>!Do(t,e)))),void n.oc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Hh(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),Dl(n.remoteStore,s.targetId),Rd(n,s.targetId)})).catch(Ar)):(Rd(n,s.targetId),await Hh(n.localStore,s.targetId,!0))}async function _d(t,e){const n=Ks(t);try{const t=await function(t,e){const n=Ks(t),s=e.snapshotVersion;let r=n.Ki;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.ji.newChangeBuffer({trackRemovals:!0});r=n.Ki;const o=[];e.targetChanges.forEach(((i,a)=>{const u=r.get(a);if(!u)return;o.push(n.Ns.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Ns.addMatchingKeys(t,i.addedDocuments,a))));let c=u.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?c=c.withResumeToken(Zr.EMPTY_BYTE_STRING,ar.min()).withLastLimboFreeSnapshotVersion(ar.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,s)),r=r.insert(a,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,c,i)&&o.push(n.Ns.updateTargetData(t,c))}));let a=Ia(),u=Ca();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push($h(t,i,e.documentUpdates).next((t=>{a=t.Hi,u=t.Ji}))),!s.isEqual(ar.min())){const e=n.Ns.getLastRemoteSnapshotVersion(t).next((e=>n.Ns.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return xr.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,u))).next((()=>a))})).then((t=>(n.Ki=r,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.hc.get(e);s&&(qs(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.ic=!0:t.modifiedDocuments.size>0?qs(s.ic):t.removedDocuments.size>0&&(qs(s.ic),s.ic=!1))})),await Vd(n,t,e)}catch(t){await Ar(t)}}function Ad(t,e,n){const s=Ks(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.oc.forEach(((n,s)=>{const r=s.view.Pu(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=Ks(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Pu(e)&&(s=!0)})),s&&hd(n)}(s.eventManager,e),t.length&&s.rc.Ho(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function xd(t,e,n){const s=Ks(t);s.sharedClientState.updateQueryState(e,"rejected",n);const r=s.hc.get(e),i=r&&r.key;if(i){let t=new Ji(dr.comparator);t=t.insert(i,ao.newNoDocument(i,ar.min()));const n=Ca().add(i),r=new Ra(ar.min(),new Map,new eo(sr),t,n);await _d(s,r),s.ac=s.ac.remove(i),s.hc.delete(e),Fd(s)}else await Hh(s.localStore,e,!1).then((()=>Rd(s,e,n))).catch(Ar)}async function Dd(t,e){const n=Ks(t),s=e.batch.batchId;try{const t=await function(t,e){const n=Ks(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),r=n.ji.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const r=n.batch,i=r.keys();let o=xr.resolve();return i.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);qs(null!==i),e.version.compareTo(i)<0&&(r.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,r)))}(n,t,e,r).next((()=>r.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Ca();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(n.localStore,e);kd(n,s,null),Nd(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Vd(n,t)}catch(t){await Ar(t)}}async function Cd(t,e,n){const s=Ks(t);try{const t=await function(t,e){const n=Ks(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(qs(null!==e),s=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,s))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(s.localStore,e);kd(s,e,n),Nd(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Vd(s,t)}catch(n){await Ar(n)}}function Nd(t,e){(t.dc.get(e)||[]).forEach((t=>{t.resolve()})),t.dc.delete(e)}function kd(t,e,n){const s=Ks(t);let r=s.fc[s.currentUser.toKey()];if(r){const t=r.get(e);t&&(n?t.reject(n):t.resolve(),r=r.remove(e)),s.fc[s.currentUser.toKey()]=r}}function Rd(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.uc.get(e))t.oc.delete(s),n&&t.rc.gc(s,n);t.uc.delete(e),t.isPrimaryClient&&t.lc.ds(e).forEach((e=>{t.lc.containsKey(e)||Md(t,e)}))}function Md(t,e){t.cc.delete(e.path.canonicalString());const n=t.ac.get(e);null!==n&&(Dl(t.remoteStore,n),t.ac=t.ac.remove(e),t.hc.delete(n),Fd(t))}function Ld(t,e,n){for(const s of n)s instanceof pd?(t.lc.addReference(s.key,e),Od(t,s)):s instanceof yd?(Os("SyncEngine","Document no longer in limbo: "+s.key),t.lc.removeReference(s.key,e),t.lc.containsKey(s.key)||Md(t,s.key)):Us()}function Od(t,e){const n=e.key,s=n.path.canonicalString();t.ac.get(n)||t.cc.has(s)||(Os("SyncEngine","New document in limbo: "+n),t.cc.add(s),Fd(t))}function Fd(t){for(;t.cc.size>0&&t.ac.size<t.maxConcurrentLimboResolutions;){const e=t.cc.values().next().value;t.cc.delete(e);const n=new dr(cr.fromString(e)),s=t._c.next();t.hc.set(s,new Id(n)),t.ac=t.ac.insert(n,s),xl(t.remoteStore,new Yu(_o(vo(n.path)),s,2,Ur.at))}}async function Vd(t,e,n){const s=Ks(t),r=[],i=[],o=[];s.oc.isEmpty()||(s.oc.forEach(((t,a)=>{o.push(s.mc(a,e,n).then((t=>{if((t||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=Uh.Ni(a.targetId,t);i.push(e)}})))})),await Promise.all(o),s.rc.Ho(r),await async function(t,e){const n=Ks(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>xr.forEach(e,(e=>xr.forEach(e.Ci,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>xr.forEach(e.xi,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!Rr(t))throw t;Os("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ki.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.Ki=n.Ki.insert(e,r)}}}(s.localStore,i))}async function Pd(t,e){const n=Ks(t);if(!n.currentUser.isEqual(e)){Os("SyncEngine","User change. New user:",e.toKey());const t=await Gh(n.localStore,e);n.currentUser=e,function(t,e){t.dc.forEach((t=>{t.forEach((t=>{t.reject(new js(Gs.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.dc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Vd(n,t.Wi)}}function Ud(t,e){const n=Ks(t),s=n.hc.get(e);if(s&&s.ic)return Ca().add(s.key);{let t=Ca();const s=n.uc.get(e);if(!s)return t;for(const e of s){const s=n.oc.get(e);t=t.unionWith(s.view.Wu)}return t}}async function qd(t,e){const n=Ks(t),s=await Wh(n.localStore,e.query,!0),r=e.view.nc(s);return n.isPrimaryClient&&Ld(n,e.targetId,r.tc),r}async function Bd(t,e){const n=Ks(t);return Yh(n.localStore,e).then((t=>Vd(n,t)))}async function Kd(t,e,n,s){const r=Ks(t),i=await function(t,e){const n=Ks(t),s=Ks(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.An(t,e).next((e=>e?n.localDocuments.getDocuments(t,e):xr.resolve(null)))))}(r.localStore,e);null!==i?("pending"===n?await ql(r.remoteStore):"acknowledged"===n||"rejected"===n?(kd(r,e,s||null),Nd(r,e),function(t,e){Ks(Ks(t).mutationQueue).bn(e)}(r.localStore,e)):Us(),await Vd(r,i)):Os("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Gd(t,e,n){const s=Ks(t),r=[],i=[];for(const t of e){let e;const n=s.uc.get(t);if(n&&0!==n.length){e=await zh(s.localStore,_o(n[0]));for(const t of n){const e=s.oc.get(t),n=await qd(s,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await Xh(s.localStore,t);e=await zh(s.localStore,n),await Ed(s,jd(n),t,!1,e.resumeToken)}r.push(e)}return s.rc.Ho(i),r}function jd(t){return wo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function $d(t){const e=Ks(t);return Ks(Ks(e.localStore).persistence).Si()}async function Qd(t,e,n,s){const r=Ks(t);if(r.wc)return void Os("SyncEngine","Ignoring unexpected query state notification.");const i=r.uc.get(e);if(i&&i.length>0)switch(n){case"current":case"not-current":{const t=await Yh(r.localStore,Ro(i[0])),s=Ra.createSynthesizedRemoteEventForCurrentChange(e,"current"===n,Zr.EMPTY_BYTE_STRING);await Vd(r,t,s);break}case"rejected":await Hh(r.localStore,e,!0),Rd(r,e,s);break;default:Us()}}async function zd(t,e,n){const s=Hd(t);if(s.wc){for(const t of e){if(s.uc.has(t)){Os("SyncEngine","Adding an already active target "+t);continue}const e=await Xh(s.localStore,t),n=await zh(s.localStore,e);await Ed(s,jd(e),n.targetId,!1,n.resumeToken),xl(s.remoteStore,n)}for(const t of n)s.uc.has(t)&&await Hh(s.localStore,t,!1).then((()=>{Dl(s.remoteStore,t),Rd(s,t)})).catch(Ar)}}function Hd(t){const e=Ks(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=_d.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ud.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xd.bind(null,e),e.rc.Ho=ud.bind(null,e.eventManager),e.rc.gc=cd.bind(null,e.eventManager),e}function Wd(t){const e=Ks(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Dd.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Cd.bind(null,e),e}class Xd{constructor(){this.synchronizeTabs=!1}async initialize(t){this.Tt=yl(t.databaseInfo.databaseId),this.sharedClientState=this.Ic(t),this.persistence=this.Tc(t),await this.persistence.start(),this.localStore=this.Ec(t),this.gcScheduler=this.Ac(t,this.localStore),this.indexBackfillerScheduler=this.Rc(t,this.localStore)}Ac(t,e){return null}Rc(t,e){return null}Ec(t){return Kh(this.persistence,new qh,t.initialUser,this.Tt)}Tc(t){return new Ch(kh.qs,this.Tt)}Ic(t){return new cl}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Yd extends Xd{constructor(t,e,n){super(),this.bc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.bc.initialize(this,t),await Wd(this.bc.syncEngine),await ql(this.bc.remoteStore),await this.persistence.di((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}Ec(t){return Kh(this.persistence,new qh,t.initialUser,this.Tt)}Ac(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new oh(n,t.asyncQueue,e)}Rc(t,e){const n=new Pr(e,this.persistence);return new Vr(t.asyncQueue,n)}Tc(t){const e=Ph(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?$c.withCacheSize(this.cacheSizeBytes):$c.DEFAULT;return new Oh(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,gl(),pl(),this.Tt,this.sharedClientState,!!this.forceOwnership)}Ic(t){return new cl}}class Jd extends Yd{constructor(t,e){super(t,e,!1),this.bc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.bc.syncEngine;this.sharedClientState instanceof ul&&(this.sharedClientState.syncEngine={Br:Kd.bind(null,e),Lr:Qd.bind(null,e),qr:zd.bind(null,e),Si:$d.bind(null,e),$r:Bd.bind(null,e)},await this.sharedClientState.start()),await this.persistence.di((async t=>{await async function(t,e){const n=Ks(t);if(Hd(n),Wd(n),!0===e&&!0!==n.wc){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Gd(n,t.toArray());n.wc=!0,await Xl(n.remoteStore,!0);for(const t of e)xl(n.remoteStore,t)}else if(!1===e&&!1!==n.wc){const t=[];let e=Promise.resolve();n.uc.forEach(((s,r)=>{n.sharedClientState.isLocalQueryTarget(r)?t.push(r):e=e.then((()=>(Rd(n,r),Hh(n.localStore,r,!0)))),Dl(n.remoteStore,r)})),await e,await Gd(n,t),function(t){const e=Ks(t);e.hc.forEach(((t,n)=>{Dl(e.remoteStore,n)})),e.lc._s(),e.hc=new Map,e.ac=new Ji(dr.comparator)}(n),n.wc=!1,await Xl(n.remoteStore,!1)}}(this.bc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start():t||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(t&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():t||this.indexBackfillerScheduler.stop())}))}Ic(t){const e=gl();if(!ul.C(e))throw new js(Gs.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ph(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new ul(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class Zd{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Ad(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Pd.bind(null,this.syncEngine),await Xl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new id}createDatastore(t){const e=yl(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new ml(s));var s;return function(t,e,n,s){return new bl(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,r=t=>Ad(this.syncEngine,t,0),i=ll.C()?new ll:new hl,new Sl(e,n,s,r,i);var e,n,s,r,i}createSyncEngine(t,e){return function(t,e,n,s,r,i,o){const a=new Td(t,e,n,s,r,i);return o&&(a.wc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Ks(t);Os("RemoteStore","RemoteStore shutting down."),e.mu.add(5),await Al(e),e.yu.shutdown(),e.pu.set("Unknown")}(this.remoteStore)}}function tf(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class ef{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.vc(this.observer.next,t)}error(t){this.observer.error?this.vc(this.observer.error,t):Fs("Uncaught Error in snapshot listener:",t.toString())}Pc(){this.muted=!0}vc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class nf{constructor(t,e){this.Vc=t,this.Tt=e,this.metadata=new $s,this.buffer=new Uint8Array,this.Sc=new TextDecoder("utf-8"),this.Dc().then((t=>{t&&t.Fu()?this.metadata.resolve(t.Mu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.Mu)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Vc.cancel()}async getMetadata(){return this.metadata.promise}async yc(){return await this.getMetadata(),this.Dc()}async Dc(){const t=await this.Cc();if(null===t)return null;const e=this.Sc.decode(t),n=Number(e);isNaN(n)&&this.xc(`length string (${e}) is not valid number`);const s=await this.Nc(n);return new dd(JSON.parse(s),t.length+n)}kc(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async Cc(){for(;this.kc()<0&&!await this.Oc(););if(0===this.buffer.length)return null;const t=this.kc();t<0&&this.xc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Nc(t){for(;this.buffer.length<t;)await this.Oc()&&this.xc("Reached the end of bundle when more is expected.");const e=this.Sc.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}xc(t){throw this.Vc.cancel(),new Error(`Invalid bundle format: ${t}`)}async Oc(){const t=await this.Vc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class sf{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new js(Gs.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ks(t),s=eu(n.Tt)+"/documents",r={documents:e.map((t=>Ya(n.Tt,t)))},i=await n.mo("BatchGetDocuments",s,r,e.length),o=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){qs(!!e.found),e.found.name,e.found.updateTime;const n=Ja(t,e.found.name),s=Ha(e.found.updateTime),r=e.found.createTime?Ha(e.found.createTime):ar.min(),i=new io({mapValue:{fields:e.found.fields}});return ao.newFoundDocument(n,s,r,i)}(t,e):"missing"in e?function(t,e){qs(!!e.missing),qs(!!e.readTime);const n=Ja(t,e.missing),s=Ha(e.readTime);return ao.newNoDocument(n,s)}(t,e):Us()}(n.Tt,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());qs(!!e),a.push(e)})),a}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new la(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=dr.fromPath(e);this.mutations.push(new da(n,this.precondition(n)))})),await async function(t,e){const n=Ks(t),s=eu(n.Tt)+"/documents",r={writes:e.map((t=>iu(n.Tt,t)))};await n.lo("Commit",s,r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Us();e=ar.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new js(Gs.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(ar.min())?Jo.exists(!1):Jo.updateTime(e):Jo.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ar.min()))throw new js(Gs.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jo.updateTime(e)}return Jo.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class rf{constructor(t,e,n,s,r){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=r,this.Mc=n.maxAttempts,this.ko=new wl(this.asyncQueue,"transaction_retry")}run(){this.Mc-=1,this.Fc()}Fc(){this.ko.vo((async()=>{const t=new sf(this.datastore),e=this.$c(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Bc(t)}))))})).catch((t=>{this.Bc(t)}))}))}$c(t){try{const e=this.updateFunction(t);return!Hr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Bc(t){this.Mc>0&&this.Lc(t)?(this.Mc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Fc(),Promise.resolve())))):this.deferred.reject(t)}Lc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!pa(e)}return!1}}class of{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=Ns.UNAUTHENTICATED,this.clientId=nr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Os("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Os("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new js(Gs.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new $s;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=td(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function af(t,e){t.asyncQueue.verifyOperationInProgress(),Os("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await Gh(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function uf(t,e){t.asyncQueue.verifyOperationInProgress();const n=await cf(t);Os("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>Wl(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Wl(e.remoteStore,n))),t.onlineComponents=e}async function cf(t){return t.offlineComponents||(Os("FirestoreClient","Using default OfflineComponentProvider"),await af(t,new Xd)),t.offlineComponents}async function hf(t){return t.onlineComponents||(Os("FirestoreClient","Using default OnlineComponentProvider"),await uf(t,new Zd)),t.onlineComponents}function lf(t){return cf(t).then((t=>t.persistence))}function df(t){return cf(t).then((t=>t.localStore))}function ff(t){return hf(t).then((t=>t.remoteStore))}function mf(t){return hf(t).then((t=>t.syncEngine))}function gf(t){return hf(t).then((t=>t.datastore))}async function pf(t){const e=await hf(t),n=e.eventManager;return n.onListen=bd.bind(null,e.syncEngine),n.onUnlisten=Sd.bind(null,e.syncEngine),n}function yf(t,e,n={}){const s=new $s;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,r){const i=new ef({next:i=>{e.enqueueAndForget((()=>ad(t,o)));const a=i.docs.has(n);!a&&i.fromCache?r.reject(new js(Gs.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&s&&"server"===s.source?r.reject(new js(Gs.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(i)},error:t=>r.reject(t)}),o=new ld(vo(n.path),i,{includeMetadataChanges:!0,Ou:!0});return od(t,o)}(await pf(t),t.asyncQueue,e,n,s))),s.promise}function wf(t,e,n={}){const s=new $s;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,r){const i=new ef({next:n=>{e.enqueueAndForget((()=>ad(t,o))),n.fromCache&&"server"===s.source?r.reject(new js(Gs.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),o=new ld(n,i,{includeMetadataChanges:!0,Ou:!0});return od(t,o)}(await pf(t),t.asyncQueue,e,n,s))),s.promise}function vf(t,e,n,s){const r=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new nf(t,e)}(function(t,e){if(t instanceof Uint8Array)return tf(t,e);if(t instanceof ArrayBuffer)return tf(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,yl(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const s=Ks(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=Ks(t),s=Ha(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Os.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s)),Promise.resolve(new Set);n._updateProgress(gd(s));const r=new md(s,t.localStore,e.Tt);let i=await e.yc();for(;i;){const t=await r.Bu(i);t&&n._updateProgress(t),i=await e.yc()}const o=await r.complete();return await Vd(t,o.Uu,void 0),await function(t,e){const n=Ks(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Os.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress),Promise.resolve(o.qu)}catch(t){return Vs("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}})(s,e,n).then((t=>{s.sharedClientState.notifyBundleLoaded(t)}))}(await mf(t),r,s)}))}const If=new Map;function Tf(t,e,n){if(!n)throw new js(Gs.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function bf(t,e,n,s){if(!0===e&&!0===s)throw new js(Gs.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Ef(t){if(!dr.isDocumentKey(t))throw new js(Gs.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Sf(t){if(dr.isDocumentKey(t))throw new js(Gs.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function _f(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Us()}function Af(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new js(Gs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=_f(t);throw new js(Gs.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function xf(t,e){if(e<=0)throw new js(Gs.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Df{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new js(Gs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new js(Gs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,bf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Cf{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Df({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new js(Gs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new js(Gs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Df(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new zs;switch(t.type){case"gapi":const e=t.client;return new Ys(e,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new js(Gs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=If.get(t);e&&(Os("ComponentProvider","Removing Datastore"),If.delete(t),e.terminate())}(this),Promise.resolve()}}function Nf(t,e,n,s={}){var r;const i=(t=Af(t,Cf))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Vs("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=Ns.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[c(JSON.stringify({alg:"none",type:"JWT"})),c(JSON.stringify(i)),""].join(".")}(s.mockUserToken,null===(r=t._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new js(Gs.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ns(i)}t._authCredentials=new Hs(new Qs(e,n))}}class kf{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mf(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new kf(this.firestore,t,this._key)}}class Rf{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Rf(this.firestore,t,this._query)}}class Mf extends Rf{constructor(t,e,n){super(t,e,vo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new kf(this.firestore,null,new dr(t))}withConverter(t){return new Mf(this.firestore,t,this._path)}}function Lf(t,e,...n){if(t=T(t),Tf("collection","path",e),t instanceof Cf){const s=cr.fromString(e,...n);return Sf(s),new Mf(t,null,s)}{if(!(t instanceof kf||t instanceof Mf))throw new js(Gs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(cr.fromString(e,...n));return Sf(s),new Mf(t.firestore,null,s)}}function Of(t,e){if(t=Af(t,Cf),Tf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new js(Gs.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Rf(t,null,function(t){return new yo(cr.emptyPath(),t)}(e))}function Ff(t,e,...n){if(t=T(t),1===arguments.length&&(e=nr.R()),Tf("doc","path",e),t instanceof Cf){const s=cr.fromString(e,...n);return Ef(s),new kf(t,null,new dr(s))}{if(!(t instanceof kf||t instanceof Mf))throw new js(Gs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(cr.fromString(e,...n));return Ef(s),new kf(t.firestore,t instanceof Mf?t.converter:null,new dr(s))}}function Vf(t,e){return t=T(t),e=T(e),(t instanceof kf||t instanceof Mf)&&(e instanceof kf||e instanceof Mf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Pf(t,e){return t=T(t),e=T(e),t instanceof Rf&&e instanceof Rf&&t.firestore===e.firestore&&Do(t._query,e._query)&&t.converter===e.converter}class Uf{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new wl(this,"async_queue_retry"),this.Hc=()=>{const t=pl();t&&Os("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ko.Vo()};const t=pl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Jc(),this.Yc(t)}enterRestrictedMode(t){if(!this.Kc){this.Kc=!0,this.zc=t||!1;const e=pl();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Hc)}}enqueue(t){if(this.Jc(),this.Kc)return new Promise((()=>{}));const e=new $s;return this.Yc((()=>this.Kc&&this.zc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Uc.push(t),this.Zc())))}async Zc(){if(0!==this.Uc.length){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(t){if(!Rr(t))throw t;Os("AsyncQueue","Operation failed with retryable error: "+t)}this.Uc.length>0&&this.ko.vo((()=>this.Zc()))}}Yc(t){const e=this.qc.then((()=>(this.jc=!0,t().catch((t=>{this.Qc=t,this.jc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Fs("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.jc=!1,t))))));return this.qc=e,e}enqueueAfterDelay(t,e,n){this.Jc(),this.Wc.indexOf(t)>-1&&(e=0);const s=Zl.createAndSchedule(this,t,e,n,(t=>this.Xc(t)));return this.Gc.push(s),s}Jc(){this.Qc&&Us()}verifyOperationInProgress(){}async ta(){let t;do{t=this.qc,await t}while(t!==this.qc)}ea(t){for(const e of this.Gc)if(e.timerId===t)return!0;return!1}na(t){return this.ta().then((()=>{this.Gc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Gc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ta()}))}sa(t){this.Wc.push(t)}Xc(t){const e=this.Gc.indexOf(t);this.Gc.splice(e,1)}}function qf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Bf{constructor(){this._progressObserver={},this._taskCompletionResolver=new $s,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const Kf=-1;class Gf extends Cf{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new Uf,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||zf(this),this._firestoreClient.terminate()}}function jf(t,e,s){s||(s="(default)");const r=n(t,"firestore");if(r.isInitialized(s)){const t=r.getImmediate({identifier:s});if(v(r.getOptions(s),e))return t;throw new js(Gs.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new js(Gs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:s})}function $f(t,e){const r="object"==typeof t?t:s(),i="string"==typeof t?t:e||"(default)",o=n(r,"firestore").getImmediate({identifier:i});if(!o._initialized){const t=f("firestore");t&&Nf(o,...t)}return o}function Qf(t){return t._firestoreClient||zf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function zf(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new Gr(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new of(t._authCredentials,t._appCheckCredentials,t._queue,s)}function Hf(t,e){rm(t=Af(t,Gf));const n=Qf(t),s=t._freezeSettings(),r=new Zd;return Xf(n,r,new Yd(r,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function Wf(t){rm(t=Af(t,Gf));const e=Qf(t),n=t._freezeSettings(),s=new Zd;return Xf(e,s,new Jd(s,n.cacheSizeBytes))}function Xf(t,e,n){const s=new $s;return t.asyncQueue.enqueue((async()=>{try{await af(t,n),await uf(t,e),s.resolve()}catch(t){const e=t;if(!function(t){return"FirebaseError"===t.name?t.code===Gs.FAILED_PRECONDITION||t.code===Gs.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(e))throw e;Vs("Error enabling offline persistence. Falling back to persistence disabled: "+e),s.reject(e)}})).then((()=>s.promise))}function Yf(t){if(t._initialized&&!t._terminated)throw new js(Gs.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new $s;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Cr.C())return Promise.resolve();const e=t+"main";await Cr.delete(e)}(Ph(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Jf(t){return function(t){const e=new $s;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Ks(t);Ml(n.remoteStore)||Os("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=Ks(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.dc.get(t)||[];s.push(e),n.dc.set(t,s)}catch(t){const n=td(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await mf(t),e))),e.promise}(Qf(t=Af(t,Gf)))}function Zf(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await lf(t),n=await ff(t);return e.setNetworkEnabled(!0),function(t){const e=Ks(t);return e.mu.delete(0),_l(e)}(n)}))}(Qf(t=Af(t,Gf)))}function tm(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await lf(t),n=await ff(t);return e.setNetworkEnabled(!1),async function(t){const e=Ks(t);e.mu.add(0),await Al(e),e.pu.set("Offline")}(n)}))}(Qf(t=Af(t,Gf)))}function em(t){return r(t.app,"firestore",t._databaseId.database),t._delete()}function nm(t,e){const n=Qf(t=Af(t,Gf)),s=new Bf;return vf(n,t._databaseId,e,s),s}function sm(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=Ks(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Os.getNamedQuery(t,e)))}(await df(t),e)))}(Qf(t=Af(t,Gf)),e).then((e=>e?new Rf(t,null,e.query):null))}function rm(t){if(t._initialized||t._terminated)throw new js(Gs.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class im{constructor(t="count",e){this._aggregateType=t,this._internalFieldPath=e,this.type="AggregateField"}}class om{constructor(t,e,n){this._userDataWriter=e,this._data=n,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertValue(this._data.value)}}class am{constructor(t){this._byteString=t}static fromBase64String(t){try{return new am(Zr.fromBase64String(t))}catch(t){throw new js(Gs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new am(Zr.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class um{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new js(Gs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lr(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function cm(){return new um("__name__")}class hm{constructor(t){this._methodName=t}}class lm{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new js(Gs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new js(Gs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return sr(this._lat,t._lat)||sr(this._long,t._long)}}const dm=/^__.*__$/;class fm{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new aa(t,this.data,this.fieldMask,e,this.fieldTransforms):new oa(t,this.data,e,this.fieldTransforms)}}class mm{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new aa(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function gm(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Us()}}class pm{constructor(t,e,n,s,r,i){this.settings=t,this.databaseId=e,this.Tt=n,this.ignoreUndefinedProperties=s,void 0===r&&this.ia(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(t){return new pm(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.oa({path:n,ca:!1});return s.aa(t),s}ha(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.oa({path:n,ca:!1});return s.ia(),s}la(t){return this.oa({path:void 0,ca:!0})}fa(t){return Fm(t,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ia(){if(this.path)for(let t=0;t<this.path.length;t++)this.aa(this.path.get(t))}aa(t){if(0===t.length)throw this.fa("Document fields must not be empty");if(gm(this.ra)&&dm.test(t))throw this.fa('Document fields cannot begin and end with "__"')}}class ym{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.Tt=n||yl(t)}wa(t,e,n,s=!1){return new pm({ra:t,methodName:e,_a:n,path:lr.emptyPath(),ca:!1,da:s},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function wm(t){const e=t._freezeSettings(),n=yl(t._databaseId);return new ym(t._databaseId,!!e.ignoreUndefinedProperties,n)}function vm(t,e,n,s,r,i={}){const o=t.wa(i.merge||i.mergeFields?2:0,e,n,r);Rm("Data must be an object, but it was:",o,s);const a=Nm(s,o);let u,c;if(i.merge)u=new ro(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const s of i.mergeFields){const r=Mm(e,s,n);if(!o.contains(r))throw new js(Gs.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);Vm(t,r)||t.push(r)}u=new ro(t),c=o.fieldTransforms.filter((t=>u.covers(t.field)))}else u=null,c=o.fieldTransforms;return new fm(new io(a),u,c)}class Im extends hm{_toFieldTransform(t){if(2!==t.ra)throw 1===t.ra?t.fa(`${this._methodName}() can only appear at the top level of your update data`):t.fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Im}}function Tm(t,e,n){return new pm({ra:3,_a:e.settings._a,methodName:t._methodName,ca:n},e.databaseId,e.Tt,e.ignoreUndefinedProperties)}class bm extends hm{_toFieldTransform(t){return new Xo(t.path,new Ko)}isEqual(t){return t instanceof bm}}class Em extends hm{constructor(t,e){super(t),this.ma=e}_toFieldTransform(t){const e=Tm(this,t,!0),n=this.ma.map((t=>Cm(t,e))),s=new Go(n);return new Xo(t.path,s)}isEqual(t){return this===t}}class Sm extends hm{constructor(t,e){super(t),this.ma=e}_toFieldTransform(t){const e=Tm(this,t,!0),n=this.ma.map((t=>Cm(t,e))),s=new $o(n);return new Xo(t.path,s)}isEqual(t){return this===t}}class _m extends hm{constructor(t,e){super(t),this.ga=e}_toFieldTransform(t){const e=new zo(t.Tt,Vo(t.Tt,this.ga));return new Xo(t.path,e)}isEqual(t){return this===t}}function Am(t,e,n,s){const r=t.wa(1,e,n);Rm("Data must be an object, but it was:",r,s);const i=[],o=io.empty();Qr(s,((t,s)=>{const a=Om(e,t,n);s=T(s);const u=r.ha(a);if(s instanceof Im)i.push(a);else{const t=Cm(s,u);null!=t&&(i.push(a),o.set(a,t))}}));const a=new ro(i);return new mm(o,a,r.fieldTransforms)}function xm(t,e,n,s,r,i){const o=t.wa(1,e,n),a=[Mm(e,s,n)],u=[r];if(i.length%2!=0)throw new js(Gs.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(Mm(e,i[t])),u.push(i[t+1]);const c=[],h=io.empty();for(let t=a.length-1;t>=0;--t)if(!Vm(c,a[t])){const e=a[t];let n=u[t];n=T(n);const s=o.ha(e);if(n instanceof Im)c.push(e);else{const t=Cm(n,s);null!=t&&(c.push(e),h.set(e,t))}}const l=new ro(c);return new mm(h,l,o.fieldTransforms)}function Dm(t,e,n,s=!1){return Cm(n,t.wa(s?4:3,e))}function Cm(t,e){if(km(t=T(t)))return Rm("Unsupported field value:",e,t),Nm(t,e);if(t instanceof hm)return function(t,e){if(!gm(e.ra))throw e.fa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.fa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.ca&&4!==e.ra)throw e.fa("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const r of t){let t=Cm(r,e.la(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=T(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Vo(e.Tt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=or.fromDate(t);return{timestampValue:$a(e.Tt,n)}}if(t instanceof or){const n=new or(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:$a(e.Tt,n)}}if(t instanceof lm)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof am)return{bytesValue:Qa(e.Tt,t._byteString)};if(t instanceof kf){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.fa(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Wa(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.fa(`Unsupported field value: ${_f(t)}`)}(t,e)}function Nm(t,e){const n={};return zr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Qr(t,((t,s)=>{const r=Cm(s,e.ua(t));null!=r&&(n[t]=r)})),{mapValue:{fields:n}}}function km(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof or||t instanceof lm||t instanceof am||t instanceof kf||t instanceof hm)}function Rm(t,e,n){if(!km(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=_f(n);throw"an object"===s?e.fa(t+" a custom object"):e.fa(t+" "+s)}}function Mm(t,e,n){if((e=T(e))instanceof um)return e._internalPath;if("string"==typeof e)return Om(t,e);throw Fm("Field path arguments must be of type string or ",t,!1,void 0,n)}const Lm=new RegExp("[~\\*/\\[\\]]");function Om(t,e,n){if(e.search(Lm)>=0)throw Fm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new um(...e.split("."))._internalPath}catch(s){throw Fm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Fm(t,e,n,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${s}`),o&&(u+=` in document ${r}`),u+=")"),new js(Gs.INVALID_ARGUMENT,a+t+u)}function Vm(t,e){return t.some((t=>t.isEqual(e)))}class Pm{constructor(t,e,n,s,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new kf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Um(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(qm("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Um extends Pm{data(){return super.data()}}function qm(t,e){return"string"==typeof e?Om(t,e):e instanceof um?e._internalPath:e._delegate._internalPath}function Bm(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new js(Gs.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Km{}class Gm extends Km{}function jm(t,e,...n){let s=[];e instanceof Km&&s.push(e),s=s.concat(n),function(t){const e=t.filter((t=>t instanceof zm)).length,n=t.filter((t=>t instanceof $m)).length;if(e>1||e>0&&n>0)throw new js(Gs.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const e of s)t=e._apply(t);return t}class $m extends Gm{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new $m(t,e,n)}_apply(t){const e=this._parse(t);return hg(t._query,e),new Rf(t.firestore,t.converter,Ao(t._query,e))}_parse(t){const e=wm(t.firestore),n=function(t,e,n,s,r,i,o){let a;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new js(Gs.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){cg(o,i);const e=[];for(const n of o)e.push(ug(s,t,n));a={arrayValue:{values:e}}}else a=ug(s,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||cg(o,i),a=Dm(n,"where",o,"in"===i||"not-in"===i);return Ri.create(r,i,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function Qm(t,e,n){const s=e,r=qm("where",t);return $m._create(r,s,n)}class zm extends Km{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new zm(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:Mi.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const s=e.getFlattenedFilters();for(const t of s)hg(n,t),n=Ao(n,t)}(t._query,e),new Rf(t.firestore,t.converter,Ao(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Hm(...t){return t.forEach((t=>dg("or",t))),zm._create("or",t)}function Wm(...t){return t.forEach((t=>dg("and",t))),zm._create("and",t)}class Xm extends Gm{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Xm(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new js(Gs.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new js(Gs.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Xi(e,n);return function(t,e){if(null===To(t)){const n=bo(t);null!==n&&lg(t,n,e.field)}}(t,s),s}(t._query,this._field,this._direction);return new Rf(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new yo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Ym(t,e="asc"){const n=e,s=qm("orderBy",t);return Xm._create(s,n)}class Jm extends Gm{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new Jm(t,e,n)}_apply(t){return new Rf(t.firestore,t.converter,xo(t._query,this._limit,this._limitType))}}function Zm(t){return xf("limit",t),Jm._create("limit",t,"F")}function tg(t){return xf("limitToLast",t),Jm._create("limitToLast",t,"L")}class eg extends Gm{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new eg(t,e,n)}_apply(t){const e=ag(t,this.type,this._docOrFields,this._inclusive);return new Rf(t.firestore,t.converter,function(t,e){return new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function ng(...t){return eg._create("startAt",t,!0)}function sg(...t){return eg._create("startAfter",t,!1)}class rg extends Gm{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new rg(t,e,n)}_apply(t){const e=ag(t,this.type,this._docOrFields,this._inclusive);return new Rf(t.firestore,t.converter,function(t,e){return new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function ig(...t){return rg._create("endBefore",t,!1)}function og(...t){return rg._create("endAt",t,!0)}function ag(t,e,n,s){if(n[0]=T(n[0]),n[0]instanceof Pm)return function(t,e,n,s,r){if(!s)throw new js(Gs.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of So(t))if(n.field.isKeyField())i.push(pi(e,s.key));else{const t=s.data.field(n.field);if(ri(t))throw new js(Gs.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new js(Gs.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new Di(i,r)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const r=wm(t.firestore);return function(t,e,n,s,r,i){const o=t.explicitOrderBy;if(r.length>o.length)throw new js(Gs.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<r.length;i++){const u=r[i];if(o[i].field.isKeyField()){if("string"!=typeof u)throw new js(Gs.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof u}`);if(!Eo(t)&&-1!==u.indexOf("/"))throw new js(Gs.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(cr.fromString(u));if(!dr.isDocumentKey(n))throw new js(Gs.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new dr(n);a.push(pi(e,r))}else{const t=Dm(n,s,u);a.push(t)}}return new Di(a,i)}(t._query,t.firestore._databaseId,r,e,n,s)}}function ug(t,e,n){if("string"==typeof(n=T(n))){if(""===n)throw new js(Gs.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Eo(e)&&-1!==n.indexOf("/"))throw new js(Gs.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(cr.fromString(n));if(!dr.isDocumentKey(s))throw new js(Gs.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return pi(t,new dr(s))}if(n instanceof kf)return pi(t,n._key);throw new js(Gs.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_f(n)}.`)}function cg(t,e){if(!Array.isArray(t)||0===t.length)throw new js(Gs.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hg(t,e){if(e.isInequality()){const n=bo(t),s=e.field;if(null!==n&&!n.isEqual(s))throw new js(Gs.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${s.toString()}'`);const r=To(t);null!==r&&lg(t,s,r)}const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new js(Gs.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new js(Gs.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function lg(t,e,n){if(!n.isEqual(e))throw new js(Gs.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function dg(t,e){if(!(e instanceof $m||e instanceof zm))throw new js(Gs.INVALID_ARGUMENT,`Function ${t}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class fg{convertValue(t,e="none"){switch(ci(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ni(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(si(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Us()}}convertObject(t,e){const n={};return Qr(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new lm(ni(t.latitude),ni(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ii(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(oi(t));default:return null}}convertTimestamp(t){const e=ei(t);return new or(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=cr.fromString(t);qs(wu(n));const s=new jr(n.get(1),n.get(3)),r=new dr(n.popFirst(5));return s.isEqual(e)||Fs(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}function mg(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class gg extends fg{constructor(t){super(),this.firestore=t}convertBytes(t){return new am(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new kf(this.firestore,null,e)}}function pg(t){return new im("sum",Mm("sum",t))}function yg(t){return new im("avg",Mm("average",t))}function wg(){return new im("count")}function vg(t,e){var n,s;return t instanceof im&&e instanceof im&&t._aggregateType===e._aggregateType&&(null===(n=t._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(s=e._internalFieldPath)||void 0===s?void 0:s.canonicalString())}function Ig(t,e){return Pf(t.query,e.query)&&v(t.data(),e.data())}class Tg{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class bg extends Pm{constructor(t,e,n,s,r,i){super(t,e,n,s,i),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Eg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(qm("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Eg extends bg{data(t={}){return super.data(t)}}class Sg{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Tg(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Eg(this._firestore,this._userDataWriter,n.key,n,new Tg(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new js(Gs.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const s=new Eg(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Tg(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Eg(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Tg(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,i=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:_g(e.type),doc:s,oldIndex:r,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function _g(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Us()}}function Ag(t,e){return t instanceof bg&&e instanceof bg?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Sg&&e instanceof Sg&&t._firestore===e._firestore&&Pf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function xg(t){t=Af(t,kf);const e=Af(t.firestore,Gf);return yf(Qf(e),t._key).then((n=>Bg(e,t,n)))}class Dg extends fg{constructor(t){super(),this.firestore=t}convertBytes(t){return new am(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new kf(this.firestore,null,e)}}function Cg(t){t=Af(t,kf);const e=Af(t.firestore,Gf),n=Qf(e),s=new Dg(e);return function(t,e){const n=new $s;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=Ks(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new js(Gs.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=td(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await df(t),e,n))),n.promise}(n,t._key).then((n=>new bg(e,s,t._key,n,new Tg(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Ng(t){t=Af(t,kf);const e=Af(t.firestore,Gf);return yf(Qf(e),t._key,{source:"server"}).then((n=>Bg(e,t,n)))}function kg(t){t=Af(t,Rf);const e=Af(t.firestore,Gf),n=Qf(e),s=new Dg(e);return Bm(t._query),wf(n,t._query).then((n=>new Sg(e,s,t,n)))}function Rg(t){t=Af(t,Rf);const e=Af(t.firestore,Gf),n=Qf(e),s=new Dg(e);return function(t,e){const n=new $s;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await Wh(t,e,!0),r=new wd(e,s.Yi),i=r.Hu(s.documents),o=r.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const s=td(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await df(t),e,n))),n.promise}(n,t._query).then((n=>new Sg(e,s,t,n)))}function Mg(t){t=Af(t,Rf);const e=Af(t.firestore,Gf),n=Qf(e),s=new Dg(e);return wf(n,t._query,{source:"server"}).then((n=>new Sg(e,s,t,n)))}function Lg(t,e,n){t=Af(t,kf);const s=Af(t.firestore,Gf),r=mg(t.converter,e,n);return qg(s,[vm(wm(s),"setDoc",t._key,r,null!==t.converter,n).toMutation(t._key,Jo.none())])}function Og(t,e,n,...s){t=Af(t,kf);const r=Af(t.firestore,Gf),i=wm(r);let o;return o="string"==typeof(e=T(e))||e instanceof um?xm(i,"updateDoc",t._key,e,n,s):Am(i,"updateDoc",t._key,e),qg(r,[o.toMutation(t._key,Jo.exists(!0))])}function Fg(t){return qg(Af(t.firestore,Gf),[new la(t._key,Jo.none())])}function Vg(t,e){const n=Af(t.firestore,Gf),s=Ff(t),r=mg(t.converter,e);return qg(n,[vm(wm(t.firestore),"addDoc",s._key,r,null!==t.converter,{}).toMutation(s._key,Jo.exists(!1))]).then((()=>s))}function Pg(t,...e){var n,s,r;t=T(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||qf(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(qf(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(r=t.complete)||void 0===r?void 0:r.bind(t)}let u,c,h;if(t instanceof kf)c=Af(t.firestore,Gf),h=vo(t._key.path),u={next:n=>{e[o]&&e[o](Bg(c,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Af(t,Rf);c=Af(n.firestore,Gf),h=n._query;const s=new Dg(c);u={next:t=>{e[o]&&e[o](new Sg(c,s,n,t))},error:e[o+1],complete:e[o+2]},Bm(t._query)}return function(t,e,n,s){const r=new ef(s),i=new ld(e,r,n);return t.asyncQueue.enqueueAndForget((async()=>od(await pf(t),i))),()=>{r.Pc(),t.asyncQueue.enqueueAndForget((async()=>ad(await pf(t),i)))}}(Qf(c),h,a,u)}function Ug(t,e){return function(t,e){const n=new ef(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){Ks(t).vu.add(e),e.next()}(await pf(t),n))),()=>{n.Pc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){Ks(t).vu.delete(e)}(await pf(t),n)))}}(Qf(t=Af(t,Gf)),qf(e)?e:{next:e})}function qg(t,e){return function(t,e){const n=new $s;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=Wd(t);try{const t=await function(t,e){const n=Ks(t),s=or.now(),r=e.reduce(((t,e)=>t.add(e.key)),Ca());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Ia(),u=Ca();return n.ji.getEntries(t,r).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(u=u.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((r=>{i=r;const o=[];for(const t of e){const e=ra(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new aa(t.key,e,oo(e.value.mapValue),Jo.exists(!0)))}return n.mutationQueue.addMutationBatch(t,s,o,e)})).next((e=>{o=e;const s=e.applyToLocalDocumentSet(i,u);return n.documentOverlayCache.saveOverlays(t,e.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:Ea(i)})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.fc[t.currentUser.toKey()];s||(s=new Ji(sr)),s=s.insert(e,n),t.fc[t.currentUser.toKey()]=s}(s,t.batchId,n),await Vd(s,t.changes),await ql(s.remoteStore)}catch(t){const e=td(t,"Failed to persist write");n.reject(e)}}(await mf(t),e,n))),n.promise}(Qf(t),e)}function Bg(t,e,n){const s=n.docs.get(e._key),r=new Dg(t);return new bg(t,r,e._key,s,new Tg(n.hasPendingWrites,n.fromCache),e.converter)}function Kg(t){return Gg(t,{count:wg()})}function Gg(t,e){const n=Af(t.firestore,Gf),s=Qf(n),r=function(t,e){const n=[];for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&n.push(e(t[s],s));return n}(e,((t,e)=>new Kr(new Br(e),t._aggregateType,t._internalFieldPath)));return function(t,e,n){const s=new $s;return t.asyncQueue.enqueueAndForget((async()=>{try{if(Ml(await ff(t))){const r=await gf(t);s.resolve(async function(t,e,n){const s=Ks(t),r=function(t,e,n){const s=uu(t,e),r=[];return n.forEach((t=>{"count"===t.lt?r.push({alias:t.alias.canonicalString(),count:{}}):"avg"===t.lt?r.push({alias:t.alias.canonicalString(),avg:{field:mu(t.fieldPath)}}):"sum"===t.lt&&r.push({alias:t.alias.canonicalString(),sum:{field:mu(t.fieldPath)}})})),{structuredAggregationQuery:{aggregations:r,structuredQuery:s.structuredQuery},parent:s.parent}}(s.Tt,_o(e),n),i=r.parent;s.connection.ho||delete r.parent;const o=(await s.mo("RunAggregationQuery",i,r,1)).filter((t=>!!t.result));return qs(1===o.length),(a=o[0]).result,a.result.aggregateFields,new io({mapValue:{fields:null===(u=a.result)||void 0===u?void 0:u.aggregateFields}});var a,u}(r,e,n))}else s.reject(new js(Gs.UNAVAILABLE,"Failed to get aggregate result because the client is offline."))}catch(t){s.reject(t)}})),s.promise}(s,t._query,r).then((e=>function(t,e,n){const s=new Dg(t);return new om(e,s,n)}(n,t,e)))}const jg={maxAttempts:5};class $g{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=wm(t)}set(t,e,n){this._verifyNotCommitted();const s=Qg(t,this._firestore),r=mg(s.converter,e,n),i=vm(this._dataReader,"WriteBatch.set",s._key,r,null!==s.converter,n);return this._mutations.push(i.toMutation(s._key,Jo.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const r=Qg(t,this._firestore);let i;return i="string"==typeof(e=T(e))||e instanceof um?xm(this._dataReader,"WriteBatch.update",r._key,e,n,s):Am(this._dataReader,"WriteBatch.update",r._key,e),this._mutations.push(i.toMutation(r._key,Jo.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Qg(t,this._firestore);return this._mutations=this._mutations.concat(new la(e._key,Jo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new js(Gs.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Qg(t,e){if((t=T(t)).firestore!==e)throw new js(Gs.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class zg extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=wm(t)}get(t){const e=Qg(t,this._firestore),n=new gg(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return Us();const s=t[0];if(s.isFoundDocument())return new Pm(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new Pm(this._firestore,n,e._key,null,e.converter);throw Us()}))}set(t,e,n){const s=Qg(t,this._firestore),r=mg(s.converter,e,n),i=vm(this._dataReader,"Transaction.set",s._key,r,null!==s.converter,n);return this._transaction.set(s._key,i),this}update(t,e,n,...s){const r=Qg(t,this._firestore);let i;return i="string"==typeof(e=T(e))||e instanceof um?xm(this._dataReader,"Transaction.update",r._key,e,n,s):Am(this._dataReader,"Transaction.update",r._key,e),this._transaction.update(r._key,i),this}delete(t){const e=Qg(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Qg(t,this._firestore),n=new Dg(this._firestore);return super.get(t).then((t=>new bg(this._firestore,n,e._key,t._document,new Tg(!1,!1),e.converter)))}}function Hg(t,e,n){t=Af(t,Gf);const s=Object.assign(Object.assign({},jg),n);return function(t){if(t.maxAttempts<1)throw new js(Gs.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s),function(t,e,n){const s=new $s;return t.asyncQueue.enqueueAndForget((async()=>{const r=await gf(t);new rf(t.asyncQueue,r,n,e,s).run()})),s.promise}(Qf(t),(n=>e(new zg(t,n))),s)}function Wg(){return new Im("deleteField")}function Xg(){return new bm("serverTimestamp")}function Yg(...t){return new Em("arrayUnion",t)}function Jg(...t){return new Sm("arrayRemove",t)}function Zg(t){return new _m("increment",t)}function tp(t){return Qf(t=Af(t,Gf)),new $g(t,(e=>qg(t,e)))}function ep(t,e){var n;const s=Qf(t=Af(t,Gf));if(!(null===(n=s.offlineComponents)||void 0===n?void 0:n.indexBackfillerScheduler))return Vs("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(t){const e="string"==typeof t?function(t){try{return JSON.parse(t)}catch(t){throw new js(Gs.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==t?void 0:t.message))}}(t):t,n=[];if(Array.isArray(e.indexes))for(const t of e.indexes){const e=np(t,"collectionGroup"),s=[];if(Array.isArray(t.fields))for(const e of t.fields){const t=Om("setIndexConfiguration",np(e,"fieldPath"));"CONTAINS"===e.arrayConfig?s.push(new yr(t,2)):"ASCENDING"===e.order?s.push(new yr(t,0)):"DESCENDING"===e.order&&s.push(new yr(t,1))}n.push(new fr(fr.UNKNOWN_ID,e,s,vr.empty()))}return n}(e);return df(s).then((t=>async function(t,e){const n=Ks(t),s=n.indexManager,r=[];return n.persistence.runTransaction("Configure indexes","readwrite",(t=>s.getFieldIndexes(t).next((n=>function(t,e,n,s,r){t=[...t],e=[...e],t.sort(n),e.sort(n);const i=t.length,o=e.length;let a=0,u=0;for(;a<o&&u<i;){const i=n(t[u],e[a]);i<0?r(t[u++]):i>0?s(e[a++]):(a++,u++)}for(;a<o;)s(e[a++]);for(;u<i;)r(t[u++])}(n,e,pr,(e=>{r.push(s.addFieldIndex(t,e))}),(e=>{r.push(s.deleteFieldIndex(t,e))})))).next((()=>xr.waitFor(r)))))}(t,r)))}function np(t,e){if("string"!=typeof t[e])throw new js(Gs.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}!function(n,s=!0){ks=i,t(new b("firestore",((t,{instanceIdentifier:e,options:n})=>{const r=t.getProvider("app").getImmediate(),i=new Gf(new Ws(t.getProvider("auth-internal")),new Zs(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new js(Gs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jr(t.options.projectId,e)}(r,e),r);return n=Object.assign({useFetchStreams:s},n),i._setSettings(n),i}),"PUBLIC").setMultipleInstances(!0)),e(Cs,"3.8.4",n),e(Cs,"3.8.4","esm2017")}();export{fg as AbstractUserDataWriter,im as AggregateField,om as AggregateQuerySnapshot,am as Bytes,Kf as CACHE_SIZE_UNLIMITED,Mf as CollectionReference,kf as DocumentReference,bg as DocumentSnapshot,um as FieldPath,hm as FieldValue,Gf as Firestore,js as FirestoreError,lm as GeoPoint,Bf as LoadBundleTask,Rf as Query,zm as QueryCompositeFilterConstraint,Gm as QueryConstraint,Eg as QueryDocumentSnapshot,rg as QueryEndAtConstraint,$m as QueryFieldFilterConstraint,Jm as QueryLimitConstraint,Xm as QueryOrderByConstraint,Sg as QuerySnapshot,eg as QueryStartAtConstraint,Tg as SnapshotMetadata,or as Timestamp,zg as Transaction,$g as WriteBatch,jr as _DatabaseId,dr as _DocumentKey,tr as _EmptyAppCheckTokenProvider,zs as _EmptyAuthCredentialsProvider,lr as _FieldPath,Af as _cast,Bs as _debugAssert,Jr as _isBase64Available,Vs as _logWarn,bf as _validateIsNotUsedTogether,Vg as addDoc,vg as aggregateFieldEqual,Ig as aggregateQuerySnapshotEqual,Wm as and,Jg as arrayRemove,Yg as arrayUnion,yg as average,Yf as clearIndexedDbPersistence,Lf as collection,Of as collectionGroup,Nf as connectFirestoreEmulator,wg as count,Fg as deleteDoc,Wg as deleteField,tm as disableNetwork,Ff as doc,cm as documentId,Hf as enableIndexedDbPersistence,Wf as enableMultiTabIndexedDbPersistence,Zf as enableNetwork,og as endAt,ig as endBefore,Qf as ensureFirestoreConfigured,qg as executeWrite,Gg as getAggregateFromServer,Kg as getCountFromServer,xg as getDoc,Cg as getDocFromCache,Ng as getDocFromServer,kg as getDocs,Rg as getDocsFromCache,Mg as getDocsFromServer,$f as getFirestore,Zg as increment,jf as initializeFirestore,Zm as limit,tg as limitToLast,nm as loadBundle,sm as namedQuery,Pg as onSnapshot,Ug as onSnapshotsInSync,Hm as or,Ym as orderBy,jm as query,Pf as queryEqual,Vf as refEqual,Hg as runTransaction,Xg as serverTimestamp,Lg as setDoc,ep as setIndexConfiguration,Ls as setLogLevel,Ag as snapshotEqual,sg as startAfter,ng as startAt,pg as sum,em as terminate,Og as updateDoc,Jf as waitForPendingWrites,Qm as where,tp as writeBatch};

//# sourceMappingURL=firebase-firestore.js.map
