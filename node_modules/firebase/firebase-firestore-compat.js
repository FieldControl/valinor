!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(pg,yg){"use strict";try{!(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l,t=e(pg);function n(t){const n=[];let r=0;for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++s)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}const r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const s=[];for(let h=0;h<n.length;h+=3){var i=n[h],a=h+1<n.length,o=a?n[h+1]:0,u=h+2<n.length,c=u?n[h+2]:0;let e=(15&o)<<2|c>>6,t=63&c;u||(t=64,a||(e=64)),s.push(r[i>>2],r[(3&i)<<4|o>>4],r[e],r[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var s,i,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(s=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&s)):239<a&&a<365?(i=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],i=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&i))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let u=0;u<e.length;){var s=n[e.charAt(u++)],i=u<e.length?n[e.charAt(u)]:0;++u;var a=u<e.length?n[e.charAt(u)]:64;++u;var o=u<e.length?n[e.charAt(u)]:64;if(++u,null==s||null==i||null==a||null==o)throw new c;r.push(s<<2|i>>4),64!==a&&(r.push(i<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return e=e,t=n(e),r.encodeByteArray(t,!0).replace(/\./g,"");var t};const s=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,i=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)}},o=()=>{try{return s()||(()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}})()||i()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}};function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){return!function(){var e=null===(e=o())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return 1;if("browser"!==e)try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class d extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],i=i?(r=n,i.replace(g,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",i=`${this.serviceName}: ${i} (${s}).`;return new d(s,i,n)}}const g=/\{\$([^}]+)}/g;function m(e){return e&&e._delegate?e._delegate:e}class p{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(pd=l=l||{})[pd.DEBUG=0]="DEBUG",pd[pd.VERBOSE=1]="VERBOSE",pd[pd.INFO=2]="INFO",pd[pd.WARN=3]="WARN",pd[pd.ERROR=4]="ERROR",pd[pd.SILENT=5]="SILENT";const y={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},v=l.INFO,w={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},I=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),s=w[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)}};var b,T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E={},_=T||self;function S(){}function x(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function D(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var A="closure_uid_"+(1e9*Math.random()>>>0),C=0;function N(e,t,n){return e.call.apply(e.bind,arguments)}function k(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function R(e,t,n){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?N:k).apply(null,arguments)}function M(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function L(e,i){function t(){}t.prototype=i.prototype,e.X=i.prototype,e.prototype=new t,(e.prototype.constructor=e).Wb=function(e,t,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[t].apply(e,r)}}function O(){this.s=this.s,this.o=this.o}O.prototype.s=!1,O.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,A)&&e[A]||(e[A]=++C))},O.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const F=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function V(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function P(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(x(n)){var r=t.length||0,s=n.length||0;t.length=r+s;for(let e=0;e<s;e++)t[r+e]=n[e]}else t.push(n)}}function B(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{_.addEventListener("test",S,t),_.removeEventListener("test",S,t)}catch(e){}return e}();function U(e){return/^[\s\xa0]*$/.test(e)}var K=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function G(e,t){return e<t?-1:t<e?1:0}function j(){var e=_.navigator;return(e=e&&e.userAgent)?e:""}function $(e){return-1!=j().indexOf(e)}function Q(e){return Q[" "](e),e}Q[" "]=S;var z,H=$("Opera"),W=$("Trident")||$("MSIE"),X=$("Edge"),Y=X||W,J=$("Gecko")&&!(-1!=j().toLowerCase().indexOf("webkit")&&!$("Edge"))&&!($("Trident")||$("MSIE"))&&!$("Edge"),Z=-1!=j().toLowerCase().indexOf("webkit")&&!$("Edge");function ee(){var e=_.document;return e?e.documentMode:void 0}e:{var te="",ne=(ne=j(),J?/rv:([^\);]+)(\)|;)/.exec(ne):X?/Edge\/([\d\.]+)/.exec(ne):W?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ne):Z?/WebKit\/(\S+)/.exec(ne):H?/(?:Version)[ \/]?(\S+)/.exec(ne):void 0);if(ne&&(te=ne?ne[1]:""),W){ne=ee();if(null!=ne&&ne>parseFloat(te)){z=String(ne);break e}}z=te}var re={};function se(){return e=function(){let e=0;var t=K(String(z)).split("."),n=K("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++)for(var s=t[a]||"",i=n[a]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],(0!=s[0].length||0!=i[0].length)&&(e=G(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||G(0==s[2].length,0==i[2].length)||G(s[2],i[2]),s=s[3],i=i[3],0==e););return 0<=e},t=re,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var ie=_.document&&W&&(ee()||parseInt(z,10))||void 0;function ae(e,t){if(B.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(J){e:{try{Q(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:oe[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&ae.X.h.call(this)}}L(ae,B);var oe={2:"touch",3:"pen",4:"mouse"};ae.prototype.h=function(){ae.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),ce=0;function he(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=s,this.key=++ce,this.ba=this.ea=!1}function le(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function de(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function fe(e){const t={};for(const n in e)t[n]=e[n];return t}const ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function me(t){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s])t[n]=r[n];for(let e=0;e<ge.length;e++)n=ge[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function pe(e){this.src=e,this.g={},this.h=0}function ye(e,t){var n,r,s,i=t.type;i in e.g&&(n=e.g[i],(s=0<=(r=F(n,t)))&&Array.prototype.splice.call(n,r,1),s&&(le(t),0==e.g[i].length&&(delete e.g[i],e.h--)))}function ve(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.ba&&i.listener==t&&i.capture==!!n&&i.ha==r)return s}return-1}pe.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var a=ve(e,t,r,s);return-1<a?(t=e[a],n||(t.ea=!1)):((t=new he(t,this.src,i,!!r,s)).ea=n,e.push(t)),t};var we="closure_lm_"+(1e6*Math.random()|0),Ie={};function be(e,t,n,r,s){if(r&&r.once)return function e(t,n,r,s,i){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,s,i);return null}r=Ae(r);return t&&t[ue]?t.O(n,r,D(s)?!!s.capture:!!s,i):Te(t,n,r,!0,s,i)}(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)be(e,t[i],n,r,s);return null}return n=Ae(n),e&&e[ue]?e.N(t,n,D(r)?!!r.capture:!!r,s):Te(e,t,n,!1,r,s)}function Te(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var a=D(s)?!!s.capture:!!s,o=xe(e);if(o||(e[we]=o=new pe(e)),(n=o.add(t,n,r,a,i)).proxy)return n;if(r=function(){const n=Se;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(s=!q?a:s)&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(_e(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ee(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[ue]?ye(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(_e(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=xe(t))?(ye(n,e),0==n.h&&(n.src=null,t[we]=null)):le(e)))}function _e(e){return e in Ie?Ie[e]:Ie[e]="on"+e}function Se(e,t){var n,r;return e=!!e.ba||(t=new ae(t,this),n=e.listener,r=e.ha||e.src,e.ea&&Ee(e),n.call(r,t))}function xe(e){return(e=e[we])instanceof pe?e:null}var De="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ae(t){return"function"==typeof t?t:(t[De]||(t[De]=function(e){return t.handleEvent(e)}),t[De])}function Ce(){O.call(this),this.i=new pe(this),(this.P=this).I=null}function Ne(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new B(t,e):t instanceof B?t.target=t.target||e:(a=t,me(t=new B(r,e),a)),a=!0,n)for(var s=n.length-1;0<=s;s--)var i=t.g=n[s],a=ke(i,r,!0,t)&&a;if(a=ke(i=t.g=e,r,!0,t)&&a,a=ke(i,r,!1,t)&&a,n)for(s=0;s<n.length;s++)a=ke(i=t.g=n[s],r,!1,t)&&a}function ke(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var a,o,u=t[i];u&&!u.ba&&u.capture==n&&(a=u.listener,o=u.ha||u.src,u.ea&&ye(e.i,u),s=!1!==a.call(o,r)&&s)}return s&&!r.defaultPrevented}L(Ce,O),Ce.prototype[ue]=!0,Ce.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,s,i){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,s,i);else s=D(s)?!!s.capture:!!s,r=Ae(r),t&&t[ue]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ve(a=t.g[n],r,s,i))&&(le(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&xe(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?ve(n,r,s,i):t)?n[t]:null)&&Ee(r))}(this,e,t,n,r)},Ce.prototype.M=function(){if(Ce.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)le(n[r]);delete t.g[e],t.h--}}this.I=null},Ce.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ce.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Re=_.JSON.stringify;var Me,Le=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Oe,e=>e.reset());class Oe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Fe(e,t){var n;Me||(n=_.Promise.resolve(void 0),Me=function(){n.then(Be)}),Ve||(Me(),Ve=!0),Pe.add(e,t)}var Ve=!1,Pe=new class{constructor(){this.h=this.g=null}add(e,t){const n=Le.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Be(){for(var e;e=function(){var e=Pe;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){_.setTimeout(()=>{throw e},0)}(e)}var t=Le;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Ve=!1}function qe(e,t){Ce.call(this),this.h=e||1,this.g=t||_,this.j=R(this.lb,this),this.l=Date.now()}function Ue(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Ke(e,t,n){if("function"==typeof e)n&&(e=R(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=R(e.handleEvent,e)}return 2147483647<Number(t)?-1:_.setTimeout(e,t||0)}L(qe,Ce),(b=qe.prototype).ca=!1,b.R=null,b.lb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Ne(this,"tick"),this.ca&&(Ue(this),this.start())))},b.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},b.M=function(){qe.X.M.call(this),Ue(this),delete this.g};class Ge extends O{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Ke(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function je(e){O.call(this),this.h=e,this.g={}}L(je,O);var $e=[];function Qe(e,t,n,r){Array.isArray(n)||(n&&($e[0]=n.toString()),n=$e);for(var s=0;s<n.length;s++){var i=be(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function ze(e){de(e.g,function(e,t){this.g.hasOwnProperty(t)&&Ee(e)},e),e.g={}}function He(){this.g=!0}function We(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var a=1;a<s.length;a++)s[a]=""}}}return Re(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}je.prototype.M=function(){je.X.M.call(this),ze(this)},je.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},He.prototype.Aa=function(){this.g=!1},He.prototype.info=function(){};var Xe={},Ye=null;function Je(){return Ye=Ye||new Ce}function Ze(e){B.call(this,Xe.Pa,e)}function et(){var e=Je();Ne(e,new Ze(e))}function tt(e,t){B.call(this,Xe.STAT_EVENT,e),this.stat=t}function nt(e){var t=Je();Ne(t,new tt(t,e))}function rt(e,t){B.call(this,Xe.Qa,e),this.size=t}function st(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){e()},t)}Xe.Pa="serverreachability",L(Ze,B),Xe.STAT_EVENT="statevent",L(tt,B),Xe.Qa="timingevent",L(rt,B);var it={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},at={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ot(){}function ut(e){return e.h||(e.h=e.i())}function ct(){}ot.prototype.h=null;T={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function ht(){B.call(this,"d")}function lt(){B.call(this,"c")}function dt(){}function ft(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new je(this),this.O=pt,this.T=new qe(e=Y?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new gt}function gt(){this.i=null,this.g="",this.h=!1}L(ht,B),L(lt,B),L(dt,ot),dt.prototype.g=function(){return new XMLHttpRequest},dt.prototype.i=function(){return{}};var mt=new dt,pt=45e3,yt={},vt={};function wt(e,t,n){e.K=1,e.v=Vt(Rt(t)),e.s=n,e.P=!0,It(e,null)}function It(e,t){e.F=Date.now(),Et(e),e.A=Rt(e.v);var a,o,u,c,h,l,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Xt(n.i,"t",r),e.C=0,n=e.l.H,e.h=new gt,e.g=Xn(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Ge(R(e.La,e,e.g),e.N)),Qe(e.S,e.g,"readystatechange",e.ib),t=e.H?fe(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),et(),a=e.j,o=e.u,u=e.A,c=e.m,h=e.U,l=e.s,a.info(function(){if(a.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,s,i=t[n].split("=");1<i.length&&(r=i[0],i=i[1],e=2<=(s=r.split("_")).length&&"type"==s[1]?e+(r+"=")+i+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+o+"\n"+u+"\n"+e})}function bt(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function Tt(e,t,n){let r=!0,s;for(;!e.I&&e.C<n.length;){if(s=(a=n,u=o=void 0,o=(i=e).C,-1==(u=a.indexOf("\n",o))?vt:(o=Number(a.substring(o,u)),isNaN(o)?yt:(u+=1)+o>a.length?vt:(a=a.substr(u,o),i.C=u+o,a))),s==vt){4==t&&(e.o=4,nt(14),r=!1),We(e.j,e.m,null,"[Incomplete Response]");break}if(s==yt){e.o=4,nt(15),We(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}We(e.j,e.m,s,null),At(e,s)}var i,a,o,u;bt(e)&&s!=vt&&s!=yt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,nt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Kn(t),t.K=!0,nt(11))):(We(e.j,e.m,n,"[Invalid Chunked Response]"),Dt(e),xt(e))}function Et(e){e.V=Date.now()+e.O,_t(e,e.O)}function _t(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=st(R(e.gb,e),t)}function St(e){e.B&&(_.clearTimeout(e.B),e.B=null)}function xt(e){0==e.l.G||e.I||$n(e.l,e)}function Dt(e){St(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ue(e.T),ze(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function At(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||rn(n.h,e)))if(!e.J&&rn(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;jn(n),Ln(n)}Un(n),nt(18)}}else n.Ba=s[1],0<n.Ba-n.T&&s[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=st(R(n.cb,n),6e3));if(nn(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else zn(n,11)}else if(!e.J&&n.g!=e||jn(n),!U(t))for(s=n.Fa.g.parse(t),t=0;t<s.length;t++){var i=s[t];if(n.T=i[0],i=i[1],2==n.G)if("c"==i[0]){n.I=i[1],n.ka=i[2];var a=i[3];null!=a&&(n.ma=a,n.j.info("VER="+n.ma));var o=i[4];null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var u,c,h=i[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;if(g){const m=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;m&&((u=r.h).g||-1==m.indexOf("spdy")&&-1==m.indexOf("quic")&&-1==m.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(sn(u,u.h),u.h=null))),!r.D||(c=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=c,Ft(r.F,r.D,c))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var l,d,f=e;(r=n).sa=Wn(r,r.H?r.ka:null,r.V),f.J?(an(r.h,f),l=f,(d=r.J)&&l.setTimeout(d),l.B&&(St(l),Et(l)),r.g=f):qn(r),0<n.i.length&&Fn(n)}else"stop"!=i[0]&&"close"!=i[0]||zn(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?zn(n,7):Mn(n):"noop"!=i[0]&&n.l&&n.l.wa(i),n.A=0)}et()}catch(e){}}function Ct(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(x(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(x(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(x(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}(b=ft.prototype).setTimeout=function(e){this.O=e},b.ib=function(e){e=e.target;const t=this.L;t&&3==Dn(e)?t.l():this.La(e)},b.La=function(e){try{if(e==this.g)e:{var t=Dn(this.g),n=this.g.Ea();this.g.aa();if(!(t<3)&&(3!=t||Y||this.g&&(this.h.h||this.g.fa()||An(this.g)))){this.I||4!=t||7==n||et(),St(this);var r=this.g.aa();this.Y=r;t:if(bt(this)){var s=An(this.g);e="";var i=s.length,a=4==Dn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Dt(this),xt(this);var o="";break t}this.h.i=new _.TextDecoder}for(n=0;n<i;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:a&&n==i-1});s.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.U,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.Z&&!this.J){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(u)){var h=u;break t}}h=null}if(!(r=h)){this.i=!1,this.o=3,nt(12),Dt(this),xt(this);break e}We(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,At(this,r)}this.P?(Tt(this,t,o),Y&&this.i&&3==t&&(Qe(this.S,this.T,"tick",this.hb),this.T.start())):(We(this.j,this.m,o,null),At(this,o)),4==t&&Dt(this),this.i&&!this.I&&(4==t?$n(this.l,this):(this.i=!1,Et(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,nt(12)):(this.o=0,nt(13)),Dt(this),xt(this)}}}catch(e){}var l,d,f,g,m,p,y},b.hb=function(){var e,t;this.g&&(e=Dn(this.g),t=this.g.fa(),this.C<t.length&&(St(this),Tt(this,e,t),this.i&&4!=e&&Et(this)))},b.cancel=function(){this.I=!0,Dt(this)},b.gb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(et(),nt(17)),Dt(this),this.o=2,xt(this)):_t(this,this.V-n)};var Nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kt(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof kt?(this.h=void 0!==t?t:e.h,Mt(this,e.j),this.s=e.s,this.g=e.g,Lt(this,e.m),this.l=e.l,t=e.i,(n=new Qt).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Ot(this,n),this.o=e.o):e&&(n=String(e).match(Nt))?(this.h=!!t,Mt(this,n[1]||"",!0),this.s=Pt(n[2]||""),this.g=Pt(n[3]||"",!0),Lt(this,n[4]),this.l=Pt(n[5]||"",!0),Ot(this,n[6]||"",!0),this.o=Pt(n[7]||"")):(this.h=!!t,this.i=new Qt(null,this.h))}function Rt(e){return new kt(e)}function Mt(e,t,n){e.j=n?Pt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Lt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ot(e,t,n){var r,s;t instanceof Qt?(e.i=t,r=e.i,(s=e.h)&&!r.j&&(zt(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Ht(this,t),Xt(this,n,e))},r)),r.j=s):(n||(t=Bt(t,jt)),e.i=new Qt(t,e.h))}function Ft(e,t,n){e.i.set(t,n)}function Vt(e){return Ft(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Pt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Bt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,qt),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function qt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}kt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Bt(t,Ut,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Bt(t,Ut,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Bt(n,"/"==n.charAt(0)?Gt:Kt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Bt(n,$t)),e.join("")};var Ut=/[#\/\?@]/g,Kt=/[#\?:]/g,Gt=/[#\?]/g,jt=/[#\?@]/g,$t=/#/g;function Qt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function zt(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,s=e[n].indexOf("="),i=null;0<=s?(r=e[n].substring(0,s),i=e[n].substring(s+1)):r=e[n],t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Ht(e,t){zt(e),t=Yt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Wt(e,t){return zt(e),t=Yt(e,t),e.g.has(t)}function Xt(e,t,n){Ht(e,t),0<n.length&&(e.i=null,e.g.set(Yt(e,t),V(n)),e.h+=n.length)}function Yt(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(b=Qt.prototype).add=function(e,t){zt(this),this.i=null,e=Yt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},b.forEach=function(n,r){zt(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},b.oa=function(){zt(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let i=0;i<n.length;i++){var s=t[i];for(let e=0;e<s.length;e++)r.push(n[i])}return r},b.W=function(t){zt(this);let n=[];if("string"==typeof t)Wt(this,t)&&(n=n.concat(this.g.get(Yt(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},b.set=function(e,t){return zt(this),this.i=null,Wt(this,e=Yt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},b.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},b.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],s=encodeURIComponent(String(r)),i=this.W(r),r=0;r<i.length;r++){var a=s;""!==i[r]&&(a+="="+encodeURIComponent(String(i[r]))),e.push(a)}return this.i=e.join("&")};var Jt=class{constructor(e,t){this.h=e,this.g=t}};function Zt(e){this.l=e||10,e=_.PerformanceNavigationTiming?0<(e=_.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(_.g&&_.g.Ga&&_.g.Ga()&&_.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var en;function tn(e){return e.h||e.g&&e.g.size>=e.j}function nn(e){return e.h?1:e.g?e.g.size:0}function rn(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function sn(e,t){e.g?e.g.add(t):e.h=t}function an(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function on(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return V(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function un(){}function cn(){this.g=new un}function hn(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function ln(e){this.l=e.ac||null,this.j=e.jb||!1}function dn(e,t){Ce.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Zt.prototype.cancel=function(){if(this.i=on(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},un.prototype.stringify=function(e){return _.JSON.stringify(e,void 0)},un.prototype.parse=function(e){return _.JSON.parse(e,void 0)},L(ln,ot),ln.prototype.g=function(){return new dn(this.l,this.j)},ln.prototype.i=(en={},function(){return en}),L(dn,Ce);var fn=0;function gn(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function mn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,pn(e)}function pn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(b=dn.prototype).open=function(e,t){if(this.readyState!=fn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,pn(this)},b.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||_).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},b.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,mn(this)),this.readyState=fn},b.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,pn(this)),this.g&&(this.readyState=3,pn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==_.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gn(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},b.Ta=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?mn:pn)(this),3==this.readyState&&gn(this))},b.Va=function(e){this.g&&(this.response=this.responseText=e,mn(this))},b.Ua=function(e){this.g&&(this.response=e,mn(this))},b.ga=function(){this.g&&mn(this)},b.setRequestHeader=function(e,t){this.v.append(e,t)},b.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},b.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(dn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var yn=_.JSON.parse;function vn(e){Ce.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=wn,this.K=this.L=!1}L(vn,Ce);var wn="",In=/^https?$/i,bn=["POST","PUT"];function Tn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,En(e),Sn(e)}function En(e){e.D||(e.D=!0,Ne(e,"complete"),Ne(e,"error"))}function _n(e){if(e.h&&void 0!==E&&(!e.C[1]||4!=Dn(e)||2!=e.aa()))if(e.v&&4==Dn(e))Ke(e.Ha,0,e);else if(Ne(e,"readystatechange"),4==Dn(e)){e.h=!1;try{var t,n,r,s,i=e.aa();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===i)&&(!(s=String(e.H).match(Nt)[1]||null)&&_.self&&_.self.location&&(s=(r=_.self.location.protocol).substr(0,r.length-1)),n=!In.test(s?s.toLowerCase():"")),t=n),t)Ne(e,"complete"),Ne(e,"success");else{e.m=6;try{var o=2<Dn(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",En(e)}}finally{Sn(e)}}}function Sn(e,t){if(e.g){xn(e);const n=e.g,r=e.C[0]?S:null;e.g=null,e.C=null,t||Ne(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function xn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(_.clearTimeout(e.A),e.A=null)}function Dn(e){return e.g?e.g.readyState:0}function An(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case wn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Cn(e){let n="";return de(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function Nn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Cn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Ft(e,t,n))}function kn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Rn(e){this.Ca=0,this.i=[],this.j=new He,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=kn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=kn("baseRetryDelayMs",5e3,e),this.bb=kn("retryDelaySeedMs",1e4,e),this.$a=kn("forwardChannelMaxRetries",2,e),this.ta=kn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new Zt(e&&e.concurrentRequestLimit),this.Fa=new cn,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Mn(e){var t,n;On(e),3==e.G&&(t=e.U++,Ft(n=Rt(e.F),"SID",e.I),Ft(n,"RID",t),Ft(n,"TYPE","terminate"),Pn(e,n),(t=new ft(e,e.j,t,void 0)).K=2,t.v=Vt(Rt(n)),n=!1,!(n=_.navigator&&_.navigator.sendBeacon?_.navigator.sendBeacon(t.v.toString(),""):n)&&_.Image&&((new Image).src=t.v,n=!0),n||(t.g=Xn(t.l,null),t.g.da(t.v)),t.F=Date.now(),Et(t)),Hn(e)}function Ln(e){e.g&&(Kn(e),e.g.cancel(),e.g=null)}function On(e){Ln(e),e.u&&(_.clearTimeout(e.u),e.u=null),jn(e),e.h.cancel(),e.m&&("number"==typeof e.m&&_.clearTimeout(e.m),e.m=null)}function Fn(e){tn(e.h)||e.m||(e.m=!0,Fe(e.Ja,e),e.C=0)}function Vn(e,t){var n=t?t.m:e.U++,r=Rt(e.F);Ft(r,"SID",e.I),Ft(r,"RID",n),Ft(r,"AID",e.T),Pn(e,r),e.o&&e.s&&Nn(r,e.o,e.s),n=new ft(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Bn(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),sn(e.h,n),wt(n,r,t)}function Pn(e,n){e.ia&&de(e.ia,function(e,t){Ft(n,t,e)}),e.l&&Ct({},function(e,t){Ft(n,t,e)})}function Bn(e,t,r){r=Math.min(e.i.length,r);var s=e.l?R(e.l.Ra,e.l,e):null;e:{var i=e.i;let n=-1;for(;;){const u=["count="+r];-1==n?0<r?(n=i[0].h,u.push("ofs="+n)):n=0:u.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=i[t].h,o=i[t].g;if((a-=n)<0)n=Math.max(0,i[t].h-100),e=!1;else try{!function(e,r,t){const s=t||"";try{Ct(e,function(e,t){let n=e;D(e)&&(n=Re(e)),r.push(s+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(s+"type="+encodeURIComponent("_badmap")),e}}(o,u,"req"+a+"_")}catch(e){s&&s(o)}}if(e){s=u.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,s}function qn(e){e.g||e.u||(e.Z=1,Fe(e.Ia,e),e.A=0)}function Un(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=st(R(e.Ia,e),Qn(e,e.A)),e.A++,1)}function Kn(e){null!=e.B&&(_.clearTimeout(e.B),e.B=null)}function Gn(e){e.g=new ft(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Rt(e.sa);Ft(t,"RID","rpc"),Ft(t,"SID",e.I),Ft(t,"CI",e.L?"0":"1"),Ft(t,"AID",e.T),Ft(t,"TYPE","xmlhttp"),Pn(e,t),e.o&&e.s&&Nn(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Vt(Rt(t)),n.s=null,n.P=!0,It(n,e)}function jn(e){null!=e.v&&(_.clearTimeout(e.v),e.v=null)}function $n(e,t){var n,r,s,i=null;if(e.g==t){jn(e),Kn(e),e.g=null;var a=2}else{if(!rn(e.h,t))return;i=t.D,an(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(i=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,Ne(a=Je(),new rt(a,i)),Fn(e)):qn(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(s=t,nn((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=s.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Za?0:r.$a)||(r.m=st(R(r.Ja,r,s),Qn(r,r.C)),r.C++,0))))&&(2!=a||!Un(e)))switch(i&&0<i.length&&(t=e.h,t.i=t.i.concat(i)),n){case 1:zn(e,5);break;case 4:zn(e,10);break;case 3:zn(e,6);break;default:zn(e,2)}}function Qn(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function zn(e,t){var n,r;e.j.info("Error code "+t),2==t?(n=null,e.l&&(n=null),r=R(e.kb,e),n||(n=new kt("//www.google.com/images/cleardot.gif"),_.location&&"http"==_.location.protocol||Mt(n,"https"),Vt(n)),function(e,t){var n=new He;if(_.Image){const r=new Image;r.onload=M(hn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=M(hn,n,r,"TestLoadImage: error",!1,t),r.onabort=M(hn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=M(hn,n,r,"TestLoadImage: timeout",!1,t),_.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):nt(2),e.G=0,e.l&&e.l.va(t),Hn(e),On(e)}function Hn(e){var t;e.G=0,e.la=[],e.l&&(0==(t=on(e.h)).length&&0==e.i.length||(P(e.la,t),P(e.la,e.i),e.h.i.length=0,V(e.i),e.i.length=0),e.l.ua())}function Wn(e,t,n){var r,s,i=n instanceof kt?Rt(n):new kt(n,void 0);return""!=i.g?(t&&(i.g=t+"."+i.g),Lt(i,i.m)):(i=(r=_.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,s=new kt(null,void 0),i&&Mt(s,i),t&&(s.g=t),r&&Lt(s,r),n&&(s.l=n),i=s),n=e.D,t=e.za,n&&t&&Ft(i,n,t),Ft(i,"VER",e.ma),Pn(e,i),i}function Xn(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new vn(new ln({jb:!0})):new vn(e.ra)).Ka(e.H),t}function Yn(){}function Jn(){if(W&&!(10<=Number(ie)))throw Error("Environmental error: no available transport.")}function Zn(e,t){Ce.call(this),this.g=new Rn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!U(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!U(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new nr(this)}function er(e){ht.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function tr(){lt.call(this),this.status=1}function nr(e){this.g=e}(b=vn.prototype).Ka=function(e){this.L=e},b.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||mt).g(),this.C=this.u?ut(this.u):ut(mt),this.g.onreadystatechange=R(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Tn(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const u of r.keys())n.set(u,r.get(u))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=_.FormData&&e instanceof _.FormData,0<=F(bn,t)&&!r&&!s&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[i,a]of n)this.g.setRequestHeader(i,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{xn(this),0<this.B&&((this.K=(o=this.g,W&&se()&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=R(this.qa,this)):this.A=Ke(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Tn(this,e)}var o},b.qa=function(){void 0!==E&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ne(this,"timeout"),this.abort(8))},b.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ne(this,"complete"),Ne(this,"abort"),Sn(this))},b.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Sn(this,!0)),vn.X.M.call(this)},b.Ha=function(){this.s||(this.F||this.v||this.l?_n(this):this.fb())},b.fb=function(){_n(this)},b.aa=function(){try{return 2<Dn(this)?this.g.status:-1}catch(e){return-1}},b.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},b.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),yn(t)}},b.Ea=function(){return this.m},b.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(b=Rn.prototype).ma=8,b.G=1,b.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new ft(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?(e=fe(e),me(e,this.S)):e=this.S),null!==this.o||this.N||(i.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var s=this.i[r];if("__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(n+=s)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Bn(this,i,n),Ft(r=Rt(this.F),"RID",t),Ft(r,"CVER",22),this.D&&Ft(r,"X-HTTP-Session-Id",this.D),Pn(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(Cn(e)))+"&"+n:this.o&&Nn(r,this.o,e)),sn(this.h,i),this.Ya&&Ft(r,"TYPE","init"),this.O?(Ft(r,"$req",n),Ft(r,"SID","null"),i.Z=!0,wt(i,r,null)):wt(i,r,n),this.G=2}}else 3==this.G&&(t?Vn(this,t):0==this.i.length||tn(this.h)||Vn(this))},b.Ia=function(){var e;this.u=null,Gn(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=st(R(this.eb,this),e))},b.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,nt(10),Ln(this),Gn(this))},b.cb=function(){null!=this.v&&(this.v=null,Ln(this),Un(this),nt(19))},b.kb=function(e){e?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))},(b=Yn.prototype).xa=function(){},b.wa=function(){},b.va=function(){},b.ua=function(){},b.Ra=function(){},Jn.prototype.g=function(e,t){return new Zn(e,t)},L(Zn,Ce),Zn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;nt(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=Wn(e,null,e.V),Fn(e)},Zn.prototype.close=function(){Mn(this.g)},Zn.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Re(e),e=t),n.i.push(new Jt(n.ab++,e)),3==n.G&&Fn(n)},Zn.prototype.M=function(){this.g.l=null,delete this.j,Mn(this.g),delete this.g,Zn.X.M.call(this)},L(er,ht),L(tr,lt),L(nr,Yn),nr.prototype.xa=function(){Ne(this.g,"a")},nr.prototype.wa=function(e){Ne(this.g,new er(e))},nr.prototype.va=function(e){Ne(this.g,new tr)},nr.prototype.ua=function(){Ne(this.g,"b")},Jn.prototype.createWebChannel=Jn.prototype.g,Zn.prototype.send=Zn.prototype.u,Zn.prototype.open=Zn.prototype.m,it.NO_ERROR=0,it.TIMEOUT=8,it.HTTP_ERROR=6,at.COMPLETE="complete",(ct.EventType=T).OPEN="a",T.CLOSE="b",T.ERROR="c",T.MESSAGE="d",Ce.prototype.listen=Ce.prototype.N,vn.prototype.listenOnce=vn.prototype.O,vn.prototype.getLastError=vn.prototype.Oa,vn.prototype.getLastErrorCode=vn.prototype.Ea,vn.prototype.getStatus=vn.prototype.aa,vn.prototype.getResponseJson=vn.prototype.Sa,vn.prototype.getResponseText=vn.prototype.fa,vn.prototype.send=vn.prototype.da,vn.prototype.setWithCredentials=vn.prototype.Ka;var rr,sr=Je,ir=it,ar=at,or=Xe,ur=10,cr=11,hr=ln,lr=ct,dr=vn;const fr="@firebase/firestore";class gr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gr.UNAUTHENTICATED=new gr(null),gr.GOOGLE_CREDENTIALS=new gr("google-credentials-uid"),gr.FIRST_PARTY=new gr("first-party-uid"),gr.MOCK_USER=new gr("mock-user");let mr="9.17.2";const pr=new class{constructor(e){this.name=e,this._logLevel=v,this._logHandler=I,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?y[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function yr(){return pr.logLevel}function vr(e,...t){var n;pr.logLevel<=l.DEBUG&&(n=t.map(br),pr.debug(`Firestore (${mr}): ${e}`,...n))}function wr(e,...t){var n;pr.logLevel<=l.ERROR&&(n=t.map(br),pr.error(`Firestore (${mr}): ${e}`,...n))}function Ir(e,...t){var n;pr.logLevel<=l.WARN&&(n=t.map(br),pr.warn(`Firestore (${mr}): ${e}`,...n))}function br(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Tr(e="Unexpected state"){var t=`FIRESTORE (${mr}) INTERNAL ASSERTION FAILED: `+e;throw wr(t),new Error(t)}function Er(e){e||Tr()}const _r={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Sr extends d{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class xr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Dr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ar{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(gr.UNAUTHENTICATED))}shutdown(){}}class Cr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Nr{constructor(e){this.t=e,this.currentUser=gr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const s=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let i=new xr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new xr,t.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await s(this.currentUser)})},o=e=>{vr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(vr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new xr))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(vr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Er("string"==typeof e.accessToken),new Dr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return Er(null===e||"string"==typeof e),new gr(e)}}class kr{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=gr.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Er(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Rr{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new kr(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(gr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Mr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Lr{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,n){const r=e=>{null!=e.error&&vr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.A;return this.A=e.token,vr("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const s=e=>{vr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit(e=>s(e)),setTimeout(()=>{var e;this.appCheck||((e=this.T.getImmediate({optional:!0}))?s(e):vr("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Er("string"==typeof e.token),this.A=e.token,new Mr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Or{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var s=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<s.length;++e)r.length<20&&s[e]<n&&(r+=t.charAt(s[e]%t.length))}return r}}function Fr(e,t){return e<t?-1:t<e?1:0}function Vr(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Pr(e){return e+"\0"}class Br{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new Sr(_r.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new Sr(_r.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Sr(_r.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new Sr(_r.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Br.fromMillis(Date.now())}static fromDate(e){return Br.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Br(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Fr(this.nanoseconds,e.nanoseconds):Fr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class qr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new qr(e)}static min(){return new qr(new Br(0,0))}static max(){return new qr(new Br(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ur{constructor(e,t,n){void 0===t?t=0:t>e.length&&Tr(),void 0===n?n=e.length-t:n>e.length-t&&Tr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ur.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ur?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),s=t.get(r);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Kr extends Ur{construct(e,t,n){return new Kr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new Sr(_r.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new Kr(t)}static emptyPath(){return new Kr([])}}const Gr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jr extends Ur{construct(e,t,n){return new jr(e,t,n)}static isValidIdentifier(e){return Gr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!jr.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new jr(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var s=()=>{if(0===n.length)throw new Sr(_r.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Sr(_r.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Sr(_r.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?i=!i:"."!==t||i?n+=t:s(),r++}if(s(),i)throw new Sr(_r.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new jr(t)}static emptyPath(){return new jr([])}}class $r{constructor(e){this.path=e}static fromPath(e){return new $r(Kr.fromString(e))}static fromName(e){return new $r(Kr.fromString(e).popFirst(5))}static empty(){return new $r(Kr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Kr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Kr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new $r(new Kr(e.slice()))}}class Qr{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function zr(e){return e.fields.find(e=>2===e.kind)}function Hr(e){return e.fields.filter(e=>2!==e.kind)}Qr.UNKNOWN_ID=-1;class Wr{constructor(e,t){this.fieldPath=e,this.kind=t}}class Xr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Xr(0,Zr.min())}}function Yr(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=qr.fromTimestamp(1e9===r?new Br(n+1,0):new Br(n,r));return new Zr(r,$r.empty(),t)}function Jr(e){return new Zr(e.readTime,e.key,-1)}class Zr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Zr(qr.min(),$r.empty(),-1)}static max(){return new Zr(qr.max(),$r.empty(),-1)}}function es(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=$r.comparator(e.documentKey,t.documentKey),0!==n?n:Fr(e.largestBatchId,t.largestBatchId))}const ts="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ns{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rs(e){if(e.code!==_r.FAILED_PRECONDITION||e.message!==ts)throw e;vr("LocalStore","Unexpectedly lost primary lease")}class ss{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,s){return this.callbackAttached&&Tr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(r,this.result):new ss((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(s,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof ss?t:ss.resolve(t)}catch(e){return ss.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ss.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ss.reject(t)}static resolve(n){return new ss((e,t)=>{e(n)})}static reject(n){return new ss((e,t)=>{t(n)})}static waitFor(e){return new ss((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=ss.resolve(!1);for(const n of e)t=t.next(e=>e?ss.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,u){return new ss((t,n)=>{const r=o.length,s=new Array(r);let i=0;for(let e=0;e<r;e++){const a=e;u(o[a]).next(e=>{s[a]=e,++i,i===r&&t(s)},e=>n(e))}})}static doWhile(r,s){return new ss((e,t)=>{const n=()=>{!0===r()?s().next(()=>{n()},t):e()};n()})}}class is{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.v=new xr,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{e.error?this.v.reject(new us(n,e.error)):this.v.resolve()},this.transaction.onerror=e=>{var t=fs(e.target.error);this.v.reject(new us(n,t))}}static open(e,t,n,r){try{return new is(t,e.transaction(r,n))}catch(e){throw new us(t,e)}}get P(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(vr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new hs(t)}}class as{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===as.D(u())&&wr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return vr("SimpleDb","Removing database:",e),ls(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return}}())return!1;if(as.N())return!0;const e=u(),t=as.D(e),n=0<t&&t<10,r=as.k(e),s=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(i){return this.db||(vr("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=e=>{var t=e.target.result;n(t)},s.onblocked=()=>{r(new us(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new Sr(_r.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new Sr(_r.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new us(i,t))},s.onupgradeneeded=e=>{vr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.S.$(t,s.transaction,e.oldVersion,this.version).next(()=>{vr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.F(e);const t=is.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),ss.reject(e))).toPromise();return i.catch(()=>{}),await t.P,i}catch(e){const t=e,n="FirebaseError"!==t.name&&i<3;if(vr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class os{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return ls(this.q.delete())}}class us extends Sr{constructor(e,t){super(_r.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function cs(e){return"IndexedDbTransactionError"===e.name}class hs{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(vr("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(vr("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),ls(n)}add(e){return vr("SimpleDb","ADD",this.store.name,e,e),ls(this.store.add(e))}get(t){return ls(this.store.get(t)).next(e=>(vr("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return vr("SimpleDb","DELETE",this.store.name,e),ls(this.store.delete(e))}count(){return vr("SimpleDb","COUNT",this.store.name),ls(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.H(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new ss((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new ss((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}Y(e,t){vr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Z=!1;var r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.H(r,t)}tt(s){const e=this.cursor({});return new ss((n,r)=>{e.onerror=e=>{var t=fs(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?s(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}H(e,i){const a=[];return new ss((s,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new os(t),r=i(t.primaryKey,t.value,n);if(r instanceof ss){const e=r.catch(e=>(n.done(),ss.reject(e)));a.push(e)}n.isDone?s():null===n.G?t.continue():t.continue(n.G)}else s()}}).next(()=>ss.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ls(e){return new ss((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=fs(e.target.error);r(t)}})}let ds=!1;function fs(e){const t=as.D(u());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new Sr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ds||(ds=!0,setTimeout(()=>{throw e},0)),e}}return e}class gs{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){vr("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{vr("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){cs(e)?vr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await rs(e)}await this.nt(6e4)})}}class ms{constructor(e,t){this.localStore=e,this.persistence=t}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(e,t){const n=new Set;let r=t,s=!0;return ss.doWhile(()=>!0===s&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(s=!1):(vr("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}rt(r,s,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,s).next(n=>this.localStore.localDocuments.getNextDocuments(r,s,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ot(n,e)).next(e=>(vr("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,s,e))).next(()=>t.size)}))}ot(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=Jr(t);0<es(n,r)&&(r=n)}),new Zr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ps{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}ps.at=-1;class ys{constructor(e,t,n,r,s,i,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class vs{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new vs("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof vs&&e.projectId===this.projectId&&e.database===this.database}}function ws(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Is(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function bs(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ts(e){return null==e}function Es(e){return 0===e&&1/e==-1/0}function _s(e){return"number"==typeof e&&Number.isInteger(e)&&!Es(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class Ss extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class xs{constructor(e){this.binaryString=e}static fromBase64String(e){var t=function(e){try{return atob(e)}catch(e){throw e instanceof DOMException?new Ss("Invalid base64 string: "+e):e}}(e);return new xs(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new xs(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Fr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}xs.EMPTY_BYTE_STRING=new xs("");const Ds=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function As(t){if(Er(!!t),"string"!=typeof t)return{seconds:Cs(t.seconds),nanos:Cs(t.nanos)};{let e=0;var n=Ds.exec(t);Er(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Cs(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ns(e){return"string"==typeof e?xs.fromBase64String(e):xs.fromUint8Array(e)}function ks(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Rs(e){var t=As(e.mapValue.fields.__local_write_time__.timestampValue);return new Br(t.seconds,t.nanos)}const Ms={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ls={nullValue:"NULL_VALUE"};function Os(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ks(e)?4:Hs(e)?9007199254740991:10:Tr()}function Fs(r,s){if(r===s)return!0;var e,t,n=Os(r);if(n!==Os(s))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===s.booleanValue;case 4:return Rs(r).isEqual(Rs(s));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=As(r.timestampValue),n=As(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(s);case 5:return r.stringValue===s.stringValue;case 6:return t=s,Ns(r.bytesValue).isEqual(Ns(t.bytesValue));case 7:return r.referenceValue===s.referenceValue;case 8:return e=s,Cs((t=r).geoPointValue.latitude)===Cs(e.geoPointValue.latitude)&&Cs(t.geoPointValue.longitude)===Cs(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Cs(e.integerValue)===Cs(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Cs(e.doubleValue),r=Cs(t.doubleValue);return n===r?Es(n)===Es(r):isNaN(n)&&isNaN(r)}return!1}(r,s);case 9:return Vr(r.arrayValue.values||[],s.arrayValue.values||[],Fs);case 10:return function(e){const t=e.mapValue.fields||{},n=s.mapValue.fields||{};if(ws(t)!==ws(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!Fs(t[e],n[e])))return!1;return!0}(r);default:return Tr()}}function Vs(e,t){return void 0!==(e.values||[]).find(e=>Fs(e,t))}function Ps(e,t){if(e===t)return 0;var n,r,s,i,a=Os(e),o=Os(t);if(a!==o)return Fr(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return Fr(e.booleanValue,t.booleanValue);case 2:return r=t,s=Cs(e.integerValue||e.doubleValue),i=Cs(r.integerValue||r.doubleValue),s<i?-1:i<s?1:s===i?0:isNaN(s)?isNaN(i)?0:-1:1;case 3:return Bs(e.timestampValue,t.timestampValue);case 4:return Bs(Rs(e),Rs(t));case 5:return Fr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ns(e),r=Ns(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=Fr(n[s],r[s]);if(0!==t)return t}return Fr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(i=Fr(Cs(n.latitude),Cs(r.latitude)))?i:Fr(Cs(n.longitude),Cs(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=Ps(n[s],r[s]);if(t)return t}return Fr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Ms.mapValue&&t===Ms.mapValue)return 0;if(e===Ms.mapValue)return 1;if(t===Ms.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const t=Fr(r[o],i[o]);if(0!==t)return t;var a=Ps(n[r[o]],s[i[o]]);if(0!==a)return a}return Fr(r.length,i.length)}(e.mapValue,t.mapValue);default:throw Tr()}}function Bs(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Fr(e,t);var n=As(e),r=As(t),s=Fr(n.seconds,r.seconds);return 0!==s?s:Fr(n.nanos,r.nanos)}function qs(e){return function i(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=As(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ns(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,$r.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=i(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${i(e.fields[s])}`;return n+"}"}(e.mapValue):Tr();var t}(e)}function Us(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ks(e){return e&&"integerValue"in e}function Gs(e){return!!e&&"arrayValue"in e}function js(e){return e&&"nullValue"in e}function $s(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Qs(e){return e&&"mapValue"in e}function zs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return Is(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=zs(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=zs(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Hs(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Ws(e,t){var n=Ps(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Xs(e,t){var n=Ps(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Ys{constructor(e,t){this.position=e,this.inclusive=t}}function Js(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],a=e.position[s];if(r=i.field.isKeyField()?$r.comparator($r.fromName(a.referenceValue),n.key):Ps(a,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Zs(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Fs(e.position[n],t.position[n]))return!1;return!0}class ei{}class ti extends ei{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ci(e,t,n):"array-contains"===t?new fi(e,n):"in"===t?new gi(e,n):"not-in"===t?new mi(e,n):"array-contains-any"===t?new pi(e,n):new ti(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?hi:li)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ps(t,this.value)):null!==t&&Os(this.value)===Os(t)&&this.matchesComparison(Ps(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Tr()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ni extends ei{constructor(e,t){super(),this.filters=e,this.op=t,this.ft=null}static create(e,t){return new ni(e,t)}matches(t){return ri(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ft||(this.ft=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.dt(e=>e.isInequality());return null!==e?e.field:null}dt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function ri(e){return"and"===e.op}function si(e){return"or"===e.op}function ii(e){return ai(e)&&ri(e)}function ai(e){for(const t of e.filters)if(t instanceof ni)return!1;return!0}function oi(e,t){var n=e.filters.concat(t);return ni.create(n,e.op)}function ui(e){return e instanceof ti?`${(t=e).field.canonicalString()} ${t.op} ${qs(t.value)}`:e instanceof ni?(e=e).op.toString()+" {"+e.getFilters().map(ui).join(" ,")+"}":"Filter";var t}class ci extends ti{constructor(e,t,n){super(e,t,n),this.key=$r.fromName(n.referenceValue)}matches(e){var t=$r.comparator(e.key,this.key);return this.matchesComparison(t)}}class hi extends ti{constructor(e,t){super(e,"in",t),this.keys=di(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class li extends ti{constructor(e,t){super(e,"not-in",t),this.keys=di(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function di(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>$r.fromName(e.referenceValue))}class fi extends ti{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return Gs(t)&&Vs(t.arrayValue,this.value)}}class gi extends ti{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Vs(this.value.arrayValue,t)}}class mi extends ti{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Vs(this.value.arrayValue,t)}}class pi extends ti{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Gs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Vs(this.value.arrayValue,e))}}class yi{constructor(e,t="asc"){this.field=e,this.dir=t}}class vi{constructor(e,t){this.comparator=e,this.root=t||Ii.EMPTY}insert(e,t){return new vi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ii.BLACK,null,null))}remove(e){return new vi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ii.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wi(this.root,e,this.comparator,!1)}getReverseIterator(){return new wi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wi(this.root,e,this.comparator,!0)}}class wi{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ii{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Ii.RED,this.left=null!=r?r:Ii.EMPTY,this.right=null!=s?s:Ii.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Ii(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ii.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Ii.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,Ii.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,Ii.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Tr();if(this.right.isRed())throw Tr();var e=this.left.check();if(e!==this.right.check())throw Tr();return e+(this.isRed()?0:1)}}Ii.EMPTY=null,Ii.RED=!0,Ii.BLACK=!1,Ii.EMPTY=new class{constructor(){this.size=0}get key(){throw Tr()}get value(){throw Tr()}get color(){throw Tr()}get left(){throw Tr()}get right(){throw Tr()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Ii(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class bi{constructor(e){this.comparator=e,this.data=new vi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ti(this.data.getIterator())}getIteratorFrom(e){return new Ti(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof bi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new bi(this.comparator);return t.data=e,t}}class Ti{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ei(e){return e.hasNext()?e.getNext():void 0}class _i{constructor(e){(this.fields=e).sort(jr.comparator)}static empty(){return new _i([])}unionWith(e){let t=new bi(jr.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new _i(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Vr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Si{constructor(e){this.value=e}static empty(){return new Si({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!Qs(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zs(t)}setAll(e){let n=jr.emptyPath(),r={},s=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,s),r={},s=[],n=t.popLast()}e?r[t.lastSegment()]=zs(e):s.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,s)}delete(e){const t=this.field(e.popLast());Qs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Fs(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];Qs(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){Is(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new Si(zs(this.value))}}class xi{constructor(e,t,n,r,s,i,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=a}static newInvalidDocument(e){return new xi(e,0,qr.min(),qr.min(),qr.min(),Si.empty(),0)}static newFoundDocument(e,t,n,r){return new xi(e,1,t,qr.min(),n,r,0)}static newNoDocument(e,t){return new xi(e,2,t,qr.min(),qr.min(),Si.empty(),0)}static newUnknownDocument(e,t){return new xi(e,3,t,qr.min(),qr.min(),Si.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(qr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Si.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Si.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof xi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Di{constructor(e,t=null,n=[],r=[],s=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=a,this._t=null}}function Ai(e,t=null,n=[],r=[],s=null,i=null,a=null){return new Di(e,t,n,r,s,i,a)}function Ci(e){const t=e;if(null===t._t){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function t(e){if(e instanceof ti)return e.field.canonicalString()+e.op.toString()+qs(e.value);if(ii(e))return e.filters.map(e=>t(e)).join(",");var n=e.filters.map(e=>t(e)).join(",");return`${e.op}(${n})`}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ts(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>qs(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>qs(e)).join(",")),t._t=e}return t._t}function Ni(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<e.orderBy.length;s++)if(n=e.orderBy[s],r=t.orderBy[s],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(!function r(e,t){return e instanceof ti?(n=e,(i=t)instanceof ti&&n.op===i.op&&n.field.isEqual(i.field)&&Fs(n.value,i.value)):e instanceof ni?(s=t)instanceof ni&&e.op===s.op&&e.filters.length===s.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,s.filters[n]),!0):void Tr();var s,n,i}(e.filters[i],t.filters[i]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Zs(e.startAt,t.startAt)&&Zs(e.endAt,t.endAt)}function ki(e){return $r.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Ri(e,t){return e.filters.filter(e=>e instanceof ti&&e.field.isEqual(t))}function Mi(t,n,r){let s=Ls,i=!0;for(const r of Ri(t,n)){let e=Ls,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?Ls:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Us(vs.empty(),$r.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:Tr();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=Ls}Ws({value:s,inclusive:i},{value:e,inclusive:t})<0&&(s=e,i=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Ws({value:s,inclusive:i},{value:t,inclusive:r.inclusive})<0&&(s=t,i=r.inclusive);break}return{value:s,inclusive:i}}function Li(t,n,r){let s=Ms,i=!0;for(const r of Ri(t,n)){let e=Ms,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Us(vs.empty(),$r.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Ms:Tr(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Ms}0<Xs({value:s,inclusive:i},{value:e,inclusive:t})&&(s=e,i=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Xs({value:s,inclusive:i},{value:t,inclusive:r.inclusive})&&(s=t,i=r.inclusive);break}return{value:s,inclusive:i}}class Oi{constructor(e,t=null,n=[],r=[],s=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=a,this.endAt=o,this.wt=null,this.gt=null,this.startAt,this.endAt}}function Fi(e,t,n,r,s,i,a,o){return new Oi(e,t,n,r,s,i,a,o)}function Vi(e){return new Oi(e)}function Pi(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Bi(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function qi(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Ui(e){return null!==e.collectionGroup}function Ki(t){const n=t;if(null===n.wt){n.wt=[];const t=qi(n),e=Bi(n);if(null!==t&&null===e)t.isKeyField()||n.wt.push(new yi(t)),n.wt.push(new yi(jr.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.wt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.wt.push(new yi(jr.keyField(),t))}}}return n.wt}function Gi(e){const t=e;if(!t.gt)if("F"===t.limitType)t.gt=Ai(t.path,t.collectionGroup,Ki(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const s of Ki(t)){const t="desc"===s.dir?"asc":"desc";e.push(new yi(s.field,t))}var n=t.endAt?new Ys(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ys(t.startAt.position,t.startAt.inclusive):null;t.gt=Ai(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.gt}function ji(e,t){t.getFirstInequalityField(),qi(e);var n=e.filters.concat([t]);return new Oi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function $i(e,t,n){return new Oi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Qi(e,t){return Ni(Gi(e),Gi(t))&&e.limitType===t.limitType}function zi(e){return`${Ci(Gi(e))}|lt:${e.limitType}`}function Hi(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>ui(e)).join(", ")}]`),Ts(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>qs(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>qs(e)).join(",")),`Target(${t})`}(Gi(e))}; limitType=${e.limitType})`}function Wi(n,e){return e.isFoundDocument()&&(s=n,a=(i=e).key.path,null!==s.collectionGroup?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(a):$r.isDocumentKey(s.path)?s.path.isEqual(a):s.path.isImmediateParentOf(a))&&function(e){for(const t of Ki(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(s=e,(!(e=n).startAt||(t=e.startAt,r=Js(t,Ki(e),s),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=Js(t,Ki(e),s),t.inclusive?0<=r:0<r)));var t,r,s,i,a}function Xi(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Yi(s){return(e,t)=>{let n=!1;for(const r of Ki(s)){const s=function(e,s,t){var n=e.field.isKeyField()?$r.comparator(s.key,t.key):function(e,t){var n=s.data.field(e),r=t.data.field(e);return null!==n&&null!==r?Ps(n,r):Tr()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Tr()}}(r,e,t);if(0!==s)return s;n=n||r.field.isKeyField()}return 0}}function Ji(e,t){if(e.yt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Es(t)?"-0":t}}function Zi(e){return{integerValue:""+e}}function ea(e,t){return _s(t)?Zi(t):Ji(e,t)}class ta{constructor(){this._=void 0}}function na(e,t){return e instanceof ua?Ks(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class ra extends ta{}class sa extends ta{constructor(e){super(),this.elements=e}}function ia(e,t){const n=ha(t);for(const t of e.elements)n.some(e=>Fs(e,t))||n.push(t);return{arrayValue:{values:n}}}class aa extends ta{constructor(e){super(),this.elements=e}}function oa(e,t){let n=ha(t);for(const t of e.elements)n=n.filter(e=>!Fs(e,t));return{arrayValue:{values:n}}}class ua extends ta{constructor(e,t){super(),this.Tt=e,this.It=t}}function ca(e){return Cs(e.integerValue||e.doubleValue)}function ha(e){return Gs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class la{constructor(e,t){this.field=e,this.transform=t}}class da{constructor(e,t){this.version=e,this.transformResults=t}}class fa{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fa}static exists(e){return new fa(void 0,e)}static updateTime(e){return new fa(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ga(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ma{}function pa(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new Sa(e.key,fa.none()):new Ia(e.key,e.data,fa.none());{const s=e.data,i=Si.empty();let t=new bi(jr.comparator);for(var r of n.fields)if(!t.has(r)){let e=s.field(r);null===e&&1<r.length&&(r=r.popLast(),e=s.field(r)),null===e?i.delete(r):i.set(r,e),t=t.add(r)}return new ba(e.key,i,new _i(t.toArray()),fa.none())}}function ya(e,t,n){e instanceof Ia?function(e,t,n){const r=e.value.clone(),s=Ea(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ba?function(e,t,n){if(!ga(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=Ea(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Ta(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function va(e,t,n,r){return e instanceof Ia?function(e,t,n,r){if(!ga(e.precondition,t))return n;const s=e.value.clone(),i=_a(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof ba?function(e,t,n,r){if(!ga(e.precondition,t))return n;const s=_a(e.fieldTransforms,r,t),i=t.data;return i.setAll(Ta(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,ga(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function wa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Vr(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof sa&&t instanceof sa||e instanceof aa&&t instanceof aa?Vr(e.elements,t.elements,Fs):e instanceof ua&&t instanceof ua?Fs(e.It,t.It):e instanceof ra&&t instanceof ra)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class Ia extends ma{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ba extends ma{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ta(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function Ea(e,t,n){const r=new Map;Er(e.length===n.length);for(let h=0;h<n.length;h++){var s=e[h],i=s.transform,a=t.data.field(s.field);r.set(s.field,(o=i,u=a,c=n[h],o instanceof sa?ia(o,u):o instanceof aa?oa(o,u):c))}var o,u,c;return r}function _a(e,t,n){const r=new Map;for(const c of e){const e=c.transform,h=n.data.field(c.field);r.set(c.field,(s=e,i=h,a=t,u=o=void 0,s instanceof ra?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return i&&(e.fields.__previous_value__=i),{mapValue:e}}():s instanceof sa?ia(s,i):s instanceof aa?oa(s,i):(o=na(s=s,i),u=ca(o)+ca(s.It),Ks(o)&&Ks(s.It)?Zi(u):Ji(s.Tt,u))))}var s,i,a,o,u;return r}class Sa extends ma{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class xa extends ma{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Da{constructor(e){this.count=e}}function Aa(e){switch(e){default:return Tr(),0;case _r.CANCELLED:case _r.UNKNOWN:case _r.DEADLINE_EXCEEDED:case _r.RESOURCE_EXHAUSTED:case _r.INTERNAL:case _r.UNAVAILABLE:case _r.UNAUTHENTICATED:return;case _r.INVALID_ARGUMENT:case _r.NOT_FOUND:case _r.ALREADY_EXISTS:case _r.PERMISSION_DENIED:case _r.FAILED_PRECONDITION:case _r.ABORTED:case _r.OUT_OF_RANGE:case _r.UNIMPLEMENTED:case _r.DATA_LOSS:return 1}}function Ca(e){if(void 0===e)return wr("GRPC error has no .code"),_r.UNKNOWN;switch(e){case rr.OK:return _r.OK;case rr.CANCELLED:return _r.CANCELLED;case rr.UNKNOWN:return _r.UNKNOWN;case rr.DEADLINE_EXCEEDED:return _r.DEADLINE_EXCEEDED;case rr.RESOURCE_EXHAUSTED:return _r.RESOURCE_EXHAUSTED;case rr.INTERNAL:return _r.INTERNAL;case rr.UNAVAILABLE:return _r.UNAVAILABLE;case rr.UNAUTHENTICATED:return _r.UNAUTHENTICATED;case rr.INVALID_ARGUMENT:return _r.INVALID_ARGUMENT;case rr.NOT_FOUND:return _r.NOT_FOUND;case rr.ALREADY_EXISTS:return _r.ALREADY_EXISTS;case rr.PERMISSION_DENIED:return _r.PERMISSION_DENIED;case rr.FAILED_PRECONDITION:return _r.FAILED_PRECONDITION;case rr.ABORTED:return _r.ABORTED;case rr.OUT_OF_RANGE:return _r.OUT_OF_RANGE;case rr.UNIMPLEMENTED:return _r.UNIMPLEMENTED;case rr.DATA_LOSS:return _r.DATA_LOSS;default:return Tr()}}(at=rr=rr||{})[at.OK=0]="OK",at[at.CANCELLED=1]="CANCELLED",at[at.UNKNOWN=2]="UNKNOWN",at[at.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",at[at.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",at[at.NOT_FOUND=5]="NOT_FOUND",at[at.ALREADY_EXISTS=6]="ALREADY_EXISTS",at[at.PERMISSION_DENIED=7]="PERMISSION_DENIED",at[at.UNAUTHENTICATED=16]="UNAUTHENTICATED",at[at.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",at[at.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",at[at.ABORTED=10]="ABORTED",at[at.OUT_OF_RANGE=11]="OUT_OF_RANGE",at[at.UNIMPLEMENTED=12]="UNIMPLEMENTED",at[at.INTERNAL=13]="INTERNAL",at[at.UNAVAILABLE=14]="UNAVAILABLE",at[at.DATA_LOSS=15]="DATA_LOSS";class Na{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){Is(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return bs(this.inner)}size(){return this.innerSize}}const ka=new vi($r.comparator);const Ra=new vi($r.comparator);function Ma(...e){let t=Ra;for(const n of e)t=t.insert(n.key,n);return t}function La(e){let n=Ra;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function Oa(){return new Na(e=>e.toString(),(e,t)=>e.isEqual(t))}const Fa=new vi($r.comparator),Va=new bi($r.comparator);function Pa(...e){let t=Va;for(const n of e)t=t.add(n);return t}const Ba=new bi(Fr);class qa{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Ua.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new qa(qr.min(),r,Ba,ka,Pa())}}class Ua{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ua(n,t,Pa(),Pa(),Pa())}}class Ka{constructor(e,t,n,r){this.Et=e,this.removedTargetIds=t,this.key=n,this.At=r}}class Ga{constructor(e,t){this.targetId=e,this.Rt=t}}class ja{constructor(e,t,n=xs.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class $a{constructor(){this.bt=0,this.vt=Ha(),this.Pt=xs.EMPTY_BYTE_STRING,this.Vt=!1,this.St=!0}get current(){return this.Vt}get resumeToken(){return this.Pt}get Dt(){return 0!==this.bt}get Ct(){return this.St}xt(e){0<e.approximateByteSize()&&(this.St=!0,this.Pt=e)}Nt(){let n=Pa(),r=Pa(),s=Pa();return this.vt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:s=s.add(e);break;default:Tr()}}),new Ua(this.Pt,this.Vt,n,r,s)}kt(){this.St=!1,this.vt=Ha()}Ot(e,t){this.St=!0,this.vt=this.vt.insert(e,t)}Mt(e){this.St=!0,this.vt=this.vt.remove(e)}Ft(){this.bt+=1}$t(){--this.bt}Bt(){this.St=!0,this.Vt=!0}}class Qa{constructor(e){this.Lt=e,this.qt=new Map,this.Ut=ka,this.Kt=za(),this.Gt=new bi(Fr)}Qt(e){for(const t of e.Et)e.At&&e.At.isFoundDocument()?this.jt(t,e.At):this.zt(t,e.key,e.At);for(const n of e.removedTargetIds)this.zt(n,e.key,e.At)}Wt(n){this.forEachTarget(n,e=>{const t=this.Ht(e);switch(n.state){case 0:this.Jt(e)&&t.xt(n.resumeToken);break;case 1:t.$t(),t.Dt||t.kt(),t.xt(n.resumeToken);break;case 2:t.$t(),t.Dt||this.removeTarget(e);break;case 3:this.Jt(e)&&(t.Bt(),t.xt(n.resumeToken));break;case 4:this.Jt(e)&&(this.Yt(e),t.xt(n.resumeToken));break;default:Tr()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.qt.forEach((e,t)=>{this.Jt(t)&&n(t)})}Zt(e){const t=e.targetId,n=e.Rt.count,r=this.Xt(t);if(r){const e=r.target;if(ki(e))if(0===n){const n=new $r(e.path);this.zt(t,n,xi.newNoDocument(n,qr.min()))}else Er(1===n);else this.te(t)!==n&&(this.Yt(t),this.Gt=this.Gt.add(t))}}ee(r){const s=new Map;this.qt.forEach((e,t)=>{var n=this.Xt(t);if(n){if(e.current&&ki(n.target)){const s=new $r(n.target.path);null!==this.Ut.get(s)||this.ne(t,s)||this.zt(t,s,xi.newNoDocument(s,r))}e.Ct&&(s.set(t,e.Nt()),e.kt())}});let i=Pa();this.Kt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.Xt(e);return!t||2===t.purpose||(n=!1)}),n&&(i=i.add(e))}),this.Ut.forEach((e,t)=>t.setReadTime(r));var e=new qa(r,s,this.Gt,this.Ut,i);return this.Ut=ka,this.Kt=za(),this.Gt=new bi(Fr),e}jt(e,t){var n;this.Jt(e)&&(n=this.ne(e,t.key)?2:0,this.Ht(e).Ot(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.Kt=this.Kt.insert(t.key,this.se(t.key).add(e)))}zt(e,t,n){if(this.Jt(e)){const r=this.Ht(e);this.ne(e,t)?r.Ot(t,1):r.Mt(t),this.Kt=this.Kt.insert(t,this.se(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}}removeTarget(e){this.qt.delete(e)}te(e){var t=this.Ht(e).Nt();return this.Lt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ft(e){this.Ht(e).Ft()}Ht(e){let t=this.qt.get(e);return t||(t=new $a,this.qt.set(e,t)),t}se(e){let t=this.Kt.get(e);return t||(t=new bi(Fr),this.Kt=this.Kt.insert(e,t)),t}Jt(e){var t=null!==this.Xt(e);return t||vr("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){var t=this.qt.get(e);return t&&t.Dt?null:this.Lt.ie(e)}Yt(t){this.qt.set(t,new $a),this.Lt.getRemoteKeysForTarget(t).forEach(e=>{this.zt(t,e,null)})}ne(e,t){return this.Lt.getRemoteKeysForTarget(e).has(t)}}function za(){return new vi($r.comparator)}function Ha(){return new vi($r.comparator)}const Wa={asc:"ASCENDING",desc:"DESCENDING"},Xa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ya={and:"AND",or:"OR"};class Ja{constructor(e,t){this.databaseId=e,this.yt=t}}function Za(e,t){return e.yt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function eo(e,t){return e.yt?t.toBase64():t.toUint8Array()}function to(e){return Er(!!e),qr.fromTimestamp((t=As(e),new Br(t.seconds,t.nanos)));var t}function no(e,t){return e=e,new Kr(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function ro(e){var t=Kr.fromString(e);return Er(To(t)),t}function so(e,t){return no(e.databaseId,t.path)}function io(e,t){const n=ro(t);if(n.get(1)!==e.databaseId.projectId)throw new Sr(_r.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Sr(_r.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new $r(co(n))}function ao(e,t){return no(e.databaseId,t)}function oo(e){var t=ro(e);return 4===t.length?Kr.emptyPath():co(t)}function uo(e){return new Kr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function co(e){return Er(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function ho(e,t,n){return{name:so(e,t),fields:n.value.mapValue.fields}}function lo(e,t,n){const r=io(e,t.name),s=to(t.updateTime),i=t.createTime?to(t.createTime):qr.min(),a=new Si({mapValue:{fields:t.fields}}),o=xi.newFoundDocument(r,s,i,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function fo(e,t){let n;if(t instanceof Ia)n={update:ho(e,t.key,t.value)};else if(t instanceof Sa)n={delete:so(e,t.key)};else if(t instanceof ba)n={update:ho(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof xa))return Tr();n={verify:so(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof ra)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof sa)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof aa)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof ua)return{fieldPath:e.field.canonicalString(),increment:t.It};throw Tr()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,Za(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:Tr()),n;var r}function go(t,n){const e=n.currentDocument?void 0!==(s=n.currentDocument).updateTime?fa.updateTime(to(s.updateTime)):void 0!==s.exists?fa.exists(s.exists):fa.none():fa.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)Er("REQUEST_TIME"===t.setToServerValue),n=new ra;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new sa(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new aa(e)}else"increment"in t?n=new ua(e,t.increment):Tr();var r=jr.fromServerFormat(t.fieldPath);return new la(r,n)}(t,e)):[];var s;if(n.update){n.update.name;var i=io(t,n.update.name),a=new Si({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new _i(e.map(e=>jr.fromServerFormat(e)))}();return new ba(i,a,t,e,r)}return new Ia(i,a,e,r)}if(n.delete){const r=io(t,n.delete);return new Sa(r,e)}if(n.verify){const r=io(t,n.verify);return new xa(r,e)}return Tr()}function mo(e,t){return{documents:[ao(e,t.path)]}}function po(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=ao(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=ao(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s=function(e){if(0!==e.length)return function n(e){return e instanceof ti?function(e){if("=="===e.op){if($s(e.value))return{unaryFilter:{field:Io(e.field),op:"IS_NAN"}};if(js(e.value))return{unaryFilter:{field:Io(e.field),op:"IS_NULL"}}}else if("!="===e.op){if($s(e.value))return{unaryFilter:{field:Io(e.field),op:"IS_NOT_NAN"}};if(js(e.value))return{unaryFilter:{field:Io(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Io(e.field),op:vo(e.op),value:e.value}}}(e):e instanceof ni?function(e){const t=e.getFilters().map(e=>n(e));return 1===t.length?t[0]:{compositeFilter:{op:wo(e.op),filters:t}}}(e):Tr()}(ni.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Io(e.field),direction:(e=e.dir,Wa[e])}}(e))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);var i,s=(i=t.limit,e.yt||Ts(i)?i:{value:i});return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(s=t.startAt).inclusive,values:s.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function yo(e){let t=oo(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(0<r){Er(1===r);const g=n.from[0];g.allDescendants?s=g.collectionId:t=t.child(g.collectionId)}let i=[];n.where&&(i=function(){const e=function t(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=bo(e.unaryFilter.field);return ti.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=bo(e.unaryFilter.field);return ti.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=bo(e.unaryFilter.field);return ti.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=bo(e.unaryFilter.field);return ti.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Tr()}}(e):void 0!==e.fieldFilter?function(e){return ti.create(bo(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Tr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ni.create(e.compositeFilter.filters.map(e=>t(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Tr()}}(e.compositeFilter.op))}(e):Tr()}(n.where);return e instanceof ni&&ii(e)?e.getFilters():[e]}());let a=[];n.orderBy&&(a=n.orderBy.map(e=>function(e){return new yi(bo(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let o=null;var u,c,h,l;n.limit&&(o=(e=n.limit,Ts(u="object"==typeof e?e.value:e)?null:u));let d=null;n.startAt&&(d=(c=n.startAt,l=!!c.before,h=c.values||[],new Ys(h,l)));let f=null;return n.endAt&&(f=(c=n.endAt,h=!c.before,l=c.values||[],new Ys(l,h))),Fi(t,s,a,i,o,"F",d,f)}function vo(e){return Xa[e]}function wo(e){return Ya[e]}function Io(e){return{fieldPath:e.canonicalString()}}function bo(e){return jr.fromServerFormat(e.fieldPath)}function To(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function Eo(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=_o(t)),t=function(e,t){let n=t;const r=e.length;for(let s=0;s<r;s++){const r=e.charAt(s);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return _o(t)}function _o(e){return e+""}function So(t){const n=t.length;if(Er(2<=n),2===n)return Er(""===t.charAt(0)&&""===t.charAt(1)),Kr.emptyPath();const r=n-2,s=[];let i="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>r)&&Tr(),t.charAt(n+1)){case"":const r=t.substring(a,n);let e;0===i.length?e=r:(i+=r,e=i,i=""),s.push(e);break;case"":i+=t.substring(a,n),i+="\0";break;case"":i+=t.substring(a,n+1);break;default:Tr()}a=n+2}return new Kr(s)}const xo=["userId","batchId"];function Do(e,t){return[e,Eo(t)]}function Ao(e,t,n){return[e,Eo(t),n]}const Co={},No=["prefixPath","collectionGroup","readTime","documentId"],ko=["prefixPath","collectionGroup","documentId"],Ro=["collectionGroup","readTime","prefixPath","documentId"],Mo=["canonicalId","targetId"],Lo=["targetId","path"],Oo=["path","targetId"],Fo=["collectionId","parent"],Vo=["indexId","uid"],Po=["uid","sequenceNumber"],Bo=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],qo=["indexId","uid","orderedDocumentKey"],Uo=["userId","collectionPath","documentId"],Ko=["userId","collectionPath","largestBatchId"],Go=["userId","collectionGroup","largestBatchId"],jo=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$o=[...jo,"documentOverlays"],Qo=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],zo=Qo,Ho=[...zo,"indexConfiguration","indexState","indexEntries"];class Wo extends ns{constructor(e,t){super(),this.re=e,this.currentSequenceNumber=t}}function Xo(e,t){var n=e;return as.M(n.re,t)}class Yo{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&ya(s,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=va(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=va(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(i,a){const o=Oa();return this.mutations.forEach(e=>{const t=i.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var s=pa(n,r);null!==s&&o.set(e.key,s),n.isValidDocument()||n.convertToNoDocument(qr.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Pa())}isEqual(e){return this.batchId===e.batchId&&Vr(this.mutations,e.mutations,(e,t)=>wa(e,t))&&Vr(this.baseMutations,e.baseMutations,(e,t)=>wa(e,t))}}class Jo{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Er(e.mutations.length===n.length);let r=Fa;var s=e.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new Jo(e,t,n,r)}}class Zo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class eu{constructor(e,t,n,r,s=qr.min(),i=qr.min(),a=xs.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a}withSequenceNumber(e){return new eu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new eu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new eu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class tu{constructor(e){this.oe=e}}function nu(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:ru(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:so(s=e.oe,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:Za(s,e.version.toTimestamp()),createTime:Za(s,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:su(t.version)};else{if(!t.isUnknownDocument())return Tr();r.unknownDocument={path:n.path.toArray(),version:su(t.version)}}var s;return r}function ru(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function su(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iu(e){var t=new Br(e.seconds,e.nanoseconds);return qr.fromTimestamp(t)}function au(t,e){const n=(e.baseMutations||[]).map(e=>go(t.oe,e));for(let i=0;i<e.mutations.length-1;++i){const n=e.mutations[i];if(i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform){const r=e.mutations[i+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(e=>go(t.oe,e)),s=Br.fromMillis(e.localWriteTimeMs);return new Yo(e.batchId,s,n,r)}function ou(e){var t,n=iu(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?iu(e.lastLimboFreeSnapshotVersion):qr.min();let s;return s=void 0!==e.query.documents?(Er(1===(t=e.query).documents.length),Gi(Vi(oo(t.documents[0])))):Gi(yo(e.query)),new eu(s,e.targetId,0,e.lastListenSequenceNumber,n,r,xs.fromBase64String(e.resumeToken))}function uu(e,t){var n=su(t.snapshotVersion),r=su(t.lastLimboFreeSnapshotVersion),s=(ki(t.target)?mo:po)(e.oe,t.target),i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ci(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function cu(e){var t=yo({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?$i(t,t.limit,"L"):t}function hu(e,t){return new Zo(t.largestBatchId,go(e.oe,t.overlayMutation))}function lu(e,t){var n=t.path.lastSegment();return[e,Eo(t.path.popLast()),n]}function du(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:su(r.readTime),documentKey:Eo(r.documentKey.path),largestBatchId:r.largestBatchId}}class fu{getBundleMetadata(e,t){return gu(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:iu(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return gu(e).put({bundleId:(n=t).id,createTime:su(to(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return mu(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:cu(t.bundledQuery),readTime:iu(t.readTime)};var t})}saveNamedQuery(e,t){return mu(e).put({name:(t=t).name,readTime:su(to(t.readTime)),bundledQuery:t.bundledQuery})}}function gu(e){return Xo(e,"bundles")}function mu(e){return Xo(e,"namedQueries")}class pu{constructor(e,t){this.Tt=e,this.userId=t}static ue(e,t){var n=t.uid||"";return new pu(e,n)}getOverlay(e,t){return yu(e).get(lu(this.userId,t)).next(e=>e?hu(this.Tt,e):null)}getOverlays(e,t){const n=Oa();return ss.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,s,e){const i=[];return e.forEach((e,t)=>{var n=new Zo(s,t);i.push(this.ce(r,n))}),ss.waitFor(i)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(Eo(e.getCollectionPath())));const s=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);s.push(yu(n).Y("collectionPathOverlayIndex",t))}),ss.waitFor(s)}getOverlaysForCollection(e,t,n){const r=Oa(),s=Eo(t),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return yu(e).W("collectionPathOverlayIndex",i).next(e=>{for(const t of e){const e=hu(this.Tt,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,s){const i=Oa();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return yu(e).X({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=hu(this.Tt,t);i.size()<s||r.largestBatchId===a?(i.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>i)}ce(e,t){return yu(e).put(function(e,t,n){var[,r,s]=lu(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:fo(e.oe,n.mutation)}}(this.Tt,this.userId,t))}}function yu(e){return Xo(e,"documentOverlays")}class vu{constructor(){}ae(e,t){this.he(e,t),t.le()}he(e,t){var n,r;"nullValue"in e?this.fe(t,5):"booleanValue"in e?(this.fe(t,10),t.de(e.booleanValue?1:0)):"integerValue"in e?(this.fe(t,15),t.de(Cs(e.integerValue))):"doubleValue"in e?(n=Cs(e.doubleValue),isNaN(n)?this.fe(t,13):(this.fe(t,15),Es(n)?t.de(0):t.de(n))):"timestampValue"in e?(r=e.timestampValue,this.fe(t,20),"string"==typeof r?t._e(r):(t._e(`${r.seconds||""}`),t.de(r.nanos||0))):"stringValue"in e?(this.we(e.stringValue,t),this.me(t)):"bytesValue"in e?(this.fe(t,30),t.ge(Ns(e.bytesValue)),this.me(t)):"referenceValue"in e?this.ye(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.fe(t,45),t.de(r.latitude||0),t.de(r.longitude||0)):"mapValue"in e?Hs(e)?this.fe(t,Number.MAX_SAFE_INTEGER):(this.pe(e.mapValue,t),this.me(t)):"arrayValue"in e?(this.Ie(e.arrayValue,t),this.me(t)):Tr()}we(e,t){this.fe(t,25),this.Te(e,t)}Te(e,t){t._e(e)}pe(e,t){var n=e.fields||{};this.fe(t,55);for(const e of Object.keys(n))this.we(e,t),this.he(n[e],t)}Ie(e,t){var n=e.values||[];this.fe(t,50);for(const e of n)this.he(e,t)}ye(e,t){this.fe(t,37),$r.fromName(e).path.forEach(e=>{this.fe(t,60),this.Te(e,t)})}fe(e,t){e.de(t)}me(e){e.de(2)}}function wu(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}vu.Ee=new vu;class Iu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ae(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Re(n.value),n=t.next();this.be()}ve(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Pe(n.value),n=t.next();this.Ve()}Se(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Re(e);else if(e<2048)this.Re(960|e>>>6),this.Re(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Re(480|e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e);else{const e=t.codePointAt(0);this.Re(240|e>>>18),this.Re(128|63&e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e)}}this.be()}De(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Pe(e);else if(e<2048)this.Pe(960|e>>>6),this.Pe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e);else{const e=t.codePointAt(0);this.Pe(240|e>>>18),this.Pe(128|63&e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e)}}this.Ve()}Ce(e){var t=this.xe(e),n=wu(t);this.Ne(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}ke(e){var t=this.xe(e),n=wu(t);this.Ne(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Oe(){this.Me(255),this.Me(255)}Fe(){this.$e(255),this.$e(255)}reset(){this.position=0}seed(e){this.Ne(e.length),this.buffer.set(e,this.position),this.position+=e.length}Be(){return this.buffer.slice(0,this.position)}xe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Re(e){var t=255&e;0==t?(this.Me(0),this.Me(255)):255==t?(this.Me(255),this.Me(0)):this.Me(t)}Pe(e){var t=255&e;0==t?(this.$e(0),this.$e(255)):255==t?(this.$e(255),this.$e(0)):this.$e(e)}be(){this.Me(0),this.Me(1)}Ve(){this.$e(0),this.$e(1)}Me(e){this.Ne(1),this.buffer[this.position++]=e}$e(e){this.Ne(1),this.buffer[this.position++]=~e}Ne(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class bu{constructor(e){this.Le=e}ge(e){this.Le.Ae(e)}_e(e){this.Le.Se(e)}de(e){this.Le.Ce(e)}le(){this.Le.Oe()}}class Tu{constructor(e){this.Le=e}ge(e){this.Le.ve(e)}_e(e){this.Le.De(e)}de(e){this.Le.ke(e)}le(){this.Le.Fe()}}class Eu{constructor(){this.Le=new Iu,this.qe=new bu(this.Le),this.Ue=new Tu(this.Le)}seed(e){this.Le.seed(e)}Ke(e){return 0===e?this.qe:this.Ue}Be(){return this.Le.Be()}reset(){this.Le.reset()}}class _u{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ge(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new _u(this.indexId,this.documentKey,this.arrayValue,n)}}function Su(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=xu(e.arrayValue,t.arrayValue),0!==n?n:(n=xu(e.directionalValue,t.directionalValue),0!==n?n:$r.comparator(e.documentKey,t.documentKey)))}function xu(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class Du{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Qe=e.orderBy,this.je=[];for(const t of e.filters){const e=t;e.isInequality()?this.ze=e:this.je.push(e)}}We(e){Er(e.collectionGroup===this.collectionId);var t=zr(e);if(void 0!==t&&!this.He(t))return!1;var n=Hr(e);let r=0,s=0;for(;r<n.length&&this.He(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.ze){const e=n[r];if(!this.Je(this.ze,e)||!this.Ye(this.Qe[s++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(s>=this.Qe.length||!this.Ye(this.Qe[s++],e))return!1}return!0}He(e){for(const t of this.je)if(this.Je(t,e))return!0;return!1}Je(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}Ye(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Au(e){if(0===e.getFilters().length)return[];const t=function t(e){if(Er(e instanceof ti||e instanceof ni),e instanceof ti)return e;if(1===e.filters.length)return t(e.filters[0]);const n=e.filters.map(e=>t(e));let r=ni.create(n,e.op);return r=Lu(r),ku(r)?r:(Er(r instanceof ni),Er(ri(r)),Er(1<r.filters.length),r.filters.reduce((e,t)=>Ru(e,t)))}(function t(n){var e;if(Er(n instanceof ti||n instanceof ni),n instanceof ti){if(n instanceof gi){const r=(null===(e=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===e?void 0:e.map(e=>ti.create(n.field,"==",e)))||[];return ni.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return ni.create(r,n.op)}(e));return Er(ku(t)),Cu(t)||Nu(t)?[t]:t.getFilters()}function Cu(e){return e instanceof ti}function Nu(e){return e instanceof ni&&ii(e)}function ku(e){return Cu(e)||Nu(e)||function(e){if(e instanceof ni&&si(e)){for(const t of e.getFilters())if(!Cu(t)&&!Nu(t))return!1;return!0}return!1}(e)}function Ru(e,t){var n,r;return Er(e instanceof ti||e instanceof ni),Er(t instanceof ti||t instanceof ni),Lu(e instanceof ti?t instanceof ti?(n=e,r=t,ni.create([n,r],"and")):Mu(e,t):t instanceof ti?Mu(t,e):function(e,t){if(Er(0<e.filters.length&&0<t.filters.length),ri(e)&&ri(t))return oi(e,t.getFilters());const n=si(e)?e:t,r=si(e)?t:e,s=n.filters.map(e=>Ru(e,r));return ni.create(s,"or")}(e,t))}function Mu(t,e){if(ri(e))return oi(e,t.getFilters());var n=e.filters.map(e=>Ru(t,e));return ni.create(n,"or")}function Lu(t){if(Er(t instanceof ti||t instanceof ni),t instanceof ti)return t;const e=t.getFilters();if(1===e.length)return Lu(e[0]);if(ai(t))return t;const n=e.map(e=>Lu(e)),r=[];return n.forEach(e=>{e instanceof ti?r.push(e):e instanceof ni&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:ni.create(r,t.op)}class Ou{constructor(){this.Ze=new Fu}addToCollectionParentIndex(e,t){return this.Ze.add(t),ss.resolve()}getCollectionParents(e,t){return ss.resolve(this.Ze.getEntries(t))}addFieldIndex(e,t){return ss.resolve()}deleteFieldIndex(e,t){return ss.resolve()}getDocumentsMatchingTarget(e,t){return ss.resolve(null)}getIndexType(e,t){return ss.resolve(0)}getFieldIndexes(e,t){return ss.resolve([])}getNextCollectionGroupToUpdate(e){return ss.resolve(null)}getMinOffset(e,t){return ss.resolve(Zr.min())}getMinOffsetFromCollectionGroup(e,t){return ss.resolve(Zr.min())}updateCollectionGroup(e,t,n){return ss.resolve()}updateIndexEntries(e,t){return ss.resolve()}}class Fu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new bi(Kr.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new bi(Kr.comparator)).toArray()}}const Vu=new Uint8Array(0);class Pu{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new Fu,this.tn=new Na(e=>Ci(e),(e,t)=>Ni(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Xe.has(t))return ss.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Xe.add(t)});r={collectionId:n,parent:Eo(r)};return Bu(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Pr(n),""],!1,!0);return Bu(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(So(t.parent))}return r})}addFieldIndex(e,t){const n=Uu(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const s=n.add(r);if(t.indexState){const n=Ku(e);return s.next(e=>{n.put(du(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Uu(e),r=Ku(e),s=qu(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,c){const h=qu(e);let l=!0;const n=new Map;return ss.forEach(this.en(c),t=>this.nn(e,t).next(e=>{l=l&&!!e,n.set(t,e)})).next(()=>{if(l){let u=Pa();const l=[];return ss.forEach(n,(e,t)=>{vr("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${Ci(c)}`);var n=function(e,t){var n=zr(t);if(void 0===n)return null;for(const t of Ri(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of Hr(t))for(const t of Ri(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),s=function(e,t){const n=[];let r=!0;for(const s of Hr(t)){const t=(0===s.kind?Mi:Li)(e,s.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new Ys(n,r)}(t,e),i=function(e,t){const n=[];let r=!0;for(const s of Hr(t)){const t=(0===s.kind?Li:Mi)(e,s.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new Ys(n,r)}(t,e),a=this.sn(e,t,s),o=this.sn(e,t,i),r=this.rn(e,t,r),r=this.on(e.indexId,n,a,s.inclusive,o,i.inclusive,r);return ss.forEach(r,e=>h.J(e,c.limit).next(e=>{e.forEach(e=>{var t=$r.fromSegments(e.documentKey);u.has(t)||(u=u.add(t),l.push(t))})}))}).next(()=>l)}return ss.resolve(null)})}en(t){let e=this.tn.get(t);return e||(e=0===t.filters.length?[t]:Au(ni.create(t.filters,"and")).map(e=>Ai(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.tn.set(t,e),e)}on(t,e,n,r,s,i,a){const o=(null!=e?e.length:1)*Math.max(n.length,s.length),u=o/(null!=e?e.length:1),c=[];for(let h=0;h<o;++h){const o=e?this.un(e[h/u]):Vu,l=this.cn(t,o,n[h%u],r),d=this.an(t,o,s[h%u],i),f=a.map(e=>this.cn(t,o,e,!0));c.push(...this.createRange(l,d,f))}return c}cn(e,t,n,r){const s=new _u(e,$r.empty(),t,n);return r?s:s.Ge()}an(e,t,n,r){const s=new _u(e,$r.empty(),t,n);return r?s.Ge():s}nn(e,t){const r=new Du(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.We(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.en(t);return ss.forEach(r,t=>this.nn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new bi(jr.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}hn(e,t){const n=new Eu;for(const s of Hr(e)){const e=t.data.field(s.fieldPath);if(null==e)return null;var r=n.Ke(s.kind);vu.Ee.ae(e,r)}return n.Be()}un(e){const t=new Eu;return vu.Ee.ae(e,t.Ke(0)),t.Be()}ln(e,t){const n=new Eu;return vu.Ee.ae(Us(this.databaseId,t),n.Ke(0===(r=Hr(e)).length?0:r[r.length-1].kind)),n.Be();var r}rn(e,t,n){if(null===n)return[];let r=[];r.push(new Eu);let s=0;for(const i of Hr(e)){const e=n[s++];for(const n of r)if(this.fn(t,i.fieldPath)&&Gs(e))r=this.dn(r,i,e);else{const t=n.Ke(i.kind);vu.Ee.ae(e,t)}}return this._n(r)}sn(e,t,n){return this.rn(e,t,n.position)}_n(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Be();return t}dn(e,t,n){const r=[...e],s=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new Eu;r.seed(n.Be()),vu.Ee.ae(e,r.Ke(t.kind)),s.push(r)}return s}fn(e,t){return!!e.filters.find(e=>e instanceof ti&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=Uu(e),r=Ku(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const i=[];return ss.forEach(e,s=>r.get([s.indexId,this.uid]).next(e=>{var t,n,r;i.push((t=s,n=(e=e)?new Xr(e.sequenceNumber,new Zr(iu(e.readTime),new $r(So(e.documentKey)),e.largestBatchId)):Xr.empty(),r=t.fields.map(([e,t])=>new Wr(jr.fromServerFormat(e),t)),new Qr(t.indexId,t.collectionGroup,r,n)))})).next(()=>i)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:Fr(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Uu(e),i=Ku(e);return this.wn(e).next(t=>s.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>ss.forEach(e,e=>i.put(du(e.indexId,this.user,t,r)))))}updateIndexEntries(s,e){const n=new Map;return ss.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?ss.resolve(e):this.getFieldIndexes(s,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),ss.forEach(e,n=>this.mn(s,t,n).next(e=>{var t=this.gn(r,n);return e.isEqual(t)?ss.resolve():this.yn(s,r,n,e,t)}))))})}pn(e,t,n,r){return qu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.ln(n,t.key),documentKey:t.key.path.toArray()})}In(e,t,n,r){return qu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.ln(n,t.key),t.key.path.toArray()])}mn(e,n,r){const t=qu(e);let s=new bi(Su);return t.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.ln(r,n)])},(e,t)=>{s=s.add(new _u(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>s)}gn(e,t){let n=new bi(Su);var r=this.hn(t,e);if(null==r)return n;const s=zr(t);if(null!=s){var i=e.data.field(s.fieldPath);if(Gs(i))for(const s of i.arrayValue.values||[])n=n.add(new _u(t.indexId,e.key,this.un(s),r))}else n=n.add(new _u(t.indexId,e.key,Vu,r));return n}yn(t,n,r,c,e){vr("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const s=[];return function(e,n,r,s){var i=c.getIterator(),a=e.getIterator();let o=Ei(i),u=Ei(a);for(;o||u;){let e=!1,t=!1;if(o&&u){const r=n(o,u);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(u),u=Ei(a)):t?(s(o),o=Ei(i)):(o=Ei(i),u=Ei(a))}}(e,Su,e=>{s.push(this.pn(t,n,r,e))},e=>{s.push(this.In(t,n,r,e))}),ss.waitFor(s)}wn(e){let r=1;return Ku(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>Su(e,t)).filter((e,t,n)=>!t||0!==Su(e,n[t-1]));const r=[];r.push(e);for(const s of n){const n=Su(s,e),i=Su(s,t);if(0===n)r[0]=e.Ge();else if(0<n&&i<0)r.push(s),r.push(s.Ge());else if(0<i)break}r.push(t);const s=[];for(let a=0;a<r.length;a+=2){if(this.Tn(r[a],r[a+1]))return[];const t=[r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,Vu,[]],n=[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,Vu,[]];s.push(IDBKeyRange.bound(t,n))}return s}Tn(e,t){return 0<Su(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Gu)}getMinOffset(t,e){return ss.mapArray(this.en(e),e=>this.nn(t,e).next(e=>e||Tr())).next(Gu)}}function Bu(e){return Xo(e,"collectionParents")}function qu(e){return Xo(e,"indexEntries")}function Uu(e){return Xo(e,"indexConfiguration")}function Ku(e){return Xo(e,"indexState")}function Gu(e){Er(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let s=1;s<e.length;s++){var r=e[s].indexState.offset;es(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new Zr(t.readTime,t.documentKey,n)}const ju={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class $u{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new $u(e,$u.DEFAULT_COLLECTION_PERCENTILE,$u.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Qu(e,t,n){const r=e.store("mutations"),s=e.store("documentMutations"),i=[],a=IDBKeyRange.only(n.batchId);let o=0;const u=r.X({range:a},(e,t,n)=>(o++,n.delete()));i.push(u.next(()=>{Er(1===o)}));const c=[];for(const e of n.mutations){const r=Ao(t,e.key.path,n.batchId);i.push(s.delete(r)),c.push(e.key)}return ss.waitFor(i).next(()=>c)}function zu(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Tr();t=e.noDocument}return JSON.stringify(t).length}$u.DEFAULT_COLLECTION_PERCENTILE=10,$u.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$u.DEFAULT=new $u(41943040,$u.DEFAULT_COLLECTION_PERCENTILE,$u.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$u.DISABLED=new $u(-1,0,0);class Hu{constructor(e,t,n,r){this.userId=e,this.Tt=t,this.indexManager=n,this.referenceDelegate=r,this.En={}}static ue(e,t,n,r){Er(""!==e.uid);var s=e.isAuthenticated()?e.uid:"";return new Hu(s,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xu(e).X({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(h,l,d,f){const g=Yu(h),m=Xu(h);return m.add({}).next(e=>{Er("number"==typeof e);const t=new Yo(e,l,d,f),n=(s=this.Tt,i=this.userId,a=t,o=a.baseMutations.map(e=>fo(s.oe,e)),u=a.mutations.map(e=>fo(s.oe,e)),{userId:i,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:u}),r=[];var s,i,a,o,u;let c=new bi((e,t)=>Fr(e.canonicalString(),t.canonicalString()));for(const h of f){const l=Ao(this.userId,h.key.path,e);c=c.add(h.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,Co))}return c.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(h,e))}),h.addOnCommittedListener(()=>{this.En[e]=t.keys()}),ss.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return Xu(e).get(t).next(e=>e?(Er(e.userId===this.userId),au(this.Tt,e)):null)}An(e,n){return this.En[n]?ss.resolve(this.En[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.En[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Xu(e).X({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(Er(t.batchId>=r),s=au(this.Tt,t)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Xu(e).X({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xu(e).W("userMutationsIndex",t).next(e=>e.map(e=>au(this.Tt,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=Do(this.userId,o.path),t=IDBKeyRange.lowerBound(e),u=[];return Yu(a).X({range:t},(e,t,n)=>{var[r,s,i]=e,s=So(s);if(r===this.userId&&o.path.isEqual(s))return Xu(a).get(i).next(e=>{if(!e)throw Tr();Er(e.userId===this.userId),u.push(au(this.Tt,e))});n.done()}).next(()=>u)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new bi(Fr);const n=[];return e.forEach(a=>{var e=Do(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=Yu(t).X({range:e},(e,t,n)=>{var[r,s,i]=e,s=So(s);r===this.userId&&a.path.isEqual(s)?o=o.add(i):n.done()});n.push(e)}),ss.waitFor(n).next(()=>this.Rn(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=Do(this.userId,a),r=IDBKeyRange.lowerBound(n);let u=new bi(Fr);return Yu(e).X({range:r},(e,t,n)=>{var[r,s,i]=e,s=So(s);r===this.userId&&a.isPrefixOf(s)?s.length===o&&(u=u.add(i)):n.done()}).next(()=>this.Rn(e,u))}Rn(t,e){const n=[],r=[];return e.forEach(e=>{r.push(Xu(t).get(e).next(e=>{if(null===e)throw Tr();Er(e.userId===this.userId),n.push(au(this.Tt,e))}))}),ss.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return Qu(t.re,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.bn(n.batchId)}),ss.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}bn(e){delete this.En[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return ss.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return Yu(n).X({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=So(e[1]);r.push(t)}else n.done()}).next(()=>{Er(0===r.length)})})}containsKey(e,t){return Wu(e,this.userId,t)}vn(e){return Ju(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Wu(e,i,t){const n=Do(i,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return Yu(e).X({range:r,Z:!0},(e,t,n)=>{var[r,s]=e;r===i&&s===a&&(o=!0),n.done()}).next(()=>o)}function Xu(e){return Xo(e,"mutations")}function Yu(e){return Xo(e,"documentMutations")}function Ju(e){return Xo(e,"mutationQueues")}class Zu{constructor(e){this.Pn=e}next(){return this.Pn+=2,this.Pn}static Vn(){return new Zu(0)}static Sn(){return new Zu(-1)}}class ec{constructor(e,t){this.referenceDelegate=e,this.Tt=t}allocateTargetId(n){return this.Dn(n).next(e=>{const t=new Zu(e.highestTargetId);return e.highestTargetId=t.next(),this.Cn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Dn(e).next(e=>qr.fromTimestamp(new Br(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Dn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Dn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Cn(t,e)))}addTargetData(t,n){return this.xn(t,n).next(()=>this.Dn(t).next(e=>(e.targetCount+=1,this.Nn(n,e),this.Cn(t,e))))}updateTargetData(e,t){return this.xn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>tc(t).delete(e.targetId)).next(()=>this.Dn(t)).next(e=>(Er(0<e.targetCount),--e.targetCount,this.Cn(t,e)))}removeTargets(r,s,i){let a=0;const o=[];return tc(r).X((e,t)=>{var n=ou(t);n.sequenceNumber<=s&&null===i.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>ss.waitFor(o)).next(()=>a)}forEachTarget(e,r){return tc(e).X((e,t)=>{var n=ou(t);r(n)})}Dn(e){return nc(e).get("targetGlobalKey").next(e=>(Er(null!==e),e))}Cn(e,t){return nc(e).put("targetGlobalKey",t)}xn(e,t){return tc(e).put(uu(this.Tt,t))}Nn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Dn(e).next(e=>e.targetCount)}getTargetData(e,s){var t=Ci(s),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return tc(e).X({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=ou(t);Ni(s,r.target)&&(i=r,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const s=[],i=rc(n);return e.forEach(e=>{var t=Eo(e.path);s.push(i.put({targetId:r,path:t})),s.push(this.referenceDelegate.addReference(n,r,e))}),ss.waitFor(s)}removeMatchingKeys(n,e,r){const s=rc(n);return ss.forEach(e,e=>{var t=Eo(e.path);return ss.waitFor([s.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=rc(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=rc(e);let s=Pa();return r.X({range:n,Z:!0},(e,t,n)=>{var r=So(e[1]),r=new $r(r);s=s.add(r)}).next(()=>s)}containsKey(e,t){var n=Eo(t.path),n=IDBKeyRange.bound([n],[Pr(n)],!1,!0);let r=0;return rc(e).X({index:"documentTargetsIndex",Z:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}ie(e,t){return tc(e).get(t).next(e=>e?ou(e):null)}}function tc(e){return Xo(e,"targets")}function nc(e){return Xo(e,"targetGlobal")}function rc(e){return Xo(e,"targetDocuments")}function sc([e,t],[n,r]){var s=Fr(e,n);return 0===s?Fr(t,r):s}class ic{constructor(e){this.kn=e,this.buffer=new bi(sc),this.On=0}Mn(){return++this.On}Fn(e){var t=[e,this.Mn()];if(this.buffer.size<this.kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();sc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ac{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.$n=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Bn(6e4)}stop(){this.$n&&(this.$n.cancel(),this.$n=null)}get started(){return null!==this.$n}Bn(e){vr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.$n=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.$n=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){cs(e)?vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await rs(e)}await this.Bn(3e5)})}}class oc{constructor(e,t){this.Ln=e,this.params=t}calculateTargetCount(e,t){return this.Ln.qn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ss.resolve(ps.at);const n=new ic(t);return this.Ln.forEachTarget(e,e=>n.Fn(e.sequenceNumber)).next(()=>this.Ln.Un(e,e=>n.Fn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Ln.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Ln.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(vr("LruGarbageCollector","Garbage collection skipped; disabled"),ss.resolve(ju)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(vr("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ju):this.Kn(t,n))}getCacheSize(e){return this.Ln.getCacheSize(e)}Kn(t,n){let r,s,i,a,o,u,c;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(s=e>this.params.maximumSequenceNumbersToCollect?(vr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,s))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(i=e,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(c=Date.now(),yr()<=l.DEBUG&&vr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-h}ms\n\tDetermined least recently used ${s} in `+(o-a)+"ms\n"+`\tRemoved ${i} targets in `+(u-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-h}ms`),ss.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e})))}}class uc{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new oc(e,t))}qn(e){const n=this.Gn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Gn(e){let t=0;return this.Un(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Un(e,n){return this.Qn(e,(e,t)=>n(t))}addReference(e,t,n){return cc(e,n)}removeReference(e,t,n){return cc(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return cc(e,t)}jn(t,n){let r=!1;return Ju(t).tt(e=>Wu(t,e,n).next(e=>(e&&(r=!0),ss.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let a=0;return this.Qn(n,(t,e)=>{if(e<=r){const r=this.jn(n,t).next(e=>{if(!e)return a++,s.getEntry(n,t).next(()=>(s.removeEntry(t,qr.min()),rc(n).delete([0,Eo(t.path)])))});i.push(r)}}).next(()=>ss.waitFor(i)).next(()=>s.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return cc(e,t)}Qn(e,r){const t=rc(e);let s,i=ps.at;return t.X({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(i!==ps.at&&r(new $r(So(s)),i),i=n,s=t):i=ps.at}).next(()=>{i!==ps.at&&r(new $r(So(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function cc(e,t){return rc(e).put((e=e.currentSequenceNumber,{targetId:0,path:Eo(t.path),sequenceNumber:e}))}class hc{constructor(){this.changes=new Na(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?ss.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class lc{constructor(e){this.Tt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return mc(e).put(n)}removeEntry(e,n,t){return mc(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],ru(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.zn(t,e)))}getEntry(e,n){let r=xi.newInvalidDocument(n);return mc(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(pc(n))},(e,t)=>{r=this.Wn(n,t)}).next(()=>r)}Hn(e,n){let r={size:0,document:xi.newInvalidDocument(n)};return mc(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(pc(n))},(e,t)=>{r={document:this.Wn(n,t),size:zu(t)}}).next(()=>r)}getEntries(e,t){let r=ka;return this.Jn(e,t,(e,t)=>{var n=this.Wn(e,t);r=r.insert(e,n)}).next(()=>r)}Yn(e,t){let r=ka,s=new vi($r.comparator);return this.Jn(e,t,(e,t)=>{var n=this.Wn(e,t);r=r.insert(e,n),s=s.insert(e,zu(t))}).next(()=>({documents:r,Zn:s}))}Jn(e,t,s){if(t.isEmpty())return ss.resolve();let n=new bi(vc);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(pc(n.first()),pc(n.last())),i=n.getIterator();let a=i.getNext();return mc(e).X({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=$r.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&vc(a,r)<0;)s(a,null),a=i.getNext();a&&a.isEqual(r)&&(s(a,t),a=i.hasNext()?i.getNext():null),a?n.j(pc(a)):n.done()}).next(()=>{for(;a;)s(a,null),a=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,r,t,s){const n=r.path,i=[n.popLast().toArray(),n.lastSegment(),ru(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],a=[n.popLast().toArray(),n.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return mc(e).W(IDBKeyRange.bound(i,a,!0)).next(e=>{let t=ka;for(const n of e){const e=this.Wn($r.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e.isFoundDocument()&&(Wi(r,e)||s.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,n,s){let i=ka;var r=yc(t,n),a=yc(t,Zr.max());return mc(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.Wn($r.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(r.key,r),i.size===s&&n.done()}).next(()=>i)}newChangeBuffer(e){return new fc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return gc(e).get("remoteDocumentGlobalKey").next(e=>(Er(!!e),e))}zn(e,t){return gc(e).put("remoteDocumentGlobalKey",t)}Wn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=lo(e.oe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=$r.fromSegments(t.noDocument.path),s=iu(t.noDocument.readTime);n=xi.newNoDocument(e,s),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Tr();{const e=$r.fromSegments(t.unknownDocument.path),i=iu(t.unknownDocument.version);n=xi.newUnknownDocument(e,i)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new Br(t[0],t[1]),qr.fromTimestamp(r))),n;var r}(this.Tt,t);if(!e.isNoDocument()||!e.version.isEqual(qr.min()))return e}return xi.newInvalidDocument(e)}}function dc(e){return new lc(e)}class fc extends hc{constructor(e,t){super(),this.Xn=e,this.trackRemovals=t,this.ts=new Na(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const a=[];let o=0,u=new bi((e,t)=>Fr(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.ts.get(e);if(a.push(this.Xn.removeEntry(i,e,n.readTime)),t.isValidDocument()){var r=nu(this.Xn.Tt,t);u=u.add(e.path.popLast());var s=zu(r);o+=s-n.size,a.push(this.Xn.addEntry(i,e,r))}else if(o-=n.size,this.trackRemovals){const o=nu(this.Xn.Tt,t.convertToNoDocument(qr.min()));a.push(this.Xn.addEntry(i,e,o))}}),u.forEach(e=>{a.push(this.Xn.indexManager.addToCollectionParentIndex(i,e))}),a.push(this.Xn.updateMetadata(i,o)),ss.waitFor(a)}getFromCache(e,t){return this.Xn.Hn(e,t).next(e=>(this.ts.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Xn.Yn(e,t).next(({documents:n,Zn:e})=>(e.forEach((e,t)=>{this.ts.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function gc(e){return Xo(e,"remoteDocumentGlobal")}function mc(e){return Xo(e,"remoteDocumentsV14")}function pc(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function yc(e,t){const n=t.documentKey.path.toArray();return[e,ru(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function vc(e,t){var n=e.path.toArray(),r=t.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Fr(n[i],r[i]),s)return s;return s=Fr(n.length,r.length),s||(s=Fr(n[n.length-2],r[r.length-2]),s||Fr(n[n.length-1],r[r.length-1]))}class wc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ic{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&va(r.mutation,e,_i.empty(),Br.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,Pa()).next(()=>e))}getLocalViewOfDocuments(e,t,n=Pa()){const r=Oa();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=Ma();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=Oa();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Pa()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,s){let i=ka;const a=Oa(),o=Oa();return t.forEach((e,t)=>{const n=r.get(t.key);s.has(t.key)&&(void 0===n||n.mutation instanceof ba)?i=i.insert(t.key,t):void 0!==n?(a.set(t.key,n.mutation.getFieldMask()),va(n.mutation,t,n.mutation.getFieldMask(),Br.now())):a.set(t.key,_i.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new wc(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(i,a){const o=Oa();let u=new vi((e,t)=>e-t),c=Pa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(i,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||_i.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(u.get(r.batchId)||Pa()).add(e),u=u.insert(r.batchId,t))})}).next(()=>{const e=[],t=u.getReverseIterator();for(;t.hasNext();){const u=t.getNext(),n=u.key,r=u.value,s=Oa();r.forEach(e=>{var t;c.has(e)||(null!==(t=pa(a.get(e),o.get(e)))&&s.set(e,t),c=c.add(e))}),e.push(this.documentOverlayCache.saveOverlays(i,n,s))}return ss.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,$r.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ui(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(i,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(i,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(i,t,a.largestBatchId,o-n.size):ss.resolve(Oa());let r=-1,s=n;return e.next(e=>ss.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?ss.resolve():this.remoteDocumentCache.getEntry(i,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(i,e,n)).next(()=>this.computeViews(i,s,e,Pa())).next(e=>({batchId:r,changes:La(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new $r(t)).next(e=>{let t=Ma();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,s,i){const a=s.collectionGroup;let o=Ma();return this.indexManager.getCollectionParents(r,a).next(e=>ss.forEach(e,e=>{var t,n=(t=s,e=e.child(a),new Oi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,i).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,i,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,i.path,n.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,i,n,a))).next(r=>{a.forEach((e,t)=>{var n=t.getKey();null===r.get(n)&&(r=r.insert(n,xi.newInvalidDocument(n)))});let s=Ma();return r.forEach((e,t)=>{var n=a.get(e);void 0!==n&&va(n.mutation,t,_i.empty(),Br.now()),Wi(i,t)&&(s=s.insert(e,t))}),s})}}class bc{constructor(e){this.Tt=e,this.es=new Map,this.ns=new Map}getBundleMetadata(e,t){return ss.resolve(this.es.get(t))}saveBundleMetadata(e,t){return this.es.set(t.id,{id:t.id,version:t.version,createTime:to(t.createTime)}),ss.resolve()}getNamedQuery(e,t){return ss.resolve(this.ns.get(t))}saveNamedQuery(e,t){return this.ns.set(t.name,{name:(t=t).name,query:cu(t.bundledQuery),readTime:to(t.readTime)}),ss.resolve()}}class Tc{constructor(){this.overlays=new vi($r.comparator),this.ss=new Map}getOverlay(e,t){return ss.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Oa();return ss.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.ce(n,r,t)}),ss.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ss.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.ss.delete(n)),ss.resolve()}getOverlaysForCollection(e,t,n){const r=Oa(),s=t.length+1,i=new $r(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ss.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new vi((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=Oa(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=Oa(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return ss.resolve(a)}ce(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.ss.get(r.largestBatchId).delete(n.key);this.ss.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Zo(t,n));let s=this.ss.get(t);void 0===s&&(s=Pa(),this.ss.set(t,s)),this.ss.set(t,s.add(n.key))}}class Ec{constructor(){this.rs=new bi(_c.os),this.us=new bi(_c.cs)}isEmpty(){return this.rs.isEmpty()}addReference(e,t){var n=new _c(e,t);this.rs=this.rs.add(n),this.us=this.us.add(n)}hs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ls(new _c(e,t))}fs(e,t){e.forEach(e=>this.removeReference(e,t))}ds(e){const t=new $r(new Kr([])),n=new _c(t,e),r=new _c(t,e+1),s=[];return this.us.forEachInRange([n,r],e=>{this.ls(e),s.push(e.key)}),s}_s(){this.rs.forEach(e=>this.ls(e))}ls(e){this.rs=this.rs.delete(e),this.us=this.us.delete(e)}ws(e){var t=new $r(new Kr([])),n=new _c(t,e),t=new _c(t,e+1);let r=Pa();return this.us.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new _c(e,0),t=this.rs.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class _c{constructor(e,t){this.key=e,this.gs=t}static os(e,t){return $r.comparator(e.key,t.key)||Fr(e.gs,t.gs)}static cs(e,t){return Fr(e.gs,t.gs)||$r.comparator(e.key,t.key)}}class Sc{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ys=1,this.ps=new bi(_c.os)}checkEmpty(e){return ss.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var s=this.ys;this.ys++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var i=new Yo(s,t,n,r);this.mutationQueue.push(i);for(const t of r)this.ps=this.ps.add(new _c(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ss.resolve(i)}lookupMutationBatch(e,t){return ss.resolve(this.Is(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.Ts(t+1),n=n<0?0:n;return ss.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return ss.resolve(0===this.mutationQueue.length?-1:this.ys-1)}getAllMutationBatches(e){return ss.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new _c(t,0),r=new _c(t,Number.POSITIVE_INFINITY),s=[];return this.ps.forEachInRange([n,r],e=>{var t=this.Is(e.gs);s.push(t)}),ss.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new bi(Fr);return t.forEach(e=>{var t=new _c(e,0),n=new _c(e,Number.POSITIVE_INFINITY);this.ps.forEachInRange([t,n],e=>{r=r.add(e.gs)})}),ss.resolve(this.Es(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;$r.isDocumentKey(s)||(s=s.child(""));var i=new _c(new $r(s),0);let a=new bi(Fr);return this.ps.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.gs)),!0)},i),ss.resolve(this.Es(a))}Es(e){const n=[];return e.forEach(e=>{var t=this.Is(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){Er(0===this.As(r.batchId,"removed")),this.mutationQueue.shift();let s=this.ps;return ss.forEach(r.mutations,e=>{var t=new _c(e.key,r.batchId);return s=s.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ps=s})}bn(e){}containsKey(e,t){var n=new _c(t,0),n=this.ps.firstAfterOrEqual(n);return ss.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,ss.resolve()}As(e,t){return this.Ts(e)}Ts(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Is(e){var t=this.Ts(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class xc{constructor(e){this.Rs=e,this.docs=new vi($r.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.Rs(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ss.resolve(n?n.document.mutableCopy():xi.newInvalidDocument(t))}getEntries(e,t){let n=ka;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():xi.newInvalidDocument(e))}),ss.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=ka;const i=t.path,a=new $r(i.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||es(Jr(a),n)<=0||(r.has(a.key)||Wi(t,a))&&(s=s.insert(a.key,a.mutableCopy()))}return ss.resolve(s)}getAllFromCollectionGroup(e,t,n,r){Tr()}bs(e,t){return ss.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Dc(this)}getSize(e){return ss.resolve(this.size)}}class Dc extends hc{constructor(e){super(),this.Xn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Xn.addEntry(n,t)):this.Xn.removeEntry(e)}),ss.waitFor(r)}getFromCache(e,t){return this.Xn.getEntry(e,t)}getAllFromCache(e,t){return this.Xn.getEntries(e,t)}}class Ac{constructor(e){this.persistence=e,this.vs=new Na(e=>Ci(e),Ni),this.lastRemoteSnapshotVersion=qr.min(),this.highestTargetId=0,this.Ps=0,this.Vs=new Ec,this.targetCount=0,this.Ss=Zu.Vn()}forEachTarget(e,n){return this.vs.forEach((e,t)=>n(t)),ss.resolve()}getLastRemoteSnapshotVersion(e){return ss.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ss.resolve(this.Ps)}allocateTargetId(e){return this.highestTargetId=this.Ss.next(),ss.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ps&&(this.Ps=t),ss.resolve()}xn(e){this.vs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Ss=new Zu(t),this.highestTargetId=t),e.sequenceNumber>this.Ps&&(this.Ps=e.sequenceNumber)}addTargetData(e,t){return this.xn(t),this.targetCount+=1,ss.resolve()}updateTargetData(e,t){return this.xn(t),ss.resolve()}removeTargetData(e,t){return this.vs.delete(t.target),this.Vs.ds(t.targetId),--this.targetCount,ss.resolve()}removeTargets(n,r,s){let i=0;const a=[];return this.vs.forEach((e,t)=>{t.sequenceNumber<=r&&null===s.get(t.targetId)&&(this.vs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),i++)}),ss.waitFor(a).next(()=>i)}getTargetCount(e){return ss.resolve(this.targetCount)}getTargetData(e,t){var n=this.vs.get(t)||null;return ss.resolve(n)}addMatchingKeys(e,t,n){return this.Vs.hs(t,n),ss.resolve()}removeMatchingKeys(t,e,n){this.Vs.fs(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),ss.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Vs.ds(t),ss.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Vs.ws(t);return ss.resolve(n)}containsKey(e,t){return ss.resolve(this.Vs.containsKey(t))}}class Cc{constructor(e,t){this.Ds={},this.overlays={},this.Cs=new ps(0),this.xs=!1,this.xs=!0,this.referenceDelegate=e(this),this.Ns=new Ac(this),this.indexManager=new Ou,this.remoteDocumentCache=(e=e=>this.referenceDelegate.ks(e),new xc(e)),this.Tt=new tu(t),this.Os=new bc(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Tc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ds[e.toKey()];return n||(n=new Sc(t,this.referenceDelegate),this.Ds[e.toKey()]=n),n}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Os}runTransaction(e,t,n){vr("MemoryPersistence","Starting transaction:",e);const r=new Nc(this.Cs.next());return this.referenceDelegate.Ms(),n(r).next(e=>this.referenceDelegate.Fs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}$s(t,n){return ss.or(Object.values(this.Ds).map(e=>()=>e.containsKey(t,n)))}}class Nc extends ns{constructor(e){super(),this.currentSequenceNumber=e}}class kc{constructor(e){this.persistence=e,this.Bs=new Ec,this.Ls=null}static qs(e){return new kc(e)}get Us(){if(this.Ls)return this.Ls;throw Tr()}addReference(e,t,n){return this.Bs.addReference(n,t),this.Us.delete(n.toString()),ss.resolve()}removeReference(e,t,n){return this.Bs.removeReference(n,t),this.Us.add(n.toString()),ss.resolve()}markPotentiallyOrphaned(e,t){return this.Us.add(t.toString()),ss.resolve()}removeTarget(e,t){this.Bs.ds(t.targetId).forEach(e=>this.Us.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Us.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ms(){this.Ls=new Set}Fs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ss.forEach(this.Us,e=>{const t=$r.fromPath(e);return this.Ks(n,t).next(e=>{e||r.removeEntry(t,qr.min())})}).next(()=>(this.Ls=null,r.apply(n)))}updateLimboDocument(e,t){return this.Ks(e,t).next(e=>{e?this.Us.delete(t.toString()):this.Us.add(t.toString())})}ks(e){return 0}Ks(e,t){return ss.or([()=>ss.resolve(this.Bs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.$s(e,t)])}}class Rc{constructor(e){this.Tt=e}$(t,e,n,r){const s=new is("createOrUpgrade",e);var i;n<1&&1<=r&&(t.createObjectStore("owner"),(i=t).createObjectStore("mutationQueues",{keyPath:"userId"}),i.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xo,{unique:!0}),i.createObjectStore("documentMutations"),Mc(t),t.createObjectStore("remoteDocuments"));let a=ss.resolve();return n<3&&3<=r&&(0!==n&&((i=t).deleteObjectStore("targetDocuments"),i.deleteObjectStore("targets"),i.deleteObjectStore("targetGlobal"),Mc(t)),a=a.next(()=>function(){const e=s.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:qr.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,s){return s.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",xo,{unique:!0});const t=s.store("mutations"),n=e.map(e=>t.put(e));return ss.waitFor(n)})}(t,s))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Gs(s))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Qs(s)))),n<7&&7<=r&&(a=a.next(()=>this.js(s))),n<8&&8<=r&&(a=a.next(()=>this.zs(t,s))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.Ws(s))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:Uo});e.createIndex("collectionPathOverlayIndex",Ko,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",Go,{unique:!1})}()})),n<13&&13<=r&&(a=a.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:No});e.createIndex("documentKeyIndex",ko),e.createIndex("collectionGroupIndex",Ro)}()).next(()=>this.Hs(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.Js(t,s))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Vo}).createIndex("sequenceNumberIndex",Po,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Bo}).createIndex("documentKeyIndex",qo,{unique:!1})}(t))),a}Qs(t){let n=0;return t.store("remoteDocuments").X((e,t)=>{n+=zu(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Gs(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.W().next(e=>ss.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.W("userMutationsIndex",e).next(e=>ss.forEach(e,e=>{Er(e.userId===n.userId);var t=au(this.Tt,e);return Qu(r,n.userId,t).next(()=>{})}))}))}js(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return t.X((e,t)=>{const n=new Kr(e),r=[0,Eo(n)];i.push(a.get(r).next(e=>e?ss.resolve():(e=>a.put({targetId:0,path:Eo(e),sequenceNumber:s.highestListenSequenceNumber}))(n)))}).next(()=>ss.waitFor(i))})}zs(e,t){e.createObjectStore("collectionParents",{keyPath:Fo});const n=t.store("collectionParents"),r=new Fu,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Eo(r)})}};return t.store("remoteDocuments").X({Z:!0},(e,t)=>{const n=new Kr(e);return s(n.popLast())}).next(()=>t.store("documentMutations").X({Z:!0},([,e],t)=>{const n=So(e);return s(n.popLast())}))}Ws(e){const r=e.store("targets");return r.X((e,t)=>{var n=ou(t),n=uu(this.Tt,n);return r.put(n)})}Hs(e,i){const t=i.store("remoteDocuments"),a=[];return t.X((e,t)=>{const n=i.store("remoteDocumentsV14"),r=((s=t).document?new $r(Kr.fromString(s.document.name).popFirst(5)):s.noDocument?$r.fromSegments(s.noDocument.path):s.unknownDocument?$r.fromSegments(s.unknownDocument.path):Tr()).path.toArray();var s={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(s))}).next(()=>ss.waitFor(a))}Js(e,i){const t=i.store("mutations"),a=dc(this.Tt),o=new Cc(kc.qs,this.Tt.oe);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:Pa();au(this.Tt,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),ss.forEach(r,(e,t)=>{var n=new gr(t),r=pu.ue(this.Tt,n),s=o.getIndexManager(n),n=Hu.ue(n,this.Tt,s,o.referenceDelegate);return new Ic(a,n,r,s).recalculateAndSaveOverlaysForDocumentKeys(new Wo(i,ps.at),e).next()})})}}function Mc(e){e.createObjectStore("targetDocuments",{keyPath:Lo}).createIndex("documentTargetsIndex",Oo,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Mo,{unique:!0}),e.createObjectStore("targetGlobal")}const Lc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Oc{constructor(e,t,n,r,s,i,a,o,u,c,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ys=s,this.window=i,this.document=a,this.Zs=u,this.Xs=c,this.ti=h,this.Cs=null,this.xs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ei=null,this.inForeground=!1,this.ni=null,this.si=null,this.ii=Number.NEGATIVE_INFINITY,this.ri=e=>Promise.resolve(),!Oc.C())throw new Sr(_r.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uc(this,r),this.oi=t+"main",this.Tt=new tu(o),this.ui=new as(this.oi,this.ti,new Rc(this.Tt)),this.Ns=new ec(this.referenceDelegate,this.Tt),this.remoteDocumentCache=dc(this.Tt),this.Os=new fu,this.window&&this.window.localStorage?this.ci=this.window.localStorage:(this.ci=null,!1===c&&wr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Sr(_r.FAILED_PRECONDITION,Lc);return this.hi(),this.li(),this.fi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ns.getHighestSequenceNumber(e))}).then(e=>{this.Cs=new ps(e,this.Zs)}).then(()=>{this.xs=!0}).catch(e=>(this.ui&&this.ui.close(),Promise.reject(e)))}di(t){return this.ri=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ui.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ys.enqueueAndForget(async()=>{this.started&&await this.ai()}))}ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Vc(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this._i(t).next(e=>{e||(this.isPrimary=!1,this.Ys.enqueueRetryable(()=>this.ri(!1)))})}).next(()=>this.wi(t)).next(e=>this.isPrimary&&!e?this.mi(t).next(()=>!1):!!e&&this.gi(t).next(()=>!0))).catch(e=>{if(cs(e))return vr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ys.enqueueRetryable(()=>this.ri(e)),this.isPrimary=e})}_i(e){return Fc(e).get("owner").next(e=>ss.resolve(this.yi(e)))}pi(e){return Vc(e).delete(this.clientId)}async Ii(){if(this.isPrimary&&!this.Ti(this.ii,18e5)){this.ii=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=Xo(e,"clientMetadata");return r.W().next(e=>{const t=this.Ei(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return ss.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.ci)for(const t of e)this.ci.removeItem(this.Ai(t.clientId))}}fi(){this.si=this.Ys.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ai().then(()=>this.Ii()).then(()=>this.fi()))}yi(e){return!!e&&e.ownerId===this.clientId}wi(t){return this.Xs?ss.resolve(!0):Fc(t).get("owner").next(e=>{if(null!==e&&this.Ti(e.leaseTimestampMs,5e3)&&!this.Ri(e.ownerId)){if(this.yi(e)&&this.networkEnabled)return!0;if(!this.yi(e)){if(!e.allowTabSynchronization)throw new Sr(_r.FAILED_PRECONDITION,Lc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vc(t).W().next(e=>void 0===this.Ei(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&vr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.xs=!1,this.bi(),this.si&&(this.si.cancel(),this.si=null),this.vi(),this.Pi(),await this.ui.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Wo(e,ps.at);return this.mi(t).next(()=>this.pi(t))}),this.ui.close(),this.Vi()}Ei(e,t){return e.filter(e=>this.Ti(e.updateTimeMs,t)&&!this.Ri(e.clientId))}Si(){return this.runTransaction("getActiveClients","readonly",e=>Vc(e).W().next(e=>this.Ei(e,18e5).map(e=>e.clientId)))}get started(){return this.xs}getMutationQueue(e,t){return Hu.ue(e,this.Tt,t,this.referenceDelegate)}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Pu(e,this.Tt.oe.databaseId)}getDocumentOverlayCache(e){return pu.ue(this.Tt,e)}getBundleCache(){return this.Os}runTransaction(t,n,r){vr("IndexedDbPersistence","Starting transaction:",t);var e,s="readonly"===n?"readonly":"readwrite",e=15===(e=this.ti)?Ho:14===e?zo:13===e?Qo:12===e?$o:11===e?jo:void Tr();let i;return this.ui.runTransaction(t,s,e,e=>(i=new Wo(e,this.Cs?this.Cs.next():ps.at),"readwrite-primary"===n?this._i(i).next(e=>!!e||this.wi(i)).next(e=>{if(!e)throw wr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ys.enqueueRetryable(()=>this.ri(!1)),new Sr(_r.FAILED_PRECONDITION,ts);return r(i)}).next(e=>this.gi(i).next(()=>e)):this.Di(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Di(e){return Fc(e).get("owner").next(e=>{if(null!==e&&this.Ti(e.leaseTimestampMs,5e3)&&!this.Ri(e.ownerId)&&!this.yi(e)&&!(this.Xs||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Sr(_r.FAILED_PRECONDITION,Lc)})}gi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Fc(e).put("owner",t)}static C(){return as.C()}mi(e){const t=Fc(e);return t.get("owner").next(e=>this.yi(e)?(vr("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):ss.resolve())}Ti(e,t){var n=Date.now();return!(e<n-t||n<e&&(wr(`Detected an update time that is in the future: ${e} > ${n}`),1))}hi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ni=()=>{this.Ys.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ai()))},this.document.addEventListener("visibilitychange",this.ni),this.inForeground="visible"===this.document.visibilityState)}vi(){this.ni&&(this.document.removeEventListener("visibilitychange",this.ni),this.ni=null)}li(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ei=()=>{this.bi(),h()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Ys.enterRestrictedMode(!0),this.Ys.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ei))}Pi(){this.ei&&(this.window.removeEventListener("pagehide",this.ei),this.ei=null)}Ri(e){var t;try{var n=null!==(null===(t=this.ci)||void 0===t?void 0:t.getItem(this.Ai(e)));return vr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return wr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}bi(){if(this.ci)try{this.ci.setItem(this.Ai(this.clientId),String(Date.now()))}catch(e){wr("Failed to set zombie client id.",e)}}Vi(){if(this.ci)try{this.ci.removeItem(this.Ai(this.clientId))}catch(e){}}Ai(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Fc(e){return Xo(e,"owner")}function Vc(e){return Xo(e,"clientMetadata")}function Pc(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Bc{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ci=n,this.xi=r}static Ni(e,t){let n=Pa(),r=Pa();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Bc(e,t.fromCache,n,r)}}class qc{constructor(){this.ki=!1}initialize(e,t){this.Oi=e,this.indexManager=t,this.ki=!0}getDocumentsMatchingQuery(t,n,r,s){return this.Mi(t,n).next(e=>e||this.Fi(t,n,s,r)).next(e=>e||this.$i(t,n))}Mi(s,i){if(Pi(i))return ss.resolve(null);let t=Gi(i);return this.indexManager.getIndexType(s,t).next(e=>0===e?null:(null!==i.limit&&1===e&&(i=$i(i,null,"F"),t=Gi(i)),this.indexManager.getDocumentsMatchingTarget(s,t).next(e=>{const r=Pa(...e);return this.Oi.getDocuments(s,r).next(n=>this.indexManager.getMinOffset(s,t).next(e=>{var t=this.Bi(i,n);return this.Li(i,t,r,e.readTime)?this.Mi(s,$i(i,null,"F")):this.qi(s,t,i,e)}))})))}Fi(n,r,s,i){return Pi(r)||i.isEqual(qr.min())?this.$i(n,r):this.Oi.getDocuments(n,s).next(e=>{var t=this.Bi(r,e);return this.Li(r,t,s,i)?this.$i(n,r):(yr()<=l.DEBUG&&vr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Hi(r)),this.qi(n,t,r,Yr(i,-1)))})}Bi(n,e){let r=new bi(Yi(n));return e.forEach((e,t)=>{Wi(n,t)&&(r=r.add(t))}),r}Li(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||0<s.version.compareTo(r))}$i(e,t){return yr()<=l.DEBUG&&vr("QueryEngine","Using full collection scan to execute query:",Hi(t)),this.Oi.getDocumentsMatchingQuery(e,t,Zr.min())}qi(e,n,t,r){return this.Oi.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class Uc{constructor(e,t,n,r){this.persistence=e,this.Ui=t,this.Tt=r,this.Ki=new vi(Fr),this.Gi=new Na(e=>Ci(e),Ni),this.Qi=new Map,this.ji=e.getRemoteDocumentCache(),this.Ns=e.getTargetCache(),this.Os=e.getBundleCache(),this.zi(n)}zi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ic(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ki))}}function Kc(e,t,n,r){return new Uc(e,t,n,r)}async function Gc(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",s=>{let i;return a.mutationQueue.getAllMutationBatches(s).next(e=>(i=e,a.zi(t),a.mutationQueue.getAllMutationBatches(s))).next(e=>{const t=[],n=[];let r=Pa();for(const s of i){t.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}for(const s of e){n.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(s,r).next(e=>({Wi:e,removedBatchIds:t,addedBatchIds:n}))})})}function jc(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ns.getLastRemoteSnapshotVersion(e))}function $c(e,c){const h=e,l=c.snapshotVersion;let d=h.Ki;return h.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=h.ji.newChangeBuffer({trackRemovals:!0});d=h.Ki;const u=[];c.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){u.push(h.Ns.removeMatchingKeys(o,t.removedDocuments,n).next(()=>h.Ns.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var s,i,a;c.targetMismatches.has(n)?e=e.withResumeToken(xs.EMPTY_BYTE_STRING,qr.min()).withLastLimboFreeSnapshotVersion(qr.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),d=d.insert(n,e),s=r,i=e,a=t,0!==s.resumeToken.approximateByteSize()&&!(3e8<=i.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||u.push(h.Ns.updateTargetData(o,e))}});let t=ka,n=Pa();if(c.documentUpdates.forEach(e=>{c.resolvedLimboDocuments.has(e)&&u.push(h.persistence.referenceDelegate.updateLimboDocument(o,e))}),u.push(Qc(o,e,c.documentUpdates).next(e=>{t=e.Hi,n=e.Ji})),!l.isEqual(qr.min())){const c=h.Ns.getLastRemoteSnapshotVersion(o).next(e=>h.Ns.setTargetsMetadata(o,o.currentSequenceNumber,l));u.push(c)}return ss.waitFor(u).next(()=>e.apply(o)).next(()=>h.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(h.Ki=d,e))}function Qc(e,i,t){let n=Pa(),a=Pa();return t.forEach(e=>n=n.add(e)),i.getEntries(e,n).next(r=>{let s=ka;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(qr.min())?(i.removeEntry(e,t.readTime),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(i.addEntry(t),s=s.insert(e,t)):vr("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Hi:s,Ji:a}})}function zc(e,r){const s=e;return s.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return s.Ns.getTargetData(t,r).next(e=>e?(n=e,ss.resolve(n)):s.Ns.allocateTargetId(t).next(e=>(n=new eu(r,e,0,t.currentSequenceNumber),s.Ns.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=s.Ki.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(s.Ki=s.Ki.insert(e.targetId,e),s.Gi.set(r,e.targetId)),e})}async function Hc(e,t,n){const r=e,s=r.Ki.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!cs(e))throw e;vr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ki=r.Ki.remove(t),r.Gi.delete(s.target)}function Wc(e,n,r){const s=e;let i=qr.min(),a=Pa();return s.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,s=r.Gi.get(n);return void 0!==s?ss.resolve(r.Ki.get(s)):r.Ns.getTargetData(t,n)}(s,t,Gi(n)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Ns.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>s.Ui.getDocumentsMatchingQuery(t,n,r?i:qr.min(),r?a:Pa())).next(e=>(Jc(s,Xi(n),e),{documents:e,Yi:a})))}function Xc(e,t){const n=e,r=n.Ns,s=n.Ki.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",e=>r.ie(e,t).next(e=>e?e.target:null))}function Yc(e,t){const n=e,r=n.Qi.get(t)||qr.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.ji.getAllFromCollectionGroup(e,t,Yr(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(Jc(n,t,e),e))}function Jc(e,t,n){let r=e.Qi.get(t)||qr.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Qi.set(t,r)}function Zc(e,t){return`firestore_clients_${e}_${t}`}function eh(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function th(e,t){return`firestore_targets_${e}_${t}`}class nh{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static er(e,t,n){var r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new Sr(r.error.code,r.error.message))),i?new nh(e,t,r.state,s):(wr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class rh{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static er(e,t){var n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new Sr(n.error.code,n.error.message))),s?new rh(e,n.state,r):(wr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class sh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static er(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Ba;for(let i=0;r&&i<n.activeTargetIds.length;++i)r=_s(n.activeTargetIds[i]),s=s.add(n.activeTargetIds[i]);return r?new sh(e,s):(wr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class ih{constructor(e,t){this.clientId=e,this.onlineState=t}static er(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ih(t.clientId,t.onlineState):(wr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ah{constructor(){this.activeTargetIds=Ba}sr(e){this.activeTargetIds=this.activeTargetIds.add(e)}ir(e){this.activeTargetIds=this.activeTargetIds.delete(e)}nr(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class oh{constructor(e,t,n,r,s){this.window=e,this.Ys=t,this.persistenceKey=n,this.rr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ur=this.cr.bind(this),this.ar=new vi(Fr),this.started=!1,this.hr=[];var i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.lr=Zc(this.persistenceKey,this.rr),this.dr=`firestore_sequence_number_${this.persistenceKey}`,this.ar=this.ar.insert(this.rr,new ah),this._r=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.wr=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.mr=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.gr=`firestore_online_state_${this.persistenceKey}`,this.yr=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.ur)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Si();for(const n of e)if(n!==this.rr){const e=this.getItem(Zc(this.persistenceKey,n));var t;!e||(t=sh.er(n,e))&&(this.ar=this.ar.insert(t.clientId,t))}this.pr();const n=this.storage.getItem(this.gr);if(n){const e=this.Ir(n);e&&this.Tr(e)}for(const e of this.hr)this.cr(e);this.hr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.dr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Er(this.ar)}isActiveQueryTarget(n){let r=!1;return this.ar.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Ar(e,"pending")}updateMutationState(e,t,n){this.Ar(e,t,n),this.Rr(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(th(this.persistenceKey,e)))||(n=rh.er(e,n))&&(t=n.state)),this.br.sr(e),this.pr(),t}removeLocalQueryTarget(e){this.br.ir(e),this.pr()}isLocalQueryTarget(e){return this.br.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(th(this.persistenceKey,e))}updateQueryState(e,t,n){this.vr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Rr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Pr(e)}notifyBundleLoaded(e){this.Vr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ur),this.removeItem(this.lr),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return vr("SharedClientState","READ",e,t),t}setItem(e,t){vr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){vr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}cr(e){const s=e;s.storageArea===this.storage&&(vr("SharedClientState","EVENT",s.key,s.newValue),s.key!==this.lr?this.Ys.enqueueRetryable(async()=>{if(this.started){if(null!==s.key)if(this._r.test(s.key)){if(null==s.newValue){var e=this.Sr(s.key);return this.Dr(e,null)}e=this.Cr(s.key,s.newValue);if(e)return this.Dr(e.clientId,e)}else if(this.wr.test(s.key)){if(null!==s.newValue){var t=this.Nr(s.key,s.newValue);if(t)return this.kr(t)}}else if(this.mr.test(s.key)){if(null!==s.newValue){t=this.Or(s.key,s.newValue);if(t)return this.Mr(t)}}else if(s.key===this.gr){if(null!==s.newValue){var n=this.Ir(s.newValue);if(n)return this.Tr(n)}}else if(s.key===this.dr){n=function(e){let t=ps.at;if(null!=e)try{var n=JSON.parse(e);Er("number"==typeof n),t=n}catch(e){wr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(s.newValue);n!==ps.at&&this.sequenceNumberHandler(n)}else if(s.key===this.yr){const r=this.Fr(s.newValue);await Promise.all(r.map(e=>this.syncEngine.$r(e)))}}else this.hr.push(s)}):wr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get br(){return this.ar.get(this.rr)}pr(){this.setItem(this.lr,this.br.nr())}Ar(e,t,n){const r=new nh(this.currentUser,e,t,n),s=eh(this.persistenceKey,this.currentUser,e);this.setItem(s,r.nr())}Rr(e){var t=eh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Pr(e){var t={clientId:this.rr,onlineState:e};this.storage.setItem(this.gr,JSON.stringify(t))}vr(e,t,n){const r=th(this.persistenceKey,e),s=new rh(e,t,n);this.setItem(r,s.nr())}Vr(e){var t=JSON.stringify(Array.from(e));this.setItem(this.yr,t)}Sr(e){var t=this._r.exec(e);return t?t[1]:null}Cr(e,t){var n=this.Sr(e);return sh.er(n,t)}Nr(e,t){var n=this.wr.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return nh.er(new gr(n),r,t)}Or(e,t){var n=this.mr.exec(e),n=Number(n[1]);return rh.er(n,t)}Ir(e){return ih.er(e)}Fr(e){return JSON.parse(e)}async kr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Br(e.batchId,e.state,e.error);vr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Mr(e){return this.syncEngine.Lr(e.targetId,e.state,e.error)}Dr(e,t){const n=t?this.ar.insert(e,t):this.ar.remove(e),r=this.Er(this.ar),s=this.Er(n),i=[],a=[];return s.forEach(e=>{r.has(e)||i.push(e)}),r.forEach(e=>{s.has(e)||a.push(e)}),this.syncEngine.qr(i,a).then(()=>{this.ar=n})}Tr(e){this.ar.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Er(e){let n=Ba;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class uh{constructor(){this.Ur=new ah,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Ur.sr(e),this.Kr[e]||"not-current"}updateQueryState(e,t,n){this.Kr[e]=t}removeLocalQueryTarget(e){this.Ur.ir(e)}isLocalQueryTarget(e){return this.Ur.activeTargetIds.has(e)}clearQueryState(e){delete this.Kr[e]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(e){return this.Ur.activeTargetIds.has(e)}start(){return this.Ur=new ah,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ch{Gr(e){}shutdown(){}}class hh{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(e){this.Hr.push(e)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Hr)e(0)}Wr(){vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Hr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const lh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class dh{constructor(e){this.Yr=e.Yr,this.Zr=e.Zr}Xr(e){this.eo=e}no(e){this.so=e}onMessage(e){this.io=e}close(){this.Zr()}send(e){this.Yr(e)}ro(){this.eo()}oo(e){this.so(e)}uo(e){this.io(e)}}class fh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.co=t+"://"+e.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(t,e,n,r,s){const i=this.fo(t,e);vr("RestConnection","Sending: ",i,n);var a={};return this._o(a,r,s),this.wo(t,i,a,n).then(e=>(vr("RestConnection","Received: ",e),e),e=>{throw Ir("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}mo(e,t,n,r,s,i){return this.lo(e,t,n,r,s)}_o(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+mr,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}fo(e,t){var n=lh[e];return`${this.co}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}wo(o,t,n,r){return new Promise((s,i)=>{const a=new dr;a.setWithCredentials(!0),a.listenOnce(ar.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case ir.NO_ERROR:var e=a.getResponseJson();vr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case ir.TIMEOUT:vr("Connection",'RPC "'+o+'" timed out'),i(new Sr(_r.DEADLINE_EXCEEDED,"Request time out"));break;case ir.HTTP_ERROR:var t=a.getStatus();if(vr("Connection",'RPC "'+o+'" failed with status:',t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);var n=null==e?void 0:e.error;if(n&&n.status&&n.message){const o=(r=n.status.toLowerCase().replace(/_/g,"-"),0<=Object.values(_r).indexOf(r)?r:_r.UNKNOWN);i(new Sr(o,n.message))}else i(new Sr(_r.UNKNOWN,"Server responded with status "+a.getStatus()))}else i(new Sr(_r.UNAVAILABLE,"Connection failed."));break;default:Tr()}}finally{vr("Connection",'RPC "'+o+'" completed.')}var r});var e=JSON.stringify(r);a.send(t,"POST",e,n,15)})}yo(e,t,n){const r=[this.co,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new Jn,i=sr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new hr({})),this._o(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;var o=r.join("");vr("Connection","Creating WebChannel: "+o,a);const u=s.createWebChannel(o,a);let c=!1,h=!1;const l=new dh({Yr:e=>{h?vr("Connection","Not sending because WebChannel is closed:",e):(c||(vr("Connection","Opening WebChannel transport."),u.open(),c=!0),vr("Connection","WebChannel sending:",e),u.send(e))},Zr:()=>u.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(u,lr.EventType.OPEN,()=>{h||vr("Connection","WebChannel transport opened.")}),d(u,lr.EventType.CLOSE,()=>{h||(h=!0,vr("Connection","WebChannel transport closed"),l.oo())}),d(u,lr.EventType.ERROR,e=>{h||(h=!0,Ir("Connection","WebChannel transport errored:",e),l.oo(new Sr(_r.UNAVAILABLE,"The operation could not be completed")))}),d(u,lr.EventType.MESSAGE,n=>{if(!h){var e=n.data[0];Er(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){vr("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){var t=rr[e];if(void 0!==t)return Ca(t)}(n),t=r.message;void 0===e&&(e=_r.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),h=!0,l.oo(new Sr(e,t)),u.close()}else vr("Connection","WebChannel received:",e),l.uo(e)}}),d(i,or.STAT_EVENT,e=>{e.stat===ur?vr("Connection","Detected buffering proxy"):e.stat===cr&&vr("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.ro()},0),l}}function gh(){return"undefined"!=typeof window?window:null}function mh(){return"undefined"!=typeof document?document:null}function ph(e){return new Ja(e,!0)}class yh{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Ys=e,this.timerId=t,this.po=n,this.Io=r,this.To=s,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}bo(){this.Eo=this.To}vo(e){this.cancel();var t=Math.floor(this.Eo+this.Po()),n=Math.max(0,Date.now()-this.Ro),r=Math.max(0,t-n);0<r&&vr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Eo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,r,()=>(this.Ro=Date.now(),e())),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}Po(){return(Math.random()-.5)*this.Eo}}class vh{constructor(e,t,n,r,s,i,a,o){this.Ys=e,this.So=n,this.Do=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new yh(e,t)}Oo(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Fo()}async stop(){this.Oo()&&await this.close(0)}$o(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&null===this.xo&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,()=>this.Lo()))}qo(e){this.Uo(),this.stream.send(e)}async Lo(){if(this.Mo())return this.close(0)}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}async close(e,t){this.Uo(),this.Ko(),this.ko.cancel(),this.Co++,4!==e?this.ko.reset():t&&t.code===_r.RESOURCE_EXHAUSTED?(wr(t.toString()),wr("Using maximum backoff delay to prevent overloading the backend."),this.ko.bo()):t&&t.code===_r.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Go(),this.stream.close(),this.stream=null),this.state=e,await this.listener.no(t)}Go(){}auth(){this.state=1;const e=this.Qo(this.Co),n=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.Co===n&&this.jo(e,t)},t=>{e(()=>{var e=new Sr(_r.UNKNOWN,"Fetching auth token failed: "+t.message);return this.zo(e)})})}jo(e,t){const n=this.Qo(this.Co);this.stream=this.Wo(e,t),this.stream.Xr(()=>{n(()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,()=>(this.Mo()&&(this.state=3),Promise.resolve())),this.listener.Xr()))}),this.stream.no(e=>{n(()=>this.zo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Fo(){this.state=5,this.ko.vo(async()=>{this.state=0,this.start()})}zo(e){return vr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Qo(t){return e=>{this.Ys.enqueueAndForget(()=>this.Co===t?e():(vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class wh extends vh{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.Tt=s}Wo(e,t){return this.connection.yo("Listen",e,t)}onMessage(e){this.ko.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:Tr(),s=t.targetChange.targetIds||[],i=(f=t.targetChange.resumeToken,e.yt?(Er(void 0===f||"string"==typeof f),xs.fromBase64String(f||"")):(Er(void 0===f||f instanceof Uint8Array),xs.fromUint8Array(f||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(f=a).code?_r.UNKNOWN:Ca(f.code),new Sr(o,f.message||""));n=new ja(r,s,i,o||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var i=io(e,u.document.name),o=to(u.document.updateTime),c=u.document.createTime?to(u.document.createTime):qr.min(),h=new Si({mapValue:{fields:u.document.fields}}),c=xi.newFoundDocument(i,o,c,h),h=u.targetIds||[],u=u.removedTargetIds||[];n=new Ka(h,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;h=t.documentDelete;h.document;u=io(e,h.document),c=h.readTime?to(h.readTime):qr.min(),c=xi.newNoDocument(u,c),h=h.removedTargetIds||[];n=new Ka([],h,c.key,c)}else if("documentRemove"in t){t.documentRemove;var l=t.documentRemove;l.document;var d=io(e,l.document),l=l.removedTargetIds||[];n=new Ka([],l,d,null)}else{if(!("filter"in t))return Tr();{t.filter;const e=t.filter;e.targetId;l=e.count||0,d=new Da(l),l=e.targetId;n=new Ga(l,d)}}var o,f;return n}(this.Tt,e),n=function(e){if(!("targetChange"in e))return qr.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?to(t.readTime):qr.min()}(e);return this.listener.Ho(t,n)}Jo(e){const t={};t.database=uo(this.Tt),t.addTarget=function(e,t){let n;var r=t.target;return n=ki(r)?{documents:mo(e,r)}:{query:po(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=eo(e,t.resumeToken):0<t.snapshotVersion.compareTo(qr.min())&&(n.readTime=Za(e,t.snapshotVersion.toTimestamp())),n}(this.Tt,e);var n,r,r=(this.Tt,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Tr()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.qo(t)}Yo(e){const t={};t.database=uo(this.Tt),t.removeTarget=e,this.qo(t)}}class Ih extends vh{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.Tt=s,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(e,t){return this.connection.yo("Write",e,t)}onMessage(e){if(Er(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Zo){this.ko.reset();var t=(r=e.writeResults,s=e.commitTime,r&&0<r.length?(Er(void 0!==s),r.map(e=>function(e,t){let n=e.updateTime?to(e.updateTime):to(t);return n.isEqual(qr.min())&&(n=to(t)),new da(n,e.transformResults||[])}(e,s))):[]),n=to(e.commitTime);return this.listener.eu(n,t)}var r,s;return Er(!e.writeResults||0===e.writeResults.length),this.Zo=!0,this.listener.nu()}su(){const e={};e.database=uo(this.Tt),this.qo(e)}tu(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>fo(this.Tt,e))};this.qo(t)}}class bh extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.Tt=r,this.iu=!1}ru(){if(this.iu)throw new Sr(_r.FAILED_PRECONDITION,"The client has already been terminated.")}lo(n,r,s){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.lo(n,r,s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===_r.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Sr(_r.UNKNOWN,e.toString())})}mo(n,r,s,i){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.mo(n,r,s,e,t,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===_r.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Sr(_r.UNKNOWN,e.toString())})}terminate(){this.iu=!0}}class Th{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){0===this.ou&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve())))}fu(e){"Online"===this.state?this.hu("Unknown"):(this.ou++,1<=this.ou&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.hu("Offline")))}set(e){this.du(),this.ou=0,"Online"===e&&(this.cu=!1),this.hu(e)}hu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}lu(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(wr(t),this.cu=!1):vr("OnlineStateTracker",t)}du(){null!==this.uu&&(this.uu.cancel(),this.uu=null)}}class Eh{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=s,this.yu.Gr(e=>{n.enqueueAndForget(async()=>{Rh(this)&&(vr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.mu.add(4),await Sh(t),t.pu.set("Unknown"),t.mu.delete(4),await _h(t)}(this))})}),this.pu=new Th(n,r)}}async function _h(e){if(Rh(e))for(const t of e.gu)await t(!0)}async function Sh(e){for(const t of e.gu)await t(!1)}function xh(e,t){const n=e;n.wu.has(t.targetId)||(n.wu.set(t.targetId,t),kh(n)?Nh(n):Uh(n).Mo()&&Ah(n,t))}function Dh(e,t){const n=e,r=Uh(n);n.wu.delete(t),r.Mo()&&Ch(n,t),0===n.wu.size&&(r.Mo()?r.Bo():Rh(n)&&n.pu.set("Unknown"))}function Ah(e,t){e.Iu.Ft(t.targetId),Uh(e).Jo(t)}function Ch(e,t){e.Iu.Ft(t),Uh(e).Yo(t)}function Nh(t){t.Iu=new Qa({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ie:e=>t.wu.get(e)||null}),Uh(t).start(),t.pu.au()}function kh(e){return Rh(e)&&!Uh(e).Oo()&&0<e.wu.size}function Rh(e){return 0===e.mu.size}function Mh(e){e.Iu=void 0}async function Lh(e,t,n){if(!cs(t))throw t;e.mu.add(1),await Sh(e),e.pu.set("Offline"),n=n||(()=>jc(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{vr("RemoteStore","Retrying IndexedDB access"),await n(),e.mu.delete(1),await _h(e)})}function Oh(t,n){return n().catch(e=>Lh(t,e,n))}async function Fh(e){const t=e,n=Kh(t);let r=0<t._u.length?t._u[t._u.length-1].batchId:-1;for(;Rh(s=t)&&s._u.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t._u.length&&n.Bo();break}r=e.batchId,function(e,t){e._u.push(t);const n=Kh(e);n.Mo()&&n.Xo&&n.tu(t.mutations)}(t,e)}catch(e){await Lh(t,e)}var s;Vh(t)&&Ph(t)}function Vh(e){return Rh(e)&&!Kh(e).Oo()&&0<e._u.length}function Ph(e){Kh(e).start()}async function Bh(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),vr("RemoteStore","RemoteStore received new credentials");var r=Rh(n);n.mu.add(3),await Sh(n),r&&n.pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.mu.delete(3),await _h(n)}async function qh(e,t){const n=e;t?(n.mu.delete(2),await _h(n)):(n.mu.add(2),await Sh(n),n.pu.set("Unknown"))}function Uh(t){return t.Tu||(t.Tu=function(e,t,n){const r=e;return r.ru(),new wh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,n)}(t.datastore,t.asyncQueue,{Xr:(async function(n){n.wu.forEach((e,t)=>{Ah(n,e)})}).bind(null,t),no:(async function(e,t){Mh(e),kh(e)?(e.pu.fu(t),Nh(e)):e.pu.set("Unknown")}).bind(null,t),Ho:(async function(e,r,t){if(e.pu.set("Online"),r instanceof ja&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.wu.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.wu.delete(n),e.Iu.removeTarget(n))}(e)}catch(t){vr("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await Lh(e,t)}else if(r instanceof Ka?e.Iu.Qt(r):r instanceof Ga?e.Iu.Zt(r):e.Iu.Wt(r),!t.isEqual(qr.min()))try{const r=await jc(e.localStore);0<=t.compareTo(r)&&await function(r,s){const e=r.Iu.ee(s);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.wu.get(t);n&&r.wu.set(t,n.withResumeToken(e.resumeToken,s))}}),e.targetMismatches.forEach(e=>{const t=r.wu.get(e);var n;t&&(r.wu.set(e,t.withResumeToken(xs.EMPTY_BYTE_STRING,t.snapshotVersion)),Ch(r,e),n=new eu(t.target,e,1,t.sequenceNumber),Ah(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){vr("RemoteStore","Failed to raise snapshot:",r),await Lh(e,r)}}).bind(null,t)}),t.gu.push(async e=>{e?(t.Tu.$o(),kh(t)?Nh(t):t.pu.set("Unknown")):(await t.Tu.stop(),Mh(t))})),t.Tu}function Kh(t){return t.Eu||(t.Eu=function(e,t,n){const r=e;return r.ru(),new Ih(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,n)}(t.datastore,t.asyncQueue,{Xr:(async function(e){Kh(e).su()}).bind(null,t),no:(async function(e,t){t&&Kh(e).Xo&&await async function(e,t){if(Aa(n=t.code)&&n!==_r.ABORTED){const n=e._u.shift();Kh(e).$o(),await Oh(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Fh(e)}var n}(e,t),Vh(e)&&Ph(e)}).bind(null,t),nu:(async function(e){const t=Kh(e);for(const n of e._u)t.tu(n.mutations)}).bind(null,t),eu:(async function(e,t,n){const r=e._u.shift(),s=Jo.from(r,t,n);await Oh(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await Fh(e)}).bind(null,t)}),t.gu.push(async e=>{e?(t.Eu.$o(),await Fh(t)):(await t.Eu.stop(),0<t._u.length&&(vr("RemoteStore",`Stopping write stream with ${t._u.length} pending writes`),t._u=[]))})),t.Eu}class Gh{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new xr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,a=new Gh(e,t,i,r,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Sr(_r.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function jh(e,t){if(wr("AsyncQueue",`${t}: ${e}`),cs(e))return new Sr(_r.UNAVAILABLE,`${t}: ${e}`);throw e}class $h{constructor(n){this.comparator=n?(e,t)=>n(e,t)||$r.comparator(e.key,t.key):(e,t)=>$r.comparator(e.key,t.key),this.keyedMap=Ma(),this.sortedSet=new vi(this.comparator)}static emptySet(e){return new $h(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof $h))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new $h;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Qh{constructor(){this.Au=new vi($r.comparator)}track(e){var t=e.doc.key,n=this.Au.get(t);!n||0!==e.type&&3===n.type?this.Au=this.Au.insert(t,e):3===e.type&&1!==n.type?this.Au=this.Au.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Au=this.Au.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Au=this.Au.remove(t):1===e.type&&2===n.type?this.Au=this.Au.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):Tr()}Ru(){const n=[];return this.Au.inorderTraversal((e,t)=>{n.push(t)}),n}}class zh{constructor(e,t,n,r,s,i,a,o,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new zh(e,t,$h.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Hh{constructor(){this.bu=void 0,this.listeners=[]}}class Wh{constructor(){this.queries=new Na(e=>zi(e),Qi),this.onlineState="Unknown",this.vu=new Set}}async function Xh(e,t){const n=e,r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Hh),s)try{i.bu=await n.onListen(r)}catch(e){const n=jh(e,`Initialization of query '${Hi(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.Pu(n.onlineState),!i.bu||t.Vu(i.bu)&&Jh(n)}async function Yh(e,t){const n=e,r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);0<=e&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Jh(e){e.vu.forEach(e=>{e.next()})}class Zh{constructor(e,t,n){this.query=e,this.Su=t,this.Du=!1,this.Cu=null,this.onlineState="Unknown",this.options=n||{}}Vu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new zh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Du?this.xu(e)&&(this.Su.next(e),t=!0):this.Nu(e,this.onlineState)&&(this.ku(e),t=!0),this.Cu=e,t}onError(e){this.Su.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Cu&&!this.Du&&this.Nu(this.Cu,e)&&(this.ku(this.Cu),t=!0),t}Nu(e,t){return!e.fromCache||(!this.options.Ou||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}xu(e){if(0<e.docChanges.length)return!0;var t=this.Cu&&this.Cu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ku(e){e=zh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Du=!0,this.Su.next(e)}}class el{constructor(e,t){this.Mu=e,this.byteLength=t}Fu(){return"metadata"in this.Mu}}class tl{constructor(e){this.Tt=e}Zi(e){return io(this.Tt,e)}Xi(e){return e.metadata.exists?lo(this.Tt,e.document,!1):xi.newNoDocument(this.Zi(e.metadata.name),this.tr(e.metadata.readTime))}tr(e){return to(e)}}class nl{constructor(e,t,n){this.$u=e,this.localStore=t,this.Tt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=rl(e)}Bu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Mu.namedQuery)this.queries.push(e.Mu.namedQuery);else if(e.Mu.documentMetadata){this.documents.push({metadata:e.Mu.documentMetadata}),e.Mu.documentMetadata.exists||++t;const n=Kr.fromString(e.Mu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Mu.document&&(this.documents[this.documents.length-1].document=e.Mu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Lu(e){const t=new Map,n=new tl(this.Tt);for(const s of e)if(s.metadata.queries){const e=n.Zi(s.metadata.name);for(const n of s.metadata.queries){var r=(t.get(n)||Pa()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=e;let i=Pa(),a=ka;for(const e of n){const n=t.Zi(e.metadata.name);e.document&&(i=i.add(n));const c=t.Xi(e);c.setReadTime(t.tr(e.metadata.readTime)),a=a.insert(n,c)}const o=s.ji.newChangeBuffer({trackRemovals:!0}),u=await zc(s,(r=r,Gi(Vi(Kr.fromString(`__bundle__/docs/${r}`)))));return s.persistence.runTransaction("Apply bundle documents","readwrite",t=>Qc(t,o,a).next(e=>(o.apply(t),e)).next(e=>s.Ns.removeMatchingKeysForTargetId(t,u.targetId).next(()=>s.Ns.addMatchingKeys(t,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(t,e.Hi,e.Ji)).next(()=>e.Hi)))}(this.localStore,new tl(this.Tt),this.documents,this.$u.id),t=this.Lu(this.documents);for(const e of this.queries)await async function(e,n,r=Pa()){const s=await zc(e,Gi(cu(n.bundledQuery))),i=e;return i.persistence.runTransaction("Save named query","readwrite",e=>{var t=to(n.readTime);if(0<=s.snapshotVersion.compareTo(t))return i.Os.saveNamedQuery(e,n);t=s.withResumeToken(xs.EMPTY_BYTE_STRING,t);return i.Ki=i.Ki.insert(t.targetId,t),i.Ns.updateTargetData(e,t).next(()=>i.Ns.removeMatchingKeysForTargetId(e,s.targetId)).next(()=>i.Ns.addMatchingKeys(e,r,s.targetId)).next(()=>i.Os.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,qu:this.collectionGroups,Uu:e}}}function rl(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class sl{constructor(e){this.key=e}}class il{constructor(e){this.key=e}}class al{constructor(e,t){this.query=e,this.Ku=t,this.Gu=null,this.hasCachedResults=!1,this.current=!1,this.Qu=Pa(),this.mutatedKeys=Pa(),this.ju=Yi(e),this.zu=new $h(this.ju)}get Wu(){return this.Ku}Hu(e,t){const o=t?t.Ju:new Qh,u=(t||this).zu;let c=(t||this).mutatedKeys,h=u,l=!1;const d="F"===this.query.limitType&&u.size===this.query.limit?u.last():null,f="L"===this.query.limitType&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((e,t)=>{const n=u.get(e),r=Wi(this.query,t)?t:null,s=!!n&&this.mutatedKeys.has(n.key),i=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?s!==i&&(o.track({type:3,doc:r}),a=!0):this.Yu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.ju(r,d)||f&&this.ju(r,f)<0)&&(l=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||f)&&(l=!0)),a&&(c=r?(h=h.add(r),i?c.add(e):c.delete(e)):(h=h.delete(e),c.delete(e)))}),null!==this.query.limit)for(;h.size>this.query.limit;){const e="F"===this.query.limitType?h.last():h.first();h=h.delete(e.key),c=c.delete(e.key),o.track({type:1,doc:e})}return{zu:h,Ju:o,Li:l,mutatedKeys:c}}Yu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.zu;this.zu=e.zu,this.mutatedKeys=e.mutatedKeys;const s=e.Ju.Ru();s.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Tr()}};return n(e)-n(t)}(e.type,t.type)||this.ju(e.doc,t.doc)),this.Zu(n);var i=t?this.Xu():[],a=0===this.Qu.size&&this.current?1:0,o=a!==this.Gu;return this.Gu=a,0!==s.length||o?{snapshot:new zh(this.query,e.zu,r,s,e.mutatedKeys,0==a,o,!1,!!n&&0<n.resumeToken.approximateByteSize()),tc:i}:{tc:i}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({zu:this.zu,Ju:new Qh,mutatedKeys:this.mutatedKeys,Li:!1},!1)):{tc:[]}}ec(e){return!this.Ku.has(e)&&!!this.zu.has(e)&&!this.zu.get(e).hasLocalMutations}Zu(e){e&&(e.addedDocuments.forEach(e=>this.Ku=this.Ku.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ku=this.Ku.delete(e)),this.current=e.current)}Xu(){if(!this.current)return[];const t=this.Qu;this.Qu=Pa(),this.zu.forEach(e=>{this.ec(e.key)&&(this.Qu=this.Qu.add(e.key))});const n=[];return t.forEach(e=>{this.Qu.has(e)||n.push(new il(e))}),this.Qu.forEach(e=>{t.has(e)||n.push(new sl(e))}),n}nc(e){this.Ku=e.Yi,this.Qu=Pa();var t=this.Hu(e.documents);return this.applyChanges(t,!0)}sc(){return zh.fromInitialDocuments(this.query,this.zu,this.mutatedKeys,0===this.Gu,this.hasCachedResults)}}class ol{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ul{constructor(e){this.key=e,this.ic=!1}}class cl{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.rc={},this.oc=new Na(e=>zi(e),Qi),this.uc=new Map,this.cc=new Set,this.ac=new vi($r.comparator),this.hc=new Map,this.lc=new Ec,this.fc={},this.dc=new Map,this._c=Zu.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return!0===this.wc}}async function hl(n,e,t,r,s){n.mc=(e,i,t)=>async function(e,t,n){let r=t.view.Hu(i);r.Li&&(r=await Wc(e.localStore,t.query,!1).then(({documents:e})=>t.view.Hu(e,r)));var s=n&&n.targetChanges.get(t.targetId),s=t.view.applyChanges(r,e.isPrimaryClient,s);return wl(e,t.targetId,s.tc),s.snapshot}(n,e,t);const i=await Wc(n.localStore,e,!0),a=new al(e,i.Yi),o=a.Hu(i.documents),u=Ua.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,s),c=a.applyChanges(o,n.isPrimaryClient,u);wl(n,t,c.tc);var h=new ol(e,t,a);return n.oc.set(e,h),n.uc.has(t)?n.uc.get(t).push(e):n.uc.set(t,[e]),c.snapshot}async function ll(e,t,n){const r=xl(e);try{const e=await function(e,s){const i=e,a=Br.now(),o=s.reduce((e,t)=>e.add(t.key),Pa());let u,c;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=ka,r=Pa();return i.ji.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,t)).next(e=>{u=e;const t=[];for(const n of s){const s=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=na(r.transform,e||null);null!=s&&(null===n&&(n=Si.empty()),n.set(r.field,s))}return n||null}(n,u.get(n.key).overlayedDocument);null!=s&&t.push(new ba(n.key,s,function r(e){const s=[];return Is(e.fields,(e,t)=>{const n=new jr([e]);if(Qs(t)){const e=r(t.mapValue).fields;if(0===e.length)s.push(n);else for(const t of e)s.push(n.child(t))}else s.push(n)}),new _i(s)}(s.value.mapValue),fa.exists(!0)))}return i.mutationQueue.addMutationBatch(n,a,t,s)}).next(e=>{var t=(c=e).applyToLocalDocumentSet(u,r);return i.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:c.batchId,changes:La(u)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.fc[e.currentUser.toKey()];r=r||new vi(Fr),r=r.insert(t,n),e.fc[e.currentUser.toKey()]=r}(r,e.batchId,n),await bl(r,e.changes),await Fh(r.remoteStore)}catch(e){const t=jh(e,"Failed to persist write");n.reject(t)}}async function dl(e,t){const r=e;try{const e=await $c(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.hc.get(t);n&&(Er(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.ic=!0:0<e.modifiedDocuments.size?Er(n.ic):0<e.removedDocuments.size&&(Er(n.ic),n.ic=!1))}),await bl(r,e,t)}catch(e){await rs(e)}}function fl(r,s,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.oc.forEach((e,t)=>{var n=t.view.Pu(s);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.Pu(n)&&(r=!0)}),r&&Jh(t)}(t.eventManager,s),r.length&&t.rc.Ho(r),t.onlineState=s,t.isPrimaryClient&&t.sharedClientState.setOnlineState(s)}}async function gl(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=s.ji.newChangeBuffer({trackRemovals:!0});return function(e,t,r,s){const i=r.batch,n=i.keys();let a=ss.resolve();return n.forEach(n=>{a=a.next(()=>s.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);Er(null!==t),e.version.compareTo(t)<0&&(i.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),s.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(s,e,r,n).next(()=>n.apply(e)).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Pa();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>s.localDocuments.getDocuments(e,t))})}(n.localStore,t);pl(n,r,null),ml(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await bl(n,e)}catch(e){await rs(e)}}function ml(e,t){(e.dc.get(t)||[]).forEach(e=>{e.resolve()}),e.dc.delete(t)}function pl(e,t,n){const r=e;let s=r.fc[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.fc[r.currentUser.toKey()]=s}}function yl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.uc.get(e))t.oc.delete(r),n&&t.rc.gc(r,n);t.uc.delete(e),t.isPrimaryClient&&t.lc.ds(e).forEach(e=>{t.lc.containsKey(e)||vl(t,e)})}function vl(e,t){e.cc.delete(t.path.canonicalString());var n=e.ac.get(t);null!==n&&(Dh(e.remoteStore,n),e.ac=e.ac.remove(t),e.hc.delete(n),Il(e))}function wl(e,t,n){for(const r of n)r instanceof sl?(e.lc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.ac.get(n)||e.cc.has(r)||(vr("SyncEngine","New document in limbo: "+n),e.cc.add(r),Il(e))}(e,r)):r instanceof il?(vr("SyncEngine","Document no longer in limbo: "+r.key),e.lc.removeReference(r.key,t),e.lc.containsKey(r.key)||vl(e,r.key)):Tr()}function Il(e){for(;0<e.cc.size&&e.ac.size<e.maxConcurrentLimboResolutions;){var t=e.cc.values().next().value;e.cc.delete(t);var n=new $r(Kr.fromString(t)),t=e._c.next();e.hc.set(t,new ul(n)),e.ac=e.ac.insert(n,t),xh(e.remoteStore,new eu(Gi(Vi(n.path)),t,2,ps.at))}}async function bl(e,t,r){const s=e,i=[],a=[],o=[];s.oc.isEmpty()||(s.oc.forEach((e,n)=>{o.push(s.mc(n,t,r).then(e=>{var t;(e||r)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(n.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(i.push(e),t=Bc.Ni(n.targetId,e),a.push(t))}))}),await Promise.all(o),s.rc.Ho(i),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>ss.forEach(t,t=>ss.forEach(t.Ci,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>ss.forEach(t.xi,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!cs(e))throw e;vr("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Ki.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.Ki=r.Ki.insert(t,s)}}}(s.localStore,a))}async function Tl(r,e){const s=r;if(Sl(s),xl(s),!0===e&&!0!==s.wc){const r=s.sharedClientState.getAllActiveQueryTargets(),e=await El(s,r.toArray());s.wc=!0,await qh(s.remoteStore,!0);for(const r of e)xh(s.remoteStore,r)}else if(!1===e&&!1!==s.wc){const r=[];let n=Promise.resolve();s.uc.forEach((e,t)=>{s.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(yl(s,t),Hc(s.localStore,t,!0))),Dh(s.remoteStore,t)}),await n,await El(s,r),function(){const n=s;n.hc.forEach((e,t)=>{Dh(n.remoteStore,t)}),n.lc._s(),n.hc=new Map,n.ac=new vi($r.comparator)}(),s.wc=!1,await qh(s.remoteStore,!1)}}async function El(t,n){const r=t,s=[],i=[];for(const t of n){let e;const h=r.uc.get(t);if(h&&0!==h.length){e=await zc(r.localStore,Gi(h[0]));for(const t of h){const n=r.oc.get(t),h=(a=r,o=n,c=u=void 0,c=await Wc((u=a).localStore,o.query,!0),c=o.view.nc(c),u.isPrimaryClient&&wl(u,o.targetId,c.tc),await c);h.snapshot&&i.push(h.snapshot)}}else{const h=await Xc(r.localStore,t);e=await zc(r.localStore,h),await hl(r,_l(h),t,!1,e.resumeToken)}s.push(e)}var a,o,u,c;return r.rc.Ho(i),s}function _l(e){return Fi(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Sl(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=dl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.hc.get(t);if(r&&r.ic)return Pa().add(r.key);{let e=Pa();const r=n.uc.get(t);if(!r)return e;for(const t of r){const r=n.oc.get(t);e=e.unionWith(r.view.Wu)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.hc.get(t),i=s&&s.key;if(i){let e=new vi($r.comparator);e=e.insert(i,xi.newNoDocument(i,qr.min()));const n=Pa().add(i),s=new qa(qr.min(),new Map,new bi(Fr),e,n);await dl(r,s),r.ac=r.ac.remove(i),r.hc.delete(t),Il(r)}else await Hc(r.localStore,t,!1).then(()=>yl(r,t,n)).catch(rs)}).bind(null,t),t.rc.Ho=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.Vu(e)&&(r=!0);s.bu=e}}r&&Jh(n)}).bind(null,t.eventManager),t.rc.gc=(function(e,t,n){const r=e,s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function xl(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=gl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return s.mutationQueue.lookupMutationBatch(t,r).next(e=>(Er(null!==e),n=e.keys(),s.mutationQueue.removeMutationBatch(t,e))).next(()=>s.mutationQueue.performConsistencyCheck(t)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>s.localDocuments.getDocuments(t,n))})}(r.localStore,t);pl(r,t,n),ml(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await bl(r,e)}catch(n){await rs(n)}}).bind(null,t),t}class Dl{constructor(){this.synchronizeTabs=!1}async initialize(e){this.Tt=ph(e.databaseInfo.databaseId),this.sharedClientState=this.Ic(e),this.persistence=this.Tc(e),await this.persistence.start(),this.localStore=this.Ec(e),this.gcScheduler=this.Ac(e,this.localStore),this.indexBackfillerScheduler=this.Rc(e,this.localStore)}Ac(e,t){return null}Rc(e,t){return null}Ec(e){return Kc(this.persistence,new qc,e.initialUser,this.Tt)}Tc(e){return new Cc(kc.qs,this.Tt)}Ic(e){return new uh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Al extends Dl{constructor(e,t,n){super(),this.bc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.bc.initialize(this,e),await xl(this.bc.syncEngine),await Fh(this.bc.remoteStore),await this.persistence.di(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ec(e){return Kc(this.persistence,new qc,e.initialUser,this.Tt)}Ac(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new ac(n,e.asyncQueue,t)}Rc(e,t){var n=new ms(t,this.persistence);return new gs(e.asyncQueue,n)}Tc(e){var t=Pc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?$u.withCacheSize(this.cacheSizeBytes):$u.DEFAULT;return new Oc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,gh(),mh(),this.Tt,this.sharedClientState,!!this.forceOwnership)}Ic(e){return new uh}}class Cl extends Al{constructor(e,t){super(e,t,!1),this.bc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.bc.syncEngine;this.sharedClientState instanceof oh&&(this.sharedClientState.syncEngine={Br:(async function(e,t,n,r){var s=e,i=await function(e,n){const r=e,s=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.An(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):ss.resolve(null)))}(s.localStore,t);null!==i?("pending"===n?await Fh(s.remoteStore):"acknowledged"===n||"rejected"===n?(pl(s,t,r||null),ml(s,t),s.localStore.mutationQueue.bn(t)):Tr(),await bl(s,i)):vr("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),Lr:(async function(e,t,n,r){const s=e;if(s.wc)vr("SyncEngine","Ignoring unexpected query state notification.");else{var i=s.uc.get(t);if(i&&0<i.length)switch(n){case"current":case"not-current":{const e=await Yc(s.localStore,Xi(i[0])),r=qa.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,xs.EMPTY_BYTE_STRING);await bl(s,e,r);break}case"rejected":await Hc(s.localStore,t,!0),yl(s,t,r);break;default:Tr()}}}).bind(null,t),qr:(async function(e,t,n){const r=Sl(e);if(r.wc){for(const e of t)if(r.uc.has(e))vr("SyncEngine","Adding an already active target "+e);else{const t=await Xc(r.localStore,e),n=await zc(r.localStore,t);await hl(r,_l(t),n.targetId,!1,n.resumeToken),xh(r.remoteStore,n)}for(const e of n)r.uc.has(e)&&await Hc(r.localStore,e,!1).then(()=>{Dh(r.remoteStore,e),yl(r,e)}).catch(rs)}}).bind(null,t),Si:(function(e){return e.localStore.persistence.Si()}).bind(null,t),$r:(async function(e,t){const n=e;return Yc(n.localStore,t).then(e=>bl(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.di(async e=>{await Tl(this.bc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Ic(e){var t=gh();if(!oh.C(t))throw new Sr(_r.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Pc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new oh(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Nl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>fl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){vr("SyncEngine","User change. New user:",t.toKey());const r=await Gc(n.localStore,t);n.currentUser=t,(e=n).dc.forEach(e=>{e.forEach(e=>{e.reject(new Sr(_r.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.dc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await bl(n,r.Wi)}}).bind(null,this.syncEngine),await qh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Wh}createDatastore(e){var t,n,r,s,i=ph(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new fh(t));return n=e.authCredentials,r=e.appCheckCredentials,s=t,e=i,new bh(n,r,s,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,s=e=>fl(this.syncEngine,e,0),i=new(hh.C()?hh:ch),new Eh(t,n,r,s,i);var t,n,r,s,i}createSyncEngine(e,t){return function(e,t,n,r,s,i,a){const o=new cl(e,t,n,r,s,i);return a&&(o.wc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;vr("RemoteStore","RemoteStore shutting down."),t.mu.add(5),await Sh(t),t.yu.shutdown(),t.pu.set("Unknown")}(this.remoteStore)}}function kl(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Rl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.vc(this.observer.next,e)}error(e){this.observer.error?this.vc(this.observer.error,e):wr("Uncaught Error in snapshot listener:",e.toString())}Pc(){this.muted=!0}vc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Ml{constructor(e,t){this.Vc=e,this.Tt=t,this.metadata=new xr,this.buffer=new Uint8Array,this.Sc=new TextDecoder("utf-8"),this.Dc().then(e=>{e&&e.Fu()?this.metadata.resolve(e.Mu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Mu)}`))},e=>this.metadata.reject(e))}close(){return this.Vc.cancel()}async getMetadata(){return this.metadata.promise}async yc(){return await this.getMetadata(),this.Dc()}async Dc(){var e=await this.Cc();if(null===e)return null;var t=this.Sc.decode(e),n=Number(t);isNaN(n)&&this.xc(`length string (${t}) is not valid number`);t=await this.Nc(n);return new el(JSON.parse(t),e.length+n)}kc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Cc(){for(;this.kc()<0&&!await this.Oc(););if(0===this.buffer.length)return null;var e=this.kc();e<0&&this.xc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Nc(e){for(;this.buffer.length<e;)await this.Oc()&&this.xc("Reached the end of bundle when more is expected.");var t=this.Sc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}xc(e){throw this.Vc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Oc(){var e=await this.Vc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Ll{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Sr(_r.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=uo(r.Tt)+"/documents",s={documents:t.map(e=>so(r.Tt,e))},i=await r.mo("BatchGetDocuments",n,s,t.length),a=new Map;i.forEach(e=>{const t=(n=r.Tt,"found"in(e=e)?function(e,t){Er(!!t.found),t.found.name,t.found.updateTime;var n=io(e,t.found.name),r=to(t.found.updateTime),s=t.found.createTime?to(t.found.createTime):qr.min(),i=new Si({mapValue:{fields:t.found.fields}});return xi.newFoundDocument(n,r,s,i)}(n,e):"missing"in e?function(e,t){Er(!!t.missing),Er(!!t.readTime);var n=io(e,t.missing),r=to(t.readTime);return xi.newNoDocument(n,r)}(n,e):Tr());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());Er(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Sa(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=$r.fromPath(t);this.mutations.push(new xa(n,this.precondition(n)))}),await async function(e,t){const n=e,r=uo(n.Tt)+"/documents",s={writes:t.map(e=>fo(n.Tt,e))};await n.lo("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Tr();t=qr.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Sr(_r.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(qr.min())?fa.exists(!1):fa.updateTime(t):fa.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return fa.exists(!0);if(t.isEqual(qr.min()))throw new Sr(_r.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fa.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Ol{constructor(e,t,n,r,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=s,this.Mc=n.maxAttempts,this.ko=new yh(this.asyncQueue,"transaction_retry")}run(){--this.Mc,this.Fc()}Fc(){this.ko.vo(async()=>{const t=new Ll(this.datastore),e=this.$c(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Bc(e)}))}).catch(e=>{this.Bc(e)})})}$c(e){try{var t=this.updateFunction(e);return!Ts(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Bc(e){0<this.Mc&&this.Lc(e)?(--this.Mc,this.asyncQueue.enqueueAndForget(()=>(this.Fc(),Promise.resolve()))):this.deferred.reject(e)}Lc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Aa(t)}}class Fl{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=gr.UNAUTHENTICATED,this.clientId=Or.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{vr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(vr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Sr(_r.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new xr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=jh(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function Vl(e,t){e.asyncQueue.verifyOperationInProgress(),vr("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Gc(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function Pl(e,n){e.asyncQueue.verifyOperationInProgress();var t=await Bl(e);vr("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>Bh(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>Bh(n.remoteStore,t)),e.onlineComponents=n}async function Bl(e){return e.offlineComponents||(vr("FirestoreClient","Using default OfflineComponentProvider"),await Vl(e,new Dl)),e.offlineComponents}async function ql(e){return e.onlineComponents||(vr("FirestoreClient","Using default OnlineComponentProvider"),await Pl(e,new Nl)),e.onlineComponents}function Ul(e){return Bl(e).then(e=>e.persistence)}function Kl(e){return Bl(e).then(e=>e.localStore)}function Gl(e){return ql(e).then(e=>e.remoteStore)}function jl(e){return ql(e).then(e=>e.syncEngine)}async function $l(e){const t=await ql(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=Sl(e);let r,s;const i=n.oc.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.sc();else{const e=await zc(n.localStore,Gi(t));n.isPrimaryClient&&xh(n.remoteStore,e);const i=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await hl(n,t,r,"current"===i,e.resumeToken)}return s}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.oc.get(t),s=n.uc.get(r.targetId);if(1<s.length)return n.uc.set(r.targetId,s.filter(e=>!Qi(e,t))),void n.oc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Hc(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Dh(n.remoteStore,r.targetId),yl(n,r.targetId)}).catch(rs)):(yl(n,r.targetId),await Hc(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function Ql(e,t,n={}){const r=new xr;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,s,i,a){const e=new Rl({next:e=>{r.enqueueAndForget(()=>Yh(n,o));var t=e.docs.has(s);!t&&e.fromCache?a.reject(new Sr(_r.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&i&&"server"===i.source?a.reject(new Sr(_r.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new Zh(Vi(s.path),e,{includeMetadataChanges:!0,Ou:!0});return Xh(n,o)}(await $l(e),e.asyncQueue,t,n,r)),r.promise}function zl(e,t,n={}){const r=new xr;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,s){const i=new Rl({next:e=>{n.enqueueAndForget(()=>Yh(t,a)),e.fromCache&&"server"===r.source?s.reject(new Sr(_r.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(e)},error:e=>s.reject(e)}),a=new Zh(e,i,{includeMetadataChanges:!0,Ou:!0});return Xh(t,a)}(await $l(e),e.asyncQueue,t,n,r)),r.promise}function Hl(e,t,n,r){const s=(n=n,t=ph(t),i="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return kl(e,void 0);if(e instanceof ArrayBuffer)return kl(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(i),t=t,new Ml(n,t));var i;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var s=await n.getMetadata();if(await function(e,t){const n=e,r=to(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Os.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,s))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:s.totalDocuments,bytesLoaded:s.totalBytes,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes}),Promise.resolve(new Set);r._updateProgress(rl(s));const a=new nl(s,t.localStore,n.Tt);let e=await n.yc();for(;e;){const t=await a.Bu(e);t&&r._updateProgress(t),e=await n.yc()}var i=await a.complete();return await bl(t,i.Uu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Os.saveBundleMetadata(e,t))}(t.localStore,s),r._completeWith(i.progress),Promise.resolve(i.qu)}catch(t){return Ir("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await jl(e),s,r)})}const Wl=new Map;function Xl(e,t,n){if(!n)throw new Sr(_r.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Yl(e,t,n,r){if(!0===t&&!0===r)throw new Sr(_r.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Jl(e){if(!$r.isDocumentKey(e))throw new Sr(_r.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Zl(e){if($r.isDocumentKey(e))throw new Sr(_r.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ed(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Tr();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function td(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new Sr(_r.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ed(e);throw new Sr(_r.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function nd(e,t){if(t<=0)throw new Sr(_r.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class rd{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Sr(_r.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Sr(_r.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Yl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sd{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Sr(_r.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Sr(_r.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ar;switch(e.type){case"gapi":var t=e.client;return new Rr(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Sr(_r.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Wl.get(e);t&&(vr("ComponentProvider","Removing Datastore"),Wl.delete(e),t.terminate())}(this),Promise.resolve()}}function id(n,e,t,r={}){var s;const i=(n=td(n,sd))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Ir("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=gr.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Sr(_r.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new gr(i)}n._authCredentials=new Cr(new Dr(e,t))}}class ad{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ud(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ad(this.firestore,e,this._key)}}class od{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new od(this.firestore,e,this._query)}}class ud extends od{constructor(e,t,n){super(e,t,Vi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ad(this.firestore,null,new $r(e))}withConverter(e){return new ud(this.firestore,e,this._path)}}function cd(e,t,...n){if(e=m(e),Xl("collection","path",t),e instanceof sd){var r=Kr.fromString(t,...n);return Zl(r),new ud(e,null,r)}if(!(e instanceof ad||e instanceof ud))throw new Sr(_r.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Kr.fromString(t,...n));return Zl(r),new ud(e.firestore,null,r)}function hd(e,t,...n){if(e=m(e),Xl("doc","path",t=1===arguments.length?Or.R():t),e instanceof sd){var r=Kr.fromString(t,...n);return Jl(r),new ad(e,null,new $r(r))}if(!(e instanceof ad||e instanceof ud))throw new Sr(_r.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Kr.fromString(t,...n));return Jl(r),new ad(e.firestore,e instanceof ud?e.converter:null,new $r(r))}function ld(e,t){return e=m(e),t=m(t),(e instanceof ad||e instanceof ud)&&(t instanceof ad||t instanceof ud)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function dd(e,t){return e=m(e),t=m(t),e instanceof od&&t instanceof od&&e.firestore===t.firestore&&Qi(e._query,t._query)&&e.converter===t.converter}class fd{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new yh(this,"async_queue_retry"),this.Hc=()=>{var e=mh();e&&vr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ko.Vo()};const e=mh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Jc(),this.Yc(e)}enterRestrictedMode(e){if(!this.Kc){this.Kc=!0,this.zc=e||!1;const t=mh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Hc)}}enqueue(e){if(this.Jc(),this.Kc)return new Promise(()=>{});const t=new xr;return this.Yc(()=>this.Kc&&this.zc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Uc.push(e),this.Zc()))}async Zc(){if(0!==this.Uc.length){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(e){if(!cs(e))throw e;vr("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Uc.length&&this.ko.vo(()=>this.Zc())}}Yc(e){var t=this.qc.then(()=>(this.jc=!0,e().catch(e=>{throw this.Qc=e,this.jc=!1,wr("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.jc=!1,e))));return this.qc=t}enqueueAfterDelay(e,t,n){this.Jc(),-1<this.Wc.indexOf(e)&&(t=0);var r=Gh.createAndSchedule(this,e,t,n,e=>this.Xc(e));return this.Gc.push(r),r}Jc(){this.Qc&&Tr()}verifyOperationInProgress(){}async ta(){for(var e;await(e=this.qc),e!==this.qc;);}ea(e){for(const t of this.Gc)if(t.timerId===e)return!0;return!1}na(t){return this.ta().then(()=>{this.Gc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Gc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ta()})}sa(e){this.Wc.push(e)}Xc(e){var t=this.Gc.indexOf(e);this.Gc.splice(t,1)}}function gd(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class md{constructor(){this._progressObserver={},this._taskCompletionResolver=new xr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var pd,yd,vd;class wd extends sd{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new fd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||bd(this),this._firestoreClient.terminate()}}function Id(e){return e._firestoreClient||bd(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function bd(e){var t,n,r,s,i,a=e._freezeSettings(),a=(n=e._databaseId,r=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",s=e._persistenceKey,i=a,new ys(n,r,s,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new Fl(e._authCredentials,e._appCheckCredentials,e._queue,a)}function Td(e,n,r){const s=new xr;return e.asyncQueue.enqueue(async()=>{try{await Vl(e,r),await Pl(e,n),s.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===_r.FAILED_PRECONDITION||t.code===_r.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw n;Ir("Error enabling offline persistence. Falling back to persistence disabled: "+n),s.reject(n)}var t}).then(()=>s.promise)}function Ed(e){return function(e){const t=new xr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;Rh(n.remoteStore)||vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.dc.get(e)||[];r.push(t),n.dc.set(e,r)}catch(e){const n=jh(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await jl(e),t)),t.promise}(Id(e=td(e,wd)))}function _d(e){return(n=Id(e=td(e,wd))).asyncQueue.enqueue(async()=>{const e=await Ul(n),t=await Gl(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.mu.delete(0),_h(e)}()});var n}function Sd(e){return(n=Id(e=td(e,wd))).asyncQueue.enqueue(async()=>{const e=await Ul(n),t=await Gl(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.mu.add(0),await Sh(e),e.pu.set("Offline")}()});var n}function xd(t,e){return n=Id(t=td(t,wd)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Os.getNamedQuery(e,t))}(await Kl(n),r)).then(e=>e?new od(t,null,e.query):null);var n,r}function Dd(e){if(e._initialized||e._terminated)throw new Sr(_r.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ad{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ad(xs.fromBase64String(e))}catch(e){throw new Sr(_r.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Ad(xs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Cd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Sr(_r.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Nd{constructor(e){this._methodName=e}}class kd{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new Sr(_r.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new Sr(_r.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Fr(this._lat,e._lat)||Fr(this._long,e._long)}}const Rd=/^__.*__$/;class Md{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ba(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ia(e,this.data,t,this.fieldTransforms)}}class Ld{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ba(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Od(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Tr()}}class Fd{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.Tt=n,this.ignoreUndefinedProperties=r,void 0===s&&this.ia(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(e){return new Fd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:n,ca:!1});return r.aa(e),r}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:n,ca:!1});return r.ia(),r}la(e){return this.oa({path:void 0,ca:!0})}fa(e){return nf(e,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}ia(){if(this.path)for(let e=0;e<this.path.length;e++)this.aa(this.path.get(e))}aa(e){if(0===e.length)throw this.fa("Document fields must not be empty");if(Od(this.ra)&&Rd.test(e))throw this.fa('Document fields cannot begin and end with "__"')}}class Vd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.Tt=n||ph(e)}wa(e,t,n,r=!1){return new Fd({ra:e,methodName:t,_a:n,path:jr.emptyPath(),ca:!1,da:r},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function Pd(e){var t=e._freezeSettings(),n=ph(e._databaseId);return new Vd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Bd(e,t,n,r,s,i={}){const a=e.wa(i.merge||i.mergeFields?2:0,t,n,s);Jd("Data must be an object, but it was:",a,r);var o=Xd(r,a);let u,c;if(i.merge)u=new _i(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=Zd(t,r,n);if(!a.contains(s))throw new Sr(_r.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);rf(e,s)||e.push(s)}u=new _i(e),c=a.fieldTransforms.filter(e=>u.covers(e.field))}else u=null,c=a.fieldTransforms;return new Md(new Si(o),u,c)}class qd extends Nd{_toFieldTransform(e){if(2!==e.ra)throw 1===e.ra?e.fa(`${this._methodName}() can only appear at the top level of your update data`):e.fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof qd}}function Ud(e,t,n){return new Fd({ra:3,_a:t.settings._a,methodName:e._methodName,ca:n},t.databaseId,t.Tt,t.ignoreUndefinedProperties)}class Kd extends Nd{_toFieldTransform(e){return new la(e.path,new ra)}isEqual(e){return e instanceof Kd}}class Gd extends Nd{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=Ud(this,e,!0),n=this.ma.map(e=>Wd(e,t)),r=new sa(n);return new la(e.path,r)}isEqual(e){return this===e}}class jd extends Nd{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=Ud(this,e,!0),n=this.ma.map(e=>Wd(e,t)),r=new aa(n);return new la(e.path,r)}isEqual(e){return this===e}}class $d extends Nd{constructor(e,t){super(e),this.ga=t}_toFieldTransform(e){var t=new ua(e.Tt,ea(e.Tt,this.ga));return new la(e.path,t)}isEqual(e){return this===e}}function Qd(e,s,i,t){const a=e.wa(1,s,i);Jd("Data must be an object, but it was:",a,t);const o=[],u=Si.empty();Is(t,(e,t)=>{var n=tf(s,e,i);t=m(t);var r=a.ha(n);if(t instanceof qd)o.push(n);else{const e=Wd(t,r);null!=e&&(o.push(n),u.set(n,e))}});var n=new _i(o);return new Ld(u,n,a.fieldTransforms)}function zd(e,t,n,r,s,i){const a=e.wa(1,t,n),o=[Zd(t,r,n)],u=[s];if(i.length%2!=0)throw new Sr(_r.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)o.push(Zd(t,i[f])),u.push(i[f+1]);const c=[],h=Si.empty();for(let g=o.length-1;0<=g;--g)if(!rf(c,o[g])){const t=o[g];var l=m(l=u[g]);const r=a.ha(t);if(l instanceof qd)c.push(t);else{const e=Wd(l,r);null!=e&&(c.push(t),h.set(t,e))}}var d=new _i(c);return new Ld(h,d,a.fieldTransforms)}function Hd(e,t,n,r=!1){return Wd(n,e.wa(r?4:3,t))}function Wd(i,e){if(Yd(i=m(i)))return Jd("Unsupported field value:",e,i),Xd(i,e);if(i instanceof Nd)return function(e,t){if(!Od(t.ra))throw t.fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.fa(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(i,e),null;if(void 0===i&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.ca&&4!==e.ra)throw e.fa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const s of i){let e=Wd(s,t.la(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=m(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ea(t.Tt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Br.fromDate(e);return{timestampValue:Za(t.Tt,n)}}if(e instanceof Br){n=new Br(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Za(t.Tt,n)}}if(e instanceof kd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ad)return{bytesValue:eo(t.Tt,e._byteString)};if(e instanceof ad){const r=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(r))throw t.fa(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:no(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.fa(`Unsupported field value: ${ed(e)}`)}(0,e)}function Xd(e,r){const s={};return bs(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Is(e,(e,t)=>{var n=Wd(t,r.ua(e));null!=n&&(s[e]=n)}),{mapValue:{fields:s}}}function Yd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Br||e instanceof kd||e instanceof Ad||e instanceof ad||e instanceof Nd)}function Jd(e,t,n){if(!Yd(n)||("object"!=typeof(s=n)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s))){var r=ed(n);throw"an object"===r?t.fa(e+" a custom object"):t.fa(e+" "+r)}var s}function Zd(e,t,n){if((t=m(t))instanceof Cd)return t._internalPath;if("string"==typeof t)return tf(e,t);throw nf("Field path arguments must be of type string or ",e,!1,void 0,n)}const ef=new RegExp("[~\\*/\\[\\]]");function tf(t,n,r){if(0<=n.search(ef))throw nf(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new Cd(...n.split("."))._internalPath}catch(e){throw nf(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function nf(e,t,n,r,s){var i=r&&!r.isEmpty(),a=void 0!==s;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new Sr(_r.INVALID_ARGUMENT,o+e+u)}function rf(e,t){return e.some(e=>e.isEqual(t))}class sf{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ad(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new af(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(of("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class af extends sf{data(){return super.data()}}function of(e,t){return"string"==typeof t?tf(e,t):(t instanceof Cd?t:t._delegate)._internalPath}function uf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Sr(_r.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cf{}class hf extends cf{}function lf(e,t,...n){let r=[];t instanceof cf&&r.push(t),r=r.concat(n),function(e){var t=e.filter(e=>e instanceof ff).length,n=e.filter(e=>e instanceof df).length;if(1<t||0<t&&0<n)throw new Sr(_r.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class df extends hf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new df(e,t,n)}_apply(e){var t=this._parse(e);return bf(e._query,t),new od(e.firestore,e.converter,ji(e._query,t))}_parse(e){var t=Pd(e.firestore);return function(e,t,n,r,s,i,a){let o;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Sr(_r.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){If(a,i);const t=[];for(const n of a)t.push(wf(r,e,n));o={arrayValue:{values:t}}}else o=wf(r,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||If(a,i),o=Hd(n,t,a,"in"===i||"not-in"===i);return ti.create(s,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class ff extends cf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ff(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:ni.create(e,this._getOperator())}_apply(e){const n=this._parse(e);return 0===n.getFilters().length?e:(function(e){let t=e;for(const e of n.getFlattenedFilters())bf(t,e),t=ji(t,e)}(e._query),new od(e.firestore,e.converter,ji(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class gf extends hf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new gf(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new Sr(_r.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Sr(_r.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,s=new yi(t,n);return n=s,null!==Bi(e=e)||null!==(r=qi(e))&&Tf(0,r,n.field),s}(e._query,this._field,this._direction);return new od(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new Oi(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class mf extends hf{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new mf(e,t,n)}_apply(e){return new od(e.firestore,e.converter,$i(e._query,this._limit,this._limitType))}}class pf extends hf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new pf(e,t,n)}_apply(e){var t,n=vf(e,this.type,this._docOrFields,this._inclusive);return new od(e.firestore,e.converter,(t=e._query,e=n,new Oi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class yf extends hf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new yf(e,t,n)}_apply(e){var t,n=vf(e,this.type,this._docOrFields,this._inclusive);return new od(e.firestore,e.converter,(t=e._query,e=n,new Oi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function vf(e,t,n,r){if(n[0]=m(n[0]),n[0]instanceof sf)return function(e,t,n,r,s){if(!r)throw new Sr(_r.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Ki(e))if(n.field.isKeyField())i.push(Us(t,r.key));else{const e=r.data.field(n.field);if(ks(e))throw new Sr(_r.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new Ys(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var s=Pd(e.firestore);return function(e,t,n,r,s,i){const a=e.explicitOrderBy;if(s.length>a.length)throw new Sr(_r.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let u=0;u<s.length;u++){const c=s[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Ui(e)&&-1!==c.indexOf("/"))throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(Kr.fromString(c));if(!$r.isDocumentKey(n))throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new $r(n);o.push(Us(t,s))}else{const e=Hd(n,r,c);o.push(e)}}return new Ys(o,i)}(e._query,e.firestore._databaseId,s,t,n,r)}function wf(e,t,n){if("string"==typeof(n=m(n))){if(""===n)throw new Sr(_r.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ui(t)&&-1!==n.indexOf("/"))throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(Kr.fromString(n));if(!$r.isDocumentKey(r))throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Us(e,new $r(r))}if(n instanceof ad)return Us(e,n._key);throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ed(n)}.`)}function If(e,t){if(!Array.isArray(e)||0===e.length)throw new Sr(_r.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function bf(e,t){if(t.isInequality()){const r=qi(e),s=t.field;if(null!==r&&!r.isEqual(s))throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${s.toString()}'`);var n=Bi(e);null!==n&&Tf(0,s,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new Sr(_r.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Sr(_r.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function Tf(e,t,n){if(!n.isEqual(t))throw new Sr(_r.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Ef{convertValue(e,t="none"){switch(Os(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ns(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Tr()}}convertObject(e,n){const r={};return Is(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new kd(Cs(e.latitude),Cs(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return ks(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Rs(e));default:return null}}convertTimestamp(e){var t=As(e);return new Br(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Kr.fromString(e);Er(To(n));const r=new vs(n.get(1),n.get(3)),s=new $r(n.popFirst(5));return r.isEqual(t)||wr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function _f(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class Sf extends Ef{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ad(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new ad(this.firestore,null,t)}}class xf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Df extends sf{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new Af(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(of("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Af extends Df{data(e={}){return super.data(e)}}class Cf{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new xf(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new Af(this._firestore,this._userDataWriter,e.key,e,new xf(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Sr(_r.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){let n=0;return i._snapshot.docChanges.map(e=>{var t=new Af(i._firestore,i._userDataWriter,e.doc.key,e.doc,new xf(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new Af(i._firestore,i._userDataWriter,e.doc.key,e.doc,new xf(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(s=s.add(e.doc),r=s.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Tr()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Nf(e,t){return e instanceof Df&&t instanceof Df?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Cf&&t instanceof Cf&&e._firestore===t._firestore&&dd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class kf extends Ef{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ad(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new ad(this.firestore,null,t)}}function Rf(t){t=td(t,ad);const n=td(t.firestore,wd),e=Id(n),r=new kf(n);return function(e,t){const n=new xr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const s=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new Sr(_r.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=jh(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Kl(e),t,n)),n.promise}(e,t._key).then(e=>new Df(n,r,t._key,e,new xf(null!==e&&e.hasLocalMutations,!0),t.converter))}function Mf(t){t=td(t,od);const n=td(t.firestore,wd),e=Id(n),r=new kf(n);return function(e,t){const n=new xr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const s=await Wc(e,t,!0),i=new al(t,s.Yi),a=i.Hu(s.documents),o=i.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=jh(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Kl(e),t,n)),n.promise}(e,t._query).then(e=>new Cf(n,r,t,e))}function Lf(e,t,n){e=td(e,ad);var r=td(e.firestore,wd),s=_f(e.converter,t,n);return Pf(r,[Bd(Pd(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,fa.none())])}function Of(e,t,n,...r){e=td(e,ad);var s=td(e.firestore,wd),i=Pd(s);let a;return a="string"==typeof(t=m(t))||t instanceof Cd?zd(i,"updateDoc",e._key,t,n,r):Qd(i,"updateDoc",e._key,t),Pf(s,[a.toMutation(e._key,fa.exists(!0))])}function Ff(t,...n){var e;t=m(t);let r={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||gd(n[s])||(r=n[s],s++);var i={includeMetadataChanges:r.includeMetadataChanges};if(gd(n[s])){const t=n[s];n[s]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[s+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[s+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,u;if(t instanceof ad)o=td(t.firestore,wd),u=Vi(t._key.path),a={next:e=>{n[s]&&n[s](Bf(o,t,e))},error:n[s+1],complete:n[s+2]};else{const c=td(t,od);o=td(c.firestore,wd),u=c._query;const h=new kf(o);a={next:e=>{n[s]&&n[s](new Cf(o,h,c,e))},error:n[s+1],complete:n[s+2]},uf(t._query)}return function(e,t,n,r){const s=new Rl(r),i=new Zh(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>Xh(await $l(e),i)),()=>{s.Pc(),e.asyncQueue.enqueueAndForget(async()=>Yh(await $l(e),i))}}(Id(o),u,i,a)}function Vf(e,t){return function(e,t){const n=new Rl(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.vu.add(t),t.next()}(await $l(e),n)),()=>{n.Pc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.vu.delete(t)}(await $l(e),n))}}(Id(e=td(e,wd)),gd(t)?t:{next:t})}function Pf(e,t){return function(e,t){const n=new xr;return e.asyncQueue.enqueueAndForget(async()=>ll(await jl(e),t,n)),n.promise}(Id(e),t)}function Bf(e,t,n){var r=n.docs.get(t._key),s=new kf(e);return new Df(e,s,t._key,r,new xf(n.hasPendingWrites,n.fromCache),t.converter)}const qf={maxAttempts:5};class Uf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Pd(e)}set(e,t,n){this._verifyNotCommitted();const r=Kf(e,this._firestore),s=_f(r.converter,t,n),i=Bd(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,fa.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var s=Kf(e,this._firestore);let i;return i="string"==typeof(t=m(t))||t instanceof Cd?zd(this._dataReader,"WriteBatch.update",s._key,t,n,r):Qd(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,fa.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=Kf(e,this._firestore);return this._mutations=this._mutations.concat(new Sa(t._key,fa.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Sr(_r.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Kf(e,t){if((e=m(e)).firestore!==t)throw new Sr(_r.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Gf extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Pd(e)}get(e){const n=Kf(e,this._firestore),r=new Sf(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return Tr();const t=e[0];if(t.isFoundDocument())return new sf(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new sf(this._firestore,r,n._key,null,n.converter);throw Tr()})}set(e,t,n){var r=Kf(e,this._firestore),s=_f(r.converter,t,n),s=Bd(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){var s=Kf(e,this._firestore),i="string"==typeof(t=m(t))||t instanceof Cd?zd(this._dataReader,"Transaction.update",s._key,t,n,r):Qd(this._dataReader,"Transaction.update",s._key,t);return this._transaction.update(s._key,i),this}delete(e){var t=Kf(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Kf(e,this._firestore),n=new kf(this._firestore);return super.get(e).then(e=>new Df(this._firestore,n,t._key,e._document,new xf(!1,!1),t.converter))}}function jf(t,n,e){t=td(t,wd);var r=Object.assign(Object.assign({},qf),e);return function(){if(r.maxAttempts<1)throw new Sr(_r.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const s=new xr;return t.asyncQueue.enqueueAndForget(async()=>{var e=await ql(t).then(e=>e.datastore);new Ol(t.asyncQueue,e,r,n,s).run()}),s.promise}(Id(t),e=>n(new Gf(t,e)),r)}pd=yg.SDK_VERSION,mr=pd,yg._registerComponent(new p("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),s=new wd(new Nr(e.getProvider("auth-internal")),new Lr(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Sr(_r.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vs(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),yg.registerVersion(fr,"3.8.4",void 0),yg.registerVersion(fr,"3.8.4","esm2017");function $f(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Sr("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Qf(){if("undefined"==typeof Uint8Array)throw new Sr("unimplemented","Uint8Arrays are not available in this environment.")}function zf(){if("undefined"==typeof atob)throw new Sr("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Hf{constructor(e){this._delegate=e}static fromBase64String(e){return zf(),new Hf(Ad.fromBase64String(e))}static fromUint8Array(e){return Qf(),new Hf(Ad.fromUint8Array(e))}toBase64(){return zf(),this._delegate.toBase64()}toUint8Array(){return Qf(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Wf(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class Xf{enableIndexedDbPersistence(e,t){return function(e,t){Dd(e=td(e,wd));var n=Id(e),r=e._freezeSettings(),s=new Nl;return Td(n,s,new Al(s,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Dd(e=td(e,wd));var t=Id(e),n=e._freezeSettings(),r=new Nl;return Td(t,r,new Cl(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Sr(_r.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new xr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!as.C())return Promise.resolve();var t=e+"main";await as.delete(t)}(Pc(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class Yf{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof vs||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Ir("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){id(this._delegate,e,t,n)}enableNetwork(){return _d(this._delegate)}disableNetwork(){return Sd(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Yl("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Ed(this._delegate)}onSnapshotsInSync(e){return Vf(this._delegate,e)}get app(){if(!this._appCompat)throw new Sr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new lg(this,cd(this._delegate,e))}catch(e){throw rg(e,"collection()","Firestore.collection()")}}doc(e){try{return new ng(this,hd(this._delegate,e))}catch(e){throw rg(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ug(this,function(e,t){if(e=td(e,sd),Xl("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new Sr(_r.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new od(e,null,(t=t,new Oi(Kr.emptyPath(),t)))}(this._delegate,e))}catch(e){throw rg(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return jf(this._delegate,e=>t(new Zf(this,e)))}batch(){return Id(this._delegate),new eg(new Uf(this._delegate,e=>Pf(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=Id(t=td(t,wd)),r=new md,Hl(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return xd(this._delegate,e).then(e=>e?new ug(this,e):null)}}class Jf extends Ef{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hf(new Ad(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return ng.forKey(t,this.firestore,null)}}class Zf{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Jf(e)}get(e){const t=dg(e);return this._delegate.get(t).then(e=>new ag(this._firestore,new Df(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=dg(e);return n?($f("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var s=dg(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){var t=dg(e);return this._delegate.delete(t),this}}class eg{constructor(e){this._delegate=e}set(e,t,n){var r=dg(e);return n?($f("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var s=dg(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){var t=dg(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class tg{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new Af(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new og(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=tg.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new tg(e,new Jf(e),t),r.set(t,s)),s}}tg.INSTANCES=new WeakMap;class ng{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Jf(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Sr("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new ng(t,new ad(t._delegate,n,new $r(e)))}static forKey(e,t,n){return new ng(t,new ad(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new lg(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new lg(this.firestore,cd(this._delegate,e))}catch(e){throw rg(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=m(e))instanceof ad&&ld(this._delegate,e)}set(e,t){t=$f("DocumentReference.set",t);try{return t?Lf(this._delegate,e,t):Lf(this._delegate,e)}catch(e){throw rg(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Of(this._delegate,e):Of(this._delegate,e,t,...n)}catch(e){throw rg(e,"updateDoc()","DocumentReference.update()")}}delete(){return Pf(td((e=this._delegate).firestore,wd),[new Sa(e._key,fa.none())]);var e}onSnapshot(...e){var t=sg(e),n=ig(e,e=>new ag(this.firestore,new Df(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return Ff(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?Rf:"server"===(null==e?void 0:e.source)?function(t){t=td(t,ad);const n=td(t.firestore,wd);return Ql(Id(n),t._key,{source:"server"}).then(e=>Bf(n,t,e))}:function(t){t=td(t,ad);const n=td(t.firestore,wd);return Ql(Id(n),t._key).then(e=>Bf(n,t,e))})(this._delegate),t.then(e=>new ag(this.firestore,new Df(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new ng(this.firestore,e?this._delegate.withConverter(tg.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function rg(e,t,n){return e.message=e.message.replace(t,n),e}function sg(e){for(const t of e)if("object"==typeof t&&!Wf(t))return t;return{}}function ig(e,t){var n;let r;return r=Wf(e[0])?e[0]:Wf(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class ag{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ng(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Nf(this._delegate,e._delegate)}}class og extends ag{data(e){var t=this._delegate.data(e);return void 0!==t||Tr(),t}}class ug{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Jf(e)}where(e,t,n){try{return new ug(this.firestore,lf(this._delegate,(r=n,s=t,i=of("where",e),df._create(i,s,r))))}catch(e){throw rg(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,s,i}orderBy(e,t){try{return new ug(this.firestore,lf(this._delegate,([n,r="asc"]=[e,t],s=r,i=of("orderBy",n),gf._create(i,s))))}catch(e){throw rg(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,s,i}limit(e){try{return new ug(this.firestore,lf(this._delegate,(nd("limit",t=e),mf._create("limit",t,"F"))))}catch(e){throw rg(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new ug(this.firestore,lf(this._delegate,(nd("limitToLast",t=e),mf._create("limitToLast",t,"L"))))}catch(e){throw rg(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new ug(this.firestore,lf(this._delegate,function(...e){return pf._create("startAt",e,!0)}(...e)))}catch(e){throw rg(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ug(this.firestore,lf(this._delegate,function(...e){return pf._create("startAfter",e,!1)}(...e)))}catch(e){throw rg(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ug(this.firestore,lf(this._delegate,function(...e){return yf._create("endBefore",e,!1)}(...e)))}catch(e){throw rg(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ug(this.firestore,lf(this._delegate,function(...e){return yf._create("endAt",e,!0)}(...e)))}catch(e){throw rg(e,"endAt()","Query.endAt()")}}isEqual(e){return dd(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?Mf:"server"===(null==e?void 0:e.source)?function(t){t=td(t,od);const n=td(t.firestore,wd),e=Id(n),r=new kf(n);return zl(e,t._query,{source:"server"}).then(e=>new Cf(n,r,t,e))}:function(t){t=td(t,od);const n=td(t.firestore,wd),e=Id(n),r=new kf(n);return uf(t._query),zl(e,t._query).then(e=>new Cf(n,r,t,e))})(this._delegate),t.then(e=>new hg(this.firestore,new Cf(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=sg(e),n=ig(e,e=>new hg(this.firestore,new Cf(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return Ff(this._delegate,t,n)}withConverter(e){return new ug(this.firestore,e?this._delegate.withConverter(tg.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class cg{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new og(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class hg{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ug(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new og(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new cg(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new og(this._firestore,e))})}isEqual(e){return Nf(this._delegate,e._delegate)}}class lg extends ug{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new ng(this.firestore,e):null}doc(e){try{return void 0===e?new ng(this.firestore,hd(this._delegate)):new ng(this.firestore,hd(this._delegate,e))}catch(e){throw rg(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=td(e.firestore,wd),r=hd(e),s=_f(e.converter,t);return Pf(n,[Bd(Pd(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,fa.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new ng(this.firestore,e))}isEqual(e){return ld(this._delegate,e._delegate)}withConverter(e){return new lg(this.firestore,e?this._delegate.withConverter(tg.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function dg(e){return td(e,ad)}const fg={Firestore:Yf,GeoPoint:kd,Timestamp:Br,Blob:Hf,Transaction:Zf,WriteBatch:eg,DocumentReference:ng,DocumentSnapshot:ag,Query:ug,QueryDocumentSnapshot:og,QuerySnapshot:hg,CollectionReference:lg,FieldPath:class gg{constructor(...e){this._delegate=new Cd(...e)}static documentId(){return new gg(jr.keyField().canonicalString())}isEqual(e){return(e=m(e))instanceof Cd&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class mg{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Kd("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new mg(e)}static delete(){const e=new qd("deleteField");return e._methodName="FieldValue.delete",new mg(e)}static arrayUnion(...e){const t=function(...e){return new Gd("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new mg(t)}static arrayRemove(...e){const t=function(...e){return new jd("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new mg(t)}static increment(e){const t=new $d("increment",e);return t._methodName="FieldValue.increment",new mg(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,pr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};yd=t.default,vd=(e,t)=>new Yf(e,t,new Xf),yd.INTERNAL.registerComponent(new p("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return vd(t,n)},"PUBLIC").setServiceProps(Object.assign({},fg))),yd.registerVersion("@firebase/firestore-compat","0.3.4")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore-compat.js.map
