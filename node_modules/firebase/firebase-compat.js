!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";const t={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},f=function(e,t){if(!e)throw u(t)},u=function(e){return new Error("Firebase Database ("+t.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},n=function(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let u=0;u<n.length;u+=3){var s=n[u],a=u+1<n.length,o=a?n[u+1]:0,c=u+2<n.length,l=c?n[u+2]:0;let e=(15&o)<<2|l>>6,t=63&l;c||(t=64,a||(e=64)),i.push(r[s>>2],r[(3&s)<<4|o>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let c=0;c<e.length;){var i=n[e.charAt(c++)],s=c<e.length?n[e.charAt(c)]:0;++c;var a=c<e.length?n[e.charAt(c)]:64;++c;var o=c<e.length?n[e.charAt(c)]:64;if(++c,null==i||null==s||null==a||null==o)throw new l;r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}function i(e){var t=n(e);return r.encodeByteArray(t,!0)}const s=function(e){return i(e).replace(/\./g,"")},a=function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=c(e[r],t[r]));return e}function o(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const e=()=>o().__FIREBASE_DEFAULTS__,h=()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}},d=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&a(e[1]);return t&&JSON.parse(t)}},p=()=>{try{return e()||h()||d()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},g=()=>{var e;return null===(e=p())||void 0===e?void 0:e.config};var m,v;class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function _(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(i)),""].join(".")}function w(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(w())}function I(){var e=null===(e=p())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function T(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function E(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function k(){const e=w();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function C(){return!0===t.NODE_ADMIN}function S(){try{return"object"==typeof indexedDB}catch(e){return!1}}function N(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}function A(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class R extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,D.prototype.create)}}class D{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(x,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new R(i,s,n)}}const x=/\{\$([^}]+)}/g;function P(e){return JSON.parse(e)}function O(e){return JSON.stringify(e)}function M(e){let t={},n={},r={},i="";try{var s=e.split(".");t=P(a(s[0])||""),n=P(a(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function F(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function U(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function q(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function V(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return;var i=e[a],s=t[a];if(B(i)&&B(s)){if(!V(i,s))return}else if(i!==s)return}for(const o of r)if(!n.includes(o))return;return 1}function B(e){return null!==e&&"object"==typeof e}function j(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function K(e){const r={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t,n;e&&([t,n]=e.split("="),r[decodeURIComponent(t)]=decodeURIComponent(n))}),r}function $(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class z{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,r){r=r||0;const i=this.W_;if("string"==typeof n)for(let e=0;e<16;e++)i[e]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3),r+=4;else for(let t=0;t<16;t++)i[t]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],a=this.chain_[2],o=this.chain_[3],c=this.chain_[4],l,u;for(let p=0;p<80;p++){u=p<40?p<20?(l=o^s&(a^o),1518500249):(l=s^a^o,1859775393):p<60?(l=s&a|o&(s|a),2400959708):(l=s^a^o,3395469782);var h=(t<<5|t>>>27)+l+c+u+i[p]&4294967295;c=o,o=a,a=4294967295&(s<<30|s>>>2),s=t,t=h}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;56<=r;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function W(e,t){const n=new G(e,t);return n.subscribe.bind(n)}class G{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=H),void 0===r.error&&(r.error=H),void 0===r.complete&&(r.complete=H);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function H(){}function Q(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i){var s=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(s)}}function Y(e,t){return`${e} failed: ${t} argument `}function X(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Y(e,t)+"must be a valid function.")}function J(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Y(e,t)+"must be a valid context object.")}function Z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}const ee=function(e){let t=0;for(let r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:55296<=n&&n<=56319?(t+=4,r++):t+=3}return t},te=1e3,ne=2,re=144e5,ie=.5;function se(e,t=te,n=ne){var r=t*Math.pow(n,e),i=Math.round(ie*r*(Math.random()-.5)*2);return Math.min(re,r+i)}function ae(e){return e&&e._delegate?e._delegate:e}class oe{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ce="[DEFAULT]";class le{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new y;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(n=null==e?void 0:e.optional)&&void 0!==n&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ce})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=ce){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ce){return this.instances.has(e)}getOptions(e=ce){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){var n=this.normalizeInstanceIdentifier(t);const r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);var i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ce?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=ce){return!this.component||this.component.multipleInstances?e:ce}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ue{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new le(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const he=[];(Wn=m=m||{})[Wn.DEBUG=0]="DEBUG",Wn[Wn.VERBOSE=1]="VERBOSE",Wn[Wn.INFO=2]="INFO",Wn[Wn.WARN=3]="WARN",Wn[Wn.ERROR=4]="ERROR",Wn[Wn.SILENT=5]="SILENT";const de={debug:m.DEBUG,verbose:m.VERBOSE,info:m.INFO,warn:m.WARN,error:m.ERROR,silent:m.SILENT},pe=m.INFO,fe={[m.DEBUG]:"log",[m.VERBOSE]:"log",[m.INFO]:"info",[m.WARN]:"warn",[m.ERROR]:"error"},ge=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=fe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class me{constructor(e){this.name=e,this._logLevel=pe,this._logHandler=ge,this._userLogHandler=null,he.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in m))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?de[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,m.DEBUG,...e),this._logHandler(this,m.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,m.VERBOSE,...e),this._logHandler(this,m.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,m.INFO,...e),this._logHandler(this,m.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,m.WARN,...e),this._logHandler(this,m.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,m.ERROR,...e),this._logHandler(this,m.ERROR,...e)}}const ve=(t,e)=>e.some(e=>t instanceof e);let ye,_e;const we=new WeakMap,be=new WeakMap,Ie=new WeakMap,Te=new WeakMap,Ee=new WeakMap;let ke={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return be.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ie.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ne(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function Ce(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(_e=_e||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...e){return r.apply(Ae(this),e),Ne(we.get(this))}:function(...e){return Ne(r.apply(Ae(this),e))}:function(e,...t){var n=r.call(Ae(this),e,...t);return Ie.set(n,e.sort?e.sort():[e]),Ne(n)}}function Se(e){return"function"==typeof e?Ce(e):(e instanceof IDBTransaction&&(s=e,be.has(s)||(t=new Promise((e,t)=>{const n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",i),s.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",i),s.addEventListener("abort",i)}),be.set(s,t))),ve(e,ye=ye||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,ke):e);var s,t}function Ne(e){if(e instanceof IDBRequest)return function(s){const e=new Promise((e,t)=>{const n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",i)},r=()=>{e(Ne(s.result)),n()},i=()=>{t(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&we.set(e,s)}).catch(()=>{}),Ee.set(e,s),e}(e);if(Te.has(e))return Te.get(e);var t=Se(e);return t!==e&&(Te.set(e,t),Ee.set(t,e)),t}const Ae=e=>Ee.get(e);function Re(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=Ne(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Ne(a.result),e.oldVersion,e.newVersion,Ne(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}function De(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),Ne(n).then(()=>{})}const xe=["get","getKey","getAll","getAllKeys","count"],Pe=["put","add","delete","clear"],Oe=new Map;function Me(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(Oe.get(t))return Oe.get(t);const i=t.replace(/FromIndex$/,""),s=t!==i,a=Pe.includes(i);if(i in(s?IDBIndex:IDBObjectStore).prototype&&(a||xe.includes(i))){var n=async function(e,...t){var n=this.transaction(e,a?"readwrite":"readonly");let r=n.store;return s&&(r=r.index(t.shift())),(await Promise.all([r[i](...t),a&&n.done]))[0]};return Oe.set(t,n),n}}}ke={...v=ke,get:(e,t,n)=>Me(e,t)||v.get(e,t,n),has:(e,t)=>!!Me(e,t)||v.has(e,t)};class Le{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,t=e.getImmediate();return`${t.library}/${t.version}`}).filter(e=>e).join(" ")}}const Fe="@firebase/app",Ue=new me("@firebase/app");var qe;const Ve="[DEFAULT]",Be={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},je=new Map,Ke=new Map;function $e(t,n){try{t.container.addComponent(n)}catch(e){Ue.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function ze(e,t){e.container.addOrOverwriteComponent(t)}function We(e){var t=e.name;if(Ke.has(t))return Ue.debug(`There were multiple attempts to register component ${t}.`),!1;Ke.set(t,e);for(const n of je.values())$e(n,e);return!0}function Ge(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const He=new D("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Qe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new oe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw He.create("app-deleted",{appName:this._name})}}const Ye="9.17.2";function Xe(e,t={}){let n=e;if("object"!=typeof t){const i=t;t={name:i}}var r=Object.assign({name:Ve,automaticDataCollectionEnabled:!1},t);const i=r.name;if("string"!=typeof i||!i)throw He.create("bad-app-name",{appName:String(i)});if(n=n||g(),!n)throw He.create("no-options");var s=je.get(i);if(s){if(V(n,s.options)&&V(r,s.config))return s;throw He.create("duplicate-app",{appName:i})}const a=new ue(i);for(const o of Ke.values())a.addComponent(o);r=new Qe(n,r,a);return je.set(i,r),r}function Je(e=Ve){var t=je.get(e);if(!t&&e===Ve)return Xe();if(!t)throw He.create("no-app",{appName:e});return t}async function Ze(e){var t=e.name;je.has(t)&&(je.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function et(e,t,n){let r=null!==(s=Be[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);var i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${t}":`];return i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ue.warn(a.join(" "))}We(new oe(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function tt(e,t){if(null!==e&&"function"!=typeof e)throw He.create("invalid-log-argument");!function(s,e){for(const t of he){let i=null;e&&e.level&&(i=de[e.level]),t.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:m[t].toLowerCase(),message:r,args:n,type:e.name})}}}(e,t)}function nt(e){var t;t=e,he.forEach(e=>{e.setLogLevel(t)})}const rt="firebase-heartbeat-database",it=1,st="firebase-heartbeat-store";let at=null;function ot(){return at=at||Re(rt,it,{upgrade:(e,t)=>{0===t&&e.createObjectStore(st)}}).catch(e=>{throw He.create("idb-open",{originalErrorMessage:e.message})}),at}async function ct(e,t){try{const r=await ot(),i=r.transaction(st,"readwrite"),s=i.objectStore(st);return await s.put(t,lt(e)),i.done}catch(e){var n;e instanceof R?Ue.warn(e.message):(n=He.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),Ue.warn(n.message))}}function lt(e){return`${e.name}!${e.options.appId}`}class ut{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new dt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate();var t=e.getPlatformInfoString();const n=ht();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";var e=ht(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const s=n.find(e=>e.agent===i.agent);if(s){if(s.dates.push(i.date),pt(n)>t){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),pt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),t=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function ht(){const e=new Date;return e.toISOString().substring(0,10)}class dt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!S()&&N().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{const n=await ot();return n.transaction(st).objectStore(st).get(lt(e))}catch(e){var t;e instanceof R?Ue.warn(e.message):(t=He.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),Ue.warn(t.message))}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return ct(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return ct(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function pt(e){return s(JSON.stringify({version:2,heartbeats:e})).length}qe="",We(new oe("platform-logger",e=>new Le(e),"PRIVATE")),We(new oe("heartbeat",e=>new ut(e),"PRIVATE")),et(Fe,"0.9.4",qe),et(Fe,"0.9.4","esm2017"),et("fire-js","");var ft=Object.freeze({__proto__:null,SDK_VERSION:Ye,_DEFAULT_ENTRY_NAME:Ve,_addComponent:$e,_addOrOverwriteComponent:ze,_apps:je,_clearComponents:function(){Ke.clear()},_components:Ke,_getProvider:Ge,_registerComponent:We,_removeServiceInstance:function(e,t,n=Ve){Ge(e,t).clearInstance(n)},deleteApp:Ze,getApp:Je,getApps:function(){return Array.from(je.values())},initializeApp:Xe,onLog:tt,registerVersion:et,setLogLevel:nt,FirebaseError:R});class gt{constructor(e,t){this._delegate=e,this.firebase=t,$e(e,new oe("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Ze(this._delegate)))}_getService(e,t=Ve){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Ve){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){$e(this._delegate,e)}_addOrOverwriteComponent(e){ze(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const mt=new D("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function vt(i){const s={},a={__esModule:!0,initializeApp:function(e,t={}){var n=Xe(e,t);if(L(s,n.name))return s[n.name];var r=new i(n,a);return s[n.name]=r},app:o,registerVersion:et,setLogLevel:nt,onLog:tt,apps:null,SDK_VERSION:Ye,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;We(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw mt.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&c(e,n.serviceProps),a[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?a[t]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var n=t;return n},modularAPIs:ft}};function o(e){if(e=e||Ve,!L(s,e))throw mt.create("no-app",{appName:e});return s[e]}return a.default=a,Object.defineProperty(a,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),o.App=i,a}var yt=function e(){const t=vt(gt);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){c(t,e)},createSubscribe:W,ErrorFactory:D,deepExtend:c}),t}();const _t=new me("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){_t.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const sO=self.firebase.SDK_VERSION;sO&&0<=sO.indexOf("LITE")&&_t.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const wt=yt;et("@firebase/app-compat","0.2.4",void 0);wt.registerVersion("firebase","9.17.2","app-compat");var bt="@firebase/installations",It="0.6.4";const Tt=1e4,Et="w:0.6.4",kt="FIS_v2",Ct="https://firebaseinstallations.googleapis.com/v1",St=36e5;const Nt=new D("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function At(e){return e instanceof R&&e.code.includes("request-failed")}function Rt({projectId:e}){return`${Ct}/projects/${e}/installations`}function Dt(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function xt(e,t){var n=(await t.json()).error;return Nt.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Pt({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Ot(e,{refreshToken:t}){const n=Pt(e);return n.append("Authorization",(t=t,`${kt} ${t}`)),n}async function Mt(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Lt(t){return new Promise(e=>{setTimeout(e,t)})}const Ft=/^[cdef][\w-]{21}$/,Ut="";function qt(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return Ft.test(e)?e:Ut}catch(e){return Ut}}function Vt(e){return`${e.appName}!${e.appId}`}const Bt=new Map;function jt(e,t){var n=Vt(e);Kt(n,t),function(e,t){const n=function(){!$t&&"BroadcastChannel"in self&&($t=new BroadcastChannel("[Firebase] FID Change"),$t.onmessage=e=>{Kt(e.data.key,e.data.fid)});return $t}();n&&n.postMessage({key:e,fid:t});0===Bt.size&&$t&&($t.close(),$t=null)}(n,t)}function Kt(e,t){var n=Bt.get(e);if(n)for(const r of n)r(t)}let $t=null;const zt="firebase-installations-store";let Wt=null;function Gt(){return Wt=Wt||Re("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(zt)}}),Wt}async function Ht(e,t){var n=Vt(e);const r=await Gt(),i=r.transaction(zt,"readwrite"),s=i.objectStore(zt);var a=await s.get(n);return await s.put(t,n),await i.done,a&&a.fid===t.fid||jt(e,t.fid),t}async function Qt(e){var t=Vt(e);const n=await Gt(),r=n.transaction(zt,"readwrite");await r.objectStore(zt).delete(t),await r.done}async function Yt(e,t){var n=Vt(e);const r=await Gt(),i=r.transaction(zt,"readwrite"),s=i.objectStore(zt);var a=await s.get(n),o=t(a);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||a&&a.fid===o.fid||jt(e,o.fid),o}async function Xt(n){let r;var e=await Yt(n.appConfig,e=>{var t=Zt(e||{fid:qt(),registrationStatus:0}),t=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await Jt(e.appConfig);for(;1===t.registrationStatus;)await Lt(100),t=await Jt(e.appConfig);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await Xt(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(Nt.create("app-offline"));return{installationEntry:t,registrationPromise:n}}var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(t,n){try{var e=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Rt(e),i=Pt(e),s=t.getImmediate({optional:!0});!s||(a=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",a);var a={fid:n,authVersion:kt,appId:e.appId,sdkVersion:Et};const o={method:"POST",headers:i,body:JSON.stringify(a)},c=await Mt(()=>fetch(r,o));if(c.ok){a=await c.json();return{fid:a.fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:Dt(a.authToken)}}throw await xt("Create Installation",c)}(t,n);return Ht(t.appConfig,e)}catch(e){throw At(e)&&409===e.customData.serverCode?await Qt(t.appConfig):await Ht(t.appConfig,{fid:n.fid,registrationStatus:0}),e}}(e,r);return{installationEntry:r,registrationPromise:n}}}(n,t);return r=t.registrationPromise,t.installationEntry});return e.fid===Ut?{installationEntry:await r}:{installationEntry:e,registrationPromise:r}}function Jt(e){return Yt(e,e=>{if(!e)throw Nt.create("installation-not-found");return Zt(e)})}function Zt(e){return 1===(t=e).registrationStatus&&t.registrationTime+Tt<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function en({appConfig:e,heartbeatServiceProvider:t},n){const r=([i,s]=[e,n["fid"]],`${Rt(i)}/${s}/authTokens:generate`);var i,s;const a=Ot(e,n),o=t.getImmediate({optional:!0});!o||(c=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",c);var c={installation:{sdkVersion:Et,appId:e.appId}};const l={method:"POST",headers:a,body:JSON.stringify(c)},u=await Mt(()=>fetch(r,l));if(u.ok)return Dt(await u.json());throw await xt("Generate Auth Token",u)}async function tn(r,i=!1){let s;var e=await Yt(r.appConfig,e=>{if(!rn(e))throw Nt.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+St}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await nn(e.appConfig);for(;1===n.authToken.requestStatus;)await Lt(100),n=await nn(e.appConfig);var r=n.authToken;return 0===r.requestStatus?tn(e,t):r}(r,i),e;if(!navigator.onLine)throw Nt.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var r=await en(t,n),e=Object.assign(Object.assign({},n),{authToken:r});return await Ht(t.appConfig,e),r}catch(e){throw!At(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(r=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await Ht(t.appConfig,r)):await Qt(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function nn(e){return Yt(e,e=>{if(!rn(e))throw Nt.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+Tt<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function rn(e){return void 0!==e&&2===e.registrationStatus}async function sn(e,t=!1){var n,r=e;return await((n=(await Xt(r)).registrationPromise)&&await n),(await tn(r,t)).token}function an(e){return Nt.create("missing-app-config-values",{valueName:e})}const on="installations",cn=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw an("App Configuration");if(!e.name)throw an("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw an(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:Ge(t,"heartbeat"),_delete:()=>Promise.resolve()}},ln=e=>{const t=Ge(e.getProvider("app").getImmediate(),on).getImmediate();return{getId:()=>async function(e){var t=e;const{installationEntry:n,registrationPromise:r}=await Xt(t);return(r||tn(t)).catch(console.error),n.fid}(t),getToken:e=>sn(t,e)}};We(new oe(on,cn,"PUBLIC")),We(new oe("installations-internal",ln,"PRIVATE")),et(bt,It),et(bt,It,"esm2017");const un="analytics",hn="firebase_id",dn="origin",pn="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",fn="https://www.googletagmanager.com/gtag/js",gn=new me("@firebase/analytics");function mn(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function vn(r,i,s,a){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await mn(r);for(const l of e){var a=c.find(e=>e.measurementId===l),o=a&&n[a.appId];if(!o){t=[];break}t.push(o)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){gn.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){var a=r[i];try{if(a)await t[a];else{const c=await mn(n);var o=c.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){gn.error(e)}e("config",i,s)}(r,i,s,a,t,n):"consent"===e?r("consent","update",n):r("set",t)}catch(e){gn.error(e)}}}const yn=new D("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),_n=30;const wn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function bn(e){var t,{appId:n,apiKey:r}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},n=pn.replace("{app-id}",n);const i=await fetch(n,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!==(t=s.error)&&void 0!==t&&t.message&&(e=s.error.message)}catch(e){}throw yn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}async function In(e,t=wn,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw yn.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw yn.create("no-api-key")}var a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new kn;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=wn){var a;const{appId:o,measurementId:c}=n;try{await Tn(i,e)}catch(e){if(c)return gn.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:c};throw e}try{const l=await bn(n);return s.deleteThrottleMetadata(o),l}catch(e){const u=e;if(!En(u)){if(s.deleteThrottleMetadata(o),c)return gn.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null===u||void 0===u?void 0:u.message}]`),{appId:o,measurementId:c};throw e}const h=503===Number(null===(a=null===u||void 0===u?void 0:u.customData)||void 0===a?void 0:a.httpStatus)?se(r,s.intervalMillis,_n):se(r,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:r+1};return s.setThrottleMetadata(o,d),gn.debug(`Calling attemptFetch again in ${h} millis`),t(n,d,i,s)}}({appId:r,apiKey:i,measurementId:s},a,o,t)}function Tn(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(yn.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function En(e){if(!(e instanceof R&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class kn{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Cn(t,e,n,r,i,s,a){const o=In(t);o.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&gn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>gn.error(e)),e.push(o);var c=async function(){if(!S())return gn.warn(yn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await N()}catch(e){return gn.warn(yn.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[l,u]=await Promise.all([o,c]);!function(e){var t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(fn)&&n.src.includes(e))return n}(s)&&function(e,t){const n=document.createElement("script");n.src=`${fn}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,l.measurementId),i("js",new Date);const h=null!==(c=null==a?void 0:a.config)&&void 0!==c?c:{};return h[dn]="firebase",h.update=!0,null!=u&&(h[hn]=u),i("config",l.measurementId,h),l.measurementId}class Sn{constructor(e){this.app=e}_delete(){return delete Nn[this.app.options.appId],Promise.resolve()}}let Nn={},An=[];const Rn={};let Dn="dataLayer",xn="gtag",Pn,On,Mn=!1;function Ln(e){if(Mn)throw yn.create("already-initialized");e.dataLayerName&&(Dn=e.dataLayerName),e.gtagName&&(xn=e.gtagName)}function Fn(e,t,n){!function(){const e=[];var t;T()&&e.push("This is a browser extension environment."),A()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=yn.create("invalid-analytics-context",{errorInfo:t}),gn.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw yn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw yn.create("no-api-key");gn.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Nn[s])throw yn.create("already-exists",{id:s});return Mn||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(Dn),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=vn(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Nn,An,Rn,Dn,xn),On=r,Pn=i,Mn=!0),Nn[s]=Cn(e,An,Rn,t,Pn,Dn,n),new Sn(e)}async function Un(){if(T())return!1;if(!A())return!1;if(!S())return!1;try{return await N()}catch(e){return!1}}function qn(e,t,n){e=ae(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(On,Nn[e.app.options.appId],t,n).catch(e=>gn.error(e))}function Vn(e,t,n){e=ae(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(On,Nn[e.app.options.appId],t,n).catch(e=>gn.error(e))}function Bn(e,t,n){e=ae(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(On,Nn[e.app.options.appId],t,n).catch(e=>gn.error(e))}function jn(e,t){e=ae(e),async function(e,t){var n=await e;window[`ga-disable-${n}`]=!t}(Nn[e.app.options.appId],t).catch(e=>gn.error(e))}function Kn(e,t,n,r){e=ae(e),async function(e,t,n,r,i){var s;i&&i.global?e("event",n,r):(s=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:s})))}(On,Nn[e.app.options.appId],t,n,r).catch(e=>gn.error(e))}const $n="@firebase/analytics";We(new oe(un,(e,{options:t})=>{return Fn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),We(new oe("analytics-internal",function(e){try{const r=e.getProvider(un).getImmediate();return{logEvent:(e,t,n)=>Kn(r,e,t,n)}}catch(e){throw yn.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),et($n,"0.9.4"),et($n,"0.9.4","esm2017");var zn,Wn,Gn;class Hn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Kn(this._delegate,e,t,n)}setCurrentScreen(e,t){qn(this._delegate,e,t)}setUserId(e,t){Vn(this._delegate,e,t)}setUserProperties(e,t){Bn(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){jn(this._delegate,e)}}(Wn=zn=zn||{}).ADD_SHIPPING_INFO="add_shipping_info",Wn.ADD_PAYMENT_INFO="add_payment_info",Wn.ADD_TO_CART="add_to_cart",Wn.ADD_TO_WISHLIST="add_to_wishlist",Wn.BEGIN_CHECKOUT="begin_checkout",Wn.CHECKOUT_PROGRESS="checkout_progress",Wn.EXCEPTION="exception",Wn.GENERATE_LEAD="generate_lead",Wn.LOGIN="login",Wn.PAGE_VIEW="page_view",Wn.PURCHASE="purchase",Wn.REFUND="refund",Wn.REMOVE_FROM_CART="remove_from_cart",Wn.SCREEN_VIEW="screen_view",Wn.SEARCH="search",Wn.SELECT_CONTENT="select_content",Wn.SELECT_ITEM="select_item",Wn.SELECT_PROMOTION="select_promotion",Wn.SET_CHECKOUT_OPTION="set_checkout_option",Wn.SHARE="share",Wn.SIGN_UP="sign_up",Wn.TIMING_COMPLETE="timing_complete",Wn.VIEW_CART="view_cart",Wn.VIEW_ITEM="view_item",Wn.VIEW_ITEM_LIST="view_item_list",Wn.VIEW_PROMOTION="view_promotion",Wn.VIEW_SEARCH_RESULTS="view_search_results";const Qn=e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new Hn(t,n)};Gn={Analytics:Hn,settings:Ln,isSupported:Un,EventName:zn},wt.INTERNAL.registerComponent(new oe("analytics-compat",Qn,"PUBLIC").setServiceProps(Gn).setMultipleInstances(!0)),wt.registerVersion("@firebase/analytics-compat","0.2.4");const Yn=new Map,Xn={activated:!1,tokenObservers:[]},Jn={initialized:!1,enabled:!1};function Zn(e){return Yn.get(e)||Object.assign({},Xn)}const er="https://content-firebaseappcheck.googleapis.com/v1",tr="exchangeDebugToken",nr={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class rr{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new y,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new y,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}const ir=new D("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function sr(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function ar(e){if(!Zn(e).activated)throw ir.create("use-before-activation",{appName:e.name})}function or(e){var t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),t=t-3600*n*24-3600*r-60*i;let s="";return n&&(s+=cr(n)+"d:"),r&&(s+=cr(r)+"h:"),s+=cr(i)+"m:"+cr(t)+"s",s}function cr(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function lr({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});!i||(c=await i.getHeartbeatsHeader())&&(r["X-Firebase-Client"]=c);var s={method:"POST",body:JSON.stringify(t),headers:r};let a;try{a=await fetch(e,s)}catch(e){throw ir.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==a.status)throw ir.create("fetch-status-error",{httpStatus:a.status});let o;try{o=await a.json()}catch(e){throw ir.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}var c=o.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw ir.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});s=1e3*Number(c[1]),c=Date.now();return{token:o.token,expireTimeMillis:c+s,issuedAtTimeMillis:c}}const ur="firebase-app-check-database",hr=1,dr="firebase-app-check-store",pr="debug-token";let fr=null;function gr(){return fr||(fr=new Promise((t,n)=>{try{const e=indexedDB.open(ur,hr);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;n(ir.create("storage-open",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(dr,{keyPath:"compositeKey"})}}catch(e){n(ir.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}),fr)}async function mr(e,t){const n=await gr(),r=n.transaction(dr,"readwrite"),i=r.objectStore(dr),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{var t;n(ir.create("storage-set",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}async function vr(e){const t=await gr(),i=t.transaction(dr,"readonly"),n=i.objectStore(dr),s=n.get(e);return new Promise((n,r)=>{s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)},i.onerror=e=>{var t;r(ir.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}function yr(e){return`${e.options.appId}-${e.name}`}const _r=new me("@firebase/app-check");async function wr(t){if(S()){let e=void 0;try{e=await vr(yr(t))}catch(e){_r.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function br(e,t){return S()?mr(yr(e),t).catch(e=>{_r.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function Ir(){let e=void 0;try{e=await vr(pr)}catch(e){}if(e)return e;var t,n=Z();return t=n,mr(pr,t).catch(e=>_r.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),n}function Tr(){return Jn.enabled}async function Er(){var e=Jn;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}const kr={error:"UNKNOWN_ERROR"};async function Cr(e,t=!1){var n=e.app;ar(n);const r=Zn(n);let i=r.token,s=void 0;if(i&&!Dr(i)&&(r.token=void 0,i=void 0),i||(o=await r.cachedTokenPromise)&&(Dr(o)?i=o:await br(n,void 0)),!t&&i&&Dr(i))return{token:i.token};let a=!1;if(Tr()){r.exchangeTokenPromise||(r.exchangeTokenPromise=lr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${er}/projects/${n}/apps/${r}:${tr}?key=${i}`,body:{debug_token:t}}}(n,await Er()),e.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);var o=await r.exchangeTokenPromise;return await br(n,o),{token:(r.token=o).token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),i=await Zn(n).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?_r.warn(e.message):_r.error(e),s=e}let c;return i?s?c=Dr(i)?{token:i.token,internalError:s}:xr(s):(c={token:i.token},r.token=i,await br(n,i)):c=xr(s),a&&Rr(n,c),c}function Sr(e,t,n,r){var i=e["app"];const s=Zn(i);i={next:n,error:r,type:t};if(s.tokenObservers=[...s.tokenObservers,i],s.token&&Dr(s.token)){const a=s.token;Promise.resolve().then(()=>{n({token:a.token}),Ar(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Ar(e))}function Nr(e,t){const n=Zn(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=r}function Ar(e){var t=e["app"];const n=Zn(t);let r=n.tokenRefresher;r||(r=function(n){const r=n["app"];return new rr(async()=>{var e=Zn(r);let t;if(t=e.token?await Cr(n,!0):await Cr(n),t.error)throw t.error;if(t.internalError)throw t.internalError},()=>!0,()=>{var e=Zn(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},nr.RETRIAL_MIN_WAIT,nr.RETRIAL_MAX_WAIT)}(e),n.tokenRefresher=r),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function Rr(e,t){for(const n of Zn(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Dr(e){return 0<e.expireTimeMillis-Date.now()}function xr(e){return{token:(t=kr,r.encodeString(JSON.stringify(t),!1)),error:e};var t}class Pr{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){var e=Zn(this.app)["tokenObservers"];for(const t of e)Nr(this.app,t.next);return Promise.resolve()}}const Or="https://www.google.com/recaptcha/api.js",Mr="https://www.google.com/recaptcha/enterprise.js";function Lr(t,n){const r=new y,e=Zn(t);e.reCAPTCHAState={initialized:r};const i=qr(t);var s=sr(!1);return s?Ur(t,n,s,i,r):function(e){const t=document.createElement("script");t.src=Or,t.onload=e,document.head.appendChild(t)}(()=>{var e=sr(!1);if(!e)throw new Error("no recaptcha");Ur(t,n,e,i,r)}),r.promise}function Fr(t,n){const r=new y,e=Zn(t);e.reCAPTCHAState={initialized:r};const i=qr(t);var s=sr(!0);return s?Ur(t,n,s,i,r):function(e){const t=document.createElement("script");t.src=Mr,t.onload=e,document.head.appendChild(t)}(()=>{var e=sr(!0);if(!e)throw new Error("no recaptcha");Ur(t,n,e,i,r)}),r.promise}function Ur(e,t,n,r,i){n.ready(()=>{!function(e,t,n,r){const i=n.render(r,{sitekey:t,size:"invisible"}),s=Zn(e);s.reCAPTCHAState=Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:i})}(e,t,n,r),i.resolve(n)})}function qr(e){var t=`fire_app_check_${e.name}`;const n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function Vr(r){ar(r);const i=await Zn(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=Zn(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class Br{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){zr(this._throttleData);var t=await Vr(this._app).catch(e=>{throw ir.create("recaptcha-error")});let e;try{e=await lr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${er}/projects/${n}/apps/${r}:exchangeRecaptchaV3Token?key=${i}`,body:{recaptcha_v3_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=$r(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ir.create("throttled",{time:or(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Ge(e,"heartbeat"),Lr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Br&&this._siteKey===e._siteKey}}class jr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){zr(this._throttleData);var t=await Vr(this._app).catch(e=>{throw ir.create("recaptcha-error")});let e;try{e=await lr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${er}/projects/${n}/apps/${r}:exchangeRecaptchaEnterpriseToken?key=${i}`,body:{recaptcha_enterprise_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=$r(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ir.create("throttled",{time:or(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Ge(e,"heartbeat"),Fr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof jr&&this._siteKey===e._siteKey}}class Kr{constructor(e){this._customProviderOptions=e}async getToken(){var e=await this._customProviderOptions.getToken(),t=function(e){const t=M(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof Kr&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function $r(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var n=t?t.backoffCount:0,r=se(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}function zr(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw ir.create("throttled",{time:or(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Wr(e=Je(),t){const n=Ge(e=ae(e),"app-check");if(Jn.initialized||function(){var e=o();const t=Jn;if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const n=new y;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(Ir())}}(),Tr()&&Er().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw ir.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=function(e,t){return Yn.set(e,t),Yn.get(e)}(t,Object.assign({},Xn));r.activated=!0,r.provider=e,r.cachedTokenPromise=wr(t).then(e=>(e&&Dr(e)&&(r.token=e,Rr(t,{token:e.token})),e)),r.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,r.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),Zn(e).isTokenAutoRefreshEnabled&&Sr(r,"INTERNAL",()=>{}),r}const Gr="app-check-internal";We(new oe("app-check",e=>{var t,n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat");return t=n,e=r,new Pr(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(Gr).initialize()})),We(new oe(Gr,e=>{var t,n=e.getProvider("app-check").getImmediate();return t=n,{getToken:e=>Cr(t,e),addTokenListener:e=>Sr(t,"INTERNAL",e),removeTokenListener:e=>Nr(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),et("@firebase/app-check","0.6.4");const Hr=new D("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class Qr{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new Br(e):e instanceof jr||e instanceof Br||e instanceof Kr?e:new Kr({getToken:e.getToken}),this._delegate=Wr(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Hr.create("use-before-activation",{appName:this.app.name});!function(e,t){const n=Zn(e.app);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),n.isTokenAutoRefreshEnabled=t}(this._delegate,e)}getToken(e){if(!this._delegate)throw Hr.create("use-before-activation",{appName:this.app.name});return async function(e,t){var n=await Cr(e,t);if(n.error)throw n.error;return{token:n.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw Hr.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),Sr(e,"EXTERNAL",r,i),()=>Nr(e.app,r)}(this._delegate,e,t)}}const Yr=e=>{var t=e.getProvider("app-compat").getImmediate();return new Qr(t)};function Xr(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}wt.INTERNAL.registerComponent(new oe("appCheck-compat",Yr,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:jr,ReCaptchaV3Provider:Br,CustomProvider:Kr})),wt.registerVersion("@firebase/app-check-compat","0.3.4");const Jr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Zr={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function ei(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function ti(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const ni=ei,ri=new D("auth","Firebase",ei()),ii=new me("@firebase/auth");function si(e,...t){ii.logLevel<=m.ERROR&&ii.error(`Auth (${Ye}): ${e}`,...t)}function ai(e,...t){throw ui(e,...t)}function oi(e,...t){return ui(e,...t)}function ci(e,t,n){var r=Object.assign(Object.assign({},ni()),{[t]:n});const i=new D("auth","Firebase",r);return i.create(t,{appName:e.name})}function li(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&ai(e,"argument-error"),ci(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function ui(e,...t){if("string"==typeof e)return ri.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function hi(e,t,...n){if(!e)throw ui(t,...n)}function di(e){var t="INTERNAL ASSERTION FAILED: "+e;throw si(t),new Error(t)}function pi(e,t){e||di(t)}const fi=new Map;function gi(e){pi(e instanceof Function,"Expected a class definition");let t=fi.get(e);return t?pi(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,fi.set(e,t)),t}function mi(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function vi(){return"http:"===yi()||"https:"===yi()}function yi(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class _i{constructor(e,t){pi((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=b()||E()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(vi()||T()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function wi(e,t){pi(e.emulator,"Emulator should always be set here");var n=e.emulator["url"];return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class bi{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void di("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void di("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void di("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const Ii={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Ti=new _i(3e4,6e4);function Ei(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function ki(i,s,a,o,e={}){return Ci(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var n=j(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),bi.fetch()(Ni(i,i.config.apiHost,a,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function Ci(t,e,n){t._canInitEmulator=!1;var r=Object.assign(Object.assign({},Ii),e);try{const a=new Ai(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();var i=await o.json();if("needConfirmation"in i)throw Ri(t,"account-exists-with-different-credential",i);if(o.ok&&!("errorMessage"in i))return i;{const c=o.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw Ri(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw Ri(t,"email-already-in-use",i);if("USER_DISABLED"===l)throw Ri(t,"user-disabled",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw ci(t,s,u);ai(t,s)}}catch(e){if(e instanceof R)throw e;ai(t,"internal-error",{message:String(e)})}}async function Si(e,t,n,r,i={}){var s=await ki(e,t,n,r,i);return"mfaPendingCredential"in s&&ai(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Ni(e,t,n,r){var i=`${t}${n}?${r}`;return e.config.emulator?wi(e.config,i):`${e.config.apiScheme}://${i}`}class Ai{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(oi(this.auth,"network-request-failed")),Ti.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ri(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=oi(e,t,r);return i.customData._tokenResponse=n,i}function Di(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function xi(e){return 1e3*Number(e)}function Pi(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return si("JWT malformed, contained fewer than 3 sections"),null;try{var i=a(n);return i?JSON.parse(i):(si("Failed to decode base64 JWT payload"),null)}catch(e){return si("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Oi(t,n,e=!1){if(e)return n;try{return n}catch(e){throw e instanceof R&&(n=[e["code"]][0],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class Mi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Li{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Di(this.lastLoginAt),this.creationTime=Di(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Fi(e){var t=e.auth,n=await e.getIdToken(),r=await Oi(e,async function(e,t){return ki(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));hi(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);var s,a,t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var t=e["providerId"],n=Xr(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],r=(s=e.providerData,a=t,[...s.filter(t=>!a.some(e=>e.providerId===t.providerId)),...a]),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!==r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Li(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class Ui{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){hi(e.idToken,"internal-error"),hi(void 0!==e.idToken,"internal-error"),hi(void 0!==e.refreshToken,"internal-error");var t,n,n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(t=e.idToken,hi(n=Pi(t),"internal-error"),hi(void 0!==n.exp,"internal-error"),hi(void 0!==n.iat,"internal-error"),Number(n.exp)-Number(n.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return hi(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var i,s,{accessToken:n,refreshToken:r,expiresIn:a}=(s=t,await{accessToken:(a=await Ci(i=e,{},async()=>{var e=j({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=Ni(i,t,"/v1/token",`key=${n}`);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",bi.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token});this.updateTokensAndExpiration(n,r,Number(a))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:i}=t;const s=new Ui;return n&&(hi("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(hi("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(hi("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ui,this.toJSON())}_performRefresh(){return di("not implemented")}}function qi(e,t){hi("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Vi{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Xr(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Mi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Li(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await Oi(this,this.stsTokenManager.getToken(this.auth,e));return hi(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=ae(e);var r=await n.getIdToken(t),i=Pi(r);hi(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");var s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Di(xi(i.auth_time)),issuedAtTime:Di(xi(i.iat)),expirationTime:Di(xi(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=ae(e);await Fi(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(hi(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Vi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){hi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Fi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await Oi(this,async function(e,t){return ki(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(a=t.displayName)&&void 0!==a?a:void 0,r=null!==(g=t.email)&&void 0!==g?g:void 0,i=null!==(o=t.phoneNumber)&&void 0!==o?o:void 0,s=null!==(l=t.photoURL)&&void 0!==l?l:void 0,a=null!==(c=t.tenantId)&&void 0!==c?c:void 0,o=null!==(g=t._redirectEventId)&&void 0!==g?g:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(g=t.lastLoginAt)&&void 0!==g?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;hi(u&&f,e,"internal-error");var g=Ui.fromJSON(this.name,f);hi("string"==typeof u,e,"internal-error"),qi(n,e.name),qi(r,e.name),hi("boolean"==typeof h,e,"internal-error"),hi("boolean"==typeof d,e,"internal-error"),qi(i,e.name),qi(s,e.name),qi(a,e.name),qi(o,e.name),qi(c,e.name),qi(l,e.name);const m=new Vi({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(m.providerData=p.map(e=>Object.assign({},e))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new Ui;r.updateFromServerResponse(t);var i=new Vi({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Fi(i),i}}class Bi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Bi.type="NONE";const ji=Bi;function Ki(e,t,n){return`firebase:${e}:${t}:${n}`}class $i{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:r,name:i}=this.auth;this.fullUserKey=Ki(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ki("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Vi._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new $i(gi(ji),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||gi(ji);const s=Ki(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{var o=await u._get(s);if(o){var c=Vi._fromJSON(e,o);u!==i&&(a=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new $i(i,e,n)}}function zi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Qi(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Wi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Xi(t))return"Blackberry";if(Ji(t))return"Webos";if(Gi(t))return"Safari";if((t.includes("chrome/")||Hi(t))&&!t.includes("edge/"))return"Chrome";if(Yi(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function Wi(e=w()){return/firefox\//i.test(e)}function Gi(e=w()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Hi(e=w()){return/crios\//i.test(e)}function Qi(e=w()){return/iemobile/i.test(e)}function Yi(e=w()){return/android/i.test(e)}function Xi(e=w()){return/blackberry/i.test(e)}function Ji(e=w()){return/webos/i.test(e)}function Zi(e=w()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function es(e=w()){return Zi(e)||Yi(e)||Ji(e)||Xi(e)||/windows phone/i.test(e)||Qi(e)}function ts(e,t=[]){let n;switch(e){case"Browser":n=zi(w());break;case"Worker":n=`${zi(w())}-${e}`;break;default:n=e}var r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ye}/${r}`}class ns{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class rs{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ss(this),this.idTokenSubscription=new ss(this),this.beforeStateQueue=new ns(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ri,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=gi(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await $i.create(this,t),!this._deleted)){if(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null===(e=this.currentUser)||void 0===e?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return hi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Fi(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?ae(e):null;return t&&hi(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&hi(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(gi(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new D("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(hi(t=e&&gi(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await $i.create(this,[gi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return hi(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return hi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ts(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return t&&(e["X-Firebase-Client"]=t),e}}function is(e){return ae(e)}class ss{constructor(e){this.auth=e,this.observer=null,this.addObserver=W(e=>this.observer=e)}get next(){return hi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function as(e,t,n){const r=is(e);hi(r._canInitEmulator,r,"emulator-config-failed"),hi(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!(null==n||!n.disableWarnings);const s=os(t);var{host:a,port:o}=function(e){const t=os(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:cs(r.substr(s.length+1))}}var[a,s]=r.split(":");return{host:a,port:cs(s)}}}(t);r.config.emulator={url:`${s}//${a}${null===o?"":`:${o}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function os(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function cs(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}class ls{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return di("not implemented")}_getIdTokenResponse(e){return di("not implemented")}_linkToIdToken(e,t){return di("not implemented")}_getReauthenticationResolver(e){return di("not implemented")}}async function us(e,t){return ki(e,"POST","/v1/accounts:resetPassword",Ei(e,t))}async function hs(e,t){return ki(e,"POST","/v1/accounts:update",t)}async function ds(e,t){return ki(e,"POST","/v1/accounts:sendOobCode",Ei(e,t))}class ps extends ls{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ps(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ps(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Si(e,"POST","/v1/accounts:signInWithPassword",Ei(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Si(e,"POST","/v1/accounts:signInWithEmailLink",Ei(e,t))}(e,{email:this._email,oobCode:this._password});default:ai(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return hs(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Si(e,"POST","/v1/accounts:signInWithEmailLink",Ei(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ai(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function fs(e,t){return Si(e,"POST","/v1/accounts:signInWithIdp",Ei(e,t))}class gs extends ls{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new gs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ai("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,t=Xr(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new gs(n,r);return i.idToken=t.idToken||void 0,i.accessToken=t.accessToken||void 0,i.secret=t.secret,i.nonce=t.nonce,i.pendingToken=t.pendingToken||null,i}_getIdTokenResponse(e){return fs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,fs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fs(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=j(t)}return e}}const ms={USER_NOT_FOUND:"user-not-found"};class vs extends ls{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new vs({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new vs({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Si(e,"POST","/v1/accounts:signInWithPhoneNumber",Ei(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){var n=await Si(e,"POST","/v1/accounts:signInWithPhoneNumber",Ei(e,t));if(n.temporaryProof)throw Ri(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Si(e,"POST","/v1/accounts:signInWithPhoneNumber",Ei(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ms)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||i?new vs({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ys{constructor(e){var t=K($(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(i=t.oobCode)&&void 0!==i?i:null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=t.mode)&&void 0!==i?i:null);hi(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(t=K($(e=e)).link,n=t?K($(t)).deep_link_id:null,((r=K($(e)).deep_link_id)?K($(r)).link:null)||r||n||t||e);try{return new ys(t)}catch(e){return null}}}class _s{constructor(){this.providerId=_s.PROVIDER_ID}static credential(e,t){return ps._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var n=ys.parseLink(t);return hi(n,"argument-error"),ps._fromEmailAndCode(e,n.code,n.tenantId)}}_s.PROVIDER_ID="password",_s.EMAIL_PASSWORD_SIGN_IN_METHOD="password",_s.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ws{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class bs extends ws{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Is extends bs{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return hi("providerId"in t&&"signInMethod"in t,"argument-error"),gs._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return hi(e.idToken||e.accessToken,"argument-error"),gs._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Is.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Is.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new Is(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Ts extends bs{constructor(){super("facebook.com")}static credential(e){return gs._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ts.credential(e.oauthAccessToken)}catch(e){return null}}}Ts.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ts.PROVIDER_ID="facebook.com";class Es extends bs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return gs._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Es.credential(t,n)}catch(e){return null}}}Es.GOOGLE_SIGN_IN_METHOD="google.com",Es.PROVIDER_ID="google.com";class ks extends bs{constructor(){super("github.com")}static credential(e){return gs._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ks.credential(e.oauthAccessToken)}catch(e){return null}}}ks.GITHUB_SIGN_IN_METHOD="github.com",ks.PROVIDER_ID="github.com";class Cs extends ls{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return fs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,fs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new Cs(t,r):null}static _create(e,t){return new Cs(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ss extends ws{constructor(e){hi(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Ss.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Ss.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=Cs.fromJSON(e);return hi(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Cs._create(n,t)}catch(e){return null}}}class Ns extends bs{constructor(){super("twitter.com")}static credential(e,t){return gs._fromParams({providerId:Ns.PROVIDER_ID,signInMethod:Ns.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ns.credentialFromTaggedObject(e)}static credentialFromError(e){return Ns.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ns.credential(t,n)}catch(e){return null}}}async function As(e,t){return Si(e,"POST","/v1/accounts:signUp",Ei(e,t))}Ns.TWITTER_SIGN_IN_METHOD="twitter.com",Ns.PROVIDER_ID="twitter.com";class Rs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){var i=await Vi._fromIdTokenResponse(e,n,r),s=Ds(n);return new Rs({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Ds(n);return new Rs({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ds(e){return e.providerId||("phoneNumber"in e?"phone":null)}class xs extends R{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,xs.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new xs(e,t,n,r)}}function Ps(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw xs._fromErrorAndOperation(t,e,n,r);throw e})}function Os(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ms(e,t){const n=ae(e);await Fs(!0,n,t);var r=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await ki(e,"POST","/v1/accounts:update",t))["providerUserInfo"];const i=Os(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Ls(e,t,n=!1){var r=await Oi(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Rs._forOperation(e,"link",r)}async function Fs(e,t,n){await Fi(t);const r=Os(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";hi(r.has(n)===e,t.auth,i)}async function Us(e,t,n=!1){var r=e["auth"],i="reauthenticate";try{var s=await Oi(e,Ps(r,i,t,e),n);hi(s.idToken,r,"internal-error");var a=Pi(s.idToken);hi(a,r,"internal-error");var o=a["sub"];return hi(e.uid===o,r,"user-mismatch"),Rs._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&ai(r,"user-mismatch"),e}}async function qs(e,t,n=!1){var r=await Ps(e,"signIn",t),r=await Rs._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(r.user),r}async function Vs(e,t){return qs(is(e),t)}async function Bs(e,t){var n=ae(e);return await Fs(!1,n,t.providerId),Ls(n,t)}async function js(e,t){return Us(ae(e),t)}async function Ks(e,t){const n=is(e);var r=await Si(n,"POST","/v1/accounts:signInWithCustomToken",Ei(n,{token:t,returnSecureToken:!0})),r=await Rs._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(r.user),r}class $s{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?zs._fromServerResponse(e,t):ai(e,"internal-error")}}class zs extends $s{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new zs(t)}}function Ws(e,t,n){var r;hi(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),hi(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(hi(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(hi(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Gs(e,t,n){var r=ae(e),i={requestType:"PASSWORD_RESET",email:t};n&&Ws(r,i,n),await ds(r,i)}async function Hs(e,t){await ki(e=ae(e),"POST","/v1/accounts:update",Ei(e,{oobCode:t}))}async function Qs(e,t){var n=ae(e),r=await us(n,{oobCode:t}),i=r.requestType;switch(hi(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":hi(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":hi(r.mfaInfo,n,"internal-error");default:hi(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=$s._fromServerResponse(is(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Ys(e,t,n){var r=ae(e),i={requestType:"EMAIL_SIGNIN",email:t};hi(n.handleCodeInApp,r,"argument-error"),n&&Ws(r,i,n),await ds(r,i)}async function Xs(e,t){var n=vi()?mi():"http://localhost",n=(await ki(e=ae(e),"POST","/v1/accounts:createAuthUri",Ei(e,{identifier:t,continueUri:n})))["signinMethods"];return n||[]}async function Js(e,t){var n=ae(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Ws(n.auth,r,t);var r=(await ds(n.auth,r))["email"];r!==e.email&&await e.reload()}async function Zs(e,t,n){var r=ae(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Ws(r.auth,i,n);var i=(await ds(r.auth,i))["email"];i!==e.email&&await e.reload()}async function ea(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=ae(e);var r=await i.getIdToken(),r=await Oi(i,async function(e,t){return ki(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}async function ta(e,t,n){var r=e["auth"];const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await Oi(e,hs(r,i));await e._updateTokensIfNecessary(r,!0)}class na{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class ra extends na{constructor(e,t,n,r){super(e,t,n),this.username=r}}class ia extends na{constructor(e,t){super(e,"facebook.com",t)}}class sa extends ra{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class aa extends na{constructor(e,t){super(e,"google.com",t)}}class oa extends ra{constructor(e,t,n){super(e,"twitter.com",t,n)}}function ca(e){var{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e["providerId"],n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Pi(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new na(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new ia(r,n);case"github.com":return new sa(r,n);case"google.com":return new aa(r,n);case"twitter.com":return new oa(r,n,e.screenName||null);case"custom":case"anonymous":return new na(r,null);default:return new na(r,t,n)}}(n)}class la{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new la("enroll",e,t)}static _fromMfaPendingCredential(e){return new la("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return la._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return la._fromIdtoken(e.multiFactorSession.idToken)}return null}}class ua{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,i){const s=is(e),a=i.customData._serverResponse;var t=(a.mfaInfo||[]).map(e=>$s._fromServerResponse(s,e));hi(a.mfaPendingCredential,s,"internal-error");const o=la._fromMfaPendingCredential(a.mfaPendingCredential);return new ua(o,t,async e=>{var t=await e._process(s,o);delete a.mfaInfo,delete a.mfaPendingCredential;var n=Object.assign(Object.assign({},a),{idToken:t.idToken,refreshToken:t.refreshToken});switch(i.operationType){case"signIn":var r=await Rs._fromIdTokenResponse(s,i.operationType,n);return await s._updateCurrentUser(r.user),r;case"reauthenticate":return hi(i.user,s,"internal-error"),Rs._forOperation(i.user,i.operationType,n);default:ai(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class ha{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>$s._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new ha(e)}async getSession(){return la._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e;var r=await this.getSession(),r=await Oi(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r,i=await this.user.getIdToken();try{var s=await Oi(this.user,(n=this.user.auth,r={idToken:i,mfaEnrollmentId:t},ki(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ei(n,r))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(e){throw e}}}const da=new WeakMap;const pa="__sak";class fa{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(pa,"1"),this.storage.removeItem(pa),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class ga extends fa{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(Gi(e=w())||Zi(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=es(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);k()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ga.type="LOCAL";const ma=ga;class va extends fa{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}va.type="SESSION";const ya=va;class _a{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new _a(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;var s=this.handlersMap[r];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function wa(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}_a.receivers=[];class ba{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=wa("",20);o.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},a);l={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),o.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Ia(){return window}function Ta(){return void 0!==Ia().WorkerGlobalScope&&"function"==typeof Ia().importScripts}const Ea="firebaseLocalStorageDb",ka="firebaseLocalStorage",Ca="fbase_key";class Sa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Na(e,t){return e.transaction([ka],t?"readwrite":"readonly").objectStore(ka)}function Aa(){const r=indexedDB.open(Ea,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(ka,{keyPath:Ca})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(ka)?n(e):(e.close(),t=indexedDB.deleteDatabase(Ea),await new Sa(t).toPromise(),n(await Aa()))})})}async function Ra(e,t,n){var r=Na(e,!0).put({fbase_key:t,value:n});return new Sa(r).toPromise()}function Da(e,t){var n=Na(e,!0).delete(t);return new Sa(n).toPromise()}class xa{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Aa(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ta()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_a._getInstance(Ta()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new ba(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await Aa();return await Ra(e,pa,"1"),await Da(e,pa),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Ra(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){var n=Na(e,!1).get(t);return void 0===(n=await new Sa(n).toPromise())?null:n.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Da(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{var t=Na(e,!1).getAll();return new Sa(t).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}xa.type="LOCAL";const Pa=xa;function Oa(i){return new Promise((e,n)=>{const t=document.createElement("script");var r;t.setAttribute("src",i),t.onload=e,t.onerror=e=>{const t=oi("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(r=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==r?r:document).appendChild(t)})}function Ma(e){return`__${e}${Math.floor(1e6*Math.random())}`}class La{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new Fa(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||1e12))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||1e12))||void 0===t||t.execute(),""}}class Fa{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var r="string"==typeof e?document.getElementById(e):e;hi(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Ua=Ma("rcb"),qa=new _i(3e4,6e4);class Va{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=Ia().grecaptcha)||void 0===e||!e.render)}load(s,a=""){var e;return hi((e=a).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(Ia().grecaptcha):new Promise((t,n)=>{const i=Ia().setTimeout(()=>{n(oi(s,"network-request-failed"))},qa.get());Ia()[Ua]=()=>{Ia().clearTimeout(i),delete Ia()[Ua];const e=Ia().grecaptcha;if(e){const r=e.render;e.render=(e,t)=>{var n=r(e,t);return this.counter++,n},this.hostLanguage=a,t(e)}else n(oi(s,"internal-error"))},Oa(`https://www.google.com/recaptcha/api.js??${j({onload:Ua,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(i),n(oi(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=Ia().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class Ba{async load(e){return new La(e)}clearedOneInstance(){}}const ja="recaptcha",Ka={theme:"light",type:"image"};class $a{constructor(e,t=Object.assign({},Ka),n){this.parameters=t,this.type=ja,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=is(n),this.isInvisible="invisible"===this.parameters.size,hi("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var r="string"==typeof e?document.getElementById(e):e;hi(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?Ba:Va),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){hi(!this.parameters.sitekey,this.auth,"argument-error"),hi(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),hi("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=Ia()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){hi(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){hi(vi()&&!Ta(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await ki(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");hi(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return hi(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class za{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=vs._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Wa(t,n,r){var i,s,a,o,c,l,u=await r.verify();try{hi("string"==typeof u,t,"argument-error"),hi(r.type===ja,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return hi("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await ki(c,"POST","/v2/accounts/mfaEnrollment:start",Ei(c,l))).phoneSessionInfo.sessionInfo;hi("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return hi(d,t,"missing-multi-factor-info"),(o={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await ki(t,"POST","/v2/accounts/mfaSignIn:start",Ei(t,o))).phoneResponseInfo.sessionInfo}var p=(s=t,a={phoneNumber:e.phoneNumber,recaptchaToken:u},await ki(s,"POST","/v1/accounts:sendVerificationCode",Ei(s,a)))["sessionInfo"];return p}finally{r._reset()}}class Ga{constructor(e){this.providerId=Ga.PROVIDER_ID,this.auth=is(e)}verifyPhoneNumber(e,t){return Wa(this.auth,e,ae(t))}static credential(e,t){return vs._fromVerification(e,t)}static credentialFromResult(e){var t=e;return Ga.credentialFromTaggedObject(t)}static credentialFromError(e){return Ga.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:n}=e;return t&&n?vs._fromTokenResponse(t,n):null}}function Ha(e,t){return t?gi(t):(hi(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ga.PROVIDER_ID="phone",Ga.PHONE_SIGN_IN_METHOD="phone";class Qa extends ls{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Ya(e){return qs(e.auth,new Qa(e),e.bypassAuthState)}function Xa(e){var{auth:t,user:n}=e;return hi(n,t,"internal-error"),Us(n,new Qa(e),e.bypassAuthState)}async function Ja(e){var{auth:t,user:n}=e;return hi(n,t,"internal-error"),Ls(n,new Qa(e),e.bypassAuthState)}class Za{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Ya;case"linkViaPopup":case"linkViaRedirect":return Ja;case"reauthViaPopup":case"reauthViaRedirect":return Xa;default:ai(this.auth,"internal-error")}}resolve(e){pi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){pi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const eo=new _i(2e3,1e4);class to extends Za{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,to.currentPopupAction&&to.currentPopupAction.cancel(),to.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return hi(e,this.auth,"internal-error"),e}async onExecution(){pi(1===this.filter.length,"Popup operations only handle one event");var e=wa();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(oi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(oi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,to.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(oi(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,eo.get())};t()}}to.currentPopupAction=null;const no="pendingRedirect",ro=new Map;class io extends Za{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=ro.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=co(t),r=oo(e);if(!await r._isAvailable())return!1;var i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}ro.set(this.auth._key(),t)}return this.bypassAuthState||ro.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function so(e,t){return oo(e)._set(co(t),"true")}function ao(e,t){ro.set(e._key(),t)}function oo(e){return gi(e._redirectPersistence)}function co(e){return Ki(no,e.config.apiKey,e.name)}function lo(e,t,n){return async function(e,t,n){var r=is(e);li(e,t,ws),await r._initializationPromise;const i=Ha(r,n);return await so(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function uo(e,t,n){return async function(e,t,n){var r=ae(e);li(r.auth,t,ws),await r.auth._initializationPromise;const i=Ha(r.auth,n);await so(i,r.auth);var s=await fo(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function ho(e,t,n){return async function(e,t,n){var r=ae(e);li(r.auth,t,ws),await r.auth._initializationPromise;const i=Ha(r.auth,n);await Fs(!1,r,t.providerId),await so(i,r.auth);var s=await fo(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function po(e,t,n=!1){const r=is(e);var i=Ha(r,t);const s=new io(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function fo(e){var t=wa(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class go{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return vo(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!vo(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(oi(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(mo(e))}saveEventToCache(e){this.cachedEventUids.add(mo(e)),this.lastProcessedEventTime=Date.now()}}function mo(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function vo({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function yo(e,t={}){return ki(e,"GET","/v1/projects",t)}const _o=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wo=/^https?/;async function bo(e){if(!e.config.emulator){var t=(await yo(e))["authorizedDomains"];for(const n of t)try{if(function(e){const t=mi(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!wo.test(n))return!1;if(_o.test(e))return r===e;const s=e.replace(/\./g,"\\."),a=new RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(r)}(n))return}catch(e){}ai(e,"unauthorized-domain")}}const Io=new _i(3e4,6e4);function To(){const t=Ia().___jsl;if(null!==t&&void 0!==t&&t.H)for(const n of Object.keys(t.H))if(t.H[n].r=t.H[n].r||[],t.H[n].L=t.H[n].L||[],t.H[n].r=[...t.H[n].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Eo=null;function ko(e){var i;return Eo=Eo||(i=e,new Promise((e,t)=>{function n(){To(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{To(),t(oi(i,"network-request-failed"))},timeout:Io.get()})}if(null!==(r=null===(r=Ia().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=Ia().gapi)||void 0===r||!r.load){var r=Ma("iframefcb");return Ia()[r]=()=>{gapi.load?n():t(oi(i,"network-request-failed"))},Oa(`https://apis.google.com/js/api.js?onload=${r}`).catch(e=>t(e))}n()}}).catch(e=>{throw Eo=null,e})),Eo}const Co=new _i(5e3,15e3),So="__/auth/iframe",No="emulator/auth/iframe",Ao={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ro=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Do(a){const e=await ko(a);var t=Ia().gapi;return hi(t,a,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;hi(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?wi(t,No):`https://${e.config.authDomain}/${So}`;const r={apiKey:t.apiKey,appName:e.name,v:Ye};(t=Ro.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${j(r).slice(1)}`}(a),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ao,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=oi(a,"network-request-failed"),r=Ia().setTimeout(()=>{t(n)},Co.get());function i(){Ia().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const xo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Po{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Oo(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c=Object.assign(Object.assign({},xo),{width:r.toString(),height:i.toString(),top:s,left:a});s=w().toLowerCase();n&&(o=Hi(s)?"_blank":n),Wi(s)&&(t=t||"http://localhost",c.scrollbars="yes");var l,a=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([n=w()]=[s],Zi(n)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new Po(null);const u=window.open(t||"",o,a);hi(u,e,"popup-blocked");try{u.focus()}catch(e){}return new Po(u)}const Mo="__/auth/handler",Lo="emulator/auth/handler";function Fo(e,t,n,r,i,s){hi(e.config.authDomain,e,"auth-domain-config-required"),hi(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Ye,eventId:i};if(t instanceof ws){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",U(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,c]of Object.entries(s||{}))a[o]=c}if(t instanceof bs){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(a.scopes=u.join(","))}e.tenantId&&(a.tid=e.tenantId);const l=a;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${e=[e["config"]][0],e.emulator?wi(e,Lo):`https://${e.authDomain}/${Mo}`}?${j(l).slice(1)}`}const Uo="webStorageSupport";const qo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ya,this._completeRedirectFn=po,this._overrideRedirectResult=ao}async _openPopup(e,t,n,r){var i;return pi(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Oo(e,Fo(e,t,n,mi(),r),wa())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=Fo(e,t,n,mi(),r),Ia().location.href=r,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(pi(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await Do(t),n=new go(t);return e.register("authEvent",e=>{return hi(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(n,r){const e=this.iframes[n._key()];e.send(Uo,{type:Uo},e=>{var t=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[Uo];void 0!==t&&r(!!t),ai(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=bo(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return es()||Gi()||Zi()}};class Vo extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return di("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Vo(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},ki(e,"POST","/v2/accounts/mfaEnrollment:finalize",Ei(e,n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},ki(e,"POST","/v2/accounts/mfaSignIn:finalize",Ei(e,t))}}class Bo{constructor(){}static assertion(e){return Vo._fromCredential(e)}}Bo.FACTOR_ID="phone";var jo="@firebase/auth";class Ko{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){hi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}var $o,zo,Wo;function Go(){return window}$o="authIdTokenMaxAge",null===(zo=p())||void 0===zo||zo[`_${$o}`],Wo="Browser",We(new oe("auth",(e,{options:r})=>{var t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");const{apiKey:i,authDomain:s}=t.options;return((e,t)=>{hi(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),hi(!(null!==s&&void 0!==s&&s.includes(":")),"argument-error",{appName:e.name});var n={apiKey:i,authDomain:s,clientPlatform:Wo,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ts(Wo)},n=new rs(e,t,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(gi);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(n,r),n})(t,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),We(new oe("auth-internal",e=>{var t=is(e.getProvider("auth").getImmediate());return e=t,new Ko(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),et(jo,"0.21.4",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Wo)),et(jo,"0.21.4","esm2017");async function Ho(e,t,n){var r=Go()["BuildInfo"];pi(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(e){if(pi(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return Zi()?s.ibi=r.packageName:Yi()?s.apn=r.packageName:ai(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,Fo(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,s)}function Qo(r){const i=Go()["cordova"];return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=w(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const Yo=20;class Xo extends go{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function Jo(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<Yo;r++){var n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:oi(e,"no-auth-event")}}async function Zo(e){var t=await tc()._get(nc(e));return t&&await tc()._remove(nc(e)),t}function ec(e,t){var n,r,i;const s=(n=rc(t=t),a=n.link?decodeURIComponent(n.link):void 0,r=rc(a).link,i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=rc(i).link)||i||r||a||t);if(s.includes("/__/auth/callback")){var a=rc(s),a=a.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(a.firebaseError)):null,a=null===(a=null===(a=null==a?void 0:a.code)||void 0===a?void 0:a.split("auth/"))||void 0===a?void 0:a[1],a=a?oi(a):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function tc(){return gi(ma)}function nc(e){return Ki("authEvent",e.config.apiKey,e.name)}function rc(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return K(t.join("?"))}const ic=class{constructor(){this._redirectPersistence=ya,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=po,this._overrideRedirectResult=ao}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new Xo(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){ai(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;i=e,o=Go(),hi("function"==typeof(null===(s=null==o?void 0:o.universalLinks)||void 0===s?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),hi(void 0!==(null===(s=null==o?void 0:o.BuildInfo)||void 0===s?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),hi("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),hi("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),hi("function"==typeof(null===(o=null===(o=null==o?void 0:o.cordova)||void 0===o?void 0:o.InAppBrowser)||void 0===o?void 0:o.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const a=await this._initialize(e);await a.initialized(),a.resetRedirect(),ro.clear(),await this._originValidation(e);var o=Jo(e,n,r);n=e,r=o,await tc()._set(nc(n),r);o=await Qo(await Ho(e,o,t));return async function(a,o,c){const l=Go()["cordova"];let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(oi(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}o.addPassiveListener(r),document.addEventListener("resume",i,!1),Yi()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,a,o)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=Go()["BuildInfo"];const n={};Zi()?n.iosBundleId=t.packageName:Yi()?n.androidPackageName=t.packageName:ai(e,"operation-not-supported-in-this-environment"),await yo(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=Go(),s=setTimeout(async()=>{await Zo(r),i.onEvent(sc())},500),a=async e=>{clearTimeout(s);var t=await Zo(r);let n=null;t&&null!=e&&e.url&&(n=ec(t,e.url)),i.onEvent(n||sc())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a);const o=t,c=`${n.packageName.toLowerCase()}://`;Go().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function sc(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:oi("no-auth-event")}}var ac;function oc(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function cc(e=w()){return!("file:"!==oc()&&"ionic:"!==oc()&&"capacitor:"!==oc()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function lc(e=w()){return k()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=w()]=[e],/Edge\/\d+/.test(e))}function uc(){try{const t=self.localStorage;var e=wa();if(t)return t.setItem(e,"1"),t.removeItem(e),!lc()||S()}catch(e){return hc()&&S()}return!1}function hc(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function dc(){return("http:"===oc()||"https:"===oc()||T()||cc())&&!(E()||I())&&uc()&&!hc()}function pc(){return cc()&&"undefined"!=typeof document}const fc={LOCAL:"local",NONE:"none",SESSION:"session"},gc=hi,mc="persistence";async function vc(e){await e._initializationPromise;const t=yc();var n=Ki(mc,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function yc(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const _c=hi;class wc{constructor(){this.browserResolver=gi(qo),this.cordovaResolver=gi(ic),this.underlyingResolver=null,this._redirectPersistence=ya,this._completeRedirectFn=po,this._overrideRedirectResult=ao}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return pc()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return _c(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!pc()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function bc(e){return e.unwrap()}function Ic(e,t){var n,r,i,s=null===(r=t.customData)||void 0===r?void 0:r._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){const o=t;o.resolver=new Cc(e,(n=t,i=ae(e),hi((a=n).customData.operationType,i,"argument-error"),hi(null===(r=a.customData._serverResponse)||void 0===r?void 0:r.mfaPendingCredential,i,"argument-error"),ua._fromError(i,a)))}else if(s){var a=Tc(t);const c=t;a&&(c.credential=a,c.tenantId=s.tenantId||void 0,c.email=s.email||void 0,c.phoneNumber=s.phoneNumber||void 0)}}function Tc(e){var t=(e instanceof R?e.customData:e)["_tokenResponse"];if(!t)return null;if(!(e instanceof R)&&"temporaryProof"in t&&"phoneNumber"in t)return Ga.credentialFromResult(e);const n=t.providerId;if(!n||n===Jr.PASSWORD)return null;let r;switch(n){case Jr.GOOGLE:r=Es;break;case Jr.FACEBOOK:r=Ts;break;case Jr.GITHUB:r=ks;break;case Jr.TWITTER:r=Ns;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:c}=t;return s||a||i||o?o?n.startsWith("saml.")?Cs._create(n,o):gs._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:i,accessToken:s}):new Is(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof R?r.credentialFromError(e):r.credentialFromResult(e)}function Ec(t,e){return e.catch(e=>{throw e instanceof R&&Ic(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:Tc(e),additionalUserInfo:ca(e),user:Sc.getOrCreate(n)}})}async function kc(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>Ec(t,n.confirm(e))}}class Cc{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Ec(bc(this.auth),this.resolver.resolveSignIn(e))}}class Sc{constructor(e){var t;this._delegate=e,this.multiFactor=(t=ae(e),da.has(t)||da.set(t,ha._fromUser(t)),da.get(t))}static getOrCreate(e){return Sc.USER_MAP.has(e)||Sc.USER_MAP.set(e,new Sc(e)),Sc.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Ec(this.auth,Bs(this._delegate,e))}async linkWithPhoneNumber(e,t){return kc(this.auth,async function(e,t,n){const r=ae(e);await Fs(!1,r,"phone");var i=await Wa(r.auth,t,ae(n));return new za(i,e=>Bs(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Ec(this.auth,async function(e,t,n){var r=ae(e);li(r.auth,t,ws);var i=Ha(r.auth,n);const s=new to(r.auth,"linkViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,wc))}async linkWithRedirect(e){return await vc(is(this.auth)),ho(this._delegate,e,wc)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Ec(this.auth,js(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return kc(this.auth,async function(e,t,n){const r=ae(e);var i=await Wa(r.auth,t,ae(n));return new za(i,e=>js(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Ec(this.auth,async function(e,t,n){var r=ae(e);li(r.auth,t,ws);var i=Ha(r.auth,n);const s=new to(r.auth,"reauthViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,wc))}async reauthenticateWithRedirect(e){return await vc(is(this.auth)),uo(this._delegate,e,wc)}sendEmailVerification(e){return Js(this._delegate,e)}async unlink(e){return await Ms(this._delegate,e),this}updateEmail(e){return ta(ae(this._delegate),e,null)}updatePassword(e){return ta(ae(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await Ls(ae(e),t)}(this._delegate,e)}updateProfile(e){return ea(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Zs(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Sc.USER_MAP=new WeakMap;const Nc=hi;class Ac{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options["apiKey"];Nc(n,"invalid-api-key",{appName:e.name}),Nc(n,"invalid-api-key",{appName:e.name});var r="undefined"!=typeof window?wc:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){const n=function(e,t){const n=yc();if(!n)return[];var r=Ki(mc,e,t);switch(n.getItem(r)){case fc.NONE:return[ji];case fc.LOCAL:return[Pa,ya];case fc.SESSION:return[ya];default:return[]}}(e,t);"undefined"==typeof self||n.includes(Pa)||n.push(Pa);if("undefined"!=typeof window)for(const r of[ma,ya])n.includes(r)||n.push(r);n.includes(ji)||n.push(ji);return n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(ti),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Sc.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){as(this._delegate,e,t)}applyActionCode(e){return Hs(this._delegate,e)}checkActionCode(e){return Qs(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await us(ae(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Ec(this._delegate,async function(e,t,n){const r=is(e);var i=await As(r,{returnSecureToken:!0,email:t,password:n}),i=await Rs._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(i.user),i}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Xs(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=ys.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){Nc(dc(),this._delegate,"operation-not-supported-in-this-environment");var e,t,n=(e=this._delegate,t=wc,await is(e)._initializationPromise,await po(e,t,!1));return n?Ec(this._delegate,Promise.resolve(n)):{credential:null,user:null}}addFrameworkForLogging(e){is(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:r,error:i,complete:s}=Rc(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){var{next:r,error:i,complete:s}=Rc(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return Ys(this._delegate,e,t)}sendPasswordResetEmail(e,t){return Gs(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,gc(Object.values(fc).includes(n),t,"invalid-persistence-type"),E()?gc(n!==fc.SESSION,t,"unsupported-persistence-type"):I()?gc(n===fc.NONE,t,"unsupported-persistence-type"):hc()?gc(n===fc.NONE||n===fc.LOCAL&&S(),t,"unsupported-persistence-type"):gc(n===fc.NONE||uc(),t,"unsupported-persistence-type");let r;switch(e){case fc.SESSION:r=ya;break;case fc.LOCAL:var i=await gi(Pa)._isAvailable();r=i?Pa:ma;break;case fc.NONE:r=ji;break;default:return ai("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Ec(this._delegate,async function(e){const t=is(e);if(await t._initializationPromise,null!==(n=t.currentUser)&&void 0!==n&&n.isAnonymous)return new Rs({user:t.currentUser,providerId:null,operationType:"signIn"});var n=await As(t,{returnSecureToken:!0}),n=await Rs._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(n.user),n}(this._delegate))}signInWithCredential(e){return Ec(this._delegate,Vs(this._delegate,e))}signInWithCustomToken(e){return Ec(this._delegate,Ks(this._delegate,e))}signInWithEmailAndPassword(e,t){return Ec(this._delegate,(n=this._delegate,e=e,t=t,Vs(ae(n),_s.credential(e,t))));var n}signInWithEmailLink(e,t){return Ec(this._delegate,async function(e,t,n){var r=ae(e),i=_s.credentialWithLink(t,n||mi());return hi(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Vs(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return kc(this._delegate,async function(e,t,n){const r=is(e);var i=await Wa(r,t,ae(n));return new za(i,e=>Vs(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return Nc(dc(),this._delegate,"operation-not-supported-in-this-environment"),Ec(this._delegate,async function(e,t,n){var r=is(e);li(e,t,ws);var i=Ha(r,n);const s=new to(r,"signInViaPopup",t,i);return s.executeNotNull()}(this._delegate,e,wc))}async signInWithRedirect(e){return Nc(dc(),this._delegate,"operation-not-supported-in-this-environment"),await vc(this._delegate),lo(this._delegate,e,wc)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var n=(await Qs(ae(e),t))["data"];return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Rc(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Sc.getOrCreate(e)),error:t,complete:n}}Ac.Persistence=fc;class Dc{constructor(){this.providerId="phone",this._delegate=new Ga(bc(wt.auth()))}static credential(e,t){return Ga.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Dc.PHONE_SIGN_IN_METHOD=Ga.PHONE_SIGN_IN_METHOD,Dc.PROVIDER_ID=Ga.PROVIDER_ID;const xc=hi;class Pc{constructor(e,t,n=wt.app()){var r;xc(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new $a(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(ac=wt).INTERNAL.registerComponent(new oe("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new Ac(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Zr.EMAIL_SIGNIN,PASSWORD_RESET:Zr.PASSWORD_RESET,RECOVER_EMAIL:Zr.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Zr.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Zr.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Zr.VERIFY_EMAIL}},EmailAuthProvider:_s,FacebookAuthProvider:Ts,GithubAuthProvider:ks,GoogleAuthProvider:Es,OAuthProvider:Is,SAMLAuthProvider:Ss,PhoneAuthProvider:Dc,PhoneMultiFactorGenerator:Bo,RecaptchaVerifier:Pc,TwitterAuthProvider:Ns,Auth:Ac,AuthCredential:ls,Error:R}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ac.registerVersion("@firebase/auth-compat","0.3.4");const Oc="@firebase/database";let Mc="";function Lc(e){Mc=e}class Fc{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),O(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:P(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Uc{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return L(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var qc,Vc,Bc,jc,Kc,$c,zc=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Fc(t)}}catch(e){}return new Uc};function Wc(e){var t=function(t){const n=[];let r=0;for(let a=0;a<t.length;a++){let e=t.charCodeAt(a);var i,s;55296<=e&&e<=56319&&(i=e-55296,a++,f(a<t.length,"Surrogate pair missing trail surrogate."),s=t.charCodeAt(a)-56320,e=65536+(i<<10)+s),e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(e<65536?n[r++]=e>>12|224:(n[r++]=e>>18|240,n[r++]=e>>12&63|128),n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e);const n=new z;return n.update(t),t=n.digest(),r.encodeByteArray(t)}const Gc=zc("localStorage"),Hc=zc("sessionStorage"),Qc=new me("@firebase/database"),Yc=function(){let e=1;return function(){return e++}}(),Xc=function(...e){let t="";for(let r=0;r<e.length;r++){var n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=Xc.apply(null,n):t+="object"==typeof n?O(n):n,t+=" "}return t};let Jc=null,Zc=!0;function el(t){return function(...e){ol(t,...e)}}function tl(...e){var t="FIREBASE INTERNAL ERROR: "+Xc(...e);Qc.error(t)}function nl(e,t){return e===t?0:e<t?-1:1}function rl(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+O(t))}function il(e){if("object"!=typeof e||null===e)return O(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=O(t[i]),n+=":",n+=il(e[t[i]]);return n+="}",n}function sl(e,t){var n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}const al=function(e,t){f(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Qc.logLevel=m.VERBOSE,Jc=Qc.log.bind(Qc),t&&Hc.set("logging_enabled",!0)):"function"==typeof e?Jc=e:(Jc=null,Hc.remove("logging_enabled"))},ol=function(...e){var t;!0===Zc&&(Zc=!1,null===Jc&&!0===Hc.get("logging_enabled")&&al(!0)),Jc&&(t=Xc.apply(null,e),Jc(t))},cl=function(...e){var t=`FIREBASE FATAL ERROR: ${Xc(...e)}`;throw Qc.error(t),new Error(t)},ll=function(...e){var t="FIREBASE WARNING: "+Xc(...e);Qc.warn(t)},ul=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ll("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},hl=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},dl="[MIN_NAME]",pl="[MAX_NAME]",fl=function(e,t){if(e===t)return 0;if(e===dl||t===pl)return-1;if(t===dl||e===pl)return 1;var n=vl(e),r=vl(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function gl(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function ml(e){f(!hl(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const o=a.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function vl(e){if(_l.test(e)){var t=Number(e);if(t>=wl&&t<=bl)return t}return null}function yl(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n}const _l=new RegExp("^-?(0*)\\d{1,10}$"),wl=-2147483648,bl=2147483647,Il=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw ll("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Tl{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){ll(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class El{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(ol("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ll(e)}}class kl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}kl.OWNER="owner";const Cl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Sl="websocket",Nl="long_polling";class Al{constructor(e,t,n,r,i=!1,s="",a=!1,o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Gc.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Gc.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Rl(e,t,n){f("string"==typeof t,"typeof type must == string"),f("object"==typeof n,"typeof params must == object");let r;if(t===Sl)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Nl)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return gl(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Dl{constructor(){this.counters_={}}incrementCounter(e,t=1){L(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return c(void 0,this.counters_)}}const xl={},Pl={};function Ol(e){var t=e.toString();return xl[t]||(xl[t]=new Dl),xl[t]}class Ml{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Il(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Ll{constructor(e,t,n,r,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=el(e),this.stats_=Ol(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Rl(t,Nl,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ml(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Fl((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Cl.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ll.forceAllow_=!0}static forceDisallow(){Ll.forceDisallow_=!0}static isAvailable(){return!!Ll.forceAllow_||!(Ll.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=O(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var t=i(t),n=sl(t,1840);for(let r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=O(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Fl{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Yc(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Fl.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){ol("frame writing exception"),e.stack&&ol(e.stack),ol(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||ol("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{ol("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Ul=null;"undefined"!=typeof MozWebSocket?Ul=MozWebSocket:"undefined"!=typeof WebSocket&&(Ul=WebSocket);class ql{constructor(e,t,n,r,i,s,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=el(this.connId),this.stats_=Ol(t),this.connURL=ql.connectionURL_(t,s,a,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Cl.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Rl(e,Sl,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Gc.set("previous_websocket_failure",!0);try{C(),this.mySock=new Ul(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ql.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==Ul&&!ql.forceDisallow_}static previouslyFailed(){return Gc.isInMemoryStorage||!0===Gc.get("previous_websocket_failure")}markConnectionHealthy(){Gc.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=P(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=O(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=sl(t,16384);1<n.length&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ql.responsesRequiredToBeHealthy=2,ql.healthyTimeout=3e4;class Vl{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ll,ql]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=ql&&ql.isAvailable();let n=t&&!ql.previouslyFailed();if(e.webSocketOnly&&(t||ll("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ql];else{const r=this.transports_=[];for(const i of Vl.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Vl.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}Vl.globalTransportInitialized_=!1;class Bl{constructor(e,t,n,r,i,s,a,o,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=el("c:"+this.id+":"),this.transportManager_=new Vl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=yl(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=rl("t",e),n=rl("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=rl("t",e),n=rl("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=rl("t",e);if("d"in e){var n=e.d;if("h"===t){const r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?tl("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tl("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&ll("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),yl(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):yl(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Gc.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class jl{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Kl{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const r=[...this.listeners_[t]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){f(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class $l extends Kl{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||b()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new $l}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class zl{constructor(n,e){if(void 0===e){this.pieces_=n.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Wl(){return new zl("")}function Gl(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Hl(e){return e.pieces_.length-e.pieceNum_}function Ql(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new zl(e.pieces_,t)}function Yl(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Xl(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Jl(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new zl(t,0)}function Zl(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof zl)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{var r=t.split("/");for(let e=0;e<r.length;e++)0<r[e].length&&n.push(r[e])}return new zl(n,0)}function eu(e){return e.pieceNum_>=e.pieces_.length}function tu(e,t){var n=Gl(e),r=Gl(t);if(null===n)return t;if(n===r)return tu(Ql(e),Ql(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function nu(e,t){var n=Xl(e,0),r=Xl(t,0);for(let s=0;s<n.length&&s<r.length;s++){var i=fl(n[s],r[s]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function ru(e,t){if(Hl(e)!==Hl(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function iu(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Hl(e)>Hl(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class su{constructor(e,t){this.errorPrefix_=t,this.parts_=Xl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=ee(this.parts_[n]);au(this)}}function au(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+ou(e))}function ou(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class cu extends Kl{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new cu}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}class lu extends jl{constructor(e,t,n,r,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=lu.nextPersistentConnectionId_++,this.log_=el("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!C())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");cu.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&$l.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(O(i)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new y;var t={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++;t=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(t),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),a=i._queryIdentifier;this.log_("Listen on "+s+" for "+a);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;lu.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(a))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,a),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&L(e,"w")){const i=F(e,"w");var n,r;Array.isArray(i)&&~i.indexOf("no_index")&&(n='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString(),ll("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${n} at `+`${r} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=M(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;var e=function(e){const t=M(e),n=t.claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}(r)?"auth":"gauth";const t={cred:r};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,n=e.d||"error";this.authToken_===r&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+O(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):tl("Unrecognized action received from server: "+O(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+lu.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var a=function(){n?n.close():(t=!0,u())};this.realtime_={close:a,sendRequest:function(e){f(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var o=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(o),this.appCheckTokenProvider_.getToken(o)]);t?ol("getToken() completed but was canceled"):(ol("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new Bl(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{ll(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&ll(e),a())}}}interrupt(e){ol("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ol("Resuming connection for reason: "+e),delete this.interruptReasons_[e],U(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>il(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){var n=new zl(e).toString();let r;if(this.listens.has(n)){const i=this.listens.get(n);r=i.get(t),i.delete(t),0===i.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){ol("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){ol("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let r=0;r<this.outstandingPuts_.length;r++)this.outstandingPuts_[r]&&this.sendPut_(r);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};e["sdk.js."+Mc.replace(/\./g,"-")]=1,b()?e["framework.cordova"]=1:E()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=$l.getInstance().currentlyOnline();return U(this.interruptReasons_)&&e}}lu.nextPersistentConnectionId_=0,lu.nextConnectionId_=0;class uu{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new uu(e,t)}}class hu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var n=new uu(dl,e),r=new uu(dl,t);return 0!==this.compare(n,r)}minPost(){return uu.MIN}}let du;class pu extends hu{static get __EMPTY_NODE(){return du}static set __EMPTY_NODE(e){du=e}compare(e,t){return fl(e.name,t.name)}isDefinedOn(e){throw u("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return uu.MIN}maxPost(){return new uu(pl,du)}makePost(e,t){return f("string"==typeof e,"KeyIndex indexValue must always be a string."),new uu(e,du)}toString(){return".key"}}const fu=new pu;class gu{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class mu{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:mu.RED,this.left=null!=r?r:vu.EMPTY_NODE,this.right=null!=i?i:vu.EMPTY_NODE}copy(e,t,n,r,i){return new mu(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return vu.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return vu.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,mu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,mu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}mu.RED=!0,mu.BLACK=!1;class vu{constructor(e,t=vu.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new vu(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,mu.BLACK,null,null))}remove(e){return new vu(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,mu.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new gu(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new gu(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new gu(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new gu(this.root_,null,this.comparator_,!0,e)}}function yu(e,t){return fl(e.name,t.name)}function _u(e,t){return fl(e,t)}vu.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new mu(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let wu;function bu(e){return"number"==typeof e?"number:"+ml(e):"string:"+e}function Iu(e){var t;e.isLeafNode()?(t=e.val(),f("string"==typeof t||"number"==typeof t||"object"==typeof t&&L(t,".sv"),"Priority must be a string or number.")):f(e===wu||e.isEmpty(),"priority of unexpected type."),f(e===wu||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Tu;class Eu{constructor(e,t=Eu.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Iu(this.priorityNode_)}static set __childrenNodeConstructor(e){Tu=e}static get __childrenNodeConstructor(){return Tu}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Eu(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Eu.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return eu(e)?this:".priority"===Gl(e)?this.priorityNode_:Eu.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Eu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=Gl(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(f(".priority"!==n||1===Hl(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Eu.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ql(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+bu(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?ml(this.value_):this.value_,this.lazyHash_=Wc(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Eu.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Eu.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=Eu.VALUE_TYPE_ORDER.indexOf(t),i=Eu.VALUE_TYPE_ORDER.indexOf(n);return f(0<=r,"Unknown leaf type: "+t),f(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}Eu.VALUE_TYPE_ORDER=["object","boolean","number","string"];let ku,Cu;const Su=new class extends hu{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?fl(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return uu.MIN}maxPost(){return new uu(pl,new Eu("[PRIORITY-POST]",Cu))}makePost(e,t){var n=ku(e);return new uu(t,new Eu("[PRIORITY-POST]",n))}toString(){return".priority"}},Nu=Math.log(2);class Au{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Nu,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Ru(c,e,l,t){c.sort(e);const u=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=c[e],i=l?l(r):r,new mu(i,r.node,mu.BLACK,null,null);var s=parseInt(n/2,10)+e,a=u(e,s),n=u(s+1,t);return r=c[s],i=l?l(r):r,new mu(i,r.node,mu.BLACK,a,n)};var n=function(e){let s=null,a=null,o=c.length;function t(e,t){var n=o-e,r=o;o-=e;var i=u(1+n,r),r=c[n],n=l?l(r):r;!function(e){if(s){s.left=e;s=e}else{a=e;s=e}}(new mu(n,r.node,t,null,i))}for(let i=0;i<e.count;++i){var n=e.nextBitIsOne(),r=Math.pow(2,e.count-(i+1));n?t(r,mu.BLACK):(t(r,mu.BLACK),t(r,mu.RED))}return a}(new Au(c.length));return new vu(t||e,n)}let Du;const xu={};class Pu{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f((xu,Su),"ChildrenNode.ts has not been loaded"),Du=Du||new Pu({".priority":xu},{".priority":Su}),Du}get(e){var t=F(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof vu?t:null}hasIndex(e){return L(this.indexSet_,e.toString())}addIndex(e,t){f(e!==fu,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(uu.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let a;a=r?Ru(n,e.getCompare()):xu;var o=e.toString();const c=Object.assign({},this.indexSet_);c[o]=e;const l=Object.assign({},this.indexes_);return l[o]=a,new Pu(l,c)}addToIndexes(a,o){var e=q(this.indexes_,(t,e)=>{const n=F(this.indexSet_,e);if(f(n,"Missing index implementation for "+e),t===xu){if(n.isDefinedOn(a.node)){const i=[],s=o.getIterator(uu.Wrap);let e=s.getNext();for(;e;)e.name!==a.name&&i.push(e),e=s.getNext();return i.push(a),Ru(i,n.getCompare())}return xu}{var r=o.get(a.name);let e=t;return r&&(e=e.remove(new uu(a.name,r))),e.insert(a,a.node)}});return new Pu(e,this.indexSet_)}removeFromIndexes(n,r){var e=q(this.indexes_,e=>{if(e===xu)return e;var t=r.get(n.name);return t?e.remove(new uu(n.name,t)):e});return new Pu(e,this.indexSet_)}}let Ou;class Mu{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Iu(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ou=Ou||new Mu(new vu(_u),null,Pu.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ou}updatePriority(e){return this.children_.isEmpty()?this:new Mu(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ou:t}getChild(e){var t=Gl(e);return null===t?this:this.getImmediateChild(t).getChild(Ql(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(f(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new uu(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Ou:this.priorityNode_;return new Mu(e,i,t)}}updateChild(e,t){var n=Gl(e);if(null===n)return t;f(".priority"!==Gl(e)||1===Hl(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(Ql(e),t);return this.updateImmediateChild(n,r)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,a=!0;if(this.forEachChild(Su,(e,t)=>{r[e]=t.val(n),i++,a&&Mu.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!n&&a&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let r="";this.getPriority().isEmpty()||(r+="priority:"+bu(this.getPriority().val())+":"),this.forEachChild(Su,(e,t)=>{var n=t.hash();""!==n&&(r+=":"+e+":"+n)}),this.lazyHash_=""===r?"":Wc(r)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new uu(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new uu(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new uu(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,uu.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,uu.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Fu?-1:0}withIndex(e){if(e===fu||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new Mu(this.children_,this.priorityNode_,t)}isIndexed(e){return e===fu||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(Su),i=n.getIterator(Su);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===fu?null:this.indexMap_.get(e.toString())}}Mu.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Lu extends Mu{constructor(){super(new vu(_u),Mu.EMPTY_NODE,Pu.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Mu.EMPTY_NODE}isEmpty(){return!1}}const Fu=new Lu;Object.defineProperties(uu,{MIN:{value:new uu(dl,Mu.EMPTY_NODE)},MAX:{value:new uu(pl,Fu)}}),pu.__EMPTY_NODE=Mu.EMPTY_NODE,Eu.__childrenNodeConstructor=Mu,qc=Fu,wu=qc,Vc=Fu,Cu=Vc;const Uu=!0;function qu(i,e=null){if(null===i)return Mu.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),f(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new Eu(t,qu(e))}if(i instanceof Array||!Uu){let r=Mu.EMPTY_NODE;return gl(i,(e,t)=>{if(L(i,e)&&"."!==e.substring(0,1)){const n=qu(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(qu(e))}{const s=[];let r=!1;if(gl(i,(e,t)=>{if("."!==e.substring(0,1)){const n=qu(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new uu(e,n)))}}),0===s.length)return Mu.EMPTY_NODE;var n=Ru(s,yu,e=>e.name,_u);if(r){t=Ru(s,Su.getCompare());return new Mu(n,qu(e),new Pu({".priority":t},{".priority":Su}))}return new Mu(n,qu(e),Pu.Default)}}ku=qu;class Vu extends hu{constructor(e){super(),this.indexPath_=e,f(!eu(e)&&".priority"!==Gl(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?fl(e.name,t.name):r}makePost(e,t){var n=qu(e),n=Mu.EMPTY_NODE.updateChild(this.indexPath_,n);return new uu(t,n)}maxPost(){var e=Mu.EMPTY_NODE.updateChild(this.indexPath_,Fu);return new uu(pl,e)}toString(){return Xl(this.indexPath_,0).join("/")}}const Bu=new class extends hu{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?fl(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return uu.MIN}maxPost(){return uu.MAX}makePost(e,t){var n=qu(e);return new uu(t,n)}toString(){return".value"}};function ju(e){return{type:"value",snapshotNode:e}}function Ku(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function $u(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function zu(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Wu{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange($u(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Ku(t,n)):s.trackChildChange(zu(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Su,(e,t)=>{n.hasChild(e)||i.trackChildChange($u(e,t))}),n.isLeafNode()||n.forEachChild(Su,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(zu(e,t,n))}else i.trackChildChange(Ku(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Mu.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Gu{constructor(e){this.indexedFilter_=new Wu(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Gu.getStartPost_(e),this.endPost_=Gu.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new uu(t,n))||(n=Mu.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?Mu.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(Mu.EMPTY_NODE);const i=this;return t.forEachChild(Su,(e,t)=>{i.matches(new uu(e,t))||(r=r.updateImmediateChild(e,Mu.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Hu{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{var t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{var t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Gu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new uu(t,n))||(n=Mu.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,n,t){let r;if(n.isLeafNode()||n.isEmpty())r=Mu.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<n.numChildren()&&n.isIndexed(this.index_)){r=Mu.EMPTY_NODE.withIndex(this.index_);let e;e=this.reverse_?n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let t=0;for(;e.hasNext()&&t<this.limit_;){var i=e.getNext();if(this.withinDirectionalStart(i)){if(!this.withinDirectionalEnd(i))break;r=r.updateImmediateChild(i.name,i.node),t++}}}else{r=n.withIndex(this.index_),r=r.updatePriority(Mu.EMPTY_NODE);let e;e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let t=0;for(;e.hasNext();){var s=e.getNext();t<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?t++:r=r.updateImmediateChild(s.name,Mu.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const a=e;f(a.numChildren()===this.limit_,"");var o=new uu(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,o);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(zu(t,n,u)),a.updateImmediateChild(t,n);{null!=i&&i.trackChildChange($u(t,u));const p=a.updateImmediateChild(t,Mu.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(Ku(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&l&&0<=s(c,o)?(null!=i&&(i.trackChildChange($u(c.name,c.node)),i.trackChildChange(Ku(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,Mu.EMPTY_NODE)):e}}class Qu{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Su}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:dl}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:pl}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Su}copy(){const e=new Qu;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Yu(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Xu(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Ju(e,t){const n=e.copy();return n.index_=t,n}function Zu(e){const t={};if(e.isDefault())return t;let n;var r;return n=e.index_===Su?"$priority":e.index_===Bu?"$value":e.index_===fu?"$key":(f(e.index_ instanceof Vu,"Unrecognized index type!"),e.index_.toString()),t.orderBy=O(n),e.startSet_&&(r=e.startAfterSet_?"startAfter":"startAt",t[r]=O(e.indexStartValue_),e.startNameSet_&&(t[r]+=","+O(e.indexStartName_))),e.endSet_&&(r=e.endBeforeSet_?"endBefore":"endAt",t[r]=O(e.indexEndValue_),e.endNameSet_&&(t[r]+=","+O(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function eh(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_),n.sin=!t.startAfterSet_),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_),n.ein=!t.endBeforeSet_),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==Su&&(n.i=t.index_.toString()),n}class th extends jl{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=el("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const a=th.getListenId_(e,r),o={};this.listens_[a]=o;var n=Zu(e._queryParams);this.restRequest_(s+".json",n,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),F(this.listens_,a)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var n=th.getListenId_(e,t);delete this.listens_[n]}get(e){var t=Zu(e._queryParams);const r=e._path.toString(),i=new y;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+j(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(a&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=P(r.responseText)}catch(e){ll("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,e)}else 401!==r.status&&404!==r.status&&ll("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})}}class nh{constructor(){this.rootNode_=Mu.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function rh(){return{value:null,children:new Map}}function ih(e,t,n){var r;eu(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=Gl(t),e.children.has(r)||e.children.set(r,rh()),ih(e.children.get(r),t=Ql(t),n))}function sh(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{sh(t,new zl(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class ah{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&gl(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class oh{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ah(e);var n=1e4+2e4*Math.random();yl(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;gl(e,(e,t)=>{0<t&&L(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),yl(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function ch(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function lh(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function uh(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(gA=Bc=Bc||{})[gA.OVERWRITE=0]="OVERWRITE",gA[gA.MERGE=1]="MERGE",gA[gA.ACK_USER_WRITE=2]="ACK_USER_WRITE",gA[gA.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class hh{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Bc.ACK_USER_WRITE,this.source=ch()}operationForChild(e){if(eu(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new zl(e));return new hh(Wl(),t,this.revert)}return f(Gl(this.path)===e,"operationForChild called for unrelated child."),new hh(Ql(this.path),this.affectedTree,this.revert)}}class dh{constructor(e,t){this.source=e,this.path=t,this.type=Bc.LISTEN_COMPLETE}operationForChild(e){return eu(this.path)?new dh(this.source,Wl()):new dh(this.source,Ql(this.path))}}class ph{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Bc.OVERWRITE}operationForChild(e){return eu(this.path)?new ph(this.source,Wl(),this.snap.getImmediateChild(e)):new ph(this.source,Ql(this.path),this.snap)}}class fh{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Bc.MERGE}operationForChild(e){if(eu(this.path)){const t=this.children.subtree(new zl(e));return t.isEmpty()?null:t.value?new ph(this.source,Wl(),t.value):new fh(this.source,Wl(),t)}return f(Gl(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new fh(this.source,Ql(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class gh{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(eu(e))return this.isFullyInitialized()&&!this.filtered_;var t=Gl(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class mh{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function vh(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),yh(n,i,"child_removed",e,r,t),yh(n,i,"child_added",e,r,t),yh(n,i,"child_moved",s,r,t),yh(n,i,"child_changed",e,r,t),yh(n,i,"value",e,r,t),i}function yh(s,a,t,e,o,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw u("Should only compare child_ events.");var r=new uu(t.childName,t.snapshotNode),i=new uu(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;o.forEach(e=>{e.respondsTo(t.type)&&a.push(e.createEvent(n,s.query_))})})}function _h(e,t){return{eventCache:e,serverCache:t}}function wh(e,t,n,r){return _h(new gh(t,n,r),e.serverCache)}function bh(e,t,n,r){return _h(e.eventCache,new gh(t,n,r))}function Ih(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Th(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Eh;class kh{constructor(e,t=(Eh=Eh||new vu(nl),Eh)){this.value=e,this.children=t}static fromObject(e){let n=new kh(null);return gl(e,(e,t)=>{n=n.set(new zl(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Wl(),value:this.value};if(eu(e))return null;{var n=Gl(e);const i=this.children.get(n);if(null===i)return null;var r=i.findRootMostMatchingPathAndValue(Ql(e),t);return null==r?null:{path:Zl(new zl(n),r.path),value:r.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(eu(e))return this;{var t=Gl(e);const n=this.children.get(t);return null!==n?n.subtree(Ql(e)):new kh(null)}}set(e,t){if(eu(e))return new kh(t,this.children);{var n=Gl(e);const i=this.children.get(n)||new kh(null);var r=i.set(Ql(e),t),r=this.children.insert(n,r);return new kh(this.value,r)}}remove(t){if(eu(t))return this.children.isEmpty()?new kh(null):new kh(null,this.children);{var n=Gl(t);const r=this.children.get(n);if(r){const i=r.remove(Ql(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new kh(null):new kh(this.value,e)}return this}}get(e){if(eu(e))return this.value;{var t=Gl(e);const n=this.children.get(t);return n?n.get(Ql(e)):null}}setTree(t,n){if(eu(t))return n;{var r=Gl(t);const i=this.children.get(r)||new kh(null),s=i.setTree(Ql(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new kh(this.value,e)}}fold(e){return this.fold_(Wl(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(Zl(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Wl(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(eu(e))return null;{r=Gl(e);const i=this.children.get(r);return i?i.findOnPath_(Ql(e),Zl(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Wl(),t)}foreachOnPath_(e,t,n){if(eu(e))return this;{this.value&&n(t,this.value);var r=Gl(e);const i=this.children.get(r);return i?i.foreachOnPath_(Ql(e),Zl(t,r),n):new kh(null)}}foreach(e){this.foreach_(Wl(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(Zl(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class Ch{constructor(e){this.writeTree_=e}static empty(){return new Ch(new kh(null))}}function Sh(t,n,r){if(eu(n))return new Ch(new kh(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=tu(s,n);return e=e.updateChild(i,r),new Ch(t.writeTree_.set(s,e))}s=new kh(r),s=t.writeTree_.setTree(n,s);return new Ch(s)}function Nh(e,n,t){let r=e;return gl(t,(e,t)=>{r=Sh(r,Zl(n,e),t)}),r}function Ah(e,t){if(eu(t))return Ch.empty();var n=e.writeTree_.setTree(t,new kh(null));return new Ch(n)}function Rh(e,t){return null!=Dh(e,t)}function Dh(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(tu(n.path,t)):null}function xh(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Su,(e,t)=>{n.push(new uu(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new uu(e,t.value))}),n}function Ph(e,t){if(eu(t))return e;var n=Dh(e,t);return null!=n?new Ch(new kh(n)):new Ch(e.writeTree_.subtree(t))}function Oh(e){return e.writeTree_.isEmpty()}function Mh(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(f(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(Zl(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(Zl(i,".priority"),n):s}}}(Wl(),e.writeTree_,t)}function Lh(e,t){return Hh(t,e)}function Fh(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);f(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var c=t.allWrites[o];c.visible&&(o>=r&&function(e,t){{if(e.snap)return iu(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&iu(Zl(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:iu(i.path,c.path)&&(a=!0)),o--}return!!s&&(a?((e=t).visibleWrites=qh(e.allWrites,Uh,Wl()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Ah(t.visibleWrites,i.path):gl(i.children,e=>{t.visibleWrites=Ah(t.visibleWrites,Zl(i.path,e))}),!0)}function Uh(e){return e.visible}function qh(e,t,n){let r=Ch.empty();for(let s=0;s<e.length;++s){const a=e[s];if(t(a)){var i=a.path;let e;if(a.snap)iu(n,i)?(e=tu(n,i),r=Sh(r,e,a.snap)):iu(i,n)&&(e=tu(i,n),r=Sh(r,Wl(),a.snap.getChild(e)));else{if(!a.children)throw u("WriteRecord should have .snap or .children");if(iu(n,i))e=tu(n,i),r=Nh(r,e,a.children);else if(iu(i,n))if(e=tu(i,n),eu(e))r=Nh(r,Wl(),a.children);else{const o=F(a.children,Gl(e));o&&(i=o.getChild(Ql(e)),r=Sh(r,Wl(),i))}}}}return r}function Vh(e,t,n,r,i){if(r||i){var s=Ph(e.visibleWrites,t);if(!i&&Oh(s))return n;if(i||null!=n||Rh(s,Wl()))return Mh(qh(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(iu(e.path,t)||iu(t,e.path))},t),n||Mu.EMPTY_NODE);return null}s=Dh(e.visibleWrites,t);if(null!=s)return s;s=Ph(e.visibleWrites,t);return Oh(s)?n:null!=n||Rh(s,Wl())?Mh(s,n||Mu.EMPTY_NODE):null}function Bh(e,t,n,r){return Vh(e.writeTree,e.treePath,t,n,r)}function jh(e,t){return function(e,t,n){let r=Mu.EMPTY_NODE;const i=Dh(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Su,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=Ph(e.visibleWrites,t);return n.forEachChild(Su,(e,t)=>{var n=Mh(Ph(s,new zl(e)),t);r=r.updateImmediateChild(e,n)}),xh(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return xh(Ph(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Kh(e,t,n,r){return function(e,t,n,r,i){f(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=Zl(t,n);return Rh(e.visibleWrites,s)?null:Oh(s=Ph(e.visibleWrites,s))?i.getChild(n):Mh(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function $h(e,t){return n=e.writeTree,t=Zl(e.treePath,t),Dh(n.visibleWrites,t);var n}function zh(e,t,n,r,i,s){return function(e,t,n,r,i,s,a){let o;var c=Ph(e.visibleWrites,t),l=Dh(c,Wl());if(null!=l)o=l;else{if(null==n)return[];o=Mh(c,n)}if(o=o.withIndex(a),o.isEmpty()||o.isLeafNode())return[];{const u=[],h=a.getCompare(),d=s?o.getReverseIteratorFrom(r,a):o.getIteratorFrom(r,a);let e=d.getNext();for(;e&&u.length<i;)0!==h(e,r)&&u.push(e),e=d.getNext();return u}}(e.writeTree,e.treePath,t,n,r,i,s)}function Wh(e,t,n){return r=e.writeTree,e=e.treePath,n=n,i=Zl(e,t=t),null!=(s=Dh(r.visibleWrites,i))?s:n.isCompleteForChild(t)?Mh(Ph(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null;var r,i,s}function Gh(e,t){return Hh(Zl(e.treePath,t),e.writeTree)}function Hh(e,t){return{treePath:e,writeTree:t}}class Qh{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,zu(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,$u(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Ku(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw u("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,zu(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Yh=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Xh{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new gh(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Wh(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Th(this.viewCache_),r=zh(this.writes_,r,t,1,n,e);return 0===r.length?null:r[0]}}function Jh(e,t,n,r,i){const s=new Qh;let a,o;if(n.type===Bc.OVERWRITE){var c=n;a=c.source.fromUser?td(e,t,c.path,c.snap,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered()&&!eu(c.path),ed(e,t,c.path,c.snap,r,i,o,s))}else if(n.type===Bc.MERGE){c=n;a=c.source.fromUser?function(r,i,s,e,a,o,c){let l=i;return e.foreach((e,t)=>{var n=Zl(s,e);nd(i,Gl(n))&&(l=td(r,l,n,t,a,o,c))}),e.foreach((e,t)=>{var n=Zl(s,e);nd(i,Gl(n))||(l=td(r,l,n,t,a,o,c))}),l}(e,t,c.path,c.children,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),id(e,t,c.path,c.children,r,i,o,s))}else if(n.type===Bc.ACK_USER_WRITE){var l=n;a=l.revert?function(n,r,i,s,e,a){let o;{if(null!=$h(s,i))return r;{var c=new Xh(s,r,e);const u=r.eventCache.getNode();let t;if(eu(i)||".priority"===Gl(i)){let e;e=r.serverCache.isFullyInitialized()?Bh(s,Th(r)):(l=r.serverCache.getNode(),f(l instanceof Mu,"serverChildren would be complete if leaf node"),jh(s,l)),e=e,t=n.filter.updateFullNode(u,e,a)}else{var l=Gl(i);let e=Wh(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,Ql(i),c,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,Mu.EMPTY_NODE,Ql(i),c,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(o=Bh(s,Th(r)),o.isLeafNode()&&(t=n.filter.updateFullNode(t,o,a)))}return o=r.serverCache.isFullyInitialized()||null!=$h(s,Wl()),wh(r,t,o,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,a,o){if(null!=$h(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(eu(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return ed(e,t,i,l.getNode().getChild(i),s,a,c,o);if(eu(i)){let n=new kh(null);return l.getNode().forEachChild(fu,(e,t)=>{n=n.set(new zl(e),t)}),id(e,t,i,n,s,a,c,o)}return t}{let r=new kh(null);return n.foreach((e,t)=>{var n=Zl(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),id(e,t,i,r,s,a,c,o)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==Bc.LISTEN_COMPLETE)throw u("Unknown operation type: "+n.type);a=function(e,t,n,r,i){const s=t.serverCache,a=bh(t,s.getNode(),s.isFullyInitialized()||eu(n),s.isFiltered());return Zh(e,a,n,r,Yh,i)}(e,t,n.path,r,s)}l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=Ih(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(ju(Ih(t)))}}(t,a,l),{viewCache:a,changes:l}}function Zh(r,i,s,a,o,c){const l=i.eventCache;if(null!=$h(a,s))return i;{let t,n;if(eu(s)){var e;f(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=jh(a,(e=Th(i))instanceof Mu?e:Mu.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=Bh(a,Th(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=Gl(s);if(".priority"===u){f(1===Hl(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=Kh(a,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=Ql(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=Kh(a,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):Wh(a,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,o,c):l.getNode()}}return wh(i,t,l.isFullyInitialized()||eu(s),r.filter.filtersNodes())}}function ed(e,t,n,r,i,s,a,o){const c=t.serverCache;let l;const u=a?e.filter:e.filter.getIndexedFilter();if(eu(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{var d=Gl(n);if(!c.isCompleteForPath(n)&&1<Hl(n))return t;var p=Ql(n);const f=c.getNode().getImmediateChild(d);h=f.updateChild(p,r);l=".priority"===d?u.updatePriority(c.getNode(),h):u.updateChild(c.getNode(),d,h,p,Yh,null)}p=bh(t,l,c.isFullyInitialized()||eu(n),u.filtersNodes());return Zh(e,p,n,i,new Xh(i,p,s),o)}function td(t,n,r,i,e,s,a){const o=n.eventCache;let c,l;const u=new Xh(e,n,s);if(eu(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,a),c=wh(n,l,!0,t.filter.filtersNodes());else{var h=Gl(r);if(".priority"===h)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=wh(n,l,o.isFullyInitialized(),o.isFiltered());else{var d=Ql(r);const p=o.getNode().getImmediateChild(h);let e;if(eu(d))e=i;else{const f=u.getCompleteChild(h);e=null!=f?".priority"===Yl(d)&&f.getChild(Jl(d)).isEmpty()?f:f.updateChild(d,i):Mu.EMPTY_NODE}c=p.equals(e)?n:wh(n,t.filter.updateChild(o.getNode(),h,e,d,u,a),o.isFullyInitialized(),t.filter.filtersNodes())}}return c}function nd(e,t){return e.eventCache.isCompleteForChild(t)}function rd(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function id(r,i,e,t,s,a,o,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=eu(e)?t:new kh(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{var n;u.hasChild(e)&&(n=rd(0,i.serverCache.getNode().getImmediateChild(e),t),l=ed(r,l,new zl(e),n,s,a,o,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||n||(n=rd(0,i.serverCache.getNode().getImmediateChild(e),t),l=ed(r,l,new zl(e),n,s,a,o,c))}),l}class sd{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Wu(n.getIndex()),i=(e=n).loadsAllData()?new Wu(e.getIndex()):new(e.hasLimit()?Hu:Gu)(e);this.processor_={filter:i};const s=t.serverCache,a=t.eventCache;var o=r.updateFullNode(Mu.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Mu.EMPTY_NODE,a.getNode(),null),o=new gh(o,s.isFullyInitialized(),r.filtersNodes()),c=new gh(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=_h(c,o),this.eventGenerator_=new mh(this.query_)}get query(){return this.query_}}function ad(e){return 0===e.eventRegistrations_.length}function od(n,r,i){const s=[];if(i){f(null==r,"A cancel should cancel all event registrations.");const a=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(i,a);t&&s.push(t)})}if(r){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){const o=n.eventRegistrations_[t];if(o.matches(r)){if(r.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(o)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return s}function cd(e,t,n,r){t.type===Bc.MERGE&&null!==t.source.queryId&&(f(Th(e.viewCache_),"We should always have a full cache before handling merges"),f(Ih(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=Jh(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,f(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),f(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,ld(e,s.changes,s.viewCache.eventCache.getNode(),null)}function ld(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return vh(e.eventGenerator_,t,n,i)}let ud;class hd{constructor(){this.views=new Map}}function dd(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return f(null!=e,"SyncTree gave us an op for an invalid query."),cd(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(cd(s,n,r,i));return e}}function pd(e,n,r,i,s){var a=n._queryIdentifier,a=e.views.get(a);if(a)return a;{let e=Bh(r,s?i:null),t=!1;t=!!e||(e=i instanceof Mu?jh(r,i):Mu.EMPTY_NODE,!1);a=_h(new gh(e,t,!1),new gh(i,s,!1));return new sd(n,a)}}function fd(e,t,n,r,i,s){var a=pd(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,a),a.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(Su,(e,t)=>{r.push(Ku(e,t))})}return n.isFullyInitialized()&&r.push(ju(n.getNode())),ld(e,r,n.getNode(),t)}(a,n)}function gd(e,t,n,r){var i=t._queryIdentifier;const s=[];let a=[];var o=wd(e);if("default"===i)for(var[c,l]of e.views.entries())a=a.concat(od(l,n,r)),ad(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(a=a.concat(od(u,n,r)),ad(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return o&&!wd(e)&&s.push((f(ud,"Reference.ts has not been loaded"),new ud(t._repo,t._path))),{removed:s,events:a}}function md(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function vd(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=Th(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!eu(t)&&!n.getImmediateChild(Gl(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function yd(e,t){const n=t._queryParams;if(n.loadsAllData())return bd(e);var r=t._queryIdentifier;return e.views.get(r)}function _d(e,t){return null!=yd(e,t)}function wd(e){return null!=bd(e)}function bd(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Id;let Td=1;class Ed{constructor(e){this.listenProvider_=e,this.syncPointTree_=new kh(null),this.pendingWriteTree_={visibleWrites:Ch.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function kd(e,t,n,r,i){var s,a,o,c;return s=e.pendingWriteTree_,a=t,o=n,c=r,r=i,f(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:c,visible:r=void 0===r?!0:r}),r&&(s.visibleWrites=Sh(s.visibleWrites,a,o)),s.lastWriteId=c,i?Od(e,new ph(ch(),t,n)):[]}function Cd(e,t,n,r){var i,s,a;i=e.pendingWriteTree_,s=t,a=n,r=r,f(r>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:a,writeId:r,visible:!0}),i.visibleWrites=Nh(i.visibleWrites,s,a),i.lastWriteId=r;var o=kh.fromObject(n);return Od(e,new fh(ch(),t,o))}function Sd(e,t,n=!1){var r=function(e,t){for(let r=0;r<e.allWrites.length;r++){var n=e.allWrites[r];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(Fh(e.pendingWriteTree_,t)){let t=new kh(null);return null!=r.snap?t=t.set(Wl(),!0):gl(r.children,e=>{t=t.set(new zl(e),!0)}),Od(e,new hh(r.path,t,n))}return[]}function Nd(e,t,n){return Od(e,new ph(lh(),t,n))}function Ad(n,e,t,r,i=!1){var s=e._path,a=n.syncPointTree_.get(s);let o=[];if(a&&("default"===e._queryIdentifier||_d(a,e))){var c=gd(a,e,t,r);0===a.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(s));const d=c.removed;if(o=c.events,!i){a=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),c=n.syncPointTree_.findOnPath(s,(e,t)=>wd(t));if(a&&!c){const p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){var l=p.fold((e,t,r)=>{if(t&&wd(t))return[bd(t)];{let n=[];return t&&(n=md(t)),gl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<l.length;++e){var u=l[e],h=u.query,u=Ld(n,u);n.listenProvider_.startListening(jd(h),Fd(n,h),u.hashFn,u.onComplete)}}}!c&&0<d.length&&!r&&(a?n.listenProvider_.stopListening(jd(e),null):d.forEach(e=>{var t=n.queryToTagMap.get(Ud(e));n.listenProvider_.stopListening(jd(e),t)}))}!function(e,t){for(let i=0;i<t.length;++i){const s=t[i];var n,r;s._queryParams.loadsAllData()||(n=Ud(s),r=e.queryToTagMap.get(n),e.queryToTagMap.delete(n),e.tagToQueryMap.delete(r))}}(n,d)}return o}function Rd(e,t,n,r){var i=qd(e,r);if(null==i)return[];var s=Vd(i),a=s.path,i=s.queryId,s=tu(a,t);return Bd(e,a,new ph(uh(i),s,n))}function Dd(e,t,n,r=!1){const i=t._path;let s=null,a=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{var n=tu(e,i);s=s||vd(t,n),a=a||wd(t)});let o=e.syncPointTree_.get(i);o?(a=a||wd(o),s=s||vd(o,Wl())):(o=new hd,e.syncPointTree_=e.syncPointTree_.set(i,o));let c;if(null!=s)c=!0;else{c=!1,s=Mu.EMPTY_NODE;const p=e.syncPointTree_.subtree(i);p.foreachChild((e,t)=>{var n=vd(t,Wl());n&&(s=s.updateImmediateChild(e,n))})}var l,u=_d(o,t);u||t._queryParams.loadsAllData()||(h=Ud(t),f(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),l=Td++,e.queryToTagMap.set(h,l),e.tagToQueryMap.set(l,h));var h=Lh(e.pendingWriteTree_,i);let d=fd(o,t,n,h,s,c);return u||a||r||(u=yd(o,t),d=d.concat(function(t,e,n){const r=e._path,i=Fd(t,e),s=Ld(t,n),a=t.listenProvider_.startListening(jd(e),i,s.hashFn,s.onComplete),o=t.syncPointTree_.subtree(r);if(i)f(!wd(o.value),"If we're adding a query, it shouldn't be shadowed");else{var c=o.fold((e,t,r)=>{if(!eu(e)&&t&&wd(t))return[bd(t).query];{let n=[];return t&&(n=n.concat(md(t).map(e=>e.query))),gl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(jd(l),Fd(t,l))}}return a}(e,t,u))),d}function xd(e,r,t){var n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(r,(e,t)=>{var n=vd(t,tu(e,r));if(n)return n});return Vh(n,r,i,t,!0)}function Pd(e,t){const r=t._path;let i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=tu(e,r);i=i||vd(t,n)});let n=e.syncPointTree_.get(r);n?i=i||vd(n,Wl()):(n=new hd,e.syncPointTree_=e.syncPointTree_.set(r,n));var s=null!=i;const a=s?new gh(i,!0,!1):null;var o=Lh(e.pendingWriteTree_,t._path);return Ih(pd(n,t,o,s?a.getNode():Mu.EMPTY_NODE,s).viewCache_)}function Od(e,t){return function t(n,r,i,s){{if(eu(n.path))return Md(n,r,i,s);{const a=r.get(Wl());null==i&&null!=a&&(i=vd(a,Wl()));let e=[];const o=Gl(n.path),c=n.operationForChild(o),l=r.children.get(o);if(l&&c){const u=i?i.getImmediateChild(o):null,h=Gh(s,o);e=e.concat(t(c,l,u,h))}return a&&(e=e.concat(dd(a,n,s,i))),e}}}(t,e.syncPointTree_,null,Lh(e.pendingWriteTree_,Wl()))}function Md(s,e,a,o){var t=e.get(Wl());null==a&&null!=t&&(a=vd(t,Wl()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=a?a.getImmediateChild(e):null,r=Gh(o,e),i=s.operationForChild(e);i&&(c=c.concat(Md(i,t,n,r)))}),t&&(c=c.concat(dd(t,s,o,a))),c}function Ld(i,t){const s=t.query,a=Fd(i,s);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||Mu.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return a?function(e,t,n){if(s=qd(e,n)){var r=Vd(s),i=r.path,s=r.queryId,r=tu(i,t);return Bd(e,i,new dh(uh(s),r))}return[]}(i,s._path,a):(t=i,n=s._path,Od(t,new dh(lh(),n)));var t,n,r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,s);return Ad(i,s,null,r)}}}function Fd(e,t){var n=Ud(t);return e.queryToTagMap.get(n)}function Ud(e){return e._path.toString()+"$"+e._queryIdentifier}function qd(e,t){return e.tagToQueryMap.get(t)}function Vd(e){var t=e.indexOf("$");return f(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new zl(e.substr(0,t))}}function Bd(e,t,n){var r=e.syncPointTree_.get(t);return f(r,"Missing sync point for query tag that we're tracking"),dd(r,n,Lh(e.pendingWriteTree_,t),null)}function jd(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(f(Id,"Reference.ts has not been loaded"),new Id(e._repo,e._path)):e}class Kd{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new Kd(t)}node(){return this.node_}}class $d{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=Zl(this.path_,e);return new $d(this.syncTree_,t)}node(){return xd(this.syncTree_,this.path_)}}function zd(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}function Wd(e,t,n){return e&&"object"==typeof e?(f(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Gd(e[".sv"],t,n):"object"==typeof e[".sv"]?Hd(e[".sv"],t):void f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const Gd=function(e,t,n){if("timestamp"===e)return n.timestamp;f(!1,"Unexpected server value: "+e)},Hd=function(e,t,n){e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&f(!1,"Unexpected increment value: "+r);const i=t.node();if(f(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i;var a=s.getValue();return"number"!=typeof a?r:a+r},Qd=function(e,t,n,r){return Xd(t,new $d(n,e),r)},Yd=function(e,t,n){return Xd(e,new Kd(t),n)};function Xd(e,r,i){var t=e.getPriority().val(),n=Wd(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const a=e;t=Wd(a.getValue(),r,i);return t!==a.getValue()||n!==a.getPriority().val()?new Eu(t,qu(n)):e}{const o=e;return s=o,n!==o.getPriority().val()&&(s=s.updatePriority(new Eu(n))),o.forEachChild(Su,(e,t)=>{var n=Xd(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class Jd{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Zd(e,t){let n=t instanceof zl?t:new zl(t),r=e,i=Gl(n);for(;null!==i;){var s=F(r.node.children,i)||{children:{},childCount:0};r=new Jd(i,r,s),n=Ql(n),i=Gl(n)}return r}function ep(e){return e.node.value}function tp(e,t){e.node.value=t,sp(e)}function np(e){return 0<e.node.childCount}function rp(n,r){gl(n.node.children,(e,t)=>{r(new Jd(e,n,t))})}function ip(e){return new zl(null===e.parent?e.name:ip(e.parent)+"/"+e.name)}function sp(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,r=function(e){return void 0===ep(e)&&!np(e)}(e=e),i=L(t.node.children,n),r&&i?(delete t.node.children[n],t.node.childCount--,sp(t)):r||i||(t.node.children[n]=e.node,t.node.childCount++,sp(t)))}function ap(e,t,n,r){r&&void 0===t||_p(Y(e,"value"),t,n)}function op(e,t,r,n){if(!n||void 0!==t){const i=Y(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];gl(t,(e,t)=>{const n=new zl(e);if(_p(i,t,Zl(r,n)),".priority"===Yl(n)&&!yp(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,n){let r,i;for(r=0;r<n.length;r++){i=n[r];var s=Xl(i);for(let e=0;e<s.length;e++)if((".priority"!==s[e]||e!==s.length-1)&&!gp(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.sort(nu);let e=null;for(r=0;r<n.length;r++){if(i=n[r],null!==e&&iu(e,i))throw new Error(t+"contains a path "+e.toString()+" that is ancestor of another path "+i.toString());e=i}}(i,s)}}function cp(e,t,n){if(!n||void 0!==t){if(hl(t))throw new Error(Y(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!yp(t))throw new Error(Y(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function lp(e,t,n,r){if(!(r&&void 0===n||gp(n)))throw new Error(Y(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function up(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),wp(e,t,n,r)}function hp(e,t){if(".info"===Gl(t))throw new Error(e+" failed = Can't modify data under /.info/")}const dp=/[\[\].#$\/\u0000-\u001F\u007F]/,pp=/[\[\].#$\u0000-\u001F\u007F]/,fp=10485760,gp=function(e){return"string"==typeof e&&0!==e.length&&!dp.test(e)},mp=function(e){return"string"==typeof e&&0!==e.length&&!pp.test(e)},vp=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),mp(e)},yp=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!hl(e)||e&&"object"==typeof e&&L(e,".sv")},_p=function(a,e,t){const o=t instanceof zl?new su(t,a):t;if(void 0===e)throw new Error(a+"contains undefined "+ou(o));if("function"==typeof e)throw new Error(a+"contains a function "+ou(o)+" with contents = "+e.toString());if(hl(e))throw new Error(a+"contains "+e.toString()+" "+ou(o));if("string"==typeof e&&e.length>fp/3&&ee(e)>fp)throw new Error(a+"contains a string greater than "+fp+" utf8 bytes "+ou(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(gl(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!gp(e)))throw new Error(a+" contains an invalid key ("+e+") "+ou(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n,r;n=o,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=ee(e),au(n),_p(a,t,o),t=o,r=t.parts_.pop(),t.byteLength_-=ee(r),0<t.parts_.length&&--t.byteLength_}),i&&s)throw new Error(a+' contains ".value" child '+ou(o)+" in addition to actual children.")}},wp=function(e,t,n,r){if(!(r&&void 0===n||mp(n)))throw new Error(Y(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},bp=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!gp(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!vp(n))throw new Error(Y(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Ip{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Tp(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i];var r=s.getPath();null===n||ru(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function Ep(e,t,n){Tp(e,n),Cp(e,e=>ru(e,t))}function kp(e,t,n){Tp(e,n),Cp(e,e=>iu(e,t)||iu(t,e))}function Cp(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let n=0;n<e.events.length;n++){const r=e.events[n];var t;null!==r&&(e.events[n]=null,t=r.getEventRunner(),Jc&&ol("event: "+r.toString()),Il(t))}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}const Sp="repo_interrupt",Np=25;class Ap{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ip,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=rh(),this.transactionQueueTree_=new Jd,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Rp(a,e,t){if(a.stats_=Ol(a.repoInfo_),a.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())a.server_=new th(a.repoInfo_,(e,t,n,r)=>{Pp(a,e,t,n,r)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>Op(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{O(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new lu(a.repoInfo_,e,(e,t,n,r)=>{Pp(a,e,t,n,r)},e=>{Op(a,e)},e=>{var n;n=a,gl(e,(e,t)=>{Mp(n,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}var n;a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(e=a.repoInfo_,t=()=>new oh(a.stats_,a.server_),n=e.toString(),Pl[n]||(Pl[n]=t()),Pl[n]),a.infoData_=new nh,a.infoSyncTree_=new Ed({startListening:(e,t,n,r)=>{let i=[];const s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=Nd(a.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Mp(a,"connected",!1),a.serverSyncTree_=new Ed({startListening:(r,e,t,i)=>(a.server_.listen(r,t,e,(e,t)=>{var n=i(e,t);kp(a.eventQueue_,r._path,n)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}})}function Dp(e){const t=e.infoData_.getNode(new zl(".info/serverTimeOffset"));var n=t.val()||0;return(new Date).getTime()+n}function xp(e){return zd({timestamp:Dp(e)})}function Pp(e,t,n,r,i){e.dataUpdateCount++;var s,a,o=new zl(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let c=[];c=i?r?(s=q(n,e=>qu(e)),function(e,t,n,r){if(o=qd(e,r)){var i=Vd(o),s=i.path,a=i.queryId,o=tu(s,t),i=kh.fromObject(n);return Bd(e,s,new fh(uh(a),o,i))}return[]}(e.serverSyncTree_,o,s,i)):(s=qu(n),Rd(e.serverSyncTree_,o,s,i)):r?(a=q(n,e=>qu(e)),t=e.serverSyncTree_,i=o,r=a,a=kh.fromObject(r),Od(t,new fh(lh(),i,a))):(a=qu(n),Nd(e.serverSyncTree_,o,a));let l=o;0<c.length&&(l=Wp(e,o)),kp(e.eventQueue_,l,c)}function Op(e,t){Mp(e,"connected",t),!1===t&&function(r){jp(r,"onDisconnectEvents");const i=xp(r),s=rh();sh(r.onDisconnect_,Wl(),(e,t)=>{var n=Qd(e,t,r.serverSyncTree_,i);ih(s,e,n)});let a=[];sh(s,Wl(),(e,t)=>{a=a.concat(Nd(r.serverSyncTree_,e,t));var n=Yp(r,e);Wp(r,n)}),r.onDisconnect_=rh(),kp(r.eventQueue_,Wl(),a)}(e)}function Mp(e,t,n){var r=new zl("/.info/"+t),i=qu(n);e.infoData_.updateSnapshot(r,i);i=Nd(e.infoSyncTree_,r,i);kp(e.eventQueue_,r,i)}function Lp(e){return e.nextWriteId_++}function Fp(r,i,e,t,s){jp(r,"set",{path:i.toString(),value:e,priority:t});var n=xp(r);const a=qu(e,t);var o=xd(r.serverSyncTree_,i),n=Yd(a,o,n);const c=Lp(r);n=kd(r.serverSyncTree_,i,n,c,!0);Tp(r.eventQueue_,n),r.server_.put(i.toString(),a.val(!0),(e,t)=>{var n="ok"===e;n||ll("set at "+i+" failed: "+e);n=Sd(r.serverSyncTree_,c,!n);kp(r.eventQueue_,i,n),Kp(0,s,e,t)});n=Yp(r,i);Wp(r,n),kp(r.eventQueue_,n,[])}function Up(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(eu(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(Su,(e,t)=>{ih(n,new zl(e),t)}),e(n,t)}}if(0<n.children.size){var r=Gl(t);return t=Ql(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),Kp(0,i,e,t)})}function qp(n,r,e,i){const s=qu(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&ih(n.onDisconnect_,r,s),Kp(0,i,e,t)})}function Vp(e,t,n){let r;r=".info"===Gl(t._path)?Ad(e.infoSyncTree_,t,n):Ad(e.serverSyncTree_,t,n),Ep(e.eventQueue_,t._path,r)}function Bp(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Sp)}function jp(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),ol(n,...t)}function Kp(e,r,i,s){r&&Il(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function $p(e,t,n){return xd(e.serverSyncTree_,t,n)||Mu.EMPTY_NODE}function zp(t,e=t.transactionQueueTree_){if(e||Qp(t,e),ep(e)){const n=Hp(t,e);f(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,a){const e=a.map(e=>e.currentWriteId),t=$p(i,s,e);let n=t;var r=t.hash();for(let u=0;u<a.length;u++){const h=a[u];f(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var o=tu(s,h.path);n=n.updateChild(o,h.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{jp(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<a.length;e++)a[e].status=2,n=n.concat(Sd(i.serverSyncTree_,a[e].currentWriteId)),a[e].onComplete&&r.push(()=>a[e].onComplete(null,!0,a[e].currentOutputSnapshotResolved)),a[e].unwatcher();Qp(i,Zd(i.transactionQueueTree_,s)),zp(i,i.transactionQueueTree_),kp(i.eventQueue_,s,n);for(let t=0;t<r.length;t++)Il(r[t])}else{if("datastale"===t)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{ll("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=t}Wp(i,s)}},r)}(t,ip(e),n)}else np(e)&&rp(e,e=>{zp(t,e)})}function Wp(e,t){var n=Gp(e,t),r=ip(n);return function(i,s,a){if(0!==s.length){const l=[];let n=[];const t=s.filter(e=>0===e.status),u=t.map(e=>e.currentWriteId);for(let r=0;r<s.length;r++){const h=s[r];var o=tu(a,h.path);let e=!1,t;if(f(null!==o,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,n=n.concat(Sd(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=Np)e=!0,t="maxretry",n=n.concat(Sd(i.serverSyncTree_,h.currentWriteId,!0));else{const d=$p(i,h.path,u);h.currentInputSnapshot=d;var c=s[r].update(d.val());if(void 0!==c){_p("transaction failed: Data returned ",c,h.path);let e=qu(c);"object"==typeof c&&null!=c&&L(c,".priority")||(e=e.updatePriority(d.getPriority()));o=h.currentWriteId,c=xp(i),c=Yd(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=Lp(i),u.splice(u.indexOf(o),1),n=n.concat(kd(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),n=n.concat(Sd(i.serverSyncTree_,o,!0))}else e=!0,t="nodata",n=n.concat(Sd(i.serverSyncTree_,h.currentWriteId,!0))}kp(i.eventQueue_,a,n),n=[],e&&(s[r].status=2,function(e){setTimeout(e,Math.floor(0))}(s[r].unwatcher),s[r].onComplete&&("nodata"===t?l.push(()=>s[r].onComplete(null,!1,s[r].currentInputSnapshot)):l.push(()=>s[r].onComplete(new Error(t),!1,null))))}Qp(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Il(l[e]);zp(i,i.transactionQueueTree_)}}(e,Hp(e,n),r),r}function Gp(e,t){let n,r=e.transactionQueueTree_;for(n=Gl(t);null!==n&&void 0===ep(r);)r=Zd(r,n),t=Ql(t),n=Gl(t);return r}function Hp(e,t){const n=[];return function t(n,e,r){const i=ep(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);rp(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function Qp(t,n){const r=ep(n);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,tp(n,0<r.length?r:void 0)}rp(n,e=>{Qp(t,e)})}function Yp(t,e){var n=ip(Gp(t,e)),r=Zd(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(r,e=>{Xp(t,e)}),Xp(t,r),function t(e,n,r,i){r&&!i&&n(e),rp(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(r,e=>{Xp(t,e)}),n}function Xp(i,s){const a=ep(s);if(a){const o=[];let e=[],t=-1;for(let n=0;n<a.length;n++)3===a[n].status||(1===a[n].status?(f(t===n-1,"All SENT items should be at beginning of queue."),t=n,a[n].status=3,a[n].abortReason="set"):(f(0===a[n].status,"Unexpected transaction status in abort"),a[n].unwatcher(),e=e.concat(Sd(i.serverSyncTree_,a[n].currentWriteId,!0)),a[n].onComplete&&o.push(a[n].onComplete.bind(null,new Error("set"),!1,null))));-1===t?tp(s,void 0):a.length=t+1,kp(i.eventQueue_,ip(s),e);for(let r=0;r<o.length;r++)Il(o[r])}}const Jp=function(e,t){var n=Zp(e),r=n.namespace;"firebase.com"===n.domain&&cl(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||cl("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||ul();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Al(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new zl(n.pathString)}},Zp=function(r){let i="",s="",a="",o="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(o=function(e){let t="";var n=e.split("/");for(let r=0;r<n.length;r++)if(0<n[r].length){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(r.substring(t,n)));var d,p=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):ll(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(d=i.indexOf("."),a=i.substring(0,d).toLowerCase(),s=i.substring(d+1),c=a),"ns"in p&&(c=p.ns)}return{host:i,port:h,domain:s,subdomain:a,secure:l,scheme:u,pathString:o,namespace:c}},ef="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",tf=function(){let s=0;const a=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=ef.charAt(e%64),e=Math.floor(e/64);f(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===a[n];n--)a[n]=0;a[n]++}else for(n=0;n<12;n++)a[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=ef.charAt(a[n]);return f(20===i.length,"nextPushId: Length should be 20."),i}}();class nf{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+O(this.snapshot.exportVal())}}class rf{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class sf{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class af{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new y;return Up(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){hp("OnDisconnect.remove",this._path);const e=new y;return qp(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){hp("OnDisconnect.set",this._path),ap("OnDisconnect.set",e,this._path,!1);const t=new y;return qp(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){hp("OnDisconnect.setWithPriority",this._path),ap("OnDisconnect.setWithPriority",e,this._path,!1),cp("OnDisconnect.setWithPriority",t,!1);const n=new y;return function(n,r,e,t,i){const s=qu(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&ih(n.onDisconnect_,r,s),Kp(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){hp("OnDisconnect.update",this._path),op("OnDisconnect.update",e,this._path,!1);const t=new y;return function(r,i,n,s){if(U(n))return ol("onDisconnect().update() called with empty data.  Don't do anything."),Kp(0,s,"ok",void 0);r.server_.onDisconnectMerge(i.toString(),n,(e,t)=>{"ok"===e&&gl(n,(e,t)=>{var n=qu(t);ih(r.onDisconnect_,Zl(i,e),n)}),Kp(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class of{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return eu(this._path)?null:Yl(this._path)}get ref(){return new hf(this._repo,this._path)}get _queryIdentifier(){var e=eh(this._queryParams),e=il(e);return"{}"===e?"default":e}get _queryObject(){return eh(this._queryParams)}isEqual(e){if(!((e=ae(e))instanceof of))return!1;var t=this._repo===e._repo,n=ru(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function cf(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function lf(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===fu){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==dl)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==pl)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Su){if(null!=t&&!yp(t)||null!=n&&!yp(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(e.getIndex()instanceof Vu||e.getIndex()===Bu,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function uf(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class hf extends of{constructor(e,t){super(e,t,new Qu,!1)}get parent(){var e=Jl(this._path);return null===e?null:new hf(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class df{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new zl(e),n=gf(this.ref,e);return new df(this._node.getChild(t),n,Su)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new df(t,gf(this.ref,e),Su)))}hasChild(e){var t=new zl(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function pf(e,t){return(e=ae(e))._checkNotDeleted("ref"),void 0!==t?gf(e._root,t):e._root}function ff(e,t){(e=ae(e))._checkNotDeleted("refFromURL");const n=Jp(t,e._repo.repoInfo_.nodeAdmin);bp("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||cl("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),pf(e,n.path.toString())}function gf(e,t){return(null===Gl((e=ae(e))._path)?up:wp)("child","path",t,!1),new hf(e._repo,Zl(e._path,t))}function mf(e,t){e=ae(e),hp("set",e._path),ap("set",t,e._path,!1);const n=new y;return Fp(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function vf(e,t){op("update",t,e._path,!1);const n=new y;return function(i,s,e,a){jp(i,"update",{path:s.toString(),value:e});let n=!0;const r=xp(i),o={};if(gl(e,(e,t)=>{n=!1,o[e]=Qd(Zl(s,e),qu(t),i.serverSyncTree_,r)}),n)ol("update() called with empty data.  Don't do anything."),Kp(0,a,"ok",void 0);else{const c=Lp(i);var t=Cd(i.serverSyncTree_,s,o,c);Tp(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||ll("update at "+s+" failed: "+e);var r=Sd(i.serverSyncTree_,c,!n),n=0<r.length?Wp(i,s):s;kp(i.eventQueue_,n,r),Kp(0,a,e,t)}),gl(e,e=>{var t=Yp(i,Zl(s,e));Wp(i,t)}),kp(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function yf(t){t=ae(t);var i,s,a,e=new sf(()=>{}),e=new _f(e);return i=t._repo,s=t,a=e,(null!=(e=Pd(i.serverSyncTree_,s))?Promise.resolve(e):i.server_.get(s).then(e=>{var t,n=qu(e).withIndex(s._queryParams.getIndex());Dd(i.serverSyncTree_,s,a,!0);let r;return r=s._queryParams.loadsAllData()?Nd(i.serverSyncTree_,s._path,n):(t=Fd(i.serverSyncTree_,s),Rd(i.serverSyncTree_,s._path,n,t)),kp(i.eventQueue_,s._path,r),Ad(i.serverSyncTree_,s,a,null,!0),n},e=>(jp(i,"get for query "+O(s)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new df(e,new hf(t._repo,t._path),t._queryParams.getIndex()))}class _f{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new nf("value",this,new df(e.snapshotNode,new hf(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rf(this,e,t):null}matches(e){return e instanceof _f&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class wf{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rf(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");var n=gf(new hf(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new nf(e.type,this,new df(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof wf&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function bf(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const c=t;var a=(e,t)=>{Vp(n._repo,n,o),c(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new sf(t,s||void 0);const o="value"===e?new _f(a):new wf(e,a);return function(e,t,n){let r;r=".info"===Gl(t._path)?Dd(e.infoSyncTree_,t,n):Dd(e.serverSyncTree_,t,n),Ep(e.eventQueue_,t._path,r)}(n._repo,n,o),()=>Vp(n._repo,n,o)}function If(e,t,n,r){return bf(e,"value",t,n,r)}function Tf(e,t,n,r){return bf(e,"child_added",t,n,r)}function Ef(e,t,n,r){return bf(e,"child_changed",t,n,r)}function kf(e,t,n,r){return bf(e,"child_moved",t,n,r)}function Cf(e,t,n,r){return bf(e,"child_removed",t,n,r)}function Sf(e,t,n){let r=null;var i=n?new sf(n):null;"value"===t?r=new _f(i):t&&(r=new wf(t,i)),Vp(e._repo,e,r)}class Nf{}class Af extends Nf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ap("endAt",this._value,e._path,!0);var t=Xu(e._queryParams,this._value,this._key);if(uf(t),lf(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new of(e._repo,e._path,t,e._orderByCalled)}}class Rf extends Nf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ap("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===fu||n?Xu(e,t,n):Xu(e,t,dl),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(uf(t),lf(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new of(e._repo,e._path,t,e._orderByCalled)}}class Df extends Nf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ap("startAt",this._value,e._path,!0);var t=Yu(e._queryParams,this._value,this._key);if(uf(t),lf(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new of(e._repo,e._path,t,e._orderByCalled)}}class xf extends Nf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){ap("startAfter",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===fu||n?Yu(e,t,n):Yu(e,t,pl),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(uf(t),lf(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new of(e._repo,e._path,t,e._orderByCalled)}}class Pf extends Nf{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new of(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class Of extends Nf{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new of(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Mf extends Nf{constructor(e){super(),this._path=e}_apply(e){cf(e,"orderByChild");var t=new zl(this._path);if(eu(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new Vu(t),t=Ju(e._queryParams,t);return lf(t),new of(e._repo,e._path,t,!0)}}class Lf extends Nf{_apply(e){cf(e,"orderByKey");var t=Ju(e._queryParams,fu);return lf(t),new of(e._repo,e._path,t,!0)}}class Ff extends Nf{_apply(e){cf(e,"orderByPriority");var t=Ju(e._queryParams,Su);return lf(t),new of(e._repo,e._path,t,!0)}}class Uf extends Nf{_apply(e){cf(e,"orderByValue");var t=Ju(e._queryParams,Bu);return lf(t),new of(e._repo,e._path,t,!0)}}class qf extends Nf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(ap("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Af(this._value,this._key)._apply(new Df(this._value,this._key)._apply(e))}}function Vf(e,...t){let n=ae(e);for(const r of t)n=r._apply(n);return n}jc=hf,f(!ud,"__referenceConstructor has already been defined"),ud=jc,Kc=hf,f(!Id,"__referenceConstructor has already been defined"),Id=Kc;const Bf="FIREBASE_DATABASE_EMULATOR_HOST",jf={};let Kf=!1;function $f(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||cl("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ol("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let a=Jp(s,i),o=a.repoInfo,c,l=void 0;"undefined"!=typeof process&&process.env&&(l=process.env[Bf]),l?(c=!0,s=`http://${l}?ns=${o.namespace}`,a=Jp(s,i),o=a.repoInfo):c=!a.repoInfo.secure;var u=i&&c?new kl(kl.OWNER):new El(e.name,e.options,t);bp("Invalid Firebase Database URL",a),eu(a.path)||cl("Database URL must point to the root of a Firebase Database (not including a child path).");u=function(e,t,n,r){let i=jf[t.name];i||(i={},jf[t.name]=i);var s=i[e.toURLString()];s&&cl("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Ap(e,Kf,n,r),i[e.toURLString()]=s}(o,e,u,new Tl(e.name,n));return new zf(u,e)}class zf{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Rp(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new hf(this._repo,Wl())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=jf[t];n&&n[e.key]===e||cl(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Bp(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&cl("Cannot call "+e+" on a deleted database.")}}function Wf(){Vl.IS_TRANSPORT_INITIALIZED&&ll("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Gf(){Wf(),Ll.forceDisallow()}function Hf(){Wf(),ql.forceDisallow(),Ll.forceAllow()}function Qf(e,t,n,r={}){(e=ae(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&cl("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let a=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&cl('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new kl(kl.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:_(r.mockUserToken,e.app.options.projectId),a=new kl(i)),r=s,e=t,t=n,n=a,r.repoInfo_=new Al(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0),n&&(r.authTokenProvider_=n)}function Yf(e){(e=ae(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Sp)}function Xf(e,t){al(e,t)}const Jf={".sv":"timestamp"};class Zf{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function eg(i,e,t){if(i=ae(i),hp("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r;const s=new y;var r=If(i,()=>{});return function(t,n,e,r,i,s){jp(t,"transaction on "+n);const a={path:n,update:e,onComplete:r,status:null,order:Yc(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},o=$p(t,n,void 0);a.currentInputSnapshot=o;var c=a.update(o.val());if(void 0===c)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{_p("transaction failed: Data returned ",c,a.path),a.status=0;var l=Zd(t.transactionQueueTree_,n);const u=ep(l)||[];u.push(a),tp(l,u);let e;if("object"==typeof c&&null!==c&&L(c,".priority"))e=F(c,".priority"),f(yp(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const h=xd(t.serverSyncTree_,n)||Mu.EMPTY_NODE;e=h.getPriority().val()}l=xp(t),c=qu(c,e),l=Yd(c,o,l);a.currentOutputSnapshotRaw=c,a.currentOutputSnapshotResolved=l,a.currentWriteId=Lp(t);l=kd(t.serverSyncTree_,n,l,a.currentWriteId,a.applyLocally);kp(t.eventQueue_,n,l),zp(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new df(n,new hf(i._repo,i._path),Su),s.resolve(new Zf(t,r)))},r,n),s.promise}lu.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},lu.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Lc(Ye),We(new oe("database",(e,{instanceIdentifier:t})=>{return $f(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),et(Oc,"0.14.4",$c),et(Oc,"0.14.4","esm2017");function tg(e){var t="FIREBASE WARNING: "+e;ng.warn(t)}const ng=new me("@firebase/database-compat");class rg{constructor(e){this._delegate=e}cancel(t){Q("OnDisconnect.cancel",0,1,arguments.length),X("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Q("OnDisconnect.remove",0,1,arguments.length),X("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Q("OnDisconnect.set",1,2,arguments.length),X("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Q("OnDisconnect.setWithPriority",2,3,arguments.length),X("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Q("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,tg("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}X("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class ig{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Q("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class sg{constructor(e,t){this._database=e,this._delegate=t}val(){return Q("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Q("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Q("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Q("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Q("DataSnapshot.child",0,1,arguments.length),e=String(e),wp("DataSnapshot.child","path",e,!1),new sg(this._database,this._delegate.child(e))}hasChild(e){return Q("DataSnapshot.hasChild",1,1,arguments.length),wp("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Q("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Q("DataSnapshot.forEach",1,1,arguments.length),X("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new sg(this._database,e)))}hasChildren(){return Q("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Q("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Q("DataSnapshot.ref",0,0,arguments.length),new og(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class ag{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){var i;Q("Query.on",2,4,arguments.length),X("Query.on","callback",n,!1);const s=ag.getCancelAndContextArgs_("Query.on",t,r);var a=(e,t)=>{n.call(s.context,new sg(this.database,e),t)};a.userCallback=n,a.context=s.context;var o=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return If(this._delegate,a,o),n;case"child_added":return Tf(this._delegate,a,o),n;case"child_removed":return Cf(this._delegate,a,o),n;case"child_changed":return Ef(this._delegate,a,o),n;case"child_moved":return kf(this._delegate,a,o),n;default:throw new Error(Y("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Q("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Y(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),X("Query.off","callback",t,!0),J("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,Sf(this._delegate,e,r)):Sf(this._delegate,e)}get(){return yf(this._delegate).then(e=>new sg(this.database,e))}once(e,r,t,n){Q("Query.once",1,4,arguments.length),X("Query.once","callback",r,!0);const i=ag.getCancelAndContextArgs_("Query.once",t,n),s=new y;var a=(e,t)=>{var n=new sg(this.database,e);r&&r.call(i.context,n,t),s.resolve(n)};a.userCallback=r,a.context=i.context;var o=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":If(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":Tf(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":Cf(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":Ef(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":kf(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(Y("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Q("Query.limitToFirst",1,1,arguments.length),new ag(this.database,Vf(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Pf(e)}(e)))}limitToLast(e){return Q("Query.limitToLast",1,1,arguments.length),new ag(this.database,Vf(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Of(e)}(e)))}orderByChild(e){return Q("Query.orderByChild",1,1,arguments.length),new ag(this.database,Vf(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return wp("orderByChild","path",e,!1),new Mf(e)}(e)))}orderByKey(){return Q("Query.orderByKey",0,0,arguments.length),new ag(this.database,Vf(this._delegate,new Lf))}orderByPriority(){return Q("Query.orderByPriority",0,0,arguments.length),new ag(this.database,Vf(this._delegate,new Ff))}orderByValue(){return Q("Query.orderByValue",0,0,arguments.length),new ag(this.database,Vf(this._delegate,new Uf))}startAt(e=null,t){return Q("Query.startAt",0,2,arguments.length),new ag(this.database,Vf(this._delegate,([e=null,t]=[e,t],lp("startAt","key",t,!0),new Df(e,t))))}startAfter(e=null,t){return Q("Query.startAfter",0,2,arguments.length),new ag(this.database,Vf(this._delegate,(e=e,t=t,lp("startAfter","key",t,!0),new xf(e,t))))}endAt(e=null,t){return Q("Query.endAt",0,2,arguments.length),new ag(this.database,Vf(this._delegate,(e=e,t=t,lp("endAt","key",t,!0),new Af(e,t))))}endBefore(e=null,t){return Q("Query.endBefore",0,2,arguments.length),new ag(this.database,Vf(this._delegate,(e=e,t=t,lp("endBefore","key",t,!0),new Rf(e,t))))}equalTo(e,t){return Q("Query.equalTo",1,2,arguments.length),new ag(this.database,Vf(this._delegate,(e=e,t=t,lp("equalTo","key",t,!0),new qf(e,t))))}toString(){return Q("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Q("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Q("Query.isEqual",1,1,arguments.length),e instanceof ag)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,X(e,"cancel",r.cancel,!0),r.context=n,J(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Y(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new og(this.database,new hf(this._delegate._repo,this._delegate._path))}}class og extends ag{constructor(e,t){super(e,new of(t._repo,t._path,new Qu,!1)),this.database=e,this._delegate=t}getKey(){return Q("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Q("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new og(this.database,gf(this._delegate,e))}getParent(){Q("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new og(this.database,e):null}getRoot(){return Q("Reference.root",0,0,arguments.length),new og(this.database,this._delegate.root)}set(e,t){Q("Reference.set",1,2,arguments.length),X("Reference.set","onComplete",t,!0);const n=mf(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Q("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,tg("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}hp("Reference.update",this._delegate._path),X("Reference.update","onComplete",n,!0);const e=vf(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Q("Reference.setWithPriority",2,3,arguments.length),X("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(hp("setWithPriority",e._path),ap("setWithPriority",t,e._path,!1),cp("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new y;return Fp(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Q("Reference.remove",0,1,arguments.length),X("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,hp("remove",n._path),mf(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Q("Reference.transaction",1,3,arguments.length),X("Reference.transaction","transactionUpdate",e,!1),X("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Y(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=eg(this._delegate,e,{applyLocally:n}).then(e=>new ig(e.committed,new sg(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Q("Reference.setPriority",1,2,arguments.length),X("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=ae(e),hp("setPriority",e._path),cp("setPriority",t,!1);const n=new y;return Fp(e._repo,Zl(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Q("Reference.push",0,2,arguments.length),X("Reference.push","onComplete",t,!0);const n=function(e,t){e=ae(e),hp("push",e._path),ap("push",t,e._path,!0);var n=Dp(e._repo),n=tf(n);const r=gf(e,n),i=gf(e,n);let s;return s=null!=t?mf(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new og(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new og(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return hp("Reference.onDisconnect",this._delegate._path),new rg(new af(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class cg{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Gf,forceLongPolling:Hf}}useEmulator(e,t,n={}){Qf(this._delegate,e,t,n)}ref(e){if(Q("database.ref",0,1,arguments.length),e instanceof og){var t=ff(this._delegate,e.toString());return new og(this,t)}t=pf(this._delegate,e);return new og(this,t)}refFromURL(e){Q("database.refFromURL",1,1,arguments.length);var t=ff(this._delegate,e);return new og(this,t)}goOffline(){var e;Q("database.goOffline",0,0,arguments.length),(e=ae(e=this._delegate))._checkNotDeleted("goOffline"),Bp(e._repo)}goOnline(){return Q("database.goOnline",0,0,arguments.length),Yf(this._delegate)}}cg.ServerValue={TIMESTAMP:Jf,increment:e=>({".sv":{increment:e}})};var lg,ug=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Lc(n);const a=new le("auth-internal",new ue("database-standalone"));return a.setComponent(new oe("auth-internal",()=>r,"PRIVATE")),{instance:new cg($f(e,a,void 0,t,s),e),namespace:i}}});const hg=cg.ServerValue;(lg=wt).INTERNAL.registerComponent(new oe("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new cg(r,n)},"PUBLIC").setServiceProps({Reference:og,Query:ag,Database:cg,DataSnapshot:sg,enableLogging:Xf,INTERNAL:ug,ServerValue:hg}).setMultipleInstances(!0)),lg.registerVersion("@firebase/database-compat","0.3.4");var yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},dg={},pg=yt||self;function fg(){}function gg(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function mg(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var vg="closure_uid_"+(1e9*Math.random()>>>0),yg=0;function _g(e,t,n){return e.call.apply(e.bind,arguments)}function wg(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function bg(e,t,n){return(bg=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_g:wg).apply(null,arguments)}function Ig(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Tg(e,s){function t(){}t.prototype=s.prototype,e.X=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Wb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function Eg(){this.s=this.s,this.o=this.o}Eg.prototype.s=!1,Eg.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,vg)&&e[vg]||(e[vg]=++yg))},Eg.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const kg=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Cg(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function Sg(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(gg(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function Ng(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Ng.prototype.h=function(){this.defaultPrevented=!0};var Ag=function(){if(!pg.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{pg.addEventListener("test",fg,t),pg.removeEventListener("test",fg,t)}catch(e){}return e}();function Rg(e){return/^[\s\xa0]*$/.test(e)}var Dg=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function xg(e,t){return e<t?-1:t<e?1:0}function Pg(){var e=pg.navigator;return(e=e&&e.userAgent)?e:""}function Og(e){return-1!=Pg().indexOf(e)}function Mg(e){return Mg[" "](e),e}Mg[" "]=fg;var Lg,Fg=Og("Opera"),Ug=Og("Trident")||Og("MSIE"),qg=Og("Edge"),Vg=qg||Ug,Bg=Og("Gecko")&&!(-1!=Pg().toLowerCase().indexOf("webkit")&&!Og("Edge"))&&!(Og("Trident")||Og("MSIE"))&&!Og("Edge"),jg=-1!=Pg().toLowerCase().indexOf("webkit")&&!Og("Edge");function Kg(){var e=pg.document;return e?e.documentMode:void 0}e:{var $g="",zg=(zg=Pg(),Bg?/rv:([^\);]+)(\)|;)/.exec(zg):qg?/Edge\/([\d\.]+)/.exec(zg):Ug?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(zg):jg?/WebKit\/(\S+)/.exec(zg):Fg?/(?:Version)[ \/]?(\S+)/.exec(zg):void 0);if(zg&&($g=zg?zg[1]:""),Ug){zg=Kg();if(null!=zg&&zg>parseFloat($g)){Lg=String(zg);break e}}Lg=$g}var Wg={};function Gg(){return e=function(){let e=0;var t=Dg(String(Lg)).split("."),n=Dg("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++)for(var i=t[a]||"",s=n[a]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=i[0].length||0!=s[0].length)&&(e=xg(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||xg(0==i[2].length,0==s[2].length)||xg(i[2],s[2]),i=i[3],s=s[3],0==e););return 0<=e},t=Wg,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var Hg=pg.document&&Ug&&(Kg()||parseInt(Lg,10))||void 0;function Qg(e,t){if(Ng.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Bg){e:{try{Mg(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Yg[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&Qg.X.h.call(this)}}Tg(Qg,Ng);var Yg={2:"touch",3:"pen",4:"mouse"};Qg.prototype.h=function(){Qg.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Xg="closure_listenable_"+(1e6*Math.random()|0),Jg=0;function Zg(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Jg,this.ba=this.ea=!1}function em(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function tm(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function nm(e){const t={};for(const n in e)t[n]=e[n];return t}const rm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function im(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<rm.length;e++)n=rm[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function sm(e){this.src=e,this.g={},this.h=0}function am(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=kg(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(em(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function om(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}sm.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=om(e,t,r,i);return-1<a?(t=e[a],n||(t.ea=!1)):((t=new Zg(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var cm="closure_lm_"+(1e6*Math.random()|0),lm={};function um(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}r=vm(r);return t&&t[Xg]?t.O(n,r,mg(i)?!!i.capture:!!i,s):hm(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)um(e,t[s],n,r,i);return null}return n=vm(n),e&&e[Xg]?e.N(t,n,mg(r)?!!r.capture:!!r,i):hm(e,t,n,!1,r,i)}function hm(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=mg(i)?!!i.capture:!!i,o=gm(e);if(o||(e[cm]=o=new sm(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=fm;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!Ag?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(pm(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function dm(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[Xg]?am(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(pm(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=gm(t))?(am(n,e),0==n.h&&(n.src=null,t[cm]=null)):em(e)))}function pm(e){return e in lm?lm[e]:lm[e]="on"+e}function fm(e,t){var n,r;return e=!!e.ba||(t=new Qg(t,this),n=e.listener,r=e.ha||e.src,e.ea&&dm(e),n.call(r,t))}function gm(e){return(e=e[cm])instanceof sm?e:null}var mm="__closure_events_fn_"+(1e9*Math.random()>>>0);function vm(t){return"function"==typeof t?t:(t[mm]||(t[mm]=function(e){return t.handleEvent(e)}),t[mm])}function ym(){Eg.call(this),this.i=new sm(this),(this.P=this).I=null}function _m(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new Ng(t,e):t instanceof Ng?t.target=t.target||e:(a=t,im(t=new Ng(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=wm(s,r,!0,t)&&a;if(a=wm(s=t.g=e,r,!0,t)&&a,a=wm(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=wm(s=t.g=n[i],r,!1,t)&&a}function wm(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,c=t[s];c&&!c.ba&&c.capture==n&&(a=c.listener,o=c.ha||c.src,c.ea&&am(e.i,c),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}Tg(ym,Eg),ym.prototype[Xg]=!0,ym.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=mg(i)?!!i.capture:!!i,r=vm(r),t&&t[Xg]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=om(a=t.g[n],r,i,s))&&(em(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&gm(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?om(n,r,i,s):t)?n[t]:null)&&dm(r))}(this,e,t,n,r)},ym.prototype.M=function(){if(ym.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)em(n[r]);delete t.g[e],t.h--}}this.I=null},ym.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ym.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var bm=pg.JSON.stringify;var Im,Tm=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Em,e=>e.reset());class Em{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function km(e,t){var n;Im||(n=pg.Promise.resolve(void 0),Im=function(){n.then(Nm)}),Cm||(Im(),Cm=!0),Sm.add(e,t)}var Cm=!1,Sm=new class{constructor(){this.h=this.g=null}add(e,t){const n=Tm.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Nm(){for(var e;e=function(){var e=Sm;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){pg.setTimeout(()=>{throw e},0)}(e)}var t=Tm;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Cm=!1}function Am(e,t){ym.call(this),this.h=e||1,this.g=t||pg,this.j=bg(this.lb,this),this.l=Date.now()}function Rm(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Dm(e,t,n){if("function"==typeof e)n&&(e=bg(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=bg(e.handleEvent,e)}return 2147483647<Number(t)?-1:pg.setTimeout(e,t||0)}Tg(Am,ym),(bt=Am.prototype).ca=!1,bt.R=null,bt.lb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),_m(this,"tick"),this.ca&&(Rm(this),this.start())))},bt.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},bt.M=function(){Am.X.M.call(this),Rm(this),delete this.g};class xm extends Eg{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Dm(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(pg.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pm(e){Eg.call(this),this.h=e,this.g={}}Tg(Pm,Eg);var Om=[];function Mm(e,t,n,r){Array.isArray(n)||(n&&(Om[0]=n.toString()),n=Om);for(var i=0;i<n.length;i++){var s=um(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Lm(e){tm(e.g,function(e,t){this.g.hasOwnProperty(t)&&dm(e)},e),e.g={}}function Fm(){this.g=!0}function Um(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return bm(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Pm.prototype.M=function(){Pm.X.M.call(this),Lm(this)},Pm.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Fm.prototype.Aa=function(){this.g=!1},Fm.prototype.info=function(){};var qm={},Vm=null;function Bm(){return Vm=Vm||new ym}function jm(e){Ng.call(this,qm.Pa,e)}function Km(){var e=Bm();_m(e,new jm(e))}function $m(e,t){Ng.call(this,qm.STAT_EVENT,e),this.stat=t}function zm(e){var t=Bm();_m(t,new $m(t,e))}function Wm(e,t){Ng.call(this,qm.Qa,e),this.size=t}function Gm(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return pg.setTimeout(function(){e()},t)}qm.Pa="serverreachability",Tg(jm,Ng),qm.STAT_EVENT="statevent",Tg($m,Ng),qm.Qa="timingevent",Tg(Wm,Ng);It={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},zc={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Hm(){}function Qm(e){return e.h||(e.h=e.i())}function Ym(){}Hm.prototype.h=null;yt={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Xm(){Ng.call(this,"d")}function Jm(){Ng.call(this,"c")}function Zm(){}function ev(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new Pm(this),this.O=rv,this.T=new Am(e=Vg?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new tv}function tv(){this.i=null,this.g="",this.h=!1}Tg(Xm,Ng),Tg(Jm,Ng),Tg(Zm,Hm),Zm.prototype.g=function(){return new XMLHttpRequest},Zm.prototype.i=function(){return{}};var nv=new Zm,rv=45e3,iv={},sv={};function av(e,t,n){e.K=1,e.v=Ev(_v(t)),e.s=n,e.P=!0,ov(e,null)}function ov(e,t){e.F=Date.now(),uv(e),e.A=_v(e.v);var a,o,c,l,u,h,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Fv(n.i,"t",r),e.C=0,n=e.l.H,e.h=new tv,e.g=Ly(e.l,n?t:null,!e.s),0<e.N&&(e.L=new xm(bg(e.La,e,e.g),e.N)),Mm(e.S,e.g,"readystatechange",e.ib),t=e.H?nm(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),Km(),a=e.j,o=e.u,c=e.A,l=e.m,u=e.U,h=e.s,a.info(function(){if(a.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+o+"\n"+c+"\n"+e})}function cv(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function lv(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if(i=(a=n,c=o=void 0,o=(s=e).C,-1==(c=a.indexOf("\n",o))?sv:(o=Number(a.substring(o,c)),isNaN(o)?iv:(c+=1)+o>a.length?sv:(a=a.substr(c,o),s.C=c+o,a))),i==sv){4==t&&(e.o=4,zm(14),r=!1),Um(e.j,e.m,null,"[Incomplete Response]");break}if(i==iv){e.o=4,zm(15),Um(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Um(e.j,e.m,i,null),gv(e,i)}var s,a,o,c;cv(e)&&i!=sv&&i!=iv&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,zm(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ny(t),t.K=!0,zm(11))):(Um(e.j,e.m,n,"[Invalid Chunked Response]"),fv(e),pv(e))}function uv(e){e.V=Date.now()+e.O,hv(e,e.O)}function hv(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Gm(bg(e.gb,e),t)}function dv(e){e.B&&(pg.clearTimeout(e.B),e.B=null)}function pv(e){0==e.l.G||e.I||Dy(e.l,e)}function fv(e){dv(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Rm(e.T),Lm(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function gv(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||$v(n.h,e)))if(!e.J&&$v(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Ry(n),wy(n)}Sy(n),zm(18)}}else n.Ba=i[1],0<n.Ba-n.T&&i[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=Gm(bg(n.cb,n),6e3));if(Kv(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else Py(n,11)}else if(!e.J&&n.g!=e||Ry(n),!Rg(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.T=s[0],s=s[1],2==n.G)if("c"==s[0]){n.I=s[1],n.ka=s[2];var a=s[3];null!=a&&(n.ma=a,n.j.info("VER="+n.ma));var o=s[4];null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var c,l,u=s[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=e.g;if(f){const g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;g&&((c=r.h).g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(c.j=c.l,c.g=new Set,c.h&&(zv(c,c.h),c.h=null))),!r.D||(l=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=l,Tv(r.F,r.D,l))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var h,d,p=e;(r=n).sa=My(r,r.H?r.ka:null,r.V),p.J?(Wv(r.h,p),h=p,(d=r.J)&&h.setTimeout(d),h.B&&(dv(h),uv(h)),r.g=p):Cy(r),0<n.i.length&&Iy(n)}else"stop"!=s[0]&&"close"!=s[0]||Py(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?Py(n,7):_y(n):"noop"!=s[0]&&n.l&&n.l.wa(s),n.A=0)}Km()}catch(e){}}function mv(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(gg(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(gg(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(gg(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(bt=ev.prototype).setTimeout=function(e){this.O=e},bt.ib=function(e){e=e.target;const t=this.L;t&&3==py(e)?t.l():this.La(e)},bt.La=function(e){try{if(e==this.g)e:{var t=py(this.g),n=this.g.Ea();this.g.aa();if(!(t<3)&&(3!=t||Vg||this.g&&(this.h.h||this.g.fa()||fy(this.g)))){this.I||4!=t||7==n||Km(),dv(this);var r=this.g.aa();this.Y=r;t:if(cv(this)){var i=fy(this.g);e="";var s=i.length,a=4==py(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){fv(this),pv(this);var o="";break t}this.h.i=new pg.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,h=this.j,d=this.u,p=this.A,f=this.m,g=this.U,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+v}),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Rg(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,zm(12),fv(this),pv(this);break e}Um(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,gv(this,r)}this.P?(lv(this,t,o),Vg&&this.i&&3==t&&(Mm(this.S,this.T,"tick",this.hb),this.T.start())):(Um(this.j,this.m,o,null),gv(this,o)),4==t&&fv(this),this.i&&!this.I&&(4==t?Dy(this.l,this):(this.i=!1,uv(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,zm(12)):(this.o=0,zm(13)),fv(this),pv(this)}}}catch(e){}var h,d,p,f,g,m,v},bt.hb=function(){var e,t;this.g&&(e=py(this.g),t=this.g.fa(),this.C<t.length&&(dv(this),lv(this,e,t),this.i&&4!=e&&uv(this)))},bt.cancel=function(){this.I=!0,fv(this)},bt.gb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(Km(),zm(17)),fv(this),this.o=2,pv(this)):hv(this,this.V-n)};var vv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function yv(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof yv?(this.h=void 0!==t?t:e.h,wv(this,e.j),this.s=e.s,this.g=e.g,bv(this,e.m),this.l=e.l,t=e.i,(n=new Pv).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Iv(this,n),this.o=e.o):e&&(n=String(e).match(vv))?(this.h=!!t,wv(this,n[1]||"",!0),this.s=kv(n[2]||""),this.g=kv(n[3]||"",!0),bv(this,n[4]),this.l=kv(n[5]||"",!0),Iv(this,n[6]||"",!0),this.o=kv(n[7]||"")):(this.h=!!t,this.i=new Pv(null,this.h))}function _v(e){return new yv(e)}function wv(e,t,n){e.j=n?kv(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function bv(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Iv(e,t,n){var r,i;t instanceof Pv?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(Ov(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Mv(this,t),Fv(this,n,e))},r)),r.j=i):(n||(t=Cv(t,Dv)),e.i=new Pv(t,e.h))}function Tv(e,t,n){e.i.set(t,n)}function Ev(e){return Tv(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function kv(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Cv(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Sv),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Sv(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}yv.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Cv(t,Nv,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Cv(t,Nv,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Cv(n,"/"==n.charAt(0)?Rv:Av,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Cv(n,xv)),e.join("")};var Nv=/[#\/\?@]/g,Av=/[#\?:]/g,Rv=/[#\?]/g,Dv=/[#\?@]/g,xv=/#/g;function Pv(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ov(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Mv(e,t){Ov(e),t=Uv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Lv(e,t){return Ov(e),t=Uv(e,t),e.g.has(t)}function Fv(e,t,n){Mv(e,t),0<n.length&&(e.i=null,e.g.set(Uv(e,t),Cg(n)),e.h+=n.length)}function Uv(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(bt=Pv.prototype).add=function(e,t){Ov(this),this.i=null,e=Uv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},bt.forEach=function(n,r){Ov(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},bt.oa=function(){Ov(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let s=0;s<n.length;s++){var i=t[s];for(let e=0;e<i.length;e++)r.push(n[s])}return r},bt.W=function(t){Ov(this);let n=[];if("string"==typeof t)Lv(this,t)&&(n=n.concat(this.g.get(Uv(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},bt.set=function(e,t){return Ov(this),this.i=null,Lv(this,e=Uv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},bt.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},bt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.W(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var qv=class{constructor(e,t){this.h=e,this.g=t}};function Vv(e){this.l=e||10,e=pg.PerformanceNavigationTiming?0<(e=pg.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(pg.g&&pg.g.Ga&&pg.g.Ga()&&pg.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Bv;function jv(e){return e.h||e.g&&e.g.size>=e.j}function Kv(e){return e.h?1:e.g?e.g.size:0}function $v(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function zv(e,t){e.g?e.g.add(t):e.h=t}function Wv(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Gv(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return Cg(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function Hv(){}function Qv(){this.g=new Hv}function Yv(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Xv(e){this.l=e.ac||null,this.j=e.jb||!1}function Jv(e,t){ym.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Zv,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Vv.prototype.cancel=function(){if(this.i=Gv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},Hv.prototype.stringify=function(e){return pg.JSON.stringify(e,void 0)},Hv.prototype.parse=function(e){return pg.JSON.parse(e,void 0)},Tg(Xv,Hm),Xv.prototype.g=function(){return new Jv(this.l,this.j)},Xv.prototype.i=(Bv={},function(){return Bv}),Tg(Jv,ym);var Zv=0;function ey(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ny(e)}function ny(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(bt=Jv.prototype).open=function(e,t){if(this.readyState!=Zv)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ny(this)},bt.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||pg).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},bt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=Zv},bt.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ny(this)),this.g&&(this.readyState=3,ny(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==pg.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ey(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},bt.Ta=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?ty:ny)(this),3==this.readyState&&ey(this))},bt.Va=function(e){this.g&&(this.response=this.responseText=e,ty(this))},bt.Ua=function(e){this.g&&(this.response=e,ty(this))},bt.ga=function(){this.g&&ty(this)},bt.setRequestHeader=function(e,t){this.v.append(e,t)},bt.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},bt.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Jv.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var ry=pg.JSON.parse;function iy(e){ym.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=sy,this.K=this.L=!1}Tg(iy,ym);var sy="",ay=/^https?$/i,oy=["POST","PUT"];function cy(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,ly(e),hy(e)}function ly(e){e.D||(e.D=!0,_m(e,"complete"),_m(e,"error"))}function uy(e){if(e.h&&void 0!==dg&&(!e.C[1]||4!=py(e)||2!=e.aa()))if(e.v&&4==py(e))Dm(e.Ha,0,e);else if(_m(e,"readystatechange"),4==py(e)){e.h=!1;try{var t,n,r,i,s=e.aa();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===s)&&(!(i=String(e.H).match(vv)[1]||null)&&pg.self&&pg.self.location&&(i=(r=pg.self.location.protocol).substr(0,r.length-1)),n=!ay.test(i?i.toLowerCase():"")),t=n),t)_m(e,"complete"),_m(e,"success");else{e.m=6;try{var o=2<py(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",ly(e)}}finally{hy(e)}}}function hy(e,t){if(e.g){dy(e);const n=e.g,r=e.C[0]?fg:null;e.g=null,e.C=null,t||_m(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function dy(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(pg.clearTimeout(e.A),e.A=null)}function py(e){return e.g?e.g.readyState:0}function fy(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case sy:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function gy(e){let n="";return tm(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function my(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=gy(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Tv(e,t,n))}function vy(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function yy(e){this.Ca=0,this.i=[],this.j=new Fm,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=vy("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=vy("baseRetryDelayMs",5e3,e),this.bb=vy("retryDelaySeedMs",1e4,e),this.$a=vy("forwardChannelMaxRetries",2,e),this.ta=vy("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new Vv(e&&e.concurrentRequestLimit),this.Fa=new Qv,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function _y(e){var t,n;by(e),3==e.G&&(t=e.U++,Tv(n=_v(e.F),"SID",e.I),Tv(n,"RID",t),Tv(n,"TYPE","terminate"),Ey(e,n),(t=new ev(e,e.j,t,void 0)).K=2,t.v=Ev(_v(n)),n=!1,!(n=pg.navigator&&pg.navigator.sendBeacon?pg.navigator.sendBeacon(t.v.toString(),""):n)&&pg.Image&&((new Image).src=t.v,n=!0),n||(t.g=Ly(t.l,null),t.g.da(t.v)),t.F=Date.now(),uv(t)),Oy(e)}function wy(e){e.g&&(Ny(e),e.g.cancel(),e.g=null)}function by(e){wy(e),e.u&&(pg.clearTimeout(e.u),e.u=null),Ry(e),e.h.cancel(),e.m&&("number"==typeof e.m&&pg.clearTimeout(e.m),e.m=null)}function Iy(e){jv(e.h)||e.m||(e.m=!0,km(e.Ja,e),e.C=0)}function Ty(e,t){var n=t?t.m:e.U++,r=_v(e.F);Tv(r,"SID",e.I),Tv(r,"RID",n),Tv(r,"AID",e.T),Ey(e,r),e.o&&e.s&&my(r,e.o,e.s),n=new ev(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=ky(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),zv(e.h,n),av(n,r,t)}function Ey(e,n){e.ia&&tm(e.ia,function(e,t){Tv(n,t,e)}),e.l&&mv({},function(e,t){Tv(n,t,e)})}function ky(e,t,r){r=Math.min(e.i.length,r);var i=e.l?bg(e.l.Ra,e.l,e):null;e:{var s=e.i;let n=-1;for(;;){const c=["count="+r];-1==n?0<r?(n=s[0].h,c.push("ofs="+n)):n=0:c.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=s[t].h,o=s[t].g;if((a-=n)<0)n=Math.max(0,s[t].h-100),e=!1;else try{!function(e,r,t){const i=t||"";try{mv(e,function(e,t){let n=e;mg(e)&&(n=bm(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,c,"req"+a+"_")}catch(e){i&&i(o)}}if(e){i=c.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,i}function Cy(e){e.g||e.u||(e.Z=1,km(e.Ia,e),e.A=0)}function Sy(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=Gm(bg(e.Ia,e),xy(e,e.A)),e.A++,1)}function Ny(e){null!=e.B&&(pg.clearTimeout(e.B),e.B=null)}function Ay(e){e.g=new ev(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=_v(e.sa);Tv(t,"RID","rpc"),Tv(t,"SID",e.I),Tv(t,"CI",e.L?"0":"1"),Tv(t,"AID",e.T),Tv(t,"TYPE","xmlhttp"),Ey(e,t),e.o&&e.s&&my(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Ev(_v(t)),n.s=null,n.P=!0,ov(n,e)}function Ry(e){null!=e.v&&(pg.clearTimeout(e.v),e.v=null)}function Dy(e,t){var n,r,i,s=null;if(e.g==t){Ry(e),Ny(e),e.g=null;var a=2}else{if(!$v(e.h,t))return;s=t.D,Wv(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,_m(a=Bm(),new Wm(a,s)),Iy(e)):Cy(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(i=t,Kv((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=i.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Za?0:r.$a)||(r.m=Gm(bg(r.Ja,r,i),xy(r,r.C)),r.C++,0))))&&(2!=a||!Sy(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:Py(e,5);break;case 4:Py(e,10);break;case 3:Py(e,6);break;default:Py(e,2)}}function xy(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function Py(e,t){var n,r;e.j.info("Error code "+t),2==t?(n=null,e.l&&(n=null),r=bg(e.kb,e),n||(n=new yv("//www.google.com/images/cleardot.gif"),pg.location&&"http"==pg.location.protocol||wv(n,"https"),Ev(n)),function(e,t){var n=new Fm;if(pg.Image){const r=new Image;r.onload=Ig(Yv,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Ig(Yv,n,r,"TestLoadImage: error",!1,t),r.onabort=Ig(Yv,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Ig(Yv,n,r,"TestLoadImage: timeout",!1,t),pg.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):zm(2),e.G=0,e.l&&e.l.va(t),Oy(e),by(e)}function Oy(e){var t;e.G=0,e.la=[],e.l&&(0==(t=Gv(e.h)).length&&0==e.i.length||(Sg(e.la,t),Sg(e.la,e.i),e.h.i.length=0,Cg(e.i),e.i.length=0),e.l.ua())}function My(e,t,n){var r,i,s=n instanceof yv?_v(n):new yv(n,void 0);return""!=s.g?(t&&(s.g=t+"."+s.g),bv(s,s.m)):(s=(r=pg.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new yv(null,void 0),s&&wv(i,s),t&&(i.g=t),r&&bv(i,r),n&&(i.l=n),s=i),n=e.D,t=e.za,n&&t&&Tv(s,n,t),Tv(s,"VER",e.ma),Ey(e,s),s}function Ly(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new iy(new Xv({jb:!0})):new iy(e.ra)).Ka(e.H),t}function Fy(){}function Uy(){if(Ug&&!(10<=Number(Hg)))throw Error("Environmental error: no available transport.")}function qy(e,t){ym.call(this),this.g=new yy(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!Rg(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Rg(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new jy(this)}function Vy(e){Xm.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function By(){Jm.call(this),this.status=1}function jy(e){this.g=e}(bt=iy.prototype).Ka=function(e){this.L=e},bt.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||nv).g(),this.C=this.u?Qm(this.u):Qm(nv),this.g.onreadystatechange=bg(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void cy(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const c of r.keys())n.set(c,r.get(c))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=pg.FormData&&e instanceof pg.FormData,0<=kg(oy,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{dy(this),0<this.B&&((this.K=(o=this.g,Ug&&Gg()&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=bg(this.qa,this)):this.A=Dm(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){cy(this,e)}var o},bt.qa=function(){void 0!==dg&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_m(this,"timeout"),this.abort(8))},bt.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,_m(this,"complete"),_m(this,"abort"),hy(this))},bt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),hy(this,!0)),iy.X.M.call(this)},bt.Ha=function(){this.s||(this.F||this.v||this.l?uy(this):this.fb())},bt.fb=function(){uy(this)},bt.aa=function(){try{return 2<py(this)?this.g.status:-1}catch(e){return-1}},bt.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},bt.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ry(t)}},bt.Ea=function(){return this.m},bt.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(bt=yy.prototype).ma=8,bt.G=1,bt.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new ev(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?(e=nm(e),im(e,this.S)):e=this.S),null!==this.o||this.N||(s.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var i=this.i[r];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=ky(this,s,n),Tv(r=_v(this.F),"RID",t),Tv(r,"CVER",22),this.D&&Tv(r,"X-HTTP-Session-Id",this.D),Ey(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(gy(e)))+"&"+n:this.o&&my(r,this.o,e)),zv(this.h,s),this.Ya&&Tv(r,"TYPE","init"),this.O?(Tv(r,"$req",n),Tv(r,"SID","null"),s.Z=!0,av(s,r,null)):av(s,r,n),this.G=2}}else 3==this.G&&(t?Ty(this,t):0==this.i.length||jv(this.h)||Ty(this))},bt.Ia=function(){var e;this.u=null,Ay(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=Gm(bg(this.eb,this),e))},bt.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,zm(10),wy(this),Ay(this))},bt.cb=function(){null!=this.v&&(this.v=null,wy(this),Sy(this),zm(19))},bt.kb=function(e){e?(this.j.info("Successfully pinged google.com"),zm(2)):(this.j.info("Failed to ping google.com"),zm(1))},(bt=Fy.prototype).xa=function(){},bt.wa=function(){},bt.va=function(){},bt.ua=function(){},bt.Ra=function(){},Uy.prototype.g=function(e,t){return new qy(e,t)},Tg(qy,ym),qy.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;zm(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=My(e,null,e.V),Iy(e)},qy.prototype.close=function(){_y(this.g)},qy.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=bm(e),e=t),n.i.push(new qv(n.ab++,e)),3==n.G&&Iy(n)},qy.prototype.M=function(){this.g.l=null,delete this.j,_y(this.g),delete this.g,qy.X.M.call(this)},Tg(Vy,Xm),Tg(By,Jm),Tg(jy,Fy),jy.prototype.xa=function(){_m(this.g,"a")},jy.prototype.wa=function(e){_m(this.g,new Vy(e))},jy.prototype.va=function(e){_m(this.g,new By)},jy.prototype.ua=function(){_m(this.g,"b")},Uy.prototype.createWebChannel=Uy.prototype.g,qy.prototype.send=qy.prototype.u,qy.prototype.open=qy.prototype.m,It.NO_ERROR=0,It.TIMEOUT=8,It.HTTP_ERROR=6,zc.COMPLETE="complete",(Ym.EventType=yt).OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",ym.prototype.listen=ym.prototype.N,iy.prototype.listenOnce=iy.prototype.O,iy.prototype.getLastError=iy.prototype.Oa,iy.prototype.getLastErrorCode=iy.prototype.Ea,iy.prototype.getStatus=iy.prototype.aa,iy.prototype.getResponseJson=iy.prototype.Sa,iy.prototype.getResponseText=iy.prototype.fa,iy.prototype.send=iy.prototype.da,iy.prototype.setWithCredentials=iy.prototype.Ka;var Ky,$y=Bm,zy=It,Wy=zc,Gy=qm,Hy=10,Qy=11,Yy=Xv,Xy=Ym,Jy=iy;const Zy="@firebase/firestore";class e_{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}e_.UNAUTHENTICATED=new e_(null),e_.GOOGLE_CREDENTIALS=new e_("google-credentials-uid"),e_.FIRST_PARTY=new e_("first-party-uid"),e_.MOCK_USER=new e_("mock-user");let t_="9.17.2";const n_=new me("@firebase/firestore");function r_(){return n_.logLevel}function i_(e,...t){var n;n_.logLevel<=m.DEBUG&&(n=t.map(o_),n_.debug(`Firestore (${t_}): ${e}`,...n))}function s_(e,...t){var n;n_.logLevel<=m.ERROR&&(n=t.map(o_),n_.error(`Firestore (${t_}): ${e}`,...n))}function a_(e,...t){var n;n_.logLevel<=m.WARN&&(n=t.map(o_),n_.warn(`Firestore (${t_}): ${e}`,...n))}function o_(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function c_(e="Unexpected state"){var t=`FIRESTORE (${t_}) INTERNAL ASSERTION FAILED: `+e;throw s_(t),new Error(t)}function l_(e){e||c_()}const u_={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class h_ extends R{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class d_{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class p_{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class f_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(e_.UNAUTHENTICATED))}shutdown(){}}class g_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class m_{constructor(e){this.t=e,this.currentUser=e_.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new d_;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new d_,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{i_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(i_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new d_))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(i_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(l_("string"==typeof e.accessToken),new p_(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return l_(null===e||"string"==typeof e),new e_(e)}}class v_{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=e_.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(l_(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class y_{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new v_(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(e_.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class __{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class w_{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,n){const r=e=>{null!=e.error&&i_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.A;return this.A=e.token,i_("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{i_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.T.getImmediate({optional:!0}))?i(e):i_("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(l_("string"==typeof e.token),this.A=e.token,new __(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class b_{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function I_(e,t){return e<t?-1:t<e?1:0}function T_(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function E_(e){return e+"\0"}class k_{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new h_(u_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new h_(u_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new h_(u_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new h_(u_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return k_.fromMillis(Date.now())}static fromDate(e){return k_.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new k_(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?I_(this.nanoseconds,e.nanoseconds):I_(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class C_{constructor(e){this.timestamp=e}static fromTimestamp(e){return new C_(e)}static min(){return new C_(new k_(0,0))}static max(){return new C_(new k_(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class S_{constructor(e,t,n){void 0===t?t=0:t>e.length&&c_(),void 0===n?n=e.length-t:n>e.length-t&&c_(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===S_.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof S_?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class N_ extends S_{construct(e,t,n){return new N_(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new h_(u_.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new N_(t)}static emptyPath(){return new N_([])}}const A_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class R_ extends S_{construct(e,t,n){return new R_(e,t,n)}static isValidIdentifier(e){return A_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!R_.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new R_(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new h_(u_.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new h_(u_.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new h_(u_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new h_(u_.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new R_(t)}static emptyPath(){return new R_([])}}class D_{constructor(e){this.path=e}static fromPath(e){return new D_(N_.fromString(e))}static fromName(e){return new D_(N_.fromString(e).popFirst(5))}static empty(){return new D_(N_.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===N_.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return N_.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new D_(new N_(e.slice()))}}class x_{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function P_(e){return e.fields.find(e=>2===e.kind)}function O_(e){return e.fields.filter(e=>2!==e.kind)}x_.UNKNOWN_ID=-1;class M_{constructor(e,t){this.fieldPath=e,this.kind=t}}class L_{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new L_(0,q_.min())}}function F_(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=C_.fromTimestamp(1e9===r?new k_(n+1,0):new k_(n,r));return new q_(r,D_.empty(),t)}function U_(e){return new q_(e.readTime,e.key,-1)}class q_{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new q_(C_.min(),D_.empty(),-1)}static max(){return new q_(C_.max(),D_.empty(),-1)}}function V_(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=D_.comparator(e.documentKey,t.documentKey),0!==n?n:I_(e.largestBatchId,t.largestBatchId))}const B_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class j_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function K_(e){if(e.code!==u_.FAILED_PRECONDITION||e.message!==B_)throw e;i_("LocalStore","Unexpectedly lost primary lease")}class $_{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&c_(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new $_((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof $_?t:$_.resolve(t)}catch(e){return $_.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):$_.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):$_.reject(t)}static resolve(n){return new $_((e,t)=>{e(n)})}static reject(n){return new $_((e,t)=>{t(n)})}static waitFor(e){return new $_((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=$_.resolve(!1);for(const n of e)t=t.next(e=>e?$_.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,c){return new $_((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;c(o[a]).next(e=>{i[a]=e,++s,s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new $_((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class z_{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.v=new d_,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{e.error?this.v.reject(new H_(n,e.error)):this.v.resolve()},this.transaction.onerror=e=>{var t=Z_(e.target.error);this.v.reject(new H_(n,t))}}static open(e,t,n,r){try{return new z_(t,e.transaction(r,n))}catch(e){throw new H_(t,e)}}get P(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(i_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new Y_(t)}}class W_{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===W_.D(w())&&s_("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return i_("SimpleDb","Removing database:",e),X_(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!S())return!1;if(W_.N())return!0;const e=w(),t=W_.D(e),n=0<t&&t<10,r=W_.k(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(s){return this.db||(i_("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new H_(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new h_(u_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new h_(u_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new H_(s,t))},i.onupgradeneeded=e=>{i_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.S.$(t,i.transaction,e.oldVersion,this.version).next(()=>{i_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=z_.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),$_.reject(e))).toPromise();return s.catch(()=>{}),await t.P,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(i_("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class G_{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return X_(this.q.delete())}}class H_ extends h_{constructor(e,t){super(u_.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Q_(e){return"IndexedDbTransactionError"===e.name}class Y_{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(i_("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(i_("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),X_(n)}add(e){return i_("SimpleDb","ADD",this.store.name,e,e),X_(this.store.add(e))}get(t){return X_(this.store.get(t)).next(e=>(i_("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return i_("SimpleDb","DELETE",this.store.name,e),X_(this.store.delete(e))}count(){return i_("SimpleDb","COUNT",this.store.name),X_(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.H(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new $_((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new $_((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}Y(e,t){i_("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Z=!1;var r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.H(r,t)}tt(i){const e=this.cursor({});return new $_((n,r)=>{e.onerror=e=>{var t=Z_(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}H(e,s){const a=[];return new $_((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new G_(t),r=s(t.primaryKey,t.value,n);if(r instanceof $_){const e=r.catch(e=>(n.done(),$_.reject(e)));a.push(e)}n.isDone?i():null===n.G?t.continue():t.continue(n.G)}else i()}}).next(()=>$_.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function X_(e){return new $_((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=Z_(e.target.error);r(t)}})}let J_=!1;function Z_(e){const t=W_.D(w());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new h_("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return J_||(J_=!0,setTimeout(()=>{throw e},0)),e}}return e}class ew{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){i_("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{i_("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){Q_(e)?i_("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await K_(e)}await this.nt(6e4)})}}class tw{constructor(e,t){this.localStore=e,this.persistence=t}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(e,t){const n=new Set;let r=t,i=!0;return $_.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(i_("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}rt(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ot(n,e)).next(e=>(i_("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}ot(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=U_(t);0<V_(n,r)&&(r=n)}),new q_(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class nw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}nw.at=-1;class rw{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class iw{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new iw("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof iw&&e.projectId===this.projectId&&e.database===this.database}}function sw(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function aw(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ow(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function cw(e){return null==e}function lw(e){return 0===e&&1/e==-1/0}function uw(e){return"number"==typeof e&&Number.isInteger(e)&&!lw(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class hw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class dw{constructor(e){this.binaryString=e}static fromBase64String(e){var t=function(e){try{return atob(e)}catch(e){throw e instanceof DOMException?new hw("Invalid base64 string: "+e):e}}(e);return new dw(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new dw(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return I_(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}dw.EMPTY_BYTE_STRING=new dw("");const pw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fw(t){if(l_(!!t),"string"!=typeof t)return{seconds:gw(t.seconds),nanos:gw(t.nanos)};{let e=0;var n=pw.exec(t);l_(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function gw(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function mw(e){return"string"==typeof e?dw.fromBase64String(e):dw.fromUint8Array(e)}function vw(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function yw(e){var t=fw(e.mapValue.fields.__local_write_time__.timestampValue);return new k_(t.seconds,t.nanos)}const _w={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ww={nullValue:"NULL_VALUE"};function bw(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?vw(e)?4:Ow(e)?9007199254740991:10:c_()}function Iw(r,i){if(r===i)return!0;var e,t,n=bw(r);if(n!==bw(i))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return yw(r).isEqual(yw(i));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=fw(r.timestampValue),n=fw(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,mw(r.bytesValue).isEqual(mw(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,gw((t=r).geoPointValue.latitude)===gw(e.geoPointValue.latitude)&&gw(t.geoPointValue.longitude)===gw(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return gw(e.integerValue)===gw(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=gw(e.doubleValue),r=gw(t.doubleValue);return n===r?lw(n)===lw(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return T_(r.arrayValue.values||[],i.arrayValue.values||[],Iw);case 10:return function(e){const t=e.mapValue.fields||{},n=i.mapValue.fields||{};if(sw(t)!==sw(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!Iw(t[e],n[e])))return!1;return!0}(r);default:return c_()}}function Tw(e,t){return void 0!==(e.values||[]).find(e=>Iw(e,t))}function Ew(e,t){if(e===t)return 0;var n,r,i,s,a=bw(e),o=bw(t);if(a!==o)return I_(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return I_(e.booleanValue,t.booleanValue);case 2:return r=t,i=gw(e.integerValue||e.doubleValue),s=gw(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return kw(e.timestampValue,t.timestampValue);case 4:return kw(yw(e),yw(t));case 5:return I_(e.stringValue,t.stringValue);case 6:return function(e,t){const n=mw(e),r=mw(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=I_(n[i],r[i]);if(0!==t)return t}return I_(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=I_(gw(n.latitude),gw(r.latitude)))?s:I_(gw(n.longitude),gw(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=Ew(n[i],r[i]);if(t)return t}return I_(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===_w.mapValue&&t===_w.mapValue)return 0;if(e===_w.mapValue)return 1;if(t===_w.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=I_(r[o],s[o]);if(0!==t)return t;var a=Ew(n[r[o]],i[s[o]]);if(0!==a)return a}return I_(r.length,s.length)}(e.mapValue,t.mapValue);default:throw c_()}}function kw(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return I_(e,t);var n=fw(e),r=fw(t),i=I_(n.seconds,r.seconds);return 0!==i?i:I_(n.nanos,r.nanos)}function Cw(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=fw(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?mw(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,D_.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):c_();var t}(e)}function Sw(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Nw(e){return e&&"integerValue"in e}function Aw(e){return!!e&&"arrayValue"in e}function Rw(e){return e&&"nullValue"in e}function Dw(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function xw(e){return e&&"mapValue"in e}function Pw(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return aw(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Pw(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Pw(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Ow(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Mw(e,t){var n=Ew(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Lw(e,t){var n=Ew(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Fw{constructor(e,t){this.position=e,this.inclusive=t}}function Uw(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?D_.comparator(D_.fromName(a.referenceValue),n.key):Ew(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function qw(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Iw(e.position[n],t.position[n]))return!1;return!0}class Vw{}class Bw extends Vw{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Qw(e,t,n):"array-contains"===t?new Zw(e,n):"in"===t?new eb(e,n):"not-in"===t?new tb(e,n):"array-contains-any"===t?new nb(e,n):new Bw(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?Yw:Xw)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ew(t,this.value)):null!==t&&bw(this.value)===bw(t)&&this.matchesComparison(Ew(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return c_()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class jw extends Vw{constructor(e,t){super(),this.filters=e,this.op=t,this.ft=null}static create(e,t){return new jw(e,t)}matches(t){return Kw(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ft||(this.ft=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.dt(e=>e.isInequality());return null!==e?e.field:null}dt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Kw(e){return"and"===e.op}function $w(e){return"or"===e.op}function zw(e){return Ww(e)&&Kw(e)}function Ww(e){for(const t of e.filters)if(t instanceof jw)return!1;return!0}function Gw(e,t){var n=e.filters.concat(t);return jw.create(n,e.op)}function Hw(e){return e instanceof Bw?`${(t=e).field.canonicalString()} ${t.op} ${Cw(t.value)}`:e instanceof jw?(e=e).op.toString()+" {"+e.getFilters().map(Hw).join(" ,")+"}":"Filter";var t}class Qw extends Bw{constructor(e,t,n){super(e,t,n),this.key=D_.fromName(n.referenceValue)}matches(e){var t=D_.comparator(e.key,this.key);return this.matchesComparison(t)}}class Yw extends Bw{constructor(e,t){super(e,"in",t),this.keys=Jw(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Xw extends Bw{constructor(e,t){super(e,"not-in",t),this.keys=Jw(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Jw(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>D_.fromName(e.referenceValue))}class Zw extends Bw{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return Aw(t)&&Tw(t.arrayValue,this.value)}}class eb extends Bw{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Tw(this.value.arrayValue,t)}}class tb extends Bw{constructor(e,t){super(e,"not-in",t)}matches(e){if(Tw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Tw(this.value.arrayValue,t)}}class nb extends Bw{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Aw(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Tw(this.value.arrayValue,e))}}class rb{constructor(e,t="asc"){this.field=e,this.dir=t}}class ib{constructor(e,t){this.comparator=e,this.root=t||ab.EMPTY}insert(e,t){return new ib(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ab.BLACK,null,null))}remove(e){return new ib(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ab.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sb(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sb(this.root,e,this.comparator,!1)}getReverseIterator(){return new sb(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sb(this.root,e,this.comparator,!0)}}class sb{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ab{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ab.RED,this.left=null!=r?r:ab.EMPTY,this.right=null!=i?i:ab.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ab(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ab.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ab.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,ab.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,ab.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw c_();if(this.right.isRed())throw c_();var e=this.left.check();if(e!==this.right.check())throw c_();return e+(this.isRed()?0:1)}}ab.EMPTY=null,ab.RED=!0,ab.BLACK=!1,ab.EMPTY=new class{constructor(){this.size=0}get key(){throw c_()}get value(){throw c_()}get color(){throw c_()}get left(){throw c_()}get right(){throw c_()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ab(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ob{constructor(e){this.comparator=e,this.data=new ib(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cb(this.data.getIterator())}getIteratorFrom(e){return new cb(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ob))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new ob(this.comparator);return t.data=e,t}}class cb{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function lb(e){return e.hasNext()?e.getNext():void 0}class ub{constructor(e){(this.fields=e).sort(R_.comparator)}static empty(){return new ub([])}unionWith(e){let t=new ob(R_.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new ub(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return T_(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class hb{constructor(e){this.value=e}static empty(){return new hb({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!xw(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pw(t)}setAll(e){let n=R_.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=Pw(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());xw(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Iw(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];xw(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){aw(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new hb(Pw(this.value))}}class db{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new db(e,0,C_.min(),C_.min(),C_.min(),hb.empty(),0)}static newFoundDocument(e,t,n,r){return new db(e,1,t,C_.min(),n,r,0)}static newNoDocument(e,t){return new db(e,2,t,C_.min(),C_.min(),hb.empty(),0)}static newUnknownDocument(e,t){return new db(e,3,t,C_.min(),C_.min(),hb.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(C_.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hb.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hb.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=C_.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof db&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new db(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class pb{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this._t=null}}function fb(e,t=null,n=[],r=[],i=null,s=null,a=null){return new pb(e,t,n,r,i,s,a)}function gb(e){const t=e;if(null===t._t){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function t(e){if(e instanceof Bw)return e.field.canonicalString()+e.op.toString()+Cw(e.value);if(zw(e))return e.filters.map(e=>t(e)).join(",");var n=e.filters.map(e=>t(e)).join(",");return`${e.op}(${n})`}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),cw(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Cw(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Cw(e)).join(",")),t._t=e}return t._t}function mb(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function r(e,t){return e instanceof Bw?(n=e,(s=t)instanceof Bw&&n.op===s.op&&n.field.isEqual(s.field)&&Iw(n.value,s.value)):e instanceof jw?(i=t)instanceof jw&&e.op===i.op&&e.filters.length===i.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,i.filters[n]),!0):void c_();var i,n,s}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!qw(e.startAt,t.startAt)&&qw(e.endAt,t.endAt)}function vb(e){return D_.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function yb(e,t){return e.filters.filter(e=>e instanceof Bw&&e.field.isEqual(t))}function _b(t,n,r){let i=ww,s=!0;for(const r of yb(t,n)){let e=ww,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?ww:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Sw(iw.empty(),D_.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:c_();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=ww}Mw({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Mw({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function wb(t,n,r){let i=_w,s=!0;for(const r of yb(t,n)){let e=_w,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Sw(iw.empty(),D_.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?_w:c_(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=_w}0<Lw({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Lw({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class bb{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.wt=null,this.gt=null,this.startAt,this.endAt}}function Ib(e,t,n,r,i,s,a,o){return new bb(e,t,n,r,i,s,a,o)}function Tb(e){return new bb(e)}function Eb(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function kb(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Cb(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Sb(e){return null!==e.collectionGroup}function Nb(t){const n=t;if(null===n.wt){n.wt=[];const t=Cb(n),e=kb(n);if(null!==t&&null===e)t.isKeyField()||n.wt.push(new rb(t)),n.wt.push(new rb(R_.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.wt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.wt.push(new rb(R_.keyField(),t))}}}return n.wt}function Ab(e){const t=e;if(!t.gt)if("F"===t.limitType)t.gt=fb(t.path,t.collectionGroup,Nb(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of Nb(t)){const t="desc"===i.dir?"asc":"desc";e.push(new rb(i.field,t))}var n=t.endAt?new Fw(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Fw(t.startAt.position,t.startAt.inclusive):null;t.gt=fb(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.gt}function Rb(e,t){t.getFirstInequalityField(),Cb(e);var n=e.filters.concat([t]);return new bb(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Db(e,t,n){return new bb(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function xb(e,t){return mb(Ab(e),Ab(t))&&e.limitType===t.limitType}function Pb(e){return`${gb(Ab(e))}|lt:${e.limitType}`}function Ob(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>Hw(e)).join(", ")}]`),cw(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Cw(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Cw(e)).join(",")),`Target(${t})`}(Ab(e))}; limitType=${e.limitType})`}function Mb(n,e){return e.isFoundDocument()&&(i=n,a=(s=e).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):D_.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e){for(const t of Nb(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(t=e.startAt,r=Uw(t,Nb(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=Uw(t,Nb(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,a}function Lb(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Fb(i){return(e,t)=>{let n=!1;for(const r of Nb(i)){const i=function(e,i,t){var n=e.field.isKeyField()?D_.comparator(i.key,t.key):function(e,t){var n=i.data.field(e),r=t.data.field(e);return null!==n&&null!==r?Ew(n,r):c_()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return c_()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function Ub(e,t){if(e.yt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:lw(t)?"-0":t}}function qb(e){return{integerValue:""+e}}function Vb(e,t){return uw(t)?qb(t):Ub(e,t)}class Bb{constructor(){this._=void 0}}function jb(e,t){return e instanceof Hb?Nw(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class Kb extends Bb{}class $b extends Bb{constructor(e){super(),this.elements=e}}function zb(e,t){const n=Yb(t);for(const t of e.elements)n.some(e=>Iw(e,t))||n.push(t);return{arrayValue:{values:n}}}class Wb extends Bb{constructor(e){super(),this.elements=e}}function Gb(e,t){let n=Yb(t);for(const t of e.elements)n=n.filter(e=>!Iw(e,t));return{arrayValue:{values:n}}}class Hb extends Bb{constructor(e,t){super(),this.Tt=e,this.It=t}}function Qb(e){return gw(e.integerValue||e.doubleValue)}function Yb(e){return Aw(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Xb{constructor(e,t){this.field=e,this.transform=t}}class Jb{constructor(e,t){this.version=e,this.transformResults=t}}class Zb{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Zb}static exists(e){return new Zb(void 0,e)}static updateTime(e){return new Zb(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function eI(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class tI{}function nI(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new hI(e.key,Zb.none()):new aI(e.key,e.data,Zb.none());{const i=e.data,s=hb.empty();let t=new ob(R_.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new oI(e.key,s,new ub(t.toArray()),Zb.none())}}function rI(e,t,n){e instanceof aI?function(e,t,n){const r=e.value.clone(),i=lI(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof oI?function(e,t,n){if(!eI(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=lI(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(cI(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function iI(e,t,n,r){return e instanceof aI?function(e,t,n,r){if(!eI(e.precondition,t))return n;const i=e.value.clone(),s=uI(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof oI?function(e,t,n,r){if(!eI(e.precondition,t))return n;const i=uI(e.fieldTransforms,r,t),s=t.data;return s.setAll(cI(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,eI(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function sI(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&T_(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof $b&&t instanceof $b||e instanceof Wb&&t instanceof Wb?T_(e.elements,t.elements,Iw):e instanceof Hb&&t instanceof Hb?Iw(e.It,t.It):e instanceof Kb&&t instanceof Kb)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class aI extends tI{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class oI extends tI{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function cI(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function lI(e,t,n){const r=new Map;l_(e.length===n.length);for(let u=0;u<n.length;u++){var i=e[u],s=i.transform,a=t.data.field(i.field);r.set(i.field,(o=s,c=a,l=n[u],o instanceof $b?zb(o,c):o instanceof Wb?Gb(o,c):l))}var o,c,l;return r}function uI(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,a=t,c=o=void 0,i instanceof Kb?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof $b?zb(i,s):i instanceof Wb?Gb(i,s):(o=jb(i=i,s),c=Qb(o)+Qb(i.It),Nw(o)&&Nw(i.It)?qb(c):Ub(i.Tt,c))))}var i,s,a,o,c;return r}class hI extends tI{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dI extends tI{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class pI{constructor(e){this.count=e}}function fI(e){switch(e){default:return c_(),0;case u_.CANCELLED:case u_.UNKNOWN:case u_.DEADLINE_EXCEEDED:case u_.RESOURCE_EXHAUSTED:case u_.INTERNAL:case u_.UNAVAILABLE:case u_.UNAUTHENTICATED:return;case u_.INVALID_ARGUMENT:case u_.NOT_FOUND:case u_.ALREADY_EXISTS:case u_.PERMISSION_DENIED:case u_.FAILED_PRECONDITION:case u_.ABORTED:case u_.OUT_OF_RANGE:case u_.UNIMPLEMENTED:case u_.DATA_LOSS:return 1}}function gI(e){if(void 0===e)return s_("GRPC error has no .code"),u_.UNKNOWN;switch(e){case Ky.OK:return u_.OK;case Ky.CANCELLED:return u_.CANCELLED;case Ky.UNKNOWN:return u_.UNKNOWN;case Ky.DEADLINE_EXCEEDED:return u_.DEADLINE_EXCEEDED;case Ky.RESOURCE_EXHAUSTED:return u_.RESOURCE_EXHAUSTED;case Ky.INTERNAL:return u_.INTERNAL;case Ky.UNAVAILABLE:return u_.UNAVAILABLE;case Ky.UNAUTHENTICATED:return u_.UNAUTHENTICATED;case Ky.INVALID_ARGUMENT:return u_.INVALID_ARGUMENT;case Ky.NOT_FOUND:return u_.NOT_FOUND;case Ky.ALREADY_EXISTS:return u_.ALREADY_EXISTS;case Ky.PERMISSION_DENIED:return u_.PERMISSION_DENIED;case Ky.FAILED_PRECONDITION:return u_.FAILED_PRECONDITION;case Ky.ABORTED:return u_.ABORTED;case Ky.OUT_OF_RANGE:return u_.OUT_OF_RANGE;case Ky.UNIMPLEMENTED:return u_.UNIMPLEMENTED;case Ky.DATA_LOSS:return u_.DATA_LOSS;default:return c_()}}(It=Ky=Ky||{})[It.OK=0]="OK",It[It.CANCELLED=1]="CANCELLED",It[It.UNKNOWN=2]="UNKNOWN",It[It.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",It[It.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",It[It.NOT_FOUND=5]="NOT_FOUND",It[It.ALREADY_EXISTS=6]="ALREADY_EXISTS",It[It.PERMISSION_DENIED=7]="PERMISSION_DENIED",It[It.UNAUTHENTICATED=16]="UNAUTHENTICATED",It[It.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",It[It.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",It[It.ABORTED=10]="ABORTED",It[It.OUT_OF_RANGE=11]="OUT_OF_RANGE",It[It.UNIMPLEMENTED=12]="UNIMPLEMENTED",It[It.INTERNAL=13]="INTERNAL",It[It.UNAVAILABLE=14]="UNAVAILABLE",It[It.DATA_LOSS=15]="DATA_LOSS";class mI{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){aw(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return ow(this.inner)}size(){return this.innerSize}}const vI=new ib(D_.comparator);const yI=new ib(D_.comparator);function _I(...e){let t=yI;for(const n of e)t=t.insert(n.key,n);return t}function wI(e){let n=yI;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function bI(){return new mI(e=>e.toString(),(e,t)=>e.isEqual(t))}const II=new ib(D_.comparator),TI=new ob(D_.comparator);function EI(...e){let t=TI;for(const n of e)t=t.add(n);return t}const kI=new ob(I_);class CI{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,SI.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new CI(C_.min(),r,kI,vI,EI())}}class SI{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new SI(n,t,EI(),EI(),EI())}}class NI{constructor(e,t,n,r){this.Et=e,this.removedTargetIds=t,this.key=n,this.At=r}}class AI{constructor(e,t){this.targetId=e,this.Rt=t}}class RI{constructor(e,t,n=dw.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class DI{constructor(){this.bt=0,this.vt=OI(),this.Pt=dw.EMPTY_BYTE_STRING,this.Vt=!1,this.St=!0}get current(){return this.Vt}get resumeToken(){return this.Pt}get Dt(){return 0!==this.bt}get Ct(){return this.St}xt(e){0<e.approximateByteSize()&&(this.St=!0,this.Pt=e)}Nt(){let n=EI(),r=EI(),i=EI();return this.vt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:c_()}}),new SI(this.Pt,this.Vt,n,r,i)}kt(){this.St=!1,this.vt=OI()}Ot(e,t){this.St=!0,this.vt=this.vt.insert(e,t)}Mt(e){this.St=!0,this.vt=this.vt.remove(e)}Ft(){this.bt+=1}$t(){--this.bt}Bt(){this.St=!0,this.Vt=!0}}class xI{constructor(e){this.Lt=e,this.qt=new Map,this.Ut=vI,this.Kt=PI(),this.Gt=new ob(I_)}Qt(e){for(const t of e.Et)e.At&&e.At.isFoundDocument()?this.jt(t,e.At):this.zt(t,e.key,e.At);for(const n of e.removedTargetIds)this.zt(n,e.key,e.At)}Wt(n){this.forEachTarget(n,e=>{const t=this.Ht(e);switch(n.state){case 0:this.Jt(e)&&t.xt(n.resumeToken);break;case 1:t.$t(),t.Dt||t.kt(),t.xt(n.resumeToken);break;case 2:t.$t(),t.Dt||this.removeTarget(e);break;case 3:this.Jt(e)&&(t.Bt(),t.xt(n.resumeToken));break;case 4:this.Jt(e)&&(this.Yt(e),t.xt(n.resumeToken));break;default:c_()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.qt.forEach((e,t)=>{this.Jt(t)&&n(t)})}Zt(e){const t=e.targetId,n=e.Rt.count,r=this.Xt(t);if(r){const e=r.target;if(vb(e))if(0===n){const n=new D_(e.path);this.zt(t,n,db.newNoDocument(n,C_.min()))}else l_(1===n);else this.te(t)!==n&&(this.Yt(t),this.Gt=this.Gt.add(t))}}ee(r){const i=new Map;this.qt.forEach((e,t)=>{var n=this.Xt(t);if(n){if(e.current&&vb(n.target)){const i=new D_(n.target.path);null!==this.Ut.get(i)||this.ne(t,i)||this.zt(t,i,db.newNoDocument(i,r))}e.Ct&&(i.set(t,e.Nt()),e.kt())}});let s=EI();this.Kt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.Xt(e);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.Ut.forEach((e,t)=>t.setReadTime(r));var e=new CI(r,i,this.Gt,this.Ut,s);return this.Ut=vI,this.Kt=PI(),this.Gt=new ob(I_),e}jt(e,t){var n;this.Jt(e)&&(n=this.ne(e,t.key)?2:0,this.Ht(e).Ot(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.Kt=this.Kt.insert(t.key,this.se(t.key).add(e)))}zt(e,t,n){if(this.Jt(e)){const r=this.Ht(e);this.ne(e,t)?r.Ot(t,1):r.Mt(t),this.Kt=this.Kt.insert(t,this.se(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}}removeTarget(e){this.qt.delete(e)}te(e){var t=this.Ht(e).Nt();return this.Lt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ft(e){this.Ht(e).Ft()}Ht(e){let t=this.qt.get(e);return t||(t=new DI,this.qt.set(e,t)),t}se(e){let t=this.Kt.get(e);return t||(t=new ob(I_),this.Kt=this.Kt.insert(e,t)),t}Jt(e){var t=null!==this.Xt(e);return t||i_("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){var t=this.qt.get(e);return t&&t.Dt?null:this.Lt.ie(e)}Yt(t){this.qt.set(t,new DI),this.Lt.getRemoteKeysForTarget(t).forEach(e=>{this.zt(t,e,null)})}ne(e,t){return this.Lt.getRemoteKeysForTarget(e).has(t)}}function PI(){return new ib(D_.comparator)}function OI(){return new ib(D_.comparator)}const MI={asc:"ASCENDING",desc:"DESCENDING"},LI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},FI={and:"AND",or:"OR"};class UI{constructor(e,t){this.databaseId=e,this.yt=t}}function qI(e,t){return e.yt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function VI(e,t){return e.yt?t.toBase64():t.toUint8Array()}function BI(e){return l_(!!e),C_.fromTimestamp((t=fw(e),new k_(t.seconds,t.nanos)));var t}function jI(e,t){return e=e,new N_(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function KI(e){var t=N_.fromString(e);return l_(oT(t)),t}function $I(e,t){return jI(e.databaseId,t.path)}function zI(e,t){const n=KI(t);if(n.get(1)!==e.databaseId.projectId)throw new h_(u_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new h_(u_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new D_(QI(n))}function WI(e,t){return jI(e.databaseId,t)}function GI(e){var t=KI(e);return 4===t.length?N_.emptyPath():QI(t)}function HI(e){return new N_(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function QI(e){return l_(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function YI(e,t,n){return{name:$I(e,t),fields:n.value.mapValue.fields}}function XI(e,t,n){const r=zI(e,t.name),i=BI(t.updateTime),s=t.createTime?BI(t.createTime):C_.min(),a=new hb({mapValue:{fields:t.fields}}),o=db.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function JI(e,t){let n;if(t instanceof aI)n={update:YI(e,t.key,t.value)};else if(t instanceof hI)n={delete:$I(e,t.key)};else if(t instanceof oI)n={update:YI(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof dI))return c_();n={verify:$I(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof Kb)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof $b)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Wb)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Hb)return{fieldPath:e.field.canonicalString(),increment:t.It};throw c_()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,qI(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:c_()),n;var r}function ZI(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?Zb.updateTime(BI(i.updateTime)):void 0!==i.exists?Zb.exists(i.exists):Zb.none():Zb.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)l_("REQUEST_TIME"===t.setToServerValue),n=new Kb;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new $b(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Wb(e)}else"increment"in t?n=new Hb(e,t.increment):c_();var r=R_.fromServerFormat(t.fieldPath);return new Xb(r,n)}(t,e)):[];var i;if(n.update){n.update.name;var s=zI(t,n.update.name),a=new hb({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new ub(e.map(e=>R_.fromServerFormat(e)))}();return new oI(s,a,t,e,r)}return new aI(s,a,e,r)}if(n.delete){const r=zI(t,n.delete);return new hI(r,e)}if(n.verify){const r=zI(t,n.verify);return new dI(r,e)}return c_()}function eT(e,t){return{documents:[WI(e,t.path)]}}function tT(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=WI(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=WI(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return function n(e){return e instanceof Bw?function(e){if("=="===e.op){if(Dw(e.value))return{unaryFilter:{field:sT(e.field),op:"IS_NAN"}};if(Rw(e.value))return{unaryFilter:{field:sT(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Dw(e.value))return{unaryFilter:{field:sT(e.field),op:"IS_NOT_NAN"}};if(Rw(e.value))return{unaryFilter:{field:sT(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sT(e.field),op:rT(e.op),value:e.value}}}(e):e instanceof jw?function(e){const t=e.getFilters().map(e=>n(e));return 1===t.length?t[0]:{compositeFilter:{op:iT(e.op),filters:t}}}(e):c_()}(jw.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:sT(e.field),direction:(e=e.dir,MI[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);var s,i=(s=t.limit,e.yt||cw(s)?s:{value:s});return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function nT(e){let t=GI(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){l_(1===r);const f=n.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];n.where&&(s=function(){const e=function t(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=aT(e.unaryFilter.field);return Bw.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=aT(e.unaryFilter.field);return Bw.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=aT(e.unaryFilter.field);return Bw.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=aT(e.unaryFilter.field);return Bw.create(i,"!=",{nullValue:"NULL_VALUE"});default:return c_()}}(e):void 0!==e.fieldFilter?function(e){return Bw.create(aT(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return c_()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return jw.create(e.compositeFilter.filters.map(e=>t(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return c_()}}(e.compositeFilter.op))}(e):c_()}(n.where);return e instanceof jw&&zw(e)?e.getFilters():[e]}());let a=[];n.orderBy&&(a=n.orderBy.map(e=>function(e){return new rb(aT(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let o=null;var c,l,u,h;n.limit&&(o=(e=n.limit,cw(c="object"==typeof e?e.value:e)?null:c));let d=null;n.startAt&&(d=(l=n.startAt,h=!!l.before,u=l.values||[],new Fw(u,h)));let p=null;return n.endAt&&(p=(l=n.endAt,u=!l.before,h=l.values||[],new Fw(h,u))),Ib(t,i,a,s,o,"F",d,p)}function rT(e){return LI[e]}function iT(e){return FI[e]}function sT(e){return{fieldPath:e.canonicalString()}}function aT(e){return R_.fromServerFormat(e.fieldPath)}function oT(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function cT(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=lT(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return lT(t)}function lT(e){return e+""}function uT(t){const n=t.length;if(l_(2<=n),2===n)return l_(""===t.charAt(0)&&""===t.charAt(1)),N_.emptyPath();const r=n-2,i=[];let s="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>r)&&c_(),t.charAt(n+1)){case"":const r=t.substring(a,n);let e;0===s.length?e=r:(s+=r,e=s,s=""),i.push(e);break;case"":s+=t.substring(a,n),s+="\0";break;case"":s+=t.substring(a,n+1);break;default:c_()}a=n+2}return new N_(i)}const hT=["userId","batchId"];function dT(e,t){return[e,cT(t)]}function pT(e,t,n){return[e,cT(t),n]}const fT={},gT=["prefixPath","collectionGroup","readTime","documentId"],mT=["prefixPath","collectionGroup","documentId"],vT=["collectionGroup","readTime","prefixPath","documentId"],yT=["canonicalId","targetId"],_T=["targetId","path"],wT=["path","targetId"],bT=["collectionId","parent"],IT=["indexId","uid"],TT=["uid","sequenceNumber"],ET=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],kT=["indexId","uid","orderedDocumentKey"],CT=["userId","collectionPath","documentId"],ST=["userId","collectionPath","largestBatchId"],NT=["userId","collectionGroup","largestBatchId"],AT=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],RT=[...AT,"documentOverlays"],DT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],xT=DT,PT=[...xT,"indexConfiguration","indexState","indexEntries"];class OT extends j_{constructor(e,t){super(),this.re=e,this.currentSequenceNumber=t}}function MT(e,t){var n=e;return W_.M(n.re,t)}class LT{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&rI(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=iI(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=iI(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=bI();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=nI(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(C_.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),EI())}isEqual(e){return this.batchId===e.batchId&&T_(this.mutations,e.mutations,(e,t)=>sI(e,t))&&T_(this.baseMutations,e.baseMutations,(e,t)=>sI(e,t))}}class FT{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){l_(e.mutations.length===n.length);let r=II;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new FT(e,t,n,r)}}class UT{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class qT{constructor(e,t,n,r,i=C_.min(),s=C_.min(),a=dw.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new qT(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new qT(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new qT(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class VT{constructor(e){this.oe=e}}function BT(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:jT(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:$I(i=e.oe,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:qI(i,e.version.toTimestamp()),createTime:qI(i,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:KT(t.version)};else{if(!t.isUnknownDocument())return c_();r.unknownDocument={path:n.path.toArray(),version:KT(t.version)}}var i;return r}function jT(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function KT(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function $T(e){var t=new k_(e.seconds,e.nanoseconds);return C_.fromTimestamp(t)}function zT(t,e){const n=(e.baseMutations||[]).map(e=>ZI(t.oe,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>ZI(t.oe,e)),i=k_.fromMillis(e.localWriteTimeMs);return new LT(e.batchId,i,n,r)}function WT(e){var t,n=$T(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?$T(e.lastLimboFreeSnapshotVersion):C_.min();let i;return i=void 0!==e.query.documents?(l_(1===(t=e.query).documents.length),Ab(Tb(GI(t.documents[0])))):Ab(nT(e.query)),new qT(i,e.targetId,0,e.lastListenSequenceNumber,n,r,dw.fromBase64String(e.resumeToken))}function GT(e,t){var n=KT(t.snapshotVersion),r=KT(t.lastLimboFreeSnapshotVersion),i=(vb(t.target)?eT:tT)(e.oe,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:gb(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function HT(e){var t=nT({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Db(t,t.limit,"L"):t}function QT(e,t){return new UT(t.largestBatchId,ZI(e.oe,t.overlayMutation))}function YT(e,t){var n=t.path.lastSegment();return[e,cT(t.path.popLast()),n]}function XT(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:KT(r.readTime),documentKey:cT(r.documentKey.path),largestBatchId:r.largestBatchId}}class JT{getBundleMetadata(e,t){return ZT(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:$T(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return ZT(e).put({bundleId:(n=t).id,createTime:KT(BI(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return eE(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:HT(t.bundledQuery),readTime:$T(t.readTime)};var t})}saveNamedQuery(e,t){return eE(e).put({name:(t=t).name,readTime:KT(BI(t.readTime)),bundledQuery:t.bundledQuery})}}function ZT(e){return MT(e,"bundles")}function eE(e){return MT(e,"namedQueries")}class tE{constructor(e,t){this.Tt=e,this.userId=t}static ue(e,t){var n=t.uid||"";return new tE(e,n)}getOverlay(e,t){return nE(e).get(YT(this.userId,t)).next(e=>e?QT(this.Tt,e):null)}getOverlays(e,t){const n=bI();return $_.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,i,e){const s=[];return e.forEach((e,t)=>{var n=new UT(i,t);s.push(this.ce(r,n))}),$_.waitFor(s)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(cT(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(nE(n).Y("collectionPathOverlayIndex",t))}),$_.waitFor(i)}getOverlaysForCollection(e,t,n){const r=bI(),i=cT(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return nE(e).W("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=QT(this.Tt,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=bI();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return nE(e).X({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=QT(this.Tt,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}ce(e,t){return nE(e).put(function(e,t,n){var[,r,i]=YT(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:JI(e.oe,n.mutation)}}(this.Tt,this.userId,t))}}function nE(e){return MT(e,"documentOverlays")}class rE{constructor(){}ae(e,t){this.he(e,t),t.le()}he(e,t){var n,r;"nullValue"in e?this.fe(t,5):"booleanValue"in e?(this.fe(t,10),t.de(e.booleanValue?1:0)):"integerValue"in e?(this.fe(t,15),t.de(gw(e.integerValue))):"doubleValue"in e?(n=gw(e.doubleValue),isNaN(n)?this.fe(t,13):(this.fe(t,15),lw(n)?t.de(0):t.de(n))):"timestampValue"in e?(r=e.timestampValue,this.fe(t,20),"string"==typeof r?t._e(r):(t._e(`${r.seconds||""}`),t.de(r.nanos||0))):"stringValue"in e?(this.we(e.stringValue,t),this.me(t)):"bytesValue"in e?(this.fe(t,30),t.ge(mw(e.bytesValue)),this.me(t)):"referenceValue"in e?this.ye(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.fe(t,45),t.de(r.latitude||0),t.de(r.longitude||0)):"mapValue"in e?Ow(e)?this.fe(t,Number.MAX_SAFE_INTEGER):(this.pe(e.mapValue,t),this.me(t)):"arrayValue"in e?(this.Ie(e.arrayValue,t),this.me(t)):c_()}we(e,t){this.fe(t,25),this.Te(e,t)}Te(e,t){t._e(e)}pe(e,t){var n=e.fields||{};this.fe(t,55);for(const e of Object.keys(n))this.we(e,t),this.he(n[e],t)}Ie(e,t){var n=e.values||[];this.fe(t,50);for(const e of n)this.he(e,t)}ye(e,t){this.fe(t,37),D_.fromName(e).path.forEach(e=>{this.fe(t,60),this.Te(e,t)})}fe(e,t){e.de(t)}me(e){e.de(2)}}function iE(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}rE.Ee=new rE;class sE{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ae(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Re(n.value),n=t.next();this.be()}ve(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Pe(n.value),n=t.next();this.Ve()}Se(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Re(e);else if(e<2048)this.Re(960|e>>>6),this.Re(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Re(480|e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e);else{const e=t.codePointAt(0);this.Re(240|e>>>18),this.Re(128|63&e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e)}}this.be()}De(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Pe(e);else if(e<2048)this.Pe(960|e>>>6),this.Pe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e);else{const e=t.codePointAt(0);this.Pe(240|e>>>18),this.Pe(128|63&e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e)}}this.Ve()}Ce(e){var t=this.xe(e),n=iE(t);this.Ne(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}ke(e){var t=this.xe(e),n=iE(t);this.Ne(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Oe(){this.Me(255),this.Me(255)}Fe(){this.$e(255),this.$e(255)}reset(){this.position=0}seed(e){this.Ne(e.length),this.buffer.set(e,this.position),this.position+=e.length}Be(){return this.buffer.slice(0,this.position)}xe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Re(e){var t=255&e;0==t?(this.Me(0),this.Me(255)):255==t?(this.Me(255),this.Me(0)):this.Me(t)}Pe(e){var t=255&e;0==t?(this.$e(0),this.$e(255)):255==t?(this.$e(255),this.$e(0)):this.$e(e)}be(){this.Me(0),this.Me(1)}Ve(){this.$e(0),this.$e(1)}Me(e){this.Ne(1),this.buffer[this.position++]=e}$e(e){this.Ne(1),this.buffer[this.position++]=~e}Ne(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class aE{constructor(e){this.Le=e}ge(e){this.Le.Ae(e)}_e(e){this.Le.Se(e)}de(e){this.Le.Ce(e)}le(){this.Le.Oe()}}class oE{constructor(e){this.Le=e}ge(e){this.Le.ve(e)}_e(e){this.Le.De(e)}de(e){this.Le.ke(e)}le(){this.Le.Fe()}}class cE{constructor(){this.Le=new sE,this.qe=new aE(this.Le),this.Ue=new oE(this.Le)}seed(e){this.Le.seed(e)}Ke(e){return 0===e?this.qe:this.Ue}Be(){return this.Le.Be()}reset(){this.Le.reset()}}class lE{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ge(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new lE(this.indexId,this.documentKey,this.arrayValue,n)}}function uE(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=hE(e.arrayValue,t.arrayValue),0!==n?n:(n=hE(e.directionalValue,t.directionalValue),0!==n?n:D_.comparator(e.documentKey,t.documentKey)))}function hE(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class dE{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Qe=e.orderBy,this.je=[];for(const t of e.filters){const e=t;e.isInequality()?this.ze=e:this.je.push(e)}}We(e){l_(e.collectionGroup===this.collectionId);var t=P_(e);if(void 0!==t&&!this.He(t))return!1;var n=O_(e);let r=0,i=0;for(;r<n.length&&this.He(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.ze){const e=n[r];if(!this.Je(this.ze,e)||!this.Ye(this.Qe[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Qe.length||!this.Ye(this.Qe[i++],e))return!1}return!0}He(e){for(const t of this.je)if(this.Je(t,e))return!0;return!1}Je(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}Ye(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function pE(e){if(0===e.getFilters().length)return[];const t=function t(e){if(l_(e instanceof Bw||e instanceof jw),e instanceof Bw)return e;if(1===e.filters.length)return t(e.filters[0]);const n=e.filters.map(e=>t(e));let r=jw.create(n,e.op);return r=_E(r),mE(r)?r:(l_(r instanceof jw),l_(Kw(r)),l_(1<r.filters.length),r.filters.reduce((e,t)=>vE(e,t)))}(function t(n){var e;if(l_(n instanceof Bw||n instanceof jw),n instanceof Bw){if(n instanceof eb){const r=(null===(e=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===e?void 0:e.map(e=>Bw.create(n.field,"==",e)))||[];return jw.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return jw.create(r,n.op)}(e));return l_(mE(t)),fE(t)||gE(t)?[t]:t.getFilters()}function fE(e){return e instanceof Bw}function gE(e){return e instanceof jw&&zw(e)}function mE(e){return fE(e)||gE(e)||function(e){if(e instanceof jw&&$w(e)){for(const t of e.getFilters())if(!fE(t)&&!gE(t))return!1;return!0}return!1}(e)}function vE(e,t){var n,r;return l_(e instanceof Bw||e instanceof jw),l_(t instanceof Bw||t instanceof jw),_E(e instanceof Bw?t instanceof Bw?(n=e,r=t,jw.create([n,r],"and")):yE(e,t):t instanceof Bw?yE(t,e):function(e,t){if(l_(0<e.filters.length&&0<t.filters.length),Kw(e)&&Kw(t))return Gw(e,t.getFilters());const n=$w(e)?e:t,r=$w(e)?t:e,i=n.filters.map(e=>vE(e,r));return jw.create(i,"or")}(e,t))}function yE(t,e){if(Kw(e))return Gw(e,t.getFilters());var n=e.filters.map(e=>vE(t,e));return jw.create(n,"or")}function _E(t){if(l_(t instanceof Bw||t instanceof jw),t instanceof Bw)return t;const e=t.getFilters();if(1===e.length)return _E(e[0]);if(Ww(t))return t;const n=e.map(e=>_E(e)),r=[];return n.forEach(e=>{e instanceof Bw?r.push(e):e instanceof jw&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:jw.create(r,t.op)}class wE{constructor(){this.Ze=new bE}addToCollectionParentIndex(e,t){return this.Ze.add(t),$_.resolve()}getCollectionParents(e,t){return $_.resolve(this.Ze.getEntries(t))}addFieldIndex(e,t){return $_.resolve()}deleteFieldIndex(e,t){return $_.resolve()}getDocumentsMatchingTarget(e,t){return $_.resolve(null)}getIndexType(e,t){return $_.resolve(0)}getFieldIndexes(e,t){return $_.resolve([])}getNextCollectionGroupToUpdate(e){return $_.resolve(null)}getMinOffset(e,t){return $_.resolve(q_.min())}getMinOffsetFromCollectionGroup(e,t){return $_.resolve(q_.min())}updateCollectionGroup(e,t,n){return $_.resolve()}updateIndexEntries(e,t){return $_.resolve()}}class bE{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ob(N_.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ob(N_.comparator)).toArray()}}const IE=new Uint8Array(0);class TE{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new bE,this.tn=new mI(e=>gb(e),(e,t)=>mb(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Xe.has(t))return $_.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Xe.add(t)});r={collectionId:n,parent:cT(r)};return EE(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[E_(n),""],!1,!0);return EE(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(uT(t.parent))}return r})}addFieldIndex(e,t){const n=CE(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const i=n.add(r);if(t.indexState){const n=SE(e);return i.next(e=>{n.put(XT(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=CE(e),r=SE(e),i=kE(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,l){const u=kE(e);let h=!0;const n=new Map;return $_.forEach(this.en(l),t=>this.nn(e,t).next(e=>{h=h&&!!e,n.set(t,e)})).next(()=>{if(h){let c=EI();const h=[];return $_.forEach(n,(e,t)=>{i_("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${gb(l)}`);var n=function(e,t){var n=P_(t);if(void 0===n)return null;for(const t of yb(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of O_(t))for(const t of yb(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of O_(t)){const t=(0===i.kind?_b:wb)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new Fw(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of O_(t)){const t=(0===i.kind?wb:_b)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new Fw(n,r)}(t,e),a=this.sn(e,t,i),o=this.sn(e,t,s),r=this.rn(e,t,r),r=this.on(e.indexId,n,a,i.inclusive,o,s.inclusive,r);return $_.forEach(r,e=>u.J(e,l.limit).next(e=>{e.forEach(e=>{var t=D_.fromSegments(e.documentKey);c.has(t)||(c=c.add(t),h.push(t))})}))}).next(()=>h)}return $_.resolve(null)})}en(t){let e=this.tn.get(t);return e||(e=0===t.filters.length?[t]:pE(jw.create(t.filters,"and")).map(e=>fb(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.tn.set(t,e),e)}on(t,e,n,r,i,s,a){const o=(null!=e?e.length:1)*Math.max(n.length,i.length),c=o/(null!=e?e.length:1),l=[];for(let u=0;u<o;++u){const o=e?this.un(e[u/c]):IE,h=this.cn(t,o,n[u%c],r),d=this.an(t,o,i[u%c],s),p=a.map(e=>this.cn(t,o,e,!0));l.push(...this.createRange(h,d,p))}return l}cn(e,t,n,r){const i=new lE(e,D_.empty(),t,n);return r?i:i.Ge()}an(e,t,n,r){const i=new lE(e,D_.empty(),t,n);return r?i.Ge():i}nn(e,t){const r=new dE(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.We(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.en(t);return $_.forEach(r,t=>this.nn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new ob(R_.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}hn(e,t){const n=new cE;for(const i of O_(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.Ke(i.kind);rE.Ee.ae(e,r)}return n.Be()}un(e){const t=new cE;return rE.Ee.ae(e,t.Ke(0)),t.Be()}ln(e,t){const n=new cE;return rE.Ee.ae(Sw(this.databaseId,t),n.Ke(0===(r=O_(e)).length?0:r[r.length-1].kind)),n.Be();var r}rn(e,t,n){if(null===n)return[];let r=[];r.push(new cE);let i=0;for(const s of O_(e)){const e=n[i++];for(const n of r)if(this.fn(t,s.fieldPath)&&Aw(e))r=this.dn(r,s,e);else{const t=n.Ke(s.kind);rE.Ee.ae(e,t)}}return this._n(r)}sn(e,t,n){return this.rn(e,t,n.position)}_n(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Be();return t}dn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new cE;r.seed(n.Be()),rE.Ee.ae(e,r.Ke(t.kind)),i.push(r)}return i}fn(e,t){return!!e.filters.find(e=>e instanceof Bw&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=CE(e),r=SE(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const s=[];return $_.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new L_(e.sequenceNumber,new q_($T(e.readTime),new D_(uT(e.documentKey)),e.largestBatchId)):L_.empty(),r=t.fields.map(([e,t])=>new M_(R_.fromServerFormat(e),t)),new x_(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:I_(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=CE(e),s=SE(e);return this.wn(e).next(t=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>$_.forEach(e,e=>s.put(XT(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return $_.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?$_.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),$_.forEach(e,n=>this.mn(i,t,n).next(e=>{var t=this.gn(r,n);return e.isEqual(t)?$_.resolve():this.yn(i,r,n,e,t)}))))})}pn(e,t,n,r){return kE(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.ln(n,t.key),documentKey:t.key.path.toArray()})}In(e,t,n,r){return kE(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.ln(n,t.key),t.key.path.toArray()])}mn(e,n,r){const t=kE(e);let i=new ob(uE);return t.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.ln(r,n)])},(e,t)=>{i=i.add(new lE(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}gn(e,t){let n=new ob(uE);var r=this.hn(t,e);if(null==r)return n;const i=P_(t);if(null!=i){var s=e.data.field(i.fieldPath);if(Aw(s))for(const i of s.arrayValue.values||[])n=n.add(new lE(t.indexId,e.key,this.un(i),r))}else n=n.add(new lE(t.indexId,e.key,IE,r));return n}yn(t,n,r,l,e){i_("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const i=[];return function(e,n,r,i){var s=l.getIterator(),a=e.getIterator();let o=lb(s),c=lb(a);for(;o||c;){let e=!1,t=!1;if(o&&c){const r=n(o,c);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(c),c=lb(a)):t?(i(o),o=lb(s)):(o=lb(s),c=lb(a))}}(e,uE,e=>{i.push(this.pn(t,n,r,e))},e=>{i.push(this.In(t,n,r,e))}),$_.waitFor(i)}wn(e){let r=1;return SE(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>uE(e,t)).filter((e,t,n)=>!t||0!==uE(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=uE(i,e),s=uE(i,t);if(0===n)r[0]=e.Ge();else if(0<n&&s<0)r.push(i),r.push(i.Ge());else if(0<s)break}r.push(t);const i=[];for(let a=0;a<r.length;a+=2){if(this.Tn(r[a],r[a+1]))return[];const t=[r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,IE,[]],n=[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,IE,[]];i.push(IDBKeyRange.bound(t,n))}return i}Tn(e,t){return 0<uE(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(NE)}getMinOffset(t,e){return $_.mapArray(this.en(e),e=>this.nn(t,e).next(e=>e||c_())).next(NE)}}function EE(e){return MT(e,"collectionParents")}function kE(e){return MT(e,"indexEntries")}function CE(e){return MT(e,"indexConfiguration")}function SE(e){return MT(e,"indexState")}function NE(e){l_(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;V_(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new q_(t.readTime,t.documentKey,n)}const AE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class RE{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new RE(e,RE.DEFAULT_COLLECTION_PERCENTILE,RE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function DE(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const c=r.X({range:a},(e,t,n)=>(o++,n.delete()));s.push(c.next(()=>{l_(1===o)}));const l=[];for(const e of n.mutations){const r=pT(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return $_.waitFor(s).next(()=>l)}function xE(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw c_();t=e.noDocument}return JSON.stringify(t).length}RE.DEFAULT_COLLECTION_PERCENTILE=10,RE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,RE.DEFAULT=new RE(41943040,RE.DEFAULT_COLLECTION_PERCENTILE,RE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),RE.DISABLED=new RE(-1,0,0);class PE{constructor(e,t,n,r){this.userId=e,this.Tt=t,this.indexManager=n,this.referenceDelegate=r,this.En={}}static ue(e,t,n,r){l_(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new PE(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ME(e).X({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=LE(u),g=ME(u);return g.add({}).next(e=>{l_("number"==typeof e);const t=new LT(e,h,d,p),n=(i=this.Tt,s=this.userId,a=t,o=a.baseMutations.map(e=>JI(i.oe,e)),c=a.mutations.map(e=>JI(i.oe,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:c}),r=[];var i,s,a,o,c;let l=new ob((e,t)=>I_(e.canonicalString(),t.canonicalString()));for(const u of p){const h=pT(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,fT))}return l.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.En[e]=t.keys()}),$_.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return ME(e).get(t).next(e=>e?(l_(e.userId===this.userId),zT(this.Tt,e)):null)}An(e,n){return this.En[n]?$_.resolve(this.En[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.En[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ME(e).X({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(l_(t.batchId>=r),i=zT(this.Tt,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ME(e).X({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ME(e).W("userMutationsIndex",t).next(e=>e.map(e=>zT(this.Tt,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=dT(this.userId,o.path),t=IDBKeyRange.lowerBound(e),c=[];return LE(a).X({range:t},(e,t,n)=>{var[r,i,s]=e,i=uT(i);if(r===this.userId&&o.path.isEqual(i))return ME(a).get(s).next(e=>{if(!e)throw c_();l_(e.userId===this.userId),c.push(zT(this.Tt,e))});n.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new ob(I_);const n=[];return e.forEach(a=>{var e=dT(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=LE(t).X({range:e},(e,t,n)=>{var[r,i,s]=e,i=uT(i);r===this.userId&&a.path.isEqual(i)?o=o.add(s):n.done()});n.push(e)}),$_.waitFor(n).next(()=>this.Rn(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=dT(this.userId,a),r=IDBKeyRange.lowerBound(n);let c=new ob(I_);return LE(e).X({range:r},(e,t,n)=>{var[r,i,s]=e,i=uT(i);r===this.userId&&a.isPrefixOf(i)?i.length===o&&(c=c.add(s)):n.done()}).next(()=>this.Rn(e,c))}Rn(t,e){const n=[],r=[];return e.forEach(e=>{r.push(ME(t).get(e).next(e=>{if(null===e)throw c_();l_(e.userId===this.userId),n.push(zT(this.Tt,e))}))}),$_.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return DE(t.re,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.bn(n.batchId)}),$_.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}bn(e){delete this.En[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return $_.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return LE(n).X({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=uT(e[1]);r.push(t)}else n.done()}).next(()=>{l_(0===r.length)})})}containsKey(e,t){return OE(e,this.userId,t)}vn(e){return FE(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function OE(e,s,t){const n=dT(s,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return LE(e).X({range:r,Z:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===a&&(o=!0),n.done()}).next(()=>o)}function ME(e){return MT(e,"mutations")}function LE(e){return MT(e,"documentMutations")}function FE(e){return MT(e,"mutationQueues")}class UE{constructor(e){this.Pn=e}next(){return this.Pn+=2,this.Pn}static Vn(){return new UE(0)}static Sn(){return new UE(-1)}}class qE{constructor(e,t){this.referenceDelegate=e,this.Tt=t}allocateTargetId(n){return this.Dn(n).next(e=>{const t=new UE(e.highestTargetId);return e.highestTargetId=t.next(),this.Cn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Dn(e).next(e=>C_.fromTimestamp(new k_(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Dn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Dn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Cn(t,e)))}addTargetData(t,n){return this.xn(t,n).next(()=>this.Dn(t).next(e=>(e.targetCount+=1,this.Nn(n,e),this.Cn(t,e))))}updateTargetData(e,t){return this.xn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>VE(t).delete(e.targetId)).next(()=>this.Dn(t)).next(e=>(l_(0<e.targetCount),--e.targetCount,this.Cn(t,e)))}removeTargets(r,i,s){let a=0;const o=[];return VE(r).X((e,t)=>{var n=WT(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>$_.waitFor(o)).next(()=>a)}forEachTarget(e,r){return VE(e).X((e,t)=>{var n=WT(t);r(n)})}Dn(e){return BE(e).get("targetGlobalKey").next(e=>(l_(null!==e),e))}Cn(e,t){return BE(e).put("targetGlobalKey",t)}xn(e,t){return VE(e).put(GT(this.Tt,t))}Nn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Dn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=gb(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return VE(e).X({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=WT(t);mb(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=jE(n);return e.forEach(e=>{var t=cT(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),$_.waitFor(i)}removeMatchingKeys(n,e,r){const i=jE(n);return $_.forEach(e,e=>{var t=cT(e.path);return $_.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=jE(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=jE(e);let i=EI();return r.X({range:n,Z:!0},(e,t,n)=>{var r=uT(e[1]),r=new D_(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=cT(t.path),n=IDBKeyRange.bound([n],[E_(n)],!1,!0);let r=0;return jE(e).X({index:"documentTargetsIndex",Z:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}ie(e,t){return VE(e).get(t).next(e=>e?WT(e):null)}}function VE(e){return MT(e,"targets")}function BE(e){return MT(e,"targetGlobal")}function jE(e){return MT(e,"targetDocuments")}function KE([e,t],[n,r]){var i=I_(e,n);return 0===i?I_(t,r):i}class $E{constructor(e){this.kn=e,this.buffer=new ob(KE),this.On=0}Mn(){return++this.On}Fn(e){var t=[e,this.Mn()];if(this.buffer.size<this.kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();KE(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class zE{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.$n=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Bn(6e4)}stop(){this.$n&&(this.$n.cancel(),this.$n=null)}get started(){return null!==this.$n}Bn(e){i_("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.$n=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.$n=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Q_(e)?i_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await K_(e)}await this.Bn(3e5)})}}class WE{constructor(e,t){this.Ln=e,this.params=t}calculateTargetCount(e,t){return this.Ln.qn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return $_.resolve(nw.at);const n=new $E(t);return this.Ln.forEachTarget(e,e=>n.Fn(e.sequenceNumber)).next(()=>this.Ln.Un(e,e=>n.Fn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Ln.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Ln.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(i_("LruGarbageCollector","Garbage collection skipped; disabled"),$_.resolve(AE)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(i_("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),AE):this.Kn(t,n))}getCacheSize(e){return this.Ln.getCacheSize(e)}Kn(t,n){let r,i,s,a,o,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(i_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),r_()<=m.DEBUG&&i_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-u}ms\n\tDetermined least recently used ${i} in `+(o-a)+"ms\n"+`\tRemoved ${s} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),$_.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class GE{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new WE(e,t))}qn(e){const n=this.Gn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Gn(e){let t=0;return this.Un(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Un(e,n){return this.Qn(e,(e,t)=>n(t))}addReference(e,t,n){return HE(e,n)}removeReference(e,t,n){return HE(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return HE(e,t)}jn(t,n){let r=!1;return FE(t).tt(e=>OE(t,e,n).next(e=>(e&&(r=!0),$_.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Qn(n,(t,e)=>{if(e<=r){const r=this.jn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,C_.min()),jE(n).delete([0,cT(t.path)])))});s.push(r)}}).next(()=>$_.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return HE(e,t)}Qn(e,r){const t=jE(e);let i,s=nw.at;return t.X({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==nw.at&&r(new D_(uT(i)),s),s=n,i=t):s=nw.at}).next(()=>{s!==nw.at&&r(new D_(uT(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function HE(e,t){return jE(e).put((e=e.currentSequenceNumber,{targetId:0,path:cT(t.path),sequenceNumber:e}))}class QE{constructor(){this.changes=new mI(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,db.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?$_.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class YE{constructor(e){this.Tt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return e0(e).put(n)}removeEntry(e,n,t){return e0(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],jT(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.zn(t,e)))}getEntry(e,n){let r=db.newInvalidDocument(n);return e0(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(t0(n))},(e,t)=>{r=this.Wn(n,t)}).next(()=>r)}Hn(e,n){let r={size:0,document:db.newInvalidDocument(n)};return e0(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(t0(n))},(e,t)=>{r={document:this.Wn(n,t),size:xE(t)}}).next(()=>r)}getEntries(e,t){let r=vI;return this.Jn(e,t,(e,t)=>{var n=this.Wn(e,t);r=r.insert(e,n)}).next(()=>r)}Yn(e,t){let r=vI,i=new ib(D_.comparator);return this.Jn(e,t,(e,t)=>{var n=this.Wn(e,t);r=r.insert(e,n),i=i.insert(e,xE(t))}).next(()=>({documents:r,Zn:i}))}Jn(e,t,i){if(t.isEmpty())return $_.resolve();let n=new ob(r0);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(t0(n.first()),t0(n.last())),s=n.getIterator();let a=s.getNext();return e0(e).X({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=D_.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&r0(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.j(t0(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t,i){const n=r.path,s=[n.popLast().toArray(),n.lastSegment(),jT(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],a=[n.popLast().toArray(),n.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return e0(e).W(IDBKeyRange.bound(s,a,!0)).next(e=>{let t=vI;for(const n of e){const e=this.Wn(D_.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e.isFoundDocument()&&(Mb(r,e)||i.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,n,i){let s=vI;var r=n0(t,n),a=n0(t,q_.max());return e0(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.Wn(D_.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()}).next(()=>s)}newChangeBuffer(e){return new JE(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return ZE(e).get("remoteDocumentGlobalKey").next(e=>(l_(!!e),e))}zn(e,t){return ZE(e).put("remoteDocumentGlobalKey",t)}Wn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=XI(e.oe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=D_.fromSegments(t.noDocument.path),i=$T(t.noDocument.readTime);n=db.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return c_();{const e=D_.fromSegments(t.unknownDocument.path),s=$T(t.unknownDocument.version);n=db.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new k_(t[0],t[1]),C_.fromTimestamp(r))),n;var r}(this.Tt,t);if(!e.isNoDocument()||!e.version.isEqual(C_.min()))return e}return db.newInvalidDocument(e)}}function XE(e){return new YE(e)}class JE extends QE{constructor(e,t){super(),this.Xn=e,this.trackRemovals=t,this.ts=new mI(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,c=new ob((e,t)=>I_(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.ts.get(e);if(a.push(this.Xn.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=BT(this.Xn.Tt,t);c=c.add(e.path.popLast());var i=xE(r);o+=i-n.size,a.push(this.Xn.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=BT(this.Xn.Tt,t.convertToNoDocument(C_.min()));a.push(this.Xn.addEntry(s,e,o))}}),c.forEach(e=>{a.push(this.Xn.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.Xn.updateMetadata(s,o)),$_.waitFor(a)}getFromCache(e,t){return this.Xn.Hn(e,t).next(e=>(this.ts.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Xn.Yn(e,t).next(({documents:n,Zn:e})=>(e.forEach((e,t)=>{this.ts.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function ZE(e){return MT(e,"remoteDocumentGlobal")}function e0(e){return MT(e,"remoteDocumentsV14")}function t0(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function n0(e,t){const n=t.documentKey.path.toArray();return[e,jT(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function r0(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=I_(n[s],r[s]),i)return i;return i=I_(n.length,r.length),i||(i=I_(n[n.length-2],r[r.length-2]),i||I_(n[n.length-1],r[r.length-1]))}class i0{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class s0{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&iI(r.mutation,e,ub.empty(),k_.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,EI()).next(()=>e))}getLocalViewOfDocuments(e,t,n=EI()){const r=bI();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=_I();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=bI();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,EI()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=vI;const a=bI(),o=bI();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof oI)?s=s.insert(t.key,t):void 0!==n?(a.set(t.key,n.mutation.getFieldMask()),iI(n.mutation,t,n.mutation.getFieldMask(),k_.now())):a.set(t.key,ub.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new i0(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(s,a){const o=bI();let c=new ib((e,t)=>e-t),l=EI();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||ub.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(c.get(r.batchId)||EI()).add(e),c=c.insert(r.batchId,t))})}).next(()=>{const e=[],t=c.getReverseIterator();for(;t.hasNext();){const c=t.getNext(),n=c.key,r=c.value,i=bI();r.forEach(e=>{var t;l.has(e)||(null!==(t=nI(a.get(e),o.get(e)))&&i.set(e,t),l=l.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return $_.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,D_.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Sb(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):$_.resolve(bI());let r=-1,i=n;return e.next(e=>$_.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?$_.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,EI())).next(e=>({batchId:r,changes:wI(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new D_(t)).next(e=>{let t=_I();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,i,s){const a=i.collectionGroup;let o=_I();return this.indexManager.getCollectionParents(r,a).next(e=>$_.forEach(e,e=>{var t,n=(t=i,e=e.child(a),new bb(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,s,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,n,a))).next(r=>{a.forEach((e,t)=>{var n=t.getKey();null===r.get(n)&&(r=r.insert(n,db.newInvalidDocument(n)))});let i=_I();return r.forEach((e,t)=>{var n=a.get(e);void 0!==n&&iI(n.mutation,t,ub.empty(),k_.now()),Mb(s,t)&&(i=i.insert(e,t))}),i})}}class a0{constructor(e){this.Tt=e,this.es=new Map,this.ns=new Map}getBundleMetadata(e,t){return $_.resolve(this.es.get(t))}saveBundleMetadata(e,t){return this.es.set(t.id,{id:t.id,version:t.version,createTime:BI(t.createTime)}),$_.resolve()}getNamedQuery(e,t){return $_.resolve(this.ns.get(t))}saveNamedQuery(e,t){return this.ns.set(t.name,{name:(t=t).name,query:HT(t.bundledQuery),readTime:BI(t.readTime)}),$_.resolve()}}class o0{constructor(){this.overlays=new ib(D_.comparator),this.ss=new Map}getOverlay(e,t){return $_.resolve(this.overlays.get(t))}getOverlays(e,t){const n=bI();return $_.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.ce(n,r,t)}),$_.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ss.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.ss.delete(n)),$_.resolve()}getOverlaysForCollection(e,t,n){const r=bI(),i=t.length+1,s=new D_(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return $_.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new ib((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=bI(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=bI(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return $_.resolve(a)}ce(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.ss.get(r.largestBatchId).delete(n.key);this.ss.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new UT(t,n));let i=this.ss.get(t);void 0===i&&(i=EI(),this.ss.set(t,i)),this.ss.set(t,i.add(n.key))}}class c0{constructor(){this.rs=new ob(l0.os),this.us=new ob(l0.cs)}isEmpty(){return this.rs.isEmpty()}addReference(e,t){var n=new l0(e,t);this.rs=this.rs.add(n),this.us=this.us.add(n)}hs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ls(new l0(e,t))}fs(e,t){e.forEach(e=>this.removeReference(e,t))}ds(e){const t=new D_(new N_([])),n=new l0(t,e),r=new l0(t,e+1),i=[];return this.us.forEachInRange([n,r],e=>{this.ls(e),i.push(e.key)}),i}_s(){this.rs.forEach(e=>this.ls(e))}ls(e){this.rs=this.rs.delete(e),this.us=this.us.delete(e)}ws(e){var t=new D_(new N_([])),n=new l0(t,e),t=new l0(t,e+1);let r=EI();return this.us.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new l0(e,0),t=this.rs.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class l0{constructor(e,t){this.key=e,this.gs=t}static os(e,t){return D_.comparator(e.key,t.key)||I_(e.gs,t.gs)}static cs(e,t){return I_(e.gs,t.gs)||D_.comparator(e.key,t.key)}}class u0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ys=1,this.ps=new ob(l0.os)}checkEmpty(e){return $_.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.ys;this.ys++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new LT(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.ps=this.ps.add(new l0(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return $_.resolve(s)}lookupMutationBatch(e,t){return $_.resolve(this.Is(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.Ts(t+1),n=n<0?0:n;return $_.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return $_.resolve(0===this.mutationQueue.length?-1:this.ys-1)}getAllMutationBatches(e){return $_.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new l0(t,0),r=new l0(t,Number.POSITIVE_INFINITY),i=[];return this.ps.forEachInRange([n,r],e=>{var t=this.Is(e.gs);i.push(t)}),$_.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ob(I_);return t.forEach(e=>{var t=new l0(e,0),n=new l0(e,Number.POSITIVE_INFINITY);this.ps.forEachInRange([t,n],e=>{r=r.add(e.gs)})}),$_.resolve(this.Es(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;D_.isDocumentKey(i)||(i=i.child(""));var s=new l0(new D_(i),0);let a=new ob(I_);return this.ps.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.gs)),!0)},s),$_.resolve(this.Es(a))}Es(e){const n=[];return e.forEach(e=>{var t=this.Is(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){l_(0===this.As(r.batchId,"removed")),this.mutationQueue.shift();let i=this.ps;return $_.forEach(r.mutations,e=>{var t=new l0(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ps=i})}bn(e){}containsKey(e,t){var n=new l0(t,0),n=this.ps.firstAfterOrEqual(n);return $_.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,$_.resolve()}As(e,t){return this.Ts(e)}Ts(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Is(e){var t=this.Ts(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class h0{constructor(e){this.Rs=e,this.docs=new ib(D_.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Rs(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return $_.resolve(n?n.document.mutableCopy():db.newInvalidDocument(t))}getEntries(e,t){let n=vI;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():db.newInvalidDocument(e))}),$_.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=vI;const s=t.path,a=new D_(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||V_(U_(a),n)<=0||(r.has(a.key)||Mb(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return $_.resolve(i)}getAllFromCollectionGroup(e,t,n,r){c_()}bs(e,t){return $_.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new d0(this)}getSize(e){return $_.resolve(this.size)}}class d0 extends QE{constructor(e){super(),this.Xn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Xn.addEntry(n,t)):this.Xn.removeEntry(e)}),$_.waitFor(r)}getFromCache(e,t){return this.Xn.getEntry(e,t)}getAllFromCache(e,t){return this.Xn.getEntries(e,t)}}class p0{constructor(e){this.persistence=e,this.vs=new mI(e=>gb(e),mb),this.lastRemoteSnapshotVersion=C_.min(),this.highestTargetId=0,this.Ps=0,this.Vs=new c0,this.targetCount=0,this.Ss=UE.Vn()}forEachTarget(e,n){return this.vs.forEach((e,t)=>n(t)),$_.resolve()}getLastRemoteSnapshotVersion(e){return $_.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return $_.resolve(this.Ps)}allocateTargetId(e){return this.highestTargetId=this.Ss.next(),$_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ps&&(this.Ps=t),$_.resolve()}xn(e){this.vs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Ss=new UE(t),this.highestTargetId=t),e.sequenceNumber>this.Ps&&(this.Ps=e.sequenceNumber)}addTargetData(e,t){return this.xn(t),this.targetCount+=1,$_.resolve()}updateTargetData(e,t){return this.xn(t),$_.resolve()}removeTargetData(e,t){return this.vs.delete(t.target),this.Vs.ds(t.targetId),--this.targetCount,$_.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.vs.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.vs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),$_.waitFor(a).next(()=>s)}getTargetCount(e){return $_.resolve(this.targetCount)}getTargetData(e,t){var n=this.vs.get(t)||null;return $_.resolve(n)}addMatchingKeys(e,t,n){return this.Vs.hs(t,n),$_.resolve()}removeMatchingKeys(t,e,n){this.Vs.fs(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),$_.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Vs.ds(t),$_.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Vs.ws(t);return $_.resolve(n)}containsKey(e,t){return $_.resolve(this.Vs.containsKey(t))}}class f0{constructor(e,t){this.Ds={},this.overlays={},this.Cs=new nw(0),this.xs=!1,this.xs=!0,this.referenceDelegate=e(this),this.Ns=new p0(this),this.indexManager=new wE,this.remoteDocumentCache=(e=e=>this.referenceDelegate.ks(e),new h0(e)),this.Tt=new VT(t),this.Os=new a0(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new o0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ds[e.toKey()];return n||(n=new u0(t,this.referenceDelegate),this.Ds[e.toKey()]=n),n}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Os}runTransaction(e,t,n){i_("MemoryPersistence","Starting transaction:",e);const r=new g0(this.Cs.next());return this.referenceDelegate.Ms(),n(r).next(e=>this.referenceDelegate.Fs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}$s(t,n){return $_.or(Object.values(this.Ds).map(e=>()=>e.containsKey(t,n)))}}class g0 extends j_{constructor(e){super(),this.currentSequenceNumber=e}}class m0{constructor(e){this.persistence=e,this.Bs=new c0,this.Ls=null}static qs(e){return new m0(e)}get Us(){if(this.Ls)return this.Ls;throw c_()}addReference(e,t,n){return this.Bs.addReference(n,t),this.Us.delete(n.toString()),$_.resolve()}removeReference(e,t,n){return this.Bs.removeReference(n,t),this.Us.add(n.toString()),$_.resolve()}markPotentiallyOrphaned(e,t){return this.Us.add(t.toString()),$_.resolve()}removeTarget(e,t){this.Bs.ds(t.targetId).forEach(e=>this.Us.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Us.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ms(){this.Ls=new Set}Fs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return $_.forEach(this.Us,e=>{const t=D_.fromPath(e);return this.Ks(n,t).next(e=>{e||r.removeEntry(t,C_.min())})}).next(()=>(this.Ls=null,r.apply(n)))}updateLimboDocument(e,t){return this.Ks(e,t).next(e=>{e?this.Us.delete(t.toString()):this.Us.add(t.toString())})}ks(e){return 0}Ks(e,t){return $_.or([()=>$_.resolve(this.Bs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.$s(e,t)])}}class v0{constructor(e){this.Tt=e}$(t,e,n,r){const i=new z_("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hT,{unique:!0}),s.createObjectStore("documentMutations"),y0(t),t.createObjectStore("remoteDocuments"));let a=$_.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),y0(t)),a=a.next(()=>function(){const e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:C_.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,i){return i.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hT,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return $_.waitFor(n)})}(t,i))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Gs(i))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Qs(i)))),n<7&&7<=r&&(a=a.next(()=>this.js(i))),n<8&&8<=r&&(a=a.next(()=>this.zs(t,i))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.Ws(i))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:CT});e.createIndex("collectionPathOverlayIndex",ST,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",NT,{unique:!1})}()})),n<13&&13<=r&&(a=a.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:gT});e.createIndex("documentKeyIndex",mT),e.createIndex("collectionGroupIndex",vT)}()).next(()=>this.Hs(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.Js(t,i))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:IT}).createIndex("sequenceNumberIndex",TT,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ET}).createIndex("documentKeyIndex",kT,{unique:!1})}(t))),a}Qs(t){let n=0;return t.store("remoteDocuments").X((e,t)=>{n+=xE(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Gs(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.W().next(e=>$_.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.W("userMutationsIndex",e).next(e=>$_.forEach(e,e=>{l_(e.userId===n.userId);var t=zT(this.Tt,e);return DE(r,n.userId,t).next(()=>{})}))}))}js(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.X((e,t)=>{const n=new N_(e),r=[0,cT(n)];s.push(a.get(r).next(e=>e?$_.resolve():(e=>a.put({targetId:0,path:cT(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>$_.waitFor(s))})}zs(e,t){e.createObjectStore("collectionParents",{keyPath:bT});const n=t.store("collectionParents"),r=new bE,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:cT(r)})}};return t.store("remoteDocuments").X({Z:!0},(e,t)=>{const n=new N_(e);return i(n.popLast())}).next(()=>t.store("documentMutations").X({Z:!0},([,e],t)=>{const n=uT(e);return i(n.popLast())}))}Ws(e){const r=e.store("targets");return r.X((e,t)=>{var n=WT(t),n=GT(this.Tt,n);return r.put(n)})}Hs(e,s){const t=s.store("remoteDocuments"),a=[];return t.X((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new D_(N_.fromString(i.document.name).popFirst(5)):i.noDocument?D_.fromSegments(i.noDocument.path):i.unknownDocument?D_.fromSegments(i.unknownDocument.path):c_()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>$_.waitFor(a))}Js(e,s){const t=s.store("mutations"),a=XE(this.Tt),o=new f0(m0.qs,this.Tt.oe);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:EI();zT(this.Tt,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),$_.forEach(r,(e,t)=>{var n=new e_(t),r=tE.ue(this.Tt,n),i=o.getIndexManager(n),n=PE.ue(n,this.Tt,i,o.referenceDelegate);return new s0(a,n,r,i).recalculateAndSaveOverlaysForDocumentKeys(new OT(s,nw.at),e).next()})})}}function y0(e){e.createObjectStore("targetDocuments",{keyPath:_T}).createIndex("documentTargetsIndex",wT,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",yT,{unique:!0}),e.createObjectStore("targetGlobal")}const _0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class w0{constructor(e,t,n,r,i,s,a,o,c,l,u=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ys=i,this.window=s,this.document=a,this.Zs=c,this.Xs=l,this.ti=u,this.Cs=null,this.xs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ei=null,this.inForeground=!1,this.ni=null,this.si=null,this.ii=Number.NEGATIVE_INFINITY,this.ri=e=>Promise.resolve(),!w0.C())throw new h_(u_.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new GE(this,r),this.oi=t+"main",this.Tt=new VT(o),this.ui=new W_(this.oi,this.ti,new v0(this.Tt)),this.Ns=new qE(this.referenceDelegate,this.Tt),this.remoteDocumentCache=XE(this.Tt),this.Os=new JT,this.window&&this.window.localStorage?this.ci=this.window.localStorage:(this.ci=null,!1===l&&s_("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new h_(u_.FAILED_PRECONDITION,_0);return this.hi(),this.li(),this.fi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ns.getHighestSequenceNumber(e))}).then(e=>{this.Cs=new nw(e,this.Zs)}).then(()=>{this.xs=!0}).catch(e=>(this.ui&&this.ui.close(),Promise.reject(e)))}di(t){return this.ri=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ui.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ys.enqueueAndForget(async()=>{this.started&&await this.ai()}))}ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>I0(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this._i(t).next(e=>{e||(this.isPrimary=!1,this.Ys.enqueueRetryable(()=>this.ri(!1)))})}).next(()=>this.wi(t)).next(e=>this.isPrimary&&!e?this.mi(t).next(()=>!1):!!e&&this.gi(t).next(()=>!0))).catch(e=>{if(Q_(e))return i_("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return i_("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ys.enqueueRetryable(()=>this.ri(e)),this.isPrimary=e})}_i(e){return b0(e).get("owner").next(e=>$_.resolve(this.yi(e)))}pi(e){return I0(e).delete(this.clientId)}async Ii(){if(this.isPrimary&&!this.Ti(this.ii,18e5)){this.ii=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=MT(e,"clientMetadata");return r.W().next(e=>{const t=this.Ei(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return $_.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.ci)for(const t of e)this.ci.removeItem(this.Ai(t.clientId))}}fi(){this.si=this.Ys.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ai().then(()=>this.Ii()).then(()=>this.fi()))}yi(e){return!!e&&e.ownerId===this.clientId}wi(t){return this.Xs?$_.resolve(!0):b0(t).get("owner").next(e=>{if(null!==e&&this.Ti(e.leaseTimestampMs,5e3)&&!this.Ri(e.ownerId)){if(this.yi(e)&&this.networkEnabled)return!0;if(!this.yi(e)){if(!e.allowTabSynchronization)throw new h_(u_.FAILED_PRECONDITION,_0);return!1}}return!(!this.networkEnabled||!this.inForeground)||I0(t).W().next(e=>void 0===this.Ei(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&i_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.xs=!1,this.bi(),this.si&&(this.si.cancel(),this.si=null),this.vi(),this.Pi(),await this.ui.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new OT(e,nw.at);return this.mi(t).next(()=>this.pi(t))}),this.ui.close(),this.Vi()}Ei(e,t){return e.filter(e=>this.Ti(e.updateTimeMs,t)&&!this.Ri(e.clientId))}Si(){return this.runTransaction("getActiveClients","readonly",e=>I0(e).W().next(e=>this.Ei(e,18e5).map(e=>e.clientId)))}get started(){return this.xs}getMutationQueue(e,t){return PE.ue(e,this.Tt,t,this.referenceDelegate)}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new TE(e,this.Tt.oe.databaseId)}getDocumentOverlayCache(e){return tE.ue(this.Tt,e)}getBundleCache(){return this.Os}runTransaction(t,n,r){i_("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",e=15===(e=this.ti)?PT:14===e?xT:13===e?DT:12===e?RT:11===e?AT:void c_();let s;return this.ui.runTransaction(t,i,e,e=>(s=new OT(e,this.Cs?this.Cs.next():nw.at),"readwrite-primary"===n?this._i(s).next(e=>!!e||this.wi(s)).next(e=>{if(!e)throw s_(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Ys.enqueueRetryable(()=>this.ri(!1)),new h_(u_.FAILED_PRECONDITION,B_);return r(s)}).next(e=>this.gi(s).next(()=>e)):this.Di(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Di(e){return b0(e).get("owner").next(e=>{if(null!==e&&this.Ti(e.leaseTimestampMs,5e3)&&!this.Ri(e.ownerId)&&!this.yi(e)&&!(this.Xs||this.allowTabSynchronization&&e.allowTabSynchronization))throw new h_(u_.FAILED_PRECONDITION,_0)})}gi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return b0(e).put("owner",t)}static C(){return W_.C()}mi(e){const t=b0(e);return t.get("owner").next(e=>this.yi(e)?(i_("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):$_.resolve())}Ti(e,t){var n=Date.now();return!(e<n-t||n<e&&(s_(`Detected an update time that is in the future: ${e} > ${n}`),1))}hi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ni=()=>{this.Ys.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ai()))},this.document.addEventListener("visibilitychange",this.ni),this.inForeground="visible"===this.document.visibilityState)}vi(){this.ni&&(this.document.removeEventListener("visibilitychange",this.ni),this.ni=null)}li(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ei=()=>{this.bi(),!I()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Ys.enterRestrictedMode(!0),this.Ys.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ei))}Pi(){this.ei&&(this.window.removeEventListener("pagehide",this.ei),this.ei=null)}Ri(e){var t;try{var n=null!==(null===(t=this.ci)||void 0===t?void 0:t.getItem(this.Ai(e)));return i_("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return s_("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}bi(){if(this.ci)try{this.ci.setItem(this.Ai(this.clientId),String(Date.now()))}catch(e){s_("Failed to set zombie client id.",e)}}Vi(){if(this.ci)try{this.ci.removeItem(this.Ai(this.clientId))}catch(e){}}Ai(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function b0(e){return MT(e,"owner")}function I0(e){return MT(e,"clientMetadata")}function T0(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class E0{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ci=n,this.xi=r}static Ni(e,t){let n=EI(),r=EI();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new E0(e,t.fromCache,n,r)}}class k0{constructor(){this.ki=!1}initialize(e,t){this.Oi=e,this.indexManager=t,this.ki=!0}getDocumentsMatchingQuery(t,n,r,i){return this.Mi(t,n).next(e=>e||this.Fi(t,n,i,r)).next(e=>e||this.$i(t,n))}Mi(i,s){if(Eb(s))return $_.resolve(null);let t=Ab(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=Db(s,null,"F"),t=Ab(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=EI(...e);return this.Oi.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Bi(s,n);return this.Li(s,t,r,e.readTime)?this.Mi(i,Db(s,null,"F")):this.qi(i,t,s,e)}))})))}Fi(n,r,i,s){return Eb(r)||s.isEqual(C_.min())?this.$i(n,r):this.Oi.getDocuments(n,i).next(e=>{var t=this.Bi(r,e);return this.Li(r,t,i,s)?this.$i(n,r):(r_()<=m.DEBUG&&i_("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ob(r)),this.qi(n,t,r,F_(s,-1)))})}Bi(n,e){let r=new ob(Fb(n));return e.forEach((e,t)=>{Mb(n,t)&&(r=r.add(t))}),r}Li(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}$i(e,t){return r_()<=m.DEBUG&&i_("QueryEngine","Using full collection scan to execute query:",Ob(t)),this.Oi.getDocumentsMatchingQuery(e,t,q_.min())}qi(e,n,t,r){return this.Oi.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class C0{constructor(e,t,n,r){this.persistence=e,this.Ui=t,this.Tt=r,this.Ki=new ib(I_),this.Gi=new mI(e=>gb(e),mb),this.Qi=new Map,this.ji=e.getRemoteDocumentCache(),this.Ns=e.getTargetCache(),this.Os=e.getBundleCache(),this.zi(n)}zi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new s0(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ki))}}function S0(e,t,n,r){return new C0(e,t,n,r)}async function N0(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.zi(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=EI();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({Wi:e,removedBatchIds:t,addedBatchIds:n}))})})}function A0(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ns.getLastRemoteSnapshotVersion(e))}function R0(e,l){const u=e,h=l.snapshotVersion;let d=u.Ki;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=u.ji.newChangeBuffer({trackRemovals:!0});d=u.Ki;const c=[];l.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){c.push(u.Ns.removeMatchingKeys(o,t.removedDocuments,n).next(()=>u.Ns.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;l.targetMismatches.has(n)?e=e.withResumeToken(dw.EMPTY_BYTE_STRING,C_.min()).withLastLimboFreeSnapshotVersion(C_.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||c.push(u.Ns.updateTargetData(o,e))}});let t=vI,n=EI();if(l.documentUpdates.forEach(e=>{l.resolvedLimboDocuments.has(e)&&c.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),c.push(D0(o,e,l.documentUpdates).next(e=>{t=e.Hi,n=e.Ji})),!h.isEqual(C_.min())){const l=u.Ns.getLastRemoteSnapshotVersion(o).next(e=>u.Ns.setTargetsMetadata(o,o.currentSequenceNumber,h));c.push(l)}return $_.waitFor(c).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(u.Ki=d,e))}function D0(e,s,t){let n=EI(),a=EI();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=vI;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(C_.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):i_("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Hi:i,Ji:a}})}function x0(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Ns.getTargetData(t,r).next(e=>e?(n=e,$_.resolve(n)):i.Ns.allocateTargetId(t).next(e=>(n=new qT(r,e,0,t.currentSequenceNumber),i.Ns.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Ki.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Ki=i.Ki.insert(e.targetId,e),i.Gi.set(r,e.targetId)),e})}async function P0(e,t,n){const r=e,i=r.Ki.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Q_(e))throw e;i_("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ki=r.Ki.remove(t),r.Gi.delete(i.target)}function O0(e,n,r){const i=e;let s=C_.min(),a=EI();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.Gi.get(n);return void 0!==i?$_.resolve(r.Ki.get(i)):r.Ns.getTargetData(t,n)}(i,t,Ab(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Ns.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.Ui.getDocumentsMatchingQuery(t,n,r?s:C_.min(),r?a:EI())).next(e=>(F0(i,Lb(n),e),{documents:e,Yi:a})))}function M0(e,t){const n=e,r=n.Ns,i=n.Ki.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.ie(e,t).next(e=>e?e.target:null))}function L0(e,t){const n=e,r=n.Qi.get(t)||C_.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.ji.getAllFromCollectionGroup(e,t,F_(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(F0(n,t,e),e))}function F0(e,t,n){let r=e.Qi.get(t)||C_.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Qi.set(t,r)}function U0(e,t){return`firestore_clients_${e}_${t}`}function q0(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function V0(e,t){return`firestore_targets_${e}_${t}`}class B0{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static er(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new h_(r.error.code,r.error.message))),s?new B0(e,t,r.state,i):(s_("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class j0{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static er(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new h_(n.error.code,n.error.message))),i?new j0(e,n.state,r):(s_("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class K0{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static er(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=kI;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=uw(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new K0(e,i):(s_("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class $0{constructor(e,t){this.clientId=e,this.onlineState=t}static er(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new $0(t.clientId,t.onlineState):(s_("SharedClientState",`Failed to parse online state: ${e}`),null)}}class z0{constructor(){this.activeTargetIds=kI}sr(e){this.activeTargetIds=this.activeTargetIds.add(e)}ir(e){this.activeTargetIds=this.activeTargetIds.delete(e)}nr(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class W0{constructor(e,t,n,r,i){this.window=e,this.Ys=t,this.persistenceKey=n,this.rr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ur=this.cr.bind(this),this.ar=new ib(I_),this.started=!1,this.hr=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.lr=U0(this.persistenceKey,this.rr),this.dr=`firestore_sequence_number_${this.persistenceKey}`,this.ar=this.ar.insert(this.rr,new z0),this._r=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.wr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.mr=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.gr=`firestore_online_state_${this.persistenceKey}`,this.yr=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.ur)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Si();for(const n of e)if(n!==this.rr){const e=this.getItem(U0(this.persistenceKey,n));var t;!e||(t=K0.er(n,e))&&(this.ar=this.ar.insert(t.clientId,t))}this.pr();const n=this.storage.getItem(this.gr);if(n){const e=this.Ir(n);e&&this.Tr(e)}for(const e of this.hr)this.cr(e);this.hr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.dr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Er(this.ar)}isActiveQueryTarget(n){let r=!1;return this.ar.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Ar(e,"pending")}updateMutationState(e,t,n){this.Ar(e,t,n),this.Rr(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(V0(this.persistenceKey,e)))||(n=j0.er(e,n))&&(t=n.state)),this.br.sr(e),this.pr(),t}removeLocalQueryTarget(e){this.br.ir(e),this.pr()}isLocalQueryTarget(e){return this.br.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(V0(this.persistenceKey,e))}updateQueryState(e,t,n){this.vr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Rr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Pr(e)}notifyBundleLoaded(e){this.Vr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ur),this.removeItem(this.lr),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return i_("SharedClientState","READ",e,t),t}setItem(e,t){i_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){i_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}cr(e){const i=e;i.storageArea===this.storage&&(i_("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.lr?this.Ys.enqueueRetryable(async()=>{if(this.started){if(null!==i.key)if(this._r.test(i.key)){if(null==i.newValue){var e=this.Sr(i.key);return this.Dr(e,null)}e=this.Cr(i.key,i.newValue);if(e)return this.Dr(e.clientId,e)}else if(this.wr.test(i.key)){if(null!==i.newValue){var t=this.Nr(i.key,i.newValue);if(t)return this.kr(t)}}else if(this.mr.test(i.key)){if(null!==i.newValue){t=this.Or(i.key,i.newValue);if(t)return this.Mr(t)}}else if(i.key===this.gr){if(null!==i.newValue){var n=this.Ir(i.newValue);if(n)return this.Tr(n)}}else if(i.key===this.dr){n=function(e){let t=nw.at;if(null!=e)try{var n=JSON.parse(e);l_("number"==typeof n),t=n}catch(e){s_("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue);n!==nw.at&&this.sequenceNumberHandler(n)}else if(i.key===this.yr){const r=this.Fr(i.newValue);await Promise.all(r.map(e=>this.syncEngine.$r(e)))}}else this.hr.push(i)}):s_("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get br(){return this.ar.get(this.rr)}pr(){this.setItem(this.lr,this.br.nr())}Ar(e,t,n){const r=new B0(this.currentUser,e,t,n),i=q0(this.persistenceKey,this.currentUser,e);this.setItem(i,r.nr())}Rr(e){var t=q0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Pr(e){var t={clientId:this.rr,onlineState:e};this.storage.setItem(this.gr,JSON.stringify(t))}vr(e,t,n){const r=V0(this.persistenceKey,e),i=new j0(e,t,n);this.setItem(r,i.nr())}Vr(e){var t=JSON.stringify(Array.from(e));this.setItem(this.yr,t)}Sr(e){var t=this._r.exec(e);return t?t[1]:null}Cr(e,t){var n=this.Sr(e);return K0.er(n,t)}Nr(e,t){var n=this.wr.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return B0.er(new e_(n),r,t)}Or(e,t){var n=this.mr.exec(e),n=Number(n[1]);return j0.er(n,t)}Ir(e){return $0.er(e)}Fr(e){return JSON.parse(e)}async kr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Br(e.batchId,e.state,e.error);i_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Mr(e){return this.syncEngine.Lr(e.targetId,e.state,e.error)}Dr(e,t){const n=t?this.ar.insert(e,t):this.ar.remove(e),r=this.Er(this.ar),i=this.Er(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.qr(s,a).then(()=>{this.ar=n})}Tr(e){this.ar.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Er(e){let n=kI;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class G0{constructor(){this.Ur=new z0,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Ur.sr(e),this.Kr[e]||"not-current"}updateQueryState(e,t,n){this.Kr[e]=t}removeLocalQueryTarget(e){this.Ur.ir(e)}isLocalQueryTarget(e){return this.Ur.activeTargetIds.has(e)}clearQueryState(e){delete this.Kr[e]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(e){return this.Ur.activeTargetIds.has(e)}start(){return this.Ur=new z0,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class H0{Gr(e){}shutdown(){}}class Q0{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(e){this.Hr.push(e)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){i_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Hr)e(0)}Wr(){i_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Hr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Y0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class X0{constructor(e){this.Yr=e.Yr,this.Zr=e.Zr}Xr(e){this.eo=e}no(e){this.so=e}onMessage(e){this.io=e}close(){this.Zr()}send(e){this.Yr(e)}ro(){this.eo()}oo(e){this.so(e)}uo(e){this.io(e)}}class J0 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.co=t+"://"+e.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(t,e,n,r,i){const s=this.fo(t,e);i_("RestConnection","Sending: ",s,n);var a={};return this._o(a,r,i),this.wo(t,s,a,n).then(e=>(i_("RestConnection","Received: ",e),e),e=>{throw a_("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e})}mo(e,t,n,r,i,s){return this.lo(e,t,n,r,i)}_o(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+t_,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}fo(e,t){var n=Y0[e];return`${this.co}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}wo(o,t,n,r){return new Promise((i,s)=>{const a=new Jy;a.setWithCredentials(!0),a.listenOnce(Wy.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case zy.NO_ERROR:var e=a.getResponseJson();i_("Connection","XHR received:",JSON.stringify(e)),i(e);break;case zy.TIMEOUT:i_("Connection",'RPC "'+o+'" timed out'),s(new h_(u_.DEADLINE_EXCEEDED,"Request time out"));break;case zy.HTTP_ERROR:var t=a.getStatus();if(i_("Connection",'RPC "'+o+'" failed with status:',t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);var n=null==e?void 0:e.error;if(n&&n.status&&n.message){const o=(r=n.status.toLowerCase().replace(/_/g,"-"),0<=Object.values(u_).indexOf(r)?r:u_.UNKNOWN);s(new h_(o,n.message))}else s(new h_(u_.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new h_(u_.UNAVAILABLE,"Connection failed."));break;default:c_()}}finally{i_("Connection",'RPC "'+o+'" completed.')}var r});var e=JSON.stringify(r);a.send(t,"POST",e,n,15)})}yo(e,t,n){const r=[this.co,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new Uy,s=$y(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Yy({})),this._o(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;var o=r.join("");i_("Connection","Creating WebChannel: "+o,a);const c=i.createWebChannel(o,a);let l=!1,u=!1;const h=new X0({Yr:e=>{u?i_("Connection","Not sending because WebChannel is closed:",e):(l||(i_("Connection","Opening WebChannel transport."),c.open(),l=!0),i_("Connection","WebChannel sending:",e),c.send(e))},Zr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(c,Xy.EventType.OPEN,()=>{u||i_("Connection","WebChannel transport opened.")}),d(c,Xy.EventType.CLOSE,()=>{u||(u=!0,i_("Connection","WebChannel transport closed"),h.oo())}),d(c,Xy.EventType.ERROR,e=>{u||(u=!0,a_("Connection","WebChannel transport errored:",e),h.oo(new h_(u_.UNAVAILABLE,"The operation could not be completed")))}),d(c,Xy.EventType.MESSAGE,n=>{if(!u){var e=n.data[0];l_(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){i_("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){var t=Ky[e];if(void 0!==t)return gI(t)}(n),t=r.message;void 0===e&&(e=u_.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),u=!0,h.oo(new h_(e,t)),c.close()}else i_("Connection","WebChannel received:",e),h.uo(e)}}),d(s,Gy.STAT_EVENT,e=>{e.stat===Hy?i_("Connection","Detected buffering proxy"):e.stat===Qy&&i_("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.ro()},0),h}}function Z0(){return"undefined"!=typeof window?window:null}function ek(){return"undefined"!=typeof document?document:null}function tk(e){return new UI(e,!0)}class nk{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ys=e,this.timerId=t,this.po=n,this.Io=r,this.To=i,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}bo(){this.Eo=this.To}vo(e){this.cancel();var t=Math.floor(this.Eo+this.Po()),n=Math.max(0,Date.now()-this.Ro),r=Math.max(0,t-n);0<r&&i_("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Eo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,r,()=>(this.Ro=Date.now(),e())),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}Po(){return(Math.random()-.5)*this.Eo}}class rk{constructor(e,t,n,r,i,s,a,o){this.Ys=e,this.So=n,this.Do=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new nk(e,t)}Oo(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Fo()}async stop(){this.Oo()&&await this.close(0)}$o(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&null===this.xo&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,()=>this.Lo()))}qo(e){this.Uo(),this.stream.send(e)}async Lo(){if(this.Mo())return this.close(0)}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}async close(e,t){this.Uo(),this.Ko(),this.ko.cancel(),this.Co++,4!==e?this.ko.reset():t&&t.code===u_.RESOURCE_EXHAUSTED?(s_(t.toString()),s_("Using maximum backoff delay to prevent overloading the backend."),this.ko.bo()):t&&t.code===u_.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Go(),this.stream.close(),this.stream=null),this.state=e,await this.listener.no(t)}Go(){}auth(){this.state=1;const e=this.Qo(this.Co),n=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.Co===n&&this.jo(e,t)},t=>{e(()=>{var e=new h_(u_.UNKNOWN,"Fetching auth token failed: "+t.message);return this.zo(e)})})}jo(e,t){const n=this.Qo(this.Co);this.stream=this.Wo(e,t),this.stream.Xr(()=>{n(()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,()=>(this.Mo()&&(this.state=3),Promise.resolve())),this.listener.Xr()))}),this.stream.no(e=>{n(()=>this.zo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Fo(){this.state=5,this.ko.vo(async()=>{this.state=0,this.start()})}zo(e){return i_("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Qo(t){return e=>{this.Ys.enqueueAndForget(()=>this.Co===t?e():(i_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ik extends rk{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.Tt=i}Wo(e,t){return this.connection.yo("Listen",e,t)}onMessage(e){this.ko.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(p=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:c_(),i=t.targetChange.targetIds||[],s=(p=t.targetChange.resumeToken,e.yt?(l_(void 0===p||"string"==typeof p),dw.fromBase64String(p||"")):(l_(void 0===p||p instanceof Uint8Array),dw.fromUint8Array(p||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(p=a).code?u_.UNKNOWN:gI(p.code),new h_(o,p.message||""));n=new RI(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var s=zI(e,c.document.name),o=BI(c.document.updateTime),l=c.document.createTime?BI(c.document.createTime):C_.min(),u=new hb({mapValue:{fields:c.document.fields}}),l=db.newFoundDocument(s,o,l,u),u=c.targetIds||[],c=c.removedTargetIds||[];n=new NI(u,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;u=t.documentDelete;u.document;c=zI(e,u.document),l=u.readTime?BI(u.readTime):C_.min(),l=db.newNoDocument(c,l),u=u.removedTargetIds||[];n=new NI([],u,l.key,l)}else if("documentRemove"in t){t.documentRemove;var h=t.documentRemove;h.document;var d=zI(e,h.document),h=h.removedTargetIds||[];n=new NI([],h,d,null)}else{if(!("filter"in t))return c_();{t.filter;const e=t.filter;e.targetId;h=e.count||0,d=new pI(h),h=e.targetId;n=new AI(h,d)}}var o,p;return n}(this.Tt,e),n=function(e){if(!("targetChange"in e))return C_.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?BI(t.readTime):C_.min()}(e);return this.listener.Ho(t,n)}Jo(e){const t={};t.database=HI(this.Tt),t.addTarget=function(e,t){let n;var r=t.target;return n=vb(r)?{documents:eT(e,r)}:{query:tT(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=VI(e,t.resumeToken):0<t.snapshotVersion.compareTo(C_.min())&&(n.readTime=qI(e,t.snapshotVersion.toTimestamp())),n}(this.Tt,e);var n,r,r=(this.Tt,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return c_()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.qo(t)}Yo(e){const t={};t.database=HI(this.Tt),t.removeTarget=e,this.qo(t)}}class sk extends rk{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.Tt=i,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(e,t){return this.connection.yo("Write",e,t)}onMessage(e){if(l_(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Zo){this.ko.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(l_(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?BI(e.updateTime):BI(t);return n.isEqual(C_.min())&&(n=BI(t)),new Jb(n,e.transformResults||[])}(e,i))):[]),n=BI(e.commitTime);return this.listener.eu(n,t)}var r,i;return l_(!e.writeResults||0===e.writeResults.length),this.Zo=!0,this.listener.nu()}su(){const e={};e.database=HI(this.Tt),this.qo(e)}tu(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>JI(this.Tt,e))};this.qo(t)}}class ak extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.Tt=r,this.iu=!1}ru(){if(this.iu)throw new h_(u_.FAILED_PRECONDITION,"The client has already been terminated.")}lo(n,r,i){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.lo(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===u_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new h_(u_.UNKNOWN,e.toString())})}mo(n,r,i,s){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.mo(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===u_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new h_(u_.UNKNOWN,e.toString())})}terminate(){this.iu=!0}}class ok{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){0===this.ou&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve())))}fu(e){"Online"===this.state?this.hu("Unknown"):(this.ou++,1<=this.ou&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.hu("Offline")))}set(e){this.du(),this.ou=0,"Online"===e&&(this.cu=!1),this.hu(e)}hu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}lu(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(s_(t),this.cu=!1):i_("OnlineStateTracker",t)}du(){null!==this.uu&&(this.uu.cancel(),this.uu=null)}}class ck{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=i,this.yu.Gr(e=>{n.enqueueAndForget(async()=>{vk(this)&&(i_("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.mu.add(4),await uk(t),t.pu.set("Unknown"),t.mu.delete(4),await lk(t)}(this))})}),this.pu=new ok(n,r)}}async function lk(e){if(vk(e))for(const t of e.gu)await t(!0)}async function uk(e){for(const t of e.gu)await t(!1)}function hk(e,t){const n=e;n.wu.has(t.targetId)||(n.wu.set(t.targetId,t),mk(n)?gk(n):Ck(n).Mo()&&pk(n,t))}function dk(e,t){const n=e,r=Ck(n);n.wu.delete(t),r.Mo()&&fk(n,t),0===n.wu.size&&(r.Mo()?r.Bo():vk(n)&&n.pu.set("Unknown"))}function pk(e,t){e.Iu.Ft(t.targetId),Ck(e).Jo(t)}function fk(e,t){e.Iu.Ft(t),Ck(e).Yo(t)}function gk(t){t.Iu=new xI({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ie:e=>t.wu.get(e)||null}),Ck(t).start(),t.pu.au()}function mk(e){return vk(e)&&!Ck(e).Oo()&&0<e.wu.size}function vk(e){return 0===e.mu.size}function yk(e){e.Iu=void 0}async function _k(e,t,n){if(!Q_(t))throw t;e.mu.add(1),await uk(e),e.pu.set("Offline"),n=n||(()=>A0(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{i_("RemoteStore","Retrying IndexedDB access"),await n(),e.mu.delete(1),await lk(e)})}function wk(t,n){return n().catch(e=>_k(t,e,n))}async function bk(e){const t=e,n=Sk(t);let r=0<t._u.length?t._u[t._u.length-1].batchId:-1;for(;vk(i=t)&&i._u.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t._u.length&&n.Bo();break}r=e.batchId,function(e,t){e._u.push(t);const n=Sk(e);n.Mo()&&n.Xo&&n.tu(t.mutations)}(t,e)}catch(e){await _k(t,e)}var i;Ik(t)&&Tk(t)}function Ik(e){return vk(e)&&!Sk(e).Oo()&&0<e._u.length}function Tk(e){Sk(e).start()}async function Ek(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),i_("RemoteStore","RemoteStore received new credentials");var r=vk(n);n.mu.add(3),await uk(n),r&&n.pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.mu.delete(3),await lk(n)}async function kk(e,t){const n=e;t?(n.mu.delete(2),await lk(n)):(n.mu.add(2),await uk(n),n.pu.set("Unknown"))}function Ck(t){return t.Tu||(t.Tu=function(e,t,n){const r=e;return r.ru(),new ik(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,n)}(t.datastore,t.asyncQueue,{Xr:(async function(n){n.wu.forEach((e,t)=>{pk(n,e)})}).bind(null,t),no:(async function(e,t){yk(e),mk(e)?(e.pu.fu(t),gk(e)):e.pu.set("Unknown")}).bind(null,t),Ho:(async function(e,r,t){if(e.pu.set("Online"),r instanceof RI&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.wu.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.wu.delete(n),e.Iu.removeTarget(n))}(e)}catch(t){i_("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await _k(e,t)}else if(r instanceof NI?e.Iu.Qt(r):r instanceof AI?e.Iu.Zt(r):e.Iu.Wt(r),!t.isEqual(C_.min()))try{const r=await A0(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.Iu.ee(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.wu.get(t);n&&r.wu.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.wu.get(e);var n;t&&(r.wu.set(e,t.withResumeToken(dw.EMPTY_BYTE_STRING,t.snapshotVersion)),fk(r,e),n=new qT(t.target,e,1,t.sequenceNumber),pk(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){i_("RemoteStore","Failed to raise snapshot:",r),await _k(e,r)}}).bind(null,t)}),t.gu.push(async e=>{e?(t.Tu.$o(),mk(t)?gk(t):t.pu.set("Unknown")):(await t.Tu.stop(),yk(t))})),t.Tu}function Sk(t){return t.Eu||(t.Eu=function(e,t,n){const r=e;return r.ru(),new sk(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,n)}(t.datastore,t.asyncQueue,{Xr:(async function(e){Sk(e).su()}).bind(null,t),no:(async function(e,t){t&&Sk(e).Xo&&await async function(e,t){if(fI(n=t.code)&&n!==u_.ABORTED){const n=e._u.shift();Sk(e).$o(),await wk(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await bk(e)}var n}(e,t),Ik(e)&&Tk(e)}).bind(null,t),nu:(async function(e){const t=Sk(e);for(const n of e._u)t.tu(n.mutations)}).bind(null,t),eu:(async function(e,t,n){const r=e._u.shift(),i=FT.from(r,t,n);await wk(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await bk(e)}).bind(null,t)}),t.gu.push(async e=>{e?(t.Eu.$o(),await bk(t)):(await t.Eu.stop(),0<t._u.length&&(i_("RemoteStore",`Stopping write stream with ${t._u.length} pending writes`),t._u=[]))})),t.Eu}class Nk{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new d_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new Nk(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new h_(u_.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ak(e,t){if(s_("AsyncQueue",`${t}: ${e}`),Q_(e))return new h_(u_.UNAVAILABLE,`${t}: ${e}`);throw e}class Rk{constructor(n){this.comparator=n?(e,t)=>n(e,t)||D_.comparator(e.key,t.key):(e,t)=>D_.comparator(e.key,t.key),this.keyedMap=_I(),this.sortedSet=new ib(this.comparator)}static emptySet(e){return new Rk(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Rk))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new Rk;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Dk{constructor(){this.Au=new ib(D_.comparator)}track(e){var t=e.doc.key,n=this.Au.get(t);!n||0!==e.type&&3===n.type?this.Au=this.Au.insert(t,e):3===e.type&&1!==n.type?this.Au=this.Au.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Au=this.Au.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Au=this.Au.remove(t):1===e.type&&2===n.type?this.Au=this.Au.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):c_()}Ru(){const n=[];return this.Au.inorderTraversal((e,t)=>{n.push(t)}),n}}class xk{constructor(e,t,n,r,i,s,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new xk(e,t,Rk.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&xb(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Pk{constructor(){this.bu=void 0,this.listeners=[]}}class Ok{constructor(){this.queries=new mI(e=>Pb(e),xb),this.onlineState="Unknown",this.vu=new Set}}async function Mk(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Pk),i)try{s.bu=await n.onListen(r)}catch(e){const n=Ak(e,`Initialization of query '${Ob(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Pu(n.onlineState),!s.bu||t.Vu(s.bu)&&Fk(n)}async function Lk(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Fk(e){e.vu.forEach(e=>{e.next()})}class Uk{constructor(e,t,n){this.query=e,this.Su=t,this.Du=!1,this.Cu=null,this.onlineState="Unknown",this.options=n||{}}Vu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new xk(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Du?this.xu(e)&&(this.Su.next(e),t=!0):this.Nu(e,this.onlineState)&&(this.ku(e),t=!0),this.Cu=e,t}onError(e){this.Su.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Cu&&!this.Du&&this.Nu(this.Cu,e)&&(this.ku(this.Cu),t=!0),t}Nu(e,t){return!e.fromCache||(!this.options.Ou||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}xu(e){if(0<e.docChanges.length)return!0;var t=this.Cu&&this.Cu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ku(e){e=xk.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Du=!0,this.Su.next(e)}}class qk{constructor(e,t){this.Mu=e,this.byteLength=t}Fu(){return"metadata"in this.Mu}}class Vk{constructor(e){this.Tt=e}Zi(e){return zI(this.Tt,e)}Xi(e){return e.metadata.exists?XI(this.Tt,e.document,!1):db.newNoDocument(this.Zi(e.metadata.name),this.tr(e.metadata.readTime))}tr(e){return BI(e)}}class Bk{constructor(e,t,n){this.$u=e,this.localStore=t,this.Tt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=jk(e)}Bu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Mu.namedQuery)this.queries.push(e.Mu.namedQuery);else if(e.Mu.documentMetadata){this.documents.push({metadata:e.Mu.documentMetadata}),e.Mu.documentMetadata.exists||++t;const n=N_.fromString(e.Mu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Mu.document&&(this.documents[this.documents.length-1].document=e.Mu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Lu(e){const t=new Map,n=new Vk(this.Tt);for(const i of e)if(i.metadata.queries){const e=n.Zi(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||EI()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=EI(),a=vI;for(const e of n){const n=t.Zi(e.metadata.name);e.document&&(s=s.add(n));const l=t.Xi(e);l.setReadTime(t.tr(e.metadata.readTime)),a=a.insert(n,l)}const o=i.ji.newChangeBuffer({trackRemovals:!0}),c=await x0(i,(r=r,Ab(Tb(N_.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>D0(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Ns.removeMatchingKeysForTargetId(t,c.targetId).next(()=>i.Ns.addMatchingKeys(t,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.Hi,e.Ji)).next(()=>e.Hi)))}(this.localStore,new Vk(this.Tt),this.documents,this.$u.id),t=this.Lu(this.documents);for(const e of this.queries)await async function(e,n,r=EI()){const i=await x0(e,Ab(HT(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=BI(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Os.saveNamedQuery(e,n);t=i.withResumeToken(dw.EMPTY_BYTE_STRING,t);return s.Ki=s.Ki.insert(t.targetId,t),s.Ns.updateTargetData(e,t).next(()=>s.Ns.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Ns.addMatchingKeys(e,r,i.targetId)).next(()=>s.Os.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,qu:this.collectionGroups,Uu:e}}}function jk(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Kk{constructor(e){this.key=e}}class $k{constructor(e){this.key=e}}class zk{constructor(e,t){this.query=e,this.Ku=t,this.Gu=null,this.hasCachedResults=!1,this.current=!1,this.Qu=EI(),this.mutatedKeys=EI(),this.ju=Fb(e),this.zu=new Rk(this.ju)}get Wu(){return this.Ku}Hu(e,t){const o=t?t.Ju:new Dk,c=(t||this).zu;let l=(t||this).mutatedKeys,u=c,h=!1;const d="F"===this.query.limitType&&c.size===this.query.limit?c.last():null,p="L"===this.query.limitType&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=Mb(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.Yu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.ju(r,d)||p&&this.ju(r,p)<0)&&(h=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||p)&&(h=!0)),a&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),o.track({type:1,doc:e})}return{zu:u,Ju:o,Li:h,mutatedKeys:l}}Yu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.zu;this.zu=e.zu,this.mutatedKeys=e.mutatedKeys;const i=e.Ju.Ru();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return c_()}};return n(e)-n(t)}(e.type,t.type)||this.ju(e.doc,t.doc)),this.Zu(n);var s=t?this.Xu():[],a=0===this.Qu.size&&this.current?1:0,o=a!==this.Gu;return this.Gu=a,0!==i.length||o?{snapshot:new xk(this.query,e.zu,r,i,e.mutatedKeys,0==a,o,!1,!!n&&0<n.resumeToken.approximateByteSize()),tc:s}:{tc:s}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({zu:this.zu,Ju:new Dk,mutatedKeys:this.mutatedKeys,Li:!1},!1)):{tc:[]}}ec(e){return!this.Ku.has(e)&&!!this.zu.has(e)&&!this.zu.get(e).hasLocalMutations}Zu(e){e&&(e.addedDocuments.forEach(e=>this.Ku=this.Ku.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ku=this.Ku.delete(e)),this.current=e.current)}Xu(){if(!this.current)return[];const t=this.Qu;this.Qu=EI(),this.zu.forEach(e=>{this.ec(e.key)&&(this.Qu=this.Qu.add(e.key))});const n=[];return t.forEach(e=>{this.Qu.has(e)||n.push(new $k(e))}),this.Qu.forEach(e=>{t.has(e)||n.push(new Kk(e))}),n}nc(e){this.Ku=e.Yi,this.Qu=EI();var t=this.Hu(e.documents);return this.applyChanges(t,!0)}sc(){return xk.fromInitialDocuments(this.query,this.zu,this.mutatedKeys,0===this.Gu,this.hasCachedResults)}}class Wk{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Gk{constructor(e){this.key=e,this.ic=!1}}class Hk{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.rc={},this.oc=new mI(e=>Pb(e),xb),this.uc=new Map,this.cc=new Set,this.ac=new ib(D_.comparator),this.hc=new Map,this.lc=new c0,this.fc={},this.dc=new Map,this._c=UE.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return!0===this.wc}}async function Qk(n,e,t,r,i){n.mc=(e,s,t)=>async function(e,t,n){let r=t.view.Hu(s);r.Li&&(r=await O0(e.localStore,t.query,!1).then(({documents:e})=>t.view.Hu(e,r)));var i=n&&n.targetChanges.get(t.targetId),i=t.view.applyChanges(r,e.isPrimaryClient,i);return iC(e,t.targetId,i.tc),i.snapshot}(n,e,t);const s=await O0(n.localStore,e,!0),a=new zk(e,s.Yi),o=a.Hu(s.documents),c=SI.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),l=a.applyChanges(o,n.isPrimaryClient,c);iC(n,t,l.tc);var u=new Wk(e,t,a);return n.oc.set(e,u),n.uc.has(t)?n.uc.get(t).push(e):n.uc.set(t,[e]),l.snapshot}async function Yk(e,t,n){const r=hC(e);try{const e=await function(e,i){const s=e,a=k_.now(),o=i.reduce((e,t)=>e.add(t.key),EI());let c,l;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=vI,r=EI();return s.ji.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{c=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=jb(r.transform,e||null);null!=i&&(null===n&&(n=hb.empty()),n.set(r.field,i))}return n||null}(n,c.get(n.key).overlayedDocument);null!=i&&t.push(new oI(n.key,i,function r(e){const i=[];return aw(e.fields,(e,t)=>{const n=new R_([e]);if(xw(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new ub(i)}(i.value.mapValue),Zb.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(l=e).applyToLocalDocumentSet(c,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:l.batchId,changes:wI(c)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.fc[e.currentUser.toKey()];r=r||new ib(I_),r=r.insert(t,n),e.fc[e.currentUser.toKey()]=r}(r,e.batchId,n),await aC(r,e.changes),await bk(r.remoteStore)}catch(e){const t=Ak(e,"Failed to persist write");n.reject(t)}}async function Xk(e,t){const r=e;try{const e=await R0(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.hc.get(t);n&&(l_(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.ic=!0:0<e.modifiedDocuments.size?l_(n.ic):0<e.removedDocuments.size&&(l_(n.ic),n.ic=!1))}),await aC(r,e,t)}catch(e){await K_(e)}}function Jk(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.oc.forEach((e,t)=>{var n=t.view.Pu(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.Pu(n)&&(r=!0)}),r&&Fk(t)}(t.eventManager,i),r.length&&t.rc.Ho(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function Zk(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.ji.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=$_.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);l_(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=EI();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);tC(n,r,null),eC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await aC(n,e)}catch(e){await K_(e)}}function eC(e,t){(e.dc.get(t)||[]).forEach(e=>{e.resolve()}),e.dc.delete(t)}function tC(e,t,n){const r=e;let i=r.fc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.fc[r.currentUser.toKey()]=i}}function nC(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.uc.get(e))t.oc.delete(r),n&&t.rc.gc(r,n);t.uc.delete(e),t.isPrimaryClient&&t.lc.ds(e).forEach(e=>{t.lc.containsKey(e)||rC(t,e)})}function rC(e,t){e.cc.delete(t.path.canonicalString());var n=e.ac.get(t);null!==n&&(dk(e.remoteStore,n),e.ac=e.ac.remove(t),e.hc.delete(n),sC(e))}function iC(e,t,n){for(const r of n)r instanceof Kk?(e.lc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.ac.get(n)||e.cc.has(r)||(i_("SyncEngine","New document in limbo: "+n),e.cc.add(r),sC(e))}(e,r)):r instanceof $k?(i_("SyncEngine","Document no longer in limbo: "+r.key),e.lc.removeReference(r.key,t),e.lc.containsKey(r.key)||rC(e,r.key)):c_()}function sC(e){for(;0<e.cc.size&&e.ac.size<e.maxConcurrentLimboResolutions;){var t=e.cc.values().next().value;e.cc.delete(t);var n=new D_(N_.fromString(t)),t=e._c.next();e.hc.set(t,new Gk(n)),e.ac=e.ac.insert(n,t),hk(e.remoteStore,new qT(Ab(Tb(n.path)),t,2,nw.at))}}async function aC(e,t,r){const i=e,s=[],a=[],o=[];i.oc.isEmpty()||(i.oc.forEach((e,n)=>{o.push(i.mc(n,t,r).then(e=>{var t;(e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(s.push(e),t=E0.Ni(n.targetId,e),a.push(t))}))}),await Promise.all(o),i.rc.Ho(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>$_.forEach(t,t=>$_.forEach(t.Ci,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>$_.forEach(t.xi,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!Q_(e))throw e;i_("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Ki.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Ki=r.Ki.insert(t,i)}}}(i.localStore,a))}async function oC(r,e){const i=r;if(uC(i),hC(i),!0===e&&!0!==i.wc){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await cC(i,r.toArray());i.wc=!0,await kk(i.remoteStore,!0);for(const r of e)hk(i.remoteStore,r)}else if(!1===e&&!1!==i.wc){const r=[];let n=Promise.resolve();i.uc.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(nC(i,t),P0(i.localStore,t,!0))),dk(i.remoteStore,t)}),await n,await cC(i,r),function(){const n=i;n.hc.forEach((e,t)=>{dk(n.remoteStore,t)}),n.lc._s(),n.hc=new Map,n.ac=new ib(D_.comparator)}(),i.wc=!1,await kk(i.remoteStore,!1)}}async function cC(t,n){const r=t,i=[],s=[];for(const t of n){let e;const u=r.uc.get(t);if(u&&0!==u.length){e=await x0(r.localStore,Ab(u[0]));for(const t of u){const n=r.oc.get(t),u=(a=r,o=n,l=c=void 0,l=await O0((c=a).localStore,o.query,!0),l=o.view.nc(l),c.isPrimaryClient&&iC(c,o.targetId,l.tc),await l);u.snapshot&&s.push(u.snapshot)}}else{const u=await M0(r.localStore,t);e=await x0(r.localStore,u),await Qk(r,lC(u),t,!1,e.resumeToken)}i.push(e)}var a,o,c,l;return r.rc.Ho(s),i}function lC(e){return Ib(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function uC(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=Xk.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.hc.get(t);if(r&&r.ic)return EI().add(r.key);{let e=EI();const r=n.uc.get(t);if(!r)return e;for(const t of r){const r=n.oc.get(t);e=e.unionWith(r.view.Wu)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.hc.get(t),s=i&&i.key;if(s){let e=new ib(D_.comparator);e=e.insert(s,db.newNoDocument(s,C_.min()));const n=EI().add(s),i=new CI(C_.min(),new Map,new ob(I_),e,n);await Xk(r,i),r.ac=r.ac.remove(s),r.hc.delete(t),sC(r)}else await P0(r.localStore,t,!1).then(()=>nC(r,t,n)).catch(K_)}).bind(null,t),t.rc.Ho=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Vu(e)&&(r=!0);i.bu=e}}r&&Fk(n)}).bind(null,t.eventManager),t.rc.gc=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function hC(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=Zk.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(l_(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);tC(r,t,n),eC(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await aC(r,e)}catch(n){await K_(n)}}).bind(null,t),t}class dC{constructor(){this.synchronizeTabs=!1}async initialize(e){this.Tt=tk(e.databaseInfo.databaseId),this.sharedClientState=this.Ic(e),this.persistence=this.Tc(e),await this.persistence.start(),this.localStore=this.Ec(e),this.gcScheduler=this.Ac(e,this.localStore),this.indexBackfillerScheduler=this.Rc(e,this.localStore)}Ac(e,t){return null}Rc(e,t){return null}Ec(e){return S0(this.persistence,new k0,e.initialUser,this.Tt)}Tc(e){return new f0(m0.qs,this.Tt)}Ic(e){return new G0}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class pC extends dC{constructor(e,t,n){super(),this.bc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.bc.initialize(this,e),await hC(this.bc.syncEngine),await bk(this.bc.remoteStore),await this.persistence.di(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ec(e){return S0(this.persistence,new k0,e.initialUser,this.Tt)}Ac(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new zE(n,e.asyncQueue,t)}Rc(e,t){var n=new tw(t,this.persistence);return new ew(e.asyncQueue,n)}Tc(e){var t=T0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?RE.withCacheSize(this.cacheSizeBytes):RE.DEFAULT;return new w0(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Z0(),ek(),this.Tt,this.sharedClientState,!!this.forceOwnership)}Ic(e){return new G0}}class fC extends pC{constructor(e,t){super(e,t,!1),this.bc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.bc.syncEngine;this.sharedClientState instanceof W0&&(this.sharedClientState.syncEngine={Br:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.An(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):$_.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await bk(i.remoteStore):"acknowledged"===n||"rejected"===n?(tC(i,t,r||null),eC(i,t),i.localStore.mutationQueue.bn(t)):c_(),await aC(i,s)):i_("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),Lr:(async function(e,t,n,r){const i=e;if(i.wc)i_("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.uc.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await L0(i.localStore,Lb(s[0])),r=CI.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,dw.EMPTY_BYTE_STRING);await aC(i,e,r);break}case"rejected":await P0(i.localStore,t,!0),nC(i,t,r);break;default:c_()}}}).bind(null,t),qr:(async function(e,t,n){const r=uC(e);if(r.wc){for(const e of t)if(r.uc.has(e))i_("SyncEngine","Adding an already active target "+e);else{const t=await M0(r.localStore,e),n=await x0(r.localStore,t);await Qk(r,lC(t),n.targetId,!1,n.resumeToken),hk(r.remoteStore,n)}for(const e of n)r.uc.has(e)&&await P0(r.localStore,e,!1).then(()=>{dk(r.remoteStore,e),nC(r,e)}).catch(K_)}}).bind(null,t),Si:(function(e){return e.localStore.persistence.Si()}).bind(null,t),$r:(async function(e,t){const n=e;return L0(n.localStore,t).then(e=>aC(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.di(async e=>{await oC(this.bc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Ic(e){var t=Z0();if(!W0.C(t))throw new h_(u_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=T0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new W0(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class gC{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Jk(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){i_("SyncEngine","User change. New user:",t.toKey());const r=await N0(n.localStore,t);n.currentUser=t,(e=n).dc.forEach(e=>{e.forEach(e=>{e.reject(new h_(u_.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.dc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await aC(n,r.Wi)}}).bind(null,this.syncEngine),await kk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ok}createDatastore(e){var t,n,r,i,s=tk(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new J0(t));return n=e.authCredentials,r=e.appCheckCredentials,i=t,e=s,new ak(n,r,i,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Jk(this.syncEngine,e,0),s=new(Q0.C()?Q0:H0),new ck(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new Hk(e,t,n,r,i,s);return a&&(o.wc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;i_("RemoteStore","RemoteStore shutting down."),t.mu.add(5),await uk(t),t.yu.shutdown(),t.pu.set("Unknown")}(this.remoteStore)}}function mC(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class vC{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.vc(this.observer.next,e)}error(e){this.observer.error?this.vc(this.observer.error,e):s_("Uncaught Error in snapshot listener:",e.toString())}Pc(){this.muted=!0}vc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class yC{constructor(e,t){this.Vc=e,this.Tt=t,this.metadata=new d_,this.buffer=new Uint8Array,this.Sc=new TextDecoder("utf-8"),this.Dc().then(e=>{e&&e.Fu()?this.metadata.resolve(e.Mu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Mu)}`))},e=>this.metadata.reject(e))}close(){return this.Vc.cancel()}async getMetadata(){return this.metadata.promise}async yc(){return await this.getMetadata(),this.Dc()}async Dc(){var e=await this.Cc();if(null===e)return null;var t=this.Sc.decode(e),n=Number(t);isNaN(n)&&this.xc(`length string (${t}) is not valid number`);t=await this.Nc(n);return new qk(JSON.parse(t),e.length+n)}kc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Cc(){for(;this.kc()<0&&!await this.Oc(););if(0===this.buffer.length)return null;var e=this.kc();e<0&&this.xc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Nc(e){for(;this.buffer.length<e;)await this.Oc()&&this.xc("Reached the end of bundle when more is expected.");var t=this.Sc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}xc(e){throw this.Vc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Oc(){var e=await this.Vc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class _C{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new h_(u_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=HI(r.Tt)+"/documents",i={documents:t.map(e=>$I(r.Tt,e))},s=await r.mo("BatchGetDocuments",n,i,t.length),a=new Map;s.forEach(e=>{const t=(n=r.Tt,"found"in(e=e)?function(e,t){l_(!!t.found),t.found.name,t.found.updateTime;var n=zI(e,t.found.name),r=BI(t.found.updateTime),i=t.found.createTime?BI(t.found.createTime):C_.min(),s=new hb({mapValue:{fields:t.found.fields}});return db.newFoundDocument(n,r,i,s)}(n,e):"missing"in e?function(e,t){l_(!!t.missing),l_(!!t.readTime);var n=zI(e,t.missing),r=BI(t.readTime);return db.newNoDocument(n,r)}(n,e):c_());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());l_(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new hI(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=D_.fromPath(t);this.mutations.push(new dI(n,this.precondition(n)))}),await async function(e,t){const n=e,r=HI(n.Tt)+"/documents",i={writes:t.map(e=>JI(n.Tt,e))};await n.lo("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw c_();t=C_.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new h_(u_.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(C_.min())?Zb.exists(!1):Zb.updateTime(t):Zb.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Zb.exists(!0);if(t.isEqual(C_.min()))throw new h_(u_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Zb.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class wC{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Mc=n.maxAttempts,this.ko=new nk(this.asyncQueue,"transaction_retry")}run(){--this.Mc,this.Fc()}Fc(){this.ko.vo(async()=>{const t=new _C(this.datastore),e=this.$c(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Bc(e)}))}).catch(e=>{this.Bc(e)})})}$c(e){try{var t=this.updateFunction(e);return!cw(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Bc(e){0<this.Mc&&this.Lc(e)?(--this.Mc,this.asyncQueue.enqueueAndForget(()=>(this.Fc(),Promise.resolve()))):this.deferred.reject(e)}Lc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!fI(t)}}class bC{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=e_.UNAUTHENTICATED,this.clientId=b_.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{i_("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(i_("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new h_(u_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new d_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=Ak(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function IC(e,t){e.asyncQueue.verifyOperationInProgress(),i_("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await N0(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function TC(e,n){e.asyncQueue.verifyOperationInProgress();var t=await EC(e);i_("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>Ek(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>Ek(n.remoteStore,t)),e.onlineComponents=n}async function EC(e){return e.offlineComponents||(i_("FirestoreClient","Using default OfflineComponentProvider"),await IC(e,new dC)),e.offlineComponents}async function kC(e){return e.onlineComponents||(i_("FirestoreClient","Using default OnlineComponentProvider"),await TC(e,new gC)),e.onlineComponents}function CC(e){return EC(e).then(e=>e.persistence)}function SC(e){return EC(e).then(e=>e.localStore)}function NC(e){return kC(e).then(e=>e.remoteStore)}function AC(e){return kC(e).then(e=>e.syncEngine)}async function RC(e){const t=await kC(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=uC(e);let r,i;const s=n.oc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.sc();else{const e=await x0(n.localStore,Ab(t));n.isPrimaryClient&&hk(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Qk(n,t,r,"current"===s,e.resumeToken)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.oc.get(t),i=n.uc.get(r.targetId);if(1<i.length)return n.uc.set(r.targetId,i.filter(e=>!xb(e,t))),void n.oc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await P0(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),dk(n.remoteStore,r.targetId),nC(n,r.targetId)}).catch(K_)):(nC(n,r.targetId),await P0(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function DC(e,t,n={}){const r=new d_;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,a){const e=new vC({next:e=>{r.enqueueAndForget(()=>Lk(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new h_(u_.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new h_(u_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new Uk(Tb(i.path),e,{includeMetadataChanges:!0,Ou:!0});return Mk(n,o)}(await RC(e),e.asyncQueue,t,n,r)),r.promise}function xC(e,t,n={}){const r=new d_;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new vC({next:e=>{n.enqueueAndForget(()=>Lk(t,a)),e.fromCache&&"server"===r.source?i.reject(new h_(u_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new Uk(e,s,{includeMetadataChanges:!0,Ou:!0});return Mk(t,a)}(await RC(e),e.asyncQueue,t,n,r)),r.promise}function PC(e,t,n,r){const i=(n=n,t=tk(t),s="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return mC(e,void 0);if(e instanceof ArrayBuffer)return mC(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new yC(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=BI(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Os.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(jk(i));const a=new Bk(i,t.localStore,n.Tt);let e=await n.yc();for(;e;){const t=await a.Bu(e);t&&r._updateProgress(t),e=await n.yc()}var s=await a.complete();return await aC(t,s.Uu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Os.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.qu)}catch(t){return a_("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await AC(e),i,r)})}const OC=new Map;function MC(e,t,n){if(!n)throw new h_(u_.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function LC(e,t,n,r){if(!0===t&&!0===r)throw new h_(u_.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function FC(e){if(!D_.isDocumentKey(e))throw new h_(u_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function UC(e){if(D_.isDocumentKey(e))throw new h_(u_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function qC(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":c_();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function VC(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new h_(u_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=qC(e);throw new h_(u_.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function BC(e,t){if(t<=0)throw new h_(u_.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class jC{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new h_(u_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new h_(u_.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,LC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class KC{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jC({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new h_(u_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new h_(u_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jC(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new f_;switch(e.type){case"gapi":var t=e.client;return new y_(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new h_(u_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=OC.get(e);t&&(i_("ComponentProvider","Removing Datastore"),OC.delete(e),t.terminate())}(this),Promise.resolve()}}class $C{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new WC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $C(this.firestore,e,this._key)}}class zC{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new zC(this.firestore,e,this._query)}}class WC extends zC{constructor(e,t,n){super(e,t,Tb(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $C(this.firestore,null,new D_(e))}withConverter(e){return new WC(this.firestore,e,this._path)}}function GC(e,t,...n){if(e=ae(e),MC("collection","path",t),e instanceof KC){var r=N_.fromString(t,...n);return UC(r),new WC(e,null,r)}if(!(e instanceof $C||e instanceof WC))throw new h_(u_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(N_.fromString(t,...n));return UC(r),new WC(e.firestore,null,r)}function HC(e,t,...n){if(e=ae(e),MC("doc","path",t=1===arguments.length?b_.R():t),e instanceof KC){var r=N_.fromString(t,...n);return FC(r),new $C(e,null,new D_(r))}if(!(e instanceof $C||e instanceof WC))throw new h_(u_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(N_.fromString(t,...n));return FC(r),new $C(e.firestore,e instanceof WC?e.converter:null,new D_(r))}function QC(e,t){return e=ae(e),t=ae(t),(e instanceof $C||e instanceof WC)&&(t instanceof $C||t instanceof WC)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function YC(e,t){return e=ae(e),t=ae(t),e instanceof zC&&t instanceof zC&&e.firestore===t.firestore&&xb(e._query,t._query)&&e.converter===t.converter}class XC{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new nk(this,"async_queue_retry"),this.Hc=()=>{var e=ek();e&&i_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ko.Vo()};const e=ek();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Jc(),this.Yc(e)}enterRestrictedMode(e){if(!this.Kc){this.Kc=!0,this.zc=e||!1;const t=ek();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Hc)}}enqueue(e){if(this.Jc(),this.Kc)return new Promise(()=>{});const t=new d_;return this.Yc(()=>this.Kc&&this.zc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Uc.push(e),this.Zc()))}async Zc(){if(0!==this.Uc.length){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(e){if(!Q_(e))throw e;i_("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Uc.length&&this.ko.vo(()=>this.Zc())}}Yc(e){var t=this.qc.then(()=>(this.jc=!0,e().catch(e=>{throw this.Qc=e,this.jc=!1,s_("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.jc=!1,e))));return this.qc=t}enqueueAfterDelay(e,t,n){this.Jc(),-1<this.Wc.indexOf(e)&&(t=0);var r=Nk.createAndSchedule(this,e,t,n,e=>this.Xc(e));return this.Gc.push(r),r}Jc(){this.Qc&&c_()}verifyOperationInProgress(){}async ta(){for(var e;await(e=this.qc),e!==this.qc;);}ea(e){for(const t of this.Gc)if(t.timerId===e)return!0;return!1}na(t){return this.ta().then(()=>{this.Gc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Gc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ta()})}sa(e){this.Wc.push(e)}Xc(e){var t=this.Gc.indexOf(e);this.Gc.splice(t,1)}}function JC(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class ZC{constructor(){this._progressObserver={},this._taskCompletionResolver=new d_,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var eS,tS,nS,rS;class iS extends KC{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new XC,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||aS(this),this._firestoreClient.terminate()}}function sS(e){return e._firestoreClient||aS(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function aS(e){var t,n,r,i,s,a=e._freezeSettings(),a=(n=e._databaseId,r=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",i=e._persistenceKey,s=a,new rw(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new bC(e._authCredentials,e._appCheckCredentials,e._queue,a)}function oS(e,n,r){const i=new d_;return e.asyncQueue.enqueue(async()=>{try{await IC(e,r),await TC(e,n),i.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===u_.FAILED_PRECONDITION||t.code===u_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw n;a_("Error enabling offline persistence. Falling back to persistence disabled: "+n),i.reject(n)}var t}).then(()=>i.promise)}function cS(e){return function(e){const t=new d_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;vk(n.remoteStore)||i_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.dc.get(e)||[];r.push(t),n.dc.set(e,r)}catch(e){const n=Ak(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await AC(e),t)),t.promise}(sS(e=VC(e,iS)))}function lS(e){return(n=sS(e=VC(e,iS))).asyncQueue.enqueue(async()=>{const e=await CC(n),t=await NC(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.mu.delete(0),lk(e)}()});var n}function uS(e){return(n=sS(e=VC(e,iS))).asyncQueue.enqueue(async()=>{const e=await CC(n),t=await NC(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.mu.add(0),await uk(e),e.pu.set("Offline")}()});var n}function hS(t,e){return n=sS(t=VC(t,iS)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Os.getNamedQuery(e,t))}(await SC(n),r)).then(e=>e?new zC(t,null,e.query):null);var n,r}function dS(e){if(e._initialized||e._terminated)throw new h_(u_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class pS{constructor(e){this._byteString=e}static fromBase64String(e){try{return new pS(dw.fromBase64String(e))}catch(e){throw new h_(u_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new pS(dw.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class fS{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new h_(u_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new R_(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class gS{constructor(e){this._methodName=e}}class mS{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new h_(u_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new h_(u_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return I_(this._lat,e._lat)||I_(this._long,e._long)}}const vS=/^__.*__$/;class yS{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new oI(e,this.data,this.fieldMask,t,this.fieldTransforms):new aI(e,this.data,t,this.fieldTransforms)}}class _S{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new oI(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function wS(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw c_()}}class bS{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.Tt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ia(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(e){return new bS(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:n,ca:!1});return r.aa(e),r}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:n,ca:!1});return r.ia(),r}la(e){return this.oa({path:void 0,ca:!0})}fa(e){return BS(e,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}ia(){if(this.path)for(let e=0;e<this.path.length;e++)this.aa(this.path.get(e))}aa(e){if(0===e.length)throw this.fa("Document fields must not be empty");if(wS(this.ra)&&vS.test(e))throw this.fa('Document fields cannot begin and end with "__"')}}class IS{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.Tt=n||tk(e)}wa(e,t,n,r=!1){return new bS({ra:e,methodName:t,_a:n,path:R_.emptyPath(),ca:!1,da:r},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function TS(e){var t=e._freezeSettings(),n=tk(e._databaseId);return new IS(e._databaseId,!!t.ignoreUndefinedProperties,n)}function ES(e,t,n,r,i,s={}){const a=e.wa(s.merge||s.mergeFields?2:0,t,n,i);FS("Data must be an object, but it was:",a,r);var o=MS(r,a);let c,l;if(s.merge)c=new ub(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=US(t,r,n);if(!a.contains(i))throw new h_(u_.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);jS(e,i)||e.push(i)}c=new ub(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new yS(new hb(o),c,l)}class kS extends gS{_toFieldTransform(e){if(2!==e.ra)throw 1===e.ra?e.fa(`${this._methodName}() can only appear at the top level of your update data`):e.fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof kS}}function CS(e,t,n){return new bS({ra:3,_a:t.settings._a,methodName:e._methodName,ca:n},t.databaseId,t.Tt,t.ignoreUndefinedProperties)}class SS extends gS{_toFieldTransform(e){return new Xb(e.path,new Kb)}isEqual(e){return e instanceof SS}}class NS extends gS{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=CS(this,e,!0),n=this.ma.map(e=>OS(e,t)),r=new $b(n);return new Xb(e.path,r)}isEqual(e){return this===e}}class AS extends gS{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=CS(this,e,!0),n=this.ma.map(e=>OS(e,t)),r=new Wb(n);return new Xb(e.path,r)}isEqual(e){return this===e}}class RS extends gS{constructor(e,t){super(e),this.ga=t}_toFieldTransform(e){var t=new Hb(e.Tt,Vb(e.Tt,this.ga));return new Xb(e.path,t)}isEqual(e){return this===e}}function DS(e,i,s,t){const a=e.wa(1,i,s);FS("Data must be an object, but it was:",a,t);const o=[],c=hb.empty();aw(t,(e,t)=>{var n=VS(i,e,s);t=ae(t);var r=a.ha(n);if(t instanceof kS)o.push(n);else{const e=OS(t,r);null!=e&&(o.push(n),c.set(n,e))}});var n=new ub(o);return new _S(c,n,a.fieldTransforms)}function xS(e,t,n,r,i,s){const a=e.wa(1,t,n),o=[US(t,r,n)],c=[i];if(s.length%2!=0)throw new h_(u_.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(US(t,s[p])),c.push(s[p+1]);const l=[],u=hb.empty();for(let f=o.length-1;0<=f;--f)if(!jS(l,o[f])){const t=o[f];var h=ae(h=c[f]);const r=a.ha(t);if(h instanceof kS)l.push(t);else{const e=OS(h,r);null!=e&&(l.push(t),u.set(t,e))}}var d=new ub(l);return new _S(u,d,a.fieldTransforms)}function PS(e,t,n,r=!1){return OS(n,e.wa(r?4:3,t))}function OS(s,e){if(LS(s=ae(s)))return FS("Unsupported field value:",e,s),MS(s,e);if(s instanceof gS)return function(e,t){if(!wS(t.ra))throw t.fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.fa(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.ca&&4!==e.ra)throw e.fa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=OS(i,t.la(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=ae(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Vb(t.Tt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=k_.fromDate(e);return{timestampValue:qI(t.Tt,n)}}if(e instanceof k_){n=new k_(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:qI(t.Tt,n)}}if(e instanceof mS)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof pS)return{bytesValue:VI(t.Tt,e._byteString)};if(e instanceof $C){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.fa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:jI(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.fa(`Unsupported field value: ${qC(e)}`)}(0,e)}function MS(e,r){const i={};return ow(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):aw(e,(e,t)=>{var n=OS(t,r.ua(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function LS(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof k_||e instanceof mS||e instanceof pS||e instanceof $C||e instanceof gS)}function FS(e,t,n){if(!LS(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=qC(n);throw"an object"===r?t.fa(e+" a custom object"):t.fa(e+" "+r)}var i}function US(e,t,n){if((t=ae(t))instanceof fS)return t._internalPath;if("string"==typeof t)return VS(e,t);throw BS("Field path arguments must be of type string or ",e,!1,void 0,n)}const qS=new RegExp("[~\\*/\\[\\]]");function VS(t,n,r){if(0<=n.search(qS))throw BS(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new fS(...n.split("."))._internalPath}catch(e){throw BS(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function BS(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${r}`),a&&(c+=` in document ${i}`),c+=")"),new h_(u_.INVALID_ARGUMENT,o+e+c)}function jS(e,t){return e.some(e=>e.isEqual(t))}class KS{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $C(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new $S(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(zS("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class $S extends KS{data(){return super.data()}}function zS(e,t){return"string"==typeof t?VS(e,t):(t instanceof fS?t:t._delegate)._internalPath}function WS(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new h_(u_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class GS{}class HS extends GS{}function QS(e,t,...n){let r=[];t instanceof GS&&r.push(t),r=r.concat(n),function(e){var t=e.filter(e=>e instanceof XS).length,n=e.filter(e=>e instanceof YS).length;if(1<t||0<t&&0<n)throw new h_(u_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class YS extends HS{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new YS(e,t,n)}_apply(e){var t=this._parse(e);return sN(e._query,t),new zC(e.firestore,e.converter,Rb(e._query,t))}_parse(e){var t=TS(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new h_(u_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){iN(a,s);const t=[];for(const n of a)t.push(rN(r,e,n));o={arrayValue:{values:t}}}else o=rN(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||iN(a,s),o=PS(n,t,a,"in"===s||"not-in"===s);return Bw.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class XS extends GS{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new XS(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:jw.create(e,this._getOperator())}_apply(e){const n=this._parse(e);return 0===n.getFilters().length?e:(function(e){let t=e;for(const e of n.getFlattenedFilters())sN(t,e),t=Rb(t,e)}(e._query),new zC(e.firestore,e.converter,Rb(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class JS extends HS{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new JS(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new h_(u_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new h_(u_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i=new rb(t,n);return n=i,null!==kb(e=e)||null!==(r=Cb(e))&&aN(0,r,n.field),i}(e._query,this._field,this._direction);return new zC(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new bb(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class ZS extends HS{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ZS(e,t,n)}_apply(e){return new zC(e.firestore,e.converter,Db(e._query,this._limit,this._limitType))}}class eN extends HS{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new eN(e,t,n)}_apply(e){var t,n=nN(e,this.type,this._docOrFields,this._inclusive);return new zC(e.firestore,e.converter,(t=e._query,e=n,new bb(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class tN extends HS{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new tN(e,t,n)}_apply(e){var t,n=nN(e,this.type,this._docOrFields,this._inclusive);return new zC(e.firestore,e.converter,(t=e._query,e=n,new bb(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function nN(e,t,n,r){if(n[0]=ae(n[0]),n[0]instanceof KS)return function(e,t,n,r,i){if(!r)throw new h_(u_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Nb(e))if(n.field.isKeyField())s.push(Sw(t,r.key));else{const e=r.data.field(n.field);if(vw(e))throw new h_(u_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new h_(u_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Fw(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=TS(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new h_(u_.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let c=0;c<i.length;c++){const l=i[c];if(a[c].field.isKeyField()){if("string"!=typeof l)throw new h_(u_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!Sb(e)&&-1!==l.indexOf("/"))throw new h_(u_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);const n=e.path.child(N_.fromString(l));if(!D_.isDocumentKey(n))throw new h_(u_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new D_(n);o.push(Sw(t,i))}else{const e=PS(n,r,l);o.push(e)}}return new Fw(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function rN(e,t,n){if("string"==typeof(n=ae(n))){if(""===n)throw new h_(u_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sb(t)&&-1!==n.indexOf("/"))throw new h_(u_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(N_.fromString(n));if(!D_.isDocumentKey(r))throw new h_(u_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Sw(e,new D_(r))}if(n instanceof $C)return Sw(e,n._key);throw new h_(u_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qC(n)}.`)}function iN(e,t){if(!Array.isArray(e)||0===e.length)throw new h_(u_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function sN(e,t){if(t.isInequality()){const r=Cb(e),i=t.field;if(null!==r&&!r.isEqual(i))throw new h_(u_.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);var n=kb(e);null!==n&&aN(0,i,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new h_(u_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new h_(u_.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function aN(e,t,n){if(!n.isEqual(t))throw new h_(u_.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class oN{convertValue(e,t="none"){switch(bw(e)){case 0:return null;case 1:return e.booleanValue;case 2:return gw(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(mw(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw c_()}}convertObject(e,n){const r={};return aw(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new mS(gw(e.latitude),gw(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return vw(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(yw(e));default:return null}}convertTimestamp(e){var t=fw(e);return new k_(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=N_.fromString(e);l_(oT(n));const r=new iw(n.get(1),n.get(3)),i=new D_(n.popFirst(5));return r.isEqual(t)||s_(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function cN(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class lN extends oN{constructor(e){super(),this.firestore=e}convertBytes(e){return new pS(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new $C(this.firestore,null,t)}}class uN{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hN extends KS{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new dN(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(zS("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class dN extends hN{data(e={}){return super.data(e)}}class pN{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new uN(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new dN(this._firestore,this._userDataWriter,e.key,e,new uN(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new h_(u_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let n=0;return s._snapshot.docChanges.map(e=>{var t=new dN(s._firestore,s._userDataWriter,e.doc.key,e.doc,new uN(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new dN(s._firestore,s._userDataWriter,e.doc.key,e.doc,new uN(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return c_()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function fN(e,t){return e instanceof hN&&t instanceof hN?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof pN&&t instanceof pN&&e._firestore===t._firestore&&YC(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class gN extends oN{constructor(e){super(),this.firestore=e}convertBytes(e){return new pS(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new $C(this.firestore,null,t)}}function mN(t){t=VC(t,$C);const n=VC(t.firestore,iS),e=sS(n),r=new gN(n);return function(e,t){const n=new d_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new h_(u_.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=Ak(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await SC(e),t,n)),n.promise}(e,t._key).then(e=>new hN(n,r,t._key,e,new uN(null!==e&&e.hasLocalMutations,!0),t.converter))}function vN(t){t=VC(t,zC);const n=VC(t.firestore,iS),e=sS(n),r=new gN(n);return function(e,t){const n=new d_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await O0(e,t,!0),s=new zk(t,i.Yi),a=s.Hu(i.documents),o=s.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=Ak(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await SC(e),t,n)),n.promise}(e,t._query).then(e=>new pN(n,r,t,e))}function yN(e,t,n){e=VC(e,$C);var r=VC(e.firestore,iS),i=cN(e.converter,t,n);return IN(r,[ES(TS(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Zb.none())])}function _N(e,t,n,...r){e=VC(e,$C);var i=VC(e.firestore,iS),s=TS(i);let a;return a="string"==typeof(t=ae(t))||t instanceof fS?xS(s,"updateDoc",e._key,t,n,r):DS(s,"updateDoc",e._key,t),IN(i,[a.toMutation(e._key,Zb.exists(!0))])}function wN(t,...n){var e;t=ae(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||JC(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(JC(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,c;if(t instanceof $C)o=VC(t.firestore,iS),c=Tb(t._key.path),a={next:e=>{n[i]&&n[i](TN(o,t,e))},error:n[i+1],complete:n[i+2]};else{const l=VC(t,zC);o=VC(l.firestore,iS),c=l._query;const u=new gN(o);a={next:e=>{n[i]&&n[i](new pN(o,u,l,e))},error:n[i+1],complete:n[i+2]},WS(t._query)}return function(e,t,n,r){const i=new vC(r),s=new Uk(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>Mk(await RC(e),s)),()=>{i.Pc(),e.asyncQueue.enqueueAndForget(async()=>Lk(await RC(e),s))}}(sS(o),c,s,a)}function bN(e,t){return function(e,t){const n=new vC(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.vu.add(t),t.next()}(await RC(e),n)),()=>{n.Pc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.vu.delete(t)}(await RC(e),n))}}(sS(e=VC(e,iS)),JC(t)?t:{next:t})}function IN(e,t){return function(e,t){const n=new d_;return e.asyncQueue.enqueueAndForget(async()=>Yk(await AC(e),t,n)),n.promise}(sS(e),t)}function TN(e,t,n){var r=n.docs.get(t._key),i=new gN(e);return new hN(e,i,t._key,r,new uN(n.hasPendingWrites,n.fromCache),t.converter)}const EN={maxAttempts:5};class kN{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=TS(e)}set(e,t,n){this._verifyNotCommitted();const r=CN(e,this._firestore),i=cN(r.converter,t,n),s=ES(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Zb.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=CN(e,this._firestore);let s;return s="string"==typeof(t=ae(t))||t instanceof fS?xS(this._dataReader,"WriteBatch.update",i._key,t,n,r):DS(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Zb.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=CN(e,this._firestore);return this._mutations=this._mutations.concat(new hI(t._key,Zb.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new h_(u_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function CN(e,t){if((e=ae(e)).firestore!==t)throw new h_(u_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class SN extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=TS(e)}get(e){const n=CN(e,this._firestore),r=new lN(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return c_();const t=e[0];if(t.isFoundDocument())return new KS(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new KS(this._firestore,r,n._key,null,n.converter);throw c_()})}set(e,t,n){var r=CN(e,this._firestore),i=cN(r.converter,t,n),i=ES(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=CN(e,this._firestore),s="string"==typeof(t=ae(t))||t instanceof fS?xS(this._dataReader,"Transaction.update",i._key,t,n,r):DS(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=CN(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=CN(e,this._firestore),n=new gN(this._firestore);return super.get(e).then(e=>new hN(this._firestore,n,t._key,e._document,new uN(!1,!1),t.converter))}}function NN(t,n,e){t=VC(t,iS);var r=Object.assign(Object.assign({},EN),e);return function(){if(r.maxAttempts<1)throw new h_(u_.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const i=new d_;return t.asyncQueue.enqueueAndForget(async()=>{var e=await kC(t).then(e=>e.datastore);new wC(t.asyncQueue,e,r,n,i).run()}),i.promise}(sS(t),e=>n(new SN(t,e)),r)}gA=Ye,t_=gA,We(new oe("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new iS(new m_(e.getProvider("auth-internal")),new w_(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new h_(u_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iw(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),et(Zy,"3.8.4",void 0),et(Zy,"3.8.4","esm2017");function AN(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new h_("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function RN(){if("undefined"==typeof Uint8Array)throw new h_("unimplemented","Uint8Arrays are not available in this environment.")}function DN(){if("undefined"==typeof atob)throw new h_("unimplemented","Blobs are unavailable in Firestore in this environment.")}class xN{constructor(e){this._delegate=e}static fromBase64String(e){return DN(),new xN(pS.fromBase64String(e))}static fromUint8Array(e){return RN(),new xN(pS.fromUint8Array(e))}toBase64(){return DN(),this._delegate.toBase64()}toUint8Array(){return RN(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function PN(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class ON{enableIndexedDbPersistence(e,t){return function(e,t){dS(e=VC(e,iS));var n=sS(e),r=e._freezeSettings(),i=new gC;return oS(n,i,new pC(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){dS(e=VC(e,iS));var t=sS(e),n=e._freezeSettings(),r=new gC;return oS(t,r,new fC(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new h_(u_.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new d_;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!W_.C())return Promise.resolve();var t=e+"main";await W_.delete(t)}(T0(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class MN{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof iw||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||a_("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,t,r={}){var i;const s=(n=VC(n,KC))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&a_("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=e_.MOCK_USER;else{e=_(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new h_(u_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new e_(s)}n._authCredentials=new g_(new p_(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return lS(this._delegate)}disableNetwork(){return uS(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,LC("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return cS(this._delegate)}onSnapshotsInSync(e){return bN(this._delegate,e)}get app(){if(!this._appCompat)throw new h_("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new QN(this,GC(this._delegate,e))}catch(e){throw BN(e,"collection()","Firestore.collection()")}}doc(e){try{return new VN(this,HC(this._delegate,e))}catch(e){throw BN(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new WN(this,function(e,t){if(e=VC(e,KC),MC("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new h_(u_.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new zC(e,null,(t=t,new bb(N_.emptyPath(),t)))}(this._delegate,e))}catch(e){throw BN(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return NN(this._delegate,e=>t(new FN(this,e)))}batch(){return sS(this._delegate),new UN(new kN(this._delegate,e=>IN(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=sS(t=VC(t,iS)),r=new ZC,PC(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return hS(this._delegate,e).then(e=>e?new WN(this,e):null)}}class LN extends oN{constructor(e){super(),this.firestore=e}convertBytes(e){return new xN(new pS(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return VN.forKey(t,this.firestore,null)}}class FN{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new LN(e)}get(e){const t=YN(e);return this._delegate.get(t).then(e=>new $N(this._firestore,new hN(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=YN(e);return n?(AN("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=YN(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=YN(e);return this._delegate.delete(t),this}}class UN{constructor(e){this._delegate=e}set(e,t,n){var r=YN(e);return n?(AN("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=YN(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=YN(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class qN{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new dN(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new zN(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=qN.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new qN(e,new LN(e),t),r.set(t,i)),i}}qN.INSTANCES=new WeakMap;class VN{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new LN(e)}static forPath(e,t,n){if(e.length%2!=0)throw new h_("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new VN(t,new $C(t._delegate,n,new D_(e)))}static forKey(e,t,n){return new VN(t,new $C(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new QN(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new QN(this.firestore,GC(this._delegate,e))}catch(e){throw BN(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=ae(e))instanceof $C&&QC(this._delegate,e)}set(e,t){t=AN("DocumentReference.set",t);try{return t?yN(this._delegate,e,t):yN(this._delegate,e)}catch(e){throw BN(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?_N(this._delegate,e):_N(this._delegate,e,t,...n)}catch(e){throw BN(e,"updateDoc()","DocumentReference.update()")}}delete(){return IN(VC((e=this._delegate).firestore,iS),[new hI(e._key,Zb.none())]);var e}onSnapshot(...e){var t=jN(e),n=KN(e,e=>new $N(this.firestore,new hN(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return wN(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?mN:"server"===(null==e?void 0:e.source)?function(t){t=VC(t,$C);const n=VC(t.firestore,iS);return DC(sS(n),t._key,{source:"server"}).then(e=>TN(n,t,e))}:function(t){t=VC(t,$C);const n=VC(t.firestore,iS);return DC(sS(n),t._key).then(e=>TN(n,t,e))})(this._delegate),t.then(e=>new $N(this.firestore,new hN(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new VN(this.firestore,e?this._delegate.withConverter(qN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function BN(e,t,n){return e.message=e.message.replace(t,n),e}function jN(e){for(const t of e)if("object"==typeof t&&!PN(t))return t;return{}}function KN(e,t){var n;let r;return r=PN(e[0])?e[0]:PN(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class $N{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new VN(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return fN(this._delegate,e._delegate)}}class zN extends $N{data(e){var t=this._delegate.data(e);return void 0!==t||c_(),t}}class WN{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new LN(e)}where(e,t,n){try{return new WN(this.firestore,QS(this._delegate,(r=n,i=t,s=zS("where",e),YS._create(s,i,r))))}catch(e){throw BN(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new WN(this.firestore,QS(this._delegate,([n,r="asc"]=[e,t],i=r,s=zS("orderBy",n),JS._create(s,i))))}catch(e){throw BN(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new WN(this.firestore,QS(this._delegate,(BC("limit",t=e),ZS._create("limit",t,"F"))))}catch(e){throw BN(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new WN(this.firestore,QS(this._delegate,(BC("limitToLast",t=e),ZS._create("limitToLast",t,"L"))))}catch(e){throw BN(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new WN(this.firestore,QS(this._delegate,function(...e){return eN._create("startAt",e,!0)}(...e)))}catch(e){throw BN(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new WN(this.firestore,QS(this._delegate,function(...e){return eN._create("startAfter",e,!1)}(...e)))}catch(e){throw BN(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new WN(this.firestore,QS(this._delegate,function(...e){return tN._create("endBefore",e,!1)}(...e)))}catch(e){throw BN(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new WN(this.firestore,QS(this._delegate,function(...e){return tN._create("endAt",e,!0)}(...e)))}catch(e){throw BN(e,"endAt()","Query.endAt()")}}isEqual(e){return YC(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?vN:"server"===(null==e?void 0:e.source)?function(t){t=VC(t,zC);const n=VC(t.firestore,iS),e=sS(n),r=new gN(n);return xC(e,t._query,{source:"server"}).then(e=>new pN(n,r,t,e))}:function(t){t=VC(t,zC);const n=VC(t.firestore,iS),e=sS(n),r=new gN(n);return WS(t._query),xC(e,t._query).then(e=>new pN(n,r,t,e))})(this._delegate),t.then(e=>new HN(this.firestore,new pN(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=jN(e),n=KN(e,e=>new HN(this.firestore,new pN(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return wN(this._delegate,t,n)}withConverter(e){return new WN(this.firestore,e?this._delegate.withConverter(qN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class GN{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new zN(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class HN{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new WN(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new zN(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new GN(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new zN(this._firestore,e))})}isEqual(e){return fN(this._delegate,e._delegate)}}class QN extends WN{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new VN(this.firestore,e):null}doc(e){try{return void 0===e?new VN(this.firestore,HC(this._delegate)):new VN(this.firestore,HC(this._delegate,e))}catch(e){throw BN(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=VC(e.firestore,iS),r=HC(e),i=cN(e.converter,t);return IN(n,[ES(TS(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Zb.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new VN(this.firestore,e))}isEqual(e){return QC(this._delegate,e._delegate)}withConverter(e){return new QN(this.firestore,e?this._delegate.withConverter(qN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function YN(e){return VC(e,$C)}const XN={Firestore:MN,GeoPoint:mS,Timestamp:k_,Blob:xN,Transaction:FN,WriteBatch:UN,DocumentReference:VN,DocumentSnapshot:$N,Query:WN,QueryDocumentSnapshot:zN,QuerySnapshot:HN,CollectionReference:QN,FieldPath:class aO{constructor(...e){this._delegate=new fS(...e)}static documentId(){return new aO(R_.keyField().canonicalString())}isEqual(e){return(e=ae(e))instanceof fS&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class oO{constructor(e){this._delegate=e}static serverTimestamp(){const e=new SS("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new oO(e)}static delete(){const e=new kS("deleteField");return e._methodName="FieldValue.delete",new oO(e)}static arrayUnion(...e){const t=function(...e){return new NS("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new oO(t)}static arrayRemove(...e){const t=function(...e){return new AS("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new oO(t)}static increment(e){const t=new RS("increment",e);return t._methodName="FieldValue.increment",new oO(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,n_.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};eS=wt,tS=(e,t)=>new MN(e,t,new ON),eS.INTERNAL.registerComponent(new oe("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return tS(t,n)},"PUBLIC").setServiceProps(Object.assign({},XN))),eS.registerVersion("@firebase/firestore-compat","0.3.4");const JN="type.googleapis.com/google.protobuf.Int64Value",ZN="type.googleapis.com/google.protobuf.UInt64Value";function eA(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function tA(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case JN:case ZN:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>tA(e)):"function"==typeof e||"object"==typeof e?eA(e,e=>tA(e)):e}const nA="functions",rA={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class iA extends R{constructor(e,t,n){super(`${nA}/${e}`,t||""),this.details=n}}function sA(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!rA[e])return new iA("internal","internal");n=rA[e],r=e}var a=s.message;"string"==typeof a&&(r=a),i=s.details,void 0!==i&&(i=tA(i))}}catch(e){}return"ok"===n?null:new iA(n,r,i)}class aA{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){var e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const oA="us-central1";class cA{constructor(e,t,n,r,i=oA,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new aA(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin,this.region=oA}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function lA(i,s,a){return e=>{return t=e,n=a||{},r=(e=i)._url(s),uA(e,r,t,n);var t,n,r}}async function uA(e,t,n,r){var i={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return eA(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)};const s={};var a=await e.contextProvider.getContext();a.authToken&&(s.Authorization="Bearer "+a.authToken),a.messagingToken&&(s["Firebase-Instance-ID-Token"]=a.messagingToken),null!==a.appCheckToken&&(s["X-Firebase-AppCheck"]=a.appCheckToken);const o=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new iA("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(r.timeout||7e4);a=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(t,i,s,e.fetchImpl),o.promise,e.cancelAllRequests]);if(o.cancel(),!a)throw new iA("cancelled","Firebase Functions instance was deleted.");i=sA(a.status,a.json);if(i)throw i;if(!a.json)throw new iA("internal","Response is not valid JSON object.");let c=a.json.data;if(void 0===c&&(c=a.json.result),void 0===c)throw new iA("internal","Response is missing data field.");return{data:tA(c)}}const hA="@firebase/functions";function dA(e,t,n){ae(e).emulatorOrigin=`http://${t}:${n}`}function pA(e,t,n){return r=ae(e),i=t,s=n,e=>uA(r,i,e,s||{});var r,i,s}nS=fetch.bind(self),We(new oe(nA,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new cA(n,r,i,s,t,nS)},"PUBLIC").setMultipleInstances(!0)),et(hA,"0.9.4",rS),et(hA,"0.9.4","esm2017");var fA,gA,mA,vA,yA;class _A{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return lA(ae(this._delegate),e,t)}httpsCallableFromURL(e,t){return pA(this._delegate,e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new R("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new R("functions","Port missing in origin provided to useFunctionsEmulator()");return dA(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return dA(this._delegate,e,t)}}const wA="us-central1",bA=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:null!=t?t:wA});return new _A(n,r)};fA={Functions:_A},wt.INTERNAL.registerComponent(new oe("functions-compat",bA,"PUBLIC").setServiceProps(fA).setMultipleInstances(!0)),wt.registerVersion("@firebase/functions-compat","0.3.4");const IA="/firebase-messaging-sw.js",TA="/firebase-cloud-messaging-push-scope",EA="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",kA="https://fcmregistrations.googleapis.com/v1",CA="google.c.a.c_id",SA="google.c.a.e";function NA(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(gA=jx=jx||{})[gA.DATA_MESSAGE=1]="DATA_MESSAGE",gA[gA.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(zc=mA=mA||{}).PUSH_RECEIVED="push-received",zc.NOTIFICATION_CLICKED="notification-clicked";const AA="fcm_token_details_db",RA="fcm_token_object_Store";async function DA(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(AA))return null}let l=null;const e=await Re(AA,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(RA)){const o=r.objectStore(RA);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:NA(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:NA(s.auth),p256dh:NA(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:NA(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:NA(a.auth),p256dh:NA(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:NA(a.vapidKey)}}))}}});return e.close(),await De(AA),await De("fcm_vapid_details_db"),await De("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const xA="firebase-messaging-database",PA=1,OA="firebase-messaging-store";let MA=null;function LA(){return MA=MA||Re(xA,PA,{upgrade:(e,t)=>{0===t&&e.createObjectStore(OA)}}),MA}async function FA(e){var t=qA(e);const n=await LA();t=await n.transaction(OA).objectStore(OA).get(t);if(t)return t;t=await DA(e.appConfig.senderId);return t?(await UA(e,t),t):void 0}async function UA(e,t){var n=qA(e);const r=await LA(),i=r.transaction(OA,"readwrite");return await i.objectStore(OA).put(t,n),await i.done,t}function qA({appConfig:e}){return e.appId}const VA=new D("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function BA(e,t){var n={method:"DELETE",headers:await KA(e)};try{const s=await fetch(`${jA(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw VA.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw VA.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function jA({projectId:e}){return`${kA}/projects/${e}/registrations`}async function KA({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function $A({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==EA&&(i.web.applicationPubKey=r),i}const zA=6048e5;async function WA(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:NA(t.getKey("auth")),p256dh:NA(t.getKey("p256dh"))},c=await FA(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+zA?async function(t,e){try{var n=await async function(e,t){var n=await KA(e),r=$A(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${jA(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw VA.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw VA.create("token-update-failed",{errorInfo:r})}if(!i.token)throw VA.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await UA(t.firebaseDependencies,r),n}catch(e){throw await GA(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await BA(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return HA(e.firebaseDependencies,o)}return HA(e.firebaseDependencies,o)}async function GA(e){var t=await FA(e.firebaseDependencies);t&&(await BA(e.firebaseDependencies,t.token),await async function(e){var t=qA(e);const n=await LA(),r=n.transaction(OA,"readwrite");await r.objectStore(OA).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function HA(e,t){var n={token:await async function(e,t){var n=await KA(e),r=$A(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(jA(e.appConfig),r);i=await s.json()}catch(e){throw VA.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw VA.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw VA.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await UA(e,n),n.token}function QA(e){var t,n,r,i,s,a={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return r=a,(n=e).notification&&(r.notification={},(t=n.notification.title)&&(r.notification.title=t),(t=n.notification.body)&&(r.notification.body=t),(t=n.notification.image)&&(r.notification.image=t),(t=n.notification.icon)&&(r.notification.icon=t)),n=a,(r=e).data&&(n.data=r.data),r=a,((e=e).fcmOptions||null!==(i=e.notification)&&void 0!==i&&i.click_action)&&(r.fcmOptions={},(s=null!==(i=null===(i=e.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=e.notification)||void 0===s?void 0:s.click_action)&&(r.fcmOptions.link=s),(s=null===(s=e.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(r.fcmOptions.analyticsLabel=s)),a}function YA(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function XA(e){return VA.create("missing-app-config-values",{valueName:e})}YA("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),YA("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class JA{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw XA("App Configuration Object");if(!e.name)throw XA("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw XA(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function ZA(e){try{e.swRegistration=await navigator.serviceWorker.register(IA,{scope:TA}),e.swRegistration.update().catch(()=>{})}catch(e){throw VA.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function eR(e,t){if(!navigator)throw VA.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw VA.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=EA)),await async function(e,t){if(t||e.swRegistration||await ZA(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw VA.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),WA(e)}async function tR(e,t,n){var r=function(e){switch(e){case mA.NOTIFICATION_CLICKED:return"notification_open";case mA.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const i=await e.firebaseDependencies.analyticsProvider.get();i.logEvent(r,{message_id:n[CA],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function nR(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===mA.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(QA(r)):e.onMessageHandler.next(QA(r))),n=r.data,"object"==typeof(t=n)&&t&&CA in t&&"1"===n[SA]&&await tR(e,r.messageType,n))}const rR="@firebase/messaging",iR=e=>{const t=new JA(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>nR(t,e)),t},sR=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>eR(t,e)}};function aR(e){return async function(e){if(!navigator)throw VA.create("only-available-in-window");return e.swRegistration||await ZA(e),GA(e)}(e=ae(e))}function oR(e,t){return function(e,t){if(!navigator)throw VA.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=ae(e),t)}We(new oe("messaging",iR,"PUBLIC")),We(new oe("messaging-internal",sR,"PRIVATE")),et(rR,"0.12.4"),et(rR,"0.12.4","esm2017");const cR="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",lR="https://fcmregistrations.googleapis.com/v1",uR="FCM_MSG",hR="google.c.a.c_id",dR=3,pR=1;function fR(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(zc=vA=vA||{})[zc.DATA_MESSAGE=1]="DATA_MESSAGE",zc[zc.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(zc=yA=yA||{}).PUSH_RECEIVED="push-received",zc.NOTIFICATION_CLICKED="notification-clicked";const gR="fcm_token_details_db",mR="fcm_token_object_Store";async function vR(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(gR))return null}let l=null;const e=await Re(gR,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(mR)){const o=r.objectStore(mR);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:fR(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:fR(s.auth),p256dh:fR(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:fR(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:fR(a.auth),p256dh:fR(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:fR(a.vapidKey)}}))}}});return e.close(),await De(gR),await De("fcm_vapid_details_db"),await De("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const yR="firebase-messaging-database",_R=1,wR="firebase-messaging-store";let bR=null;function IR(){return bR=bR||Re(yR,_R,{upgrade:(e,t)=>{0===t&&e.createObjectStore(wR)}}),bR}async function TR(e){var t=kR(e);const n=await IR();t=await n.transaction(wR).objectStore(wR).get(t);if(t)return t;t=await vR(e.appConfig.senderId);return t?(await ER(e,t),t):void 0}async function ER(e,t){var n=kR(e);const r=await IR(),i=r.transaction(wR,"readwrite");return await i.objectStore(wR).put(t,n),await i.done,t}function kR({appConfig:e}){return e.appId}const CR=new D("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function SR(e,t){var n={method:"DELETE",headers:await AR(e)};try{const s=await fetch(`${NR(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw CR.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw CR.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function NR({projectId:e}){return`${lR}/projects/${e}/registrations`}async function AR({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function RR({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==cR&&(i.web.applicationPubKey=r),i}async function DR(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:fR(t.getKey("auth")),p256dh:fR(t.getKey("p256dh"))},c=await TR(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+6048e5?async function(t,e){try{var n=await async function(e,t){var n=await AR(e),r=RR(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${NR(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw CR.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw CR.create("token-update-failed",{errorInfo:r})}if(!i.token)throw CR.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await ER(t.firebaseDependencies,r),n}catch(e){throw await xR(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await SR(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return PR(e.firebaseDependencies,o)}return PR(e.firebaseDependencies,o)}async function xR(e){var t=await TR(e.firebaseDependencies);t&&(await SR(e.firebaseDependencies,t.token),await async function(e){var t=kR(e);const n=await IR(),r=n.transaction(wR,"readwrite");await r.objectStore(wR).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function PR(e,t){var n={token:await async function(e,t){var n=await AR(e),r=RR(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(NR(e.appConfig),r);i=await s.json()}catch(e){throw CR.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw CR.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw CR.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await ER(e,n),n.token}async function OR(e,t){var n=function(e,t){var n;const r={};e.from&&(r.project_number=e.from);e.fcmMessageId&&(r.message_id=e.fcmMessageId);r.instance_id=t,e.notification?r.message_type=vA.DISPLAY_NOTIFICATION.toString():r.message_type=vA.DATA_MESSAGE.toString();r.sdk_platform=dR.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(r.collapse_key=e.collapse_key);r.event=pR.toString(),null!==(n=e.fcmOptions)&&void 0!==n&&n.analytics_label&&(r.analytics_label=null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label);return r}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,n)}function MR(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}async function LR(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await OR(t,n);var r,i,s,a,o=await UR();if(o.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=yA.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(o,n);n.notification&&await function(e){var t=e["actions"],n=Notification["maxActions"];t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[uR]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(a={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},o=a,(e=r).notification&&(o.notification={},(n=e.notification.title)&&(o.notification.title=n),(n=e.notification.body)&&(o.notification.body=n),(n=e.notification.image)&&(o.notification.image=n),(n=e.notification.icon)&&(o.notification.icon=n)),e=a,(o=r).data&&(e.data=o.data),o=a,((r=r).fcmOptions||null!==(i=r.notification)&&void 0!==i&&i.click_action)&&(o.fcmOptions={},(s=null!==(i=null===(i=r.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=r.notification)||void 0===s?void 0:s.click_action)&&(o.fcmOptions.link=s),(s=null===(s=r.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(o.fcmOptions.analyticsLabel=s)),a=a,"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(a):t.onBackgroundMessageHandler.next(a))}}async function FR(e){const t=null===(s=null===(i=e.notification)||void 0===i?void 0:i.data)||void 0===s?void 0:s[uR];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&hR in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await async function(e){var t=await UR();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=yA.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function UR(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function qR(e){return CR.create("missing-app-config-values",{valueName:e})}MR("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),MR("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class VR{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw qR("App Configuration Object");if(!e.name)throw qR("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw qR(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const BR=e=>{const t=new VR(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(LR(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var n;(n=e["newSubscription"])?(n=await TR(t.firebaseDependencies),await xR(t),t.vapidKey=null!==(n=null===(n=null==n?void 0:n.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==n?n:cR,await DR(t)):await xR(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(FR(e))}),t};function jR(e,t){return function(e,t){if(void 0!==self.document)throw CR.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=ae(e),t)}We(new oe("messaging-sw",BR,"PUBLIC"));var KR,$R,zR,WR;class GR{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return eR(e=ae(e),t)}(this._delegate,e)}async deleteToken(){return aR(this._delegate)}onMessage(e){return oR(this._delegate,e)}onBackgroundMessage(e){return jR(this._delegate,e)}}const HR=e=>self&&"ServiceWorkerGlobalScope"in self?new GR(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new GR(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),QR={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?S()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&S()&&A()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};wt.INTERNAL.registerComponent(new oe("messaging-compat",HR,"PUBLIC").setServiceProps(QR)),wt.registerVersion("@firebase/messaging-compat","0.2.4");const YR="firebasestorage.googleapis.com",XR="storageBucket";class JR extends R{constructor(e,t,n=0){super(ZR(e),`Firebase Storage: ${t} (${ZR(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,JR.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return ZR(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function ZR(e){return"storage/"+e}function eD(){return new JR(KR.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function tD(){return new JR(KR.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function nD(){return new JR(KR.CANCELED,"User canceled the upload/download.")}function rD(){return new JR(KR.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function iD(e){return new JR(KR.INVALID_ARGUMENT,e)}function sD(){return new JR(KR.APP_DELETED,"The Firebase app was deleted.")}function aD(e){return new JR(KR.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function oD(e,t){return new JR(KR.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function cD(e){throw new JR(KR.INTERNAL_ERROR,"Internal error: "+e)}(It=KR=KR||{}).UNKNOWN="unknown",It.OBJECT_NOT_FOUND="object-not-found",It.BUCKET_NOT_FOUND="bucket-not-found",It.PROJECT_NOT_FOUND="project-not-found",It.QUOTA_EXCEEDED="quota-exceeded",It.UNAUTHENTICATED="unauthenticated",It.UNAUTHORIZED="unauthorized",It.UNAUTHORIZED_APP="unauthorized-app",It.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",It.INVALID_CHECKSUM="invalid-checksum",It.CANCELED="canceled",It.INVALID_EVENT_NAME="invalid-event-name",It.INVALID_URL="invalid-url",It.INVALID_DEFAULT_BUCKET="invalid-default-bucket",It.NO_DEFAULT_BUCKET="no-default-bucket",It.CANNOT_SLICE_BLOB="cannot-slice-blob",It.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",It.NO_DOWNLOAD_URL="no-download-url",It.INVALID_ARGUMENT="invalid-argument",It.INVALID_ARGUMENT_COUNT="invalid-argument-count",It.APP_DELETED="app-deleted",It.INVALID_ROOT_OPERATION="invalid-root-operation",It.INVALID_FORMAT="invalid-format",It.INTERNAL_ERROR="internal-error",It.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class lD{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=lD.makeFromUrl(t,e)}catch(e){return new lD(t,"")}if(""===n.path)return n;throw t=t,new JR(KR.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}static makeFromUrl(e,t){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=t.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),a=t===YR?"(?:storage.googleapis.com|storage.cloud.google.com)":t,c=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${a}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let h=0;h<c.length;h++){const d=c[h];var l=d.regex.exec(e);if(l){var u=l[d.indices.bucket];let e=l[d.indices.path];e=e||"",n=new lD(u,e),d.postModify(n);break}}if(null==n)throw t=e,new JR(KR.INVALID_URL,"Invalid URL '"+t+"'.");return n}}class uD{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function hD(e){return"string"==typeof e||e instanceof String}function dD(e){return pD()&&e instanceof Blob}function pD(){return"undefined"!=typeof Blob&&!I()}function fD(e,t,n,r){if(r<t)throw iD(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw iD(`Invalid value for '${e}'. Expected ${n} or less.`)}function gD(e,t,n){let r=null==n?`https://${t}`:t;return`${n}://${r}/v0${e}`}function mD(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}function vD(e,t){var n=500<=e&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(It=$R=$R||{})[It.NO_ERROR=0]="NO_ERROR",It[It.NETWORK_ERROR=1]="NETWORK_ERROR",It[It.ABORT=2]="ABORT";class yD{constructor(e,t,n,r,i,s,a,o,c,l,u,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(n,e)=>{if(e)n(!1,new _D(!1,null,!0));else{const r=this.connectionFactory_();this.pendingConnection_=r;const i=e=>{var t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&r.addUploadProgressListener(i),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(i),this.pendingConnection_=null;var e=r.getErrorCode()===$R.NO_ERROR,t=r.getStatus();!e||vD(t,this.additionalRetryCodes_)&&this.retry?(e=r.getErrorCode()===$R.ABORT,n(!1,new _D(!1,null,e))):(t=-1!==this.successCodes_.indexOf(t),n(!0,new _D(t,r)))})}},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const o=eD();o.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,o)):r(o)}else{var a;t.canceled?(a=(this.appDelete_?sD:nD)(),r(a)):(a=tD(),r(a))}};this.canceled_?t(0,new _D(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,a=!1,o=0;function c(){return 2===o}let l=!1;function u(...e){l||(l=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(p,c())},e)}function d(){s&&clearTimeout(s)}function p(t,...n){if(l)d();else{if(t)return d(),void u.call(null,t,...n);if(c()||a)return d(),void u.call(null,t,...n);r<64&&(r*=2);let e;e=1===o?(o=2,0):1e3*(r+Math.random()),h(e)}}let f=!1;function g(e){f||(f=!0,d(),l||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{g(a=!0)},e),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class _D{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function wD(...t){const n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){const r=new n;for(let e=0;e<t.length;e++)r.append(t[e]);return r.getBlob()}if(pD())return new Blob(t);throw new JR(KR.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function bD(e){if("undefined"==typeof atob)throw new JR(KR.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}const ID={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class TD{constructor(e,t){this.data=e,this.contentType=t||null}}function ED(e,t){switch(e){case ID.RAW:return new TD(kD(t));case ID.BASE64:case ID.BASE64URL:return new TD(CD(e,t));case ID.DATA_URL:return new TD((n=t,(r=new SD(n)).base64?CD(ID.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw oD(ID.DATA_URL,"Malformed data URL.")}return kD(t)}(r.rest)),(n=t,new SD(n).contentType))}var n,r;throw eD()}function kD(t){const n=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);var r,i;e<=127?n.push(e):e<=2047?n.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,i=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&i,n.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):n.push(239,191,189):56320==(64512&e)?n.push(239,191,189):n.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(n)}function CD(t,e){switch(t){case ID.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw oD(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case ID.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw oD(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=bD(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw oD(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}class SD{constructor(e){this.base64=!1,this.contentType=null;var t,n,r=e.match(/^data:([^,]+)?,/);if(null===r)throw oD(ID.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=r[1]||null;null!=i&&(this.base64=(t=i,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=e.substring(e.indexOf(",")+1)}}class ND{constructor(e,t){let n=0,r="";dD(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(dD(this.data_)){var n=this.data_,n=(i=e,s=t,(r=n).webkitSlice?r.webkitSlice(i,s):r.mozSlice?r.mozSlice(i,s):r.slice?r.slice(i,s):null);return null===n?null:new ND(n)}var r,i,s,n=new Uint8Array(this.data_.buffer,e,t-e);return new ND(n,!0)}static getBlob(...e){if(pD()){var t=e.map(e=>e instanceof ND?e.data_:e);return new ND(wD.apply(null,t))}{const r=e.map(e=>hD(e)?ED(ID.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(e=>{for(let t=0;t<e.length;t++)i[n++]=e[t]}),new ND(i,!0)}}uploadData(){return this.data_}}function AD(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function RD(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function DD(e,t){return t}class xD{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||DD}}let PD=null;function OD(){if(PD)return PD;const e=[];e.push(new xD("bucket")),e.push(new xD("generation")),e.push(new xD("metageneration")),e.push(new xD("name","fullPath",!0));const t=new xD("name");t.xform=function(e,t){return!hD(t=t)||t.length<2?t:RD(t)},e.push(t);const n=new xD("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new xD("timeCreated")),e.push(new xD("updated")),e.push(new xD("md5Hash",null,!0)),e.push(new xD("cacheControl",null,!0)),e.push(new xD("contentDisposition",null,!0)),e.push(new xD("contentEncoding",null,!0)),e.push(new xD("contentLanguage",null,!0)),e.push(new xD("contentType",null,!0)),e.push(new xD("metadata","customMetadata",!0)),PD=e,PD}function MD(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new lD(e,t);return r._makeStorageReference(t)}})}function LD(e,t,n){var r=AD(t);return null===r?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let s=0;s<i;s++){const a=n[s];r[a.local]=a.xform(r,t[a.server])}return MD(r,e),r}(e,r,n)}function FD(e,t){const n={};var r=t.length;for(let s=0;s<r;s++){var i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}const UD="prefixes";function qD(e,t,n){var r=AD(n);return null===r?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[UD])for(const a of n[UD]){var i=a.replace(/\/$/,""),i=e._makeStorageReference(new lD(t,i));r.prefixes.push(i)}if(n.items)for(const o of n.items){var s=e._makeStorageReference(new lD(t,o.name));r.items.push(s)}return r}(e,t,r)}class VD{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function BD(e){if(!e)throw eD()}function jD(r,i){return function(e,t){var n=LD(r,t,i);return BD(null!==n),n}}function KD(r,i){return function(e,t){var n=qD(r,i,t);return BD(null!==n),n}}function $D(r,i){return function(e,t){var n=LD(r,t,i);return BD(null!==n),function(r,e,i,s){var t=AD(e);if(null===t)return null;if(!hD(t.downloadTokens))return null;const n=t.downloadTokens;if(0===n.length)return null;const a=encodeURIComponent,o=n.split(",");return o.map(e=>{var t=r.bucket,n=r.fullPath;return gD("/b/"+a(t)+"/o/"+a(n),i,s)+mD({alt:"media",token:e})})[0]}(n,t,r.host,r._protocol)}}function zD(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new JR(KR.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new JR(KR.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new JR(KR.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(r=i.path,new JR(KR.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):t,n.status=e.getStatus(),n.serverResponse=t.serverResponse,n}}function WD(r){const i=zD(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new JR(KR.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function GD(e,t,n){var r=gD(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new VD(r,"GET",jD(e,n),i);return s.errorHandler=WD(t),s}function HD(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function QD(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const a={"X-Goog-Upload-Protocol":"multipart"};var o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;var c=HD(t,r,i),l="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+FD(c,n)+"\r\n--"+o+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",o="\r\n--"+o+"--";const u=ND.getBlob(l,r,o);if(null===u)throw rD();o={name:c.fullPath},c=gD(s,e.host,e._protocol),s=e.maxUploadRetryTime;const h=new VD(c,"POST",jD(e,n),s);return h.urlParams=o,h.headers=a,h.body=u.uploadData(),h.errorHandler=zD(t),h}class YD{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function XD(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){BD(!1)}const r=t||["active"];return BD(!!n&&-1!==r.indexOf(n)),n}function JD(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),a=HD(t,r,i),o={name:a.fullPath},c=gD(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},s=FD(a,n),a=e.maxUploadRetryTime;const u=new VD(c,"POST",function(e){XD(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){BD(!1)}return BD(hD(t)),t},a);return u.urlParams=o,u.headers=l,u.body=s,u.errorHandler=zD(t),u}function ZD(e,t,n,i){var r=e.maxUploadRetryTime;const s=new VD(n,"POST",function(e){var t=XD(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){BD(!1)}n||BD(!1);var r=Number(n);return BD(!isNaN(r)),new YD(r,i.size(),"final"===t)},r);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=zD(t),s}function ex(e,a,t,o,n,c,r,i){const l=new YD(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=o.size()),o.size()!==l.total)throw new JR(KR.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));var h=l.current,d=h+u;let p="";p=0===u?"finalize":s===u?"upload, finalize":"upload";s={"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":`${l.current}`};const f=o.slice(h,d);if(null===f)throw rD();d=a.maxUploadRetryTime;const g=new VD(t,"POST",function(e,t){var n=XD(e,["active","final"]),r=l.current+u,i=o.size();let s;return s="final"===n?jD(a,c)(e,t):null,new YD(r,i,"final"===n,s)},d);return g.headers=s,g.body=f.uploadData(),g.progressCallback=i||null,g.errorHandler=zD(e),g}const tx={STATE_CHANGED:"state_changed"},nx={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function rx(e){switch(e){case"running":case"pausing":case"canceling":return nx.RUNNING;case"paused":return nx.PAUSED;case"success":return nx.SUCCESS;case"canceled":return nx.CANCELED;default:return nx.ERROR}}class ix{constructor(e,t,n){var r;"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(r=e).next,this.error=r.error,this.complete=r.complete)}}function sx(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class ax extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=$R.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=$R.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=$R.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw cD("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw cD("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw cD("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw cD("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw cD("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function ox(){return new ax}class cx{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=OD(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(KR.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{var t=this.isExponentialBackoffExpired();if(vD(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=tD()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(KR.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=JD(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=ZD(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new YD(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=ex(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,ox,e,t,!1);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){2*(262144*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=GD(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=QD(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=nD(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=rx(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new ix(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(rx(this._state)){case nx.SUCCESS:sx(this._resolve.bind(null,this.snapshot))();break;case nx.CANCELED:case nx.ERROR:const t=this._reject;sx(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(rx(this._state)){case nx.RUNNING:case nx.PAUSED:e.next&&sx(e.next.bind(e,this.snapshot))();break;case nx.SUCCESS:e.complete&&sx(e.complete.bind(e))();break;case nx.CANCELED:case nx.ERROR:default:e.error&&sx(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class lx{constructor(e,t){this._service=e,t instanceof lD?this._location=t:this._location=lD.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new lx(e,t)}get root(){var e=new lD(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return RD(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new lD(this._location.bucket,e);return new lx(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw aD(e)}}function ux(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await hx(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}function hx(e,t){null!=t&&"number"==typeof t.maxResults&&fD("options.maxResults",1,1e3,t.maxResults);var n=t||{},n=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);var a=gD(t.bucketOnlyServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime;const c=new VD(a,"GET",KD(e,t.bucket),o);return c.urlParams=s,c.errorHandler=zD(t),c}(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(n,ox)}function dx(e,t){e._throwIfRoot("updateMetadata");var n=function(e,t,n,r){var i=gD(t.fullServerUrl(),e.host,e._protocol),s=FD(n,r),a=e.maxOperationRetryTime;const o=new VD(i,"PATCH",jD(e,r),a);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=WD(t),o}(e.storage,e._location,t,OD());return e.storage.makeRequestWithTokens(n,ox)}function px(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=gD(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new VD(r,"GET",$D(e,n),i);return s.errorHandler=WD(t),s}(e.storage,e._location,OD());return e.storage.makeRequestWithTokens(t,ox).then(e=>{if(null===e)throw new JR(KR.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function fx(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=gD(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const i=new VD(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=WD(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,ox)}function gx(e,t){var n,r=(n=e._location.path,r=t.split("/").filter(e=>0<e.length).join("/"),0===n.length?r:n+"/"+r),r=new lD(e._location.bucket,r);return new lx(e.storage,r)}function mx(e,t){if(e instanceof _x){var n=e;if(null==n._bucket)throw new JR(KR.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+XR+"' property when initializing the app?");n=new lx(n,n._bucket);return null!=t?mx(n,t):n}return void 0!==t?gx(e,t):e}function vx(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof _x)return n=e,r=t,new lx(n,r);throw iD("To use ref(service, url), the first argument must be a Storage instance.")}return mx(e,t);var n,r}function yx(e,t){var n=null==t?void 0:t[XR];return null==n?null:lD.makeFromBucketSpec(n,e)}class _x{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=YR,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?lD.makeFromBucketSpec(r,this._host):yx(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=lD.makeFromBucketSpec(this._url,e):this._bucket=yx(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){fD("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){fD("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new lx(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new uD(sD());{const u=([s,a,o,e,n,r,t=!0]=[e,this._appId,n,r,t,this._firebaseVersion,i],c=mD(s.urlParams),l=s.url+c,c=Object.assign({},s.headers),i=c,(a=a)&&(i["X-Firebase-GMPID"]=a),a=c,null!==(o=o)&&0<o.length&&(a.Authorization="Firebase "+o),r=r,c["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=c,null!==(e=e)&&(r["X-Firebase-AppCheck"]=e),new yD(l,s.method,c,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,n,t));return this._requests.add(u),u.getPromise().then(()=>this._requests.delete(u),()=>this._requests.delete(u)),u}var s,a,o,c,l}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const wx="@firebase/storage";function bx(e,t,n){return e=ae(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new cx(e,new ND(t),n)}function Ix(e){return function(e){e._throwIfRoot("getMetadata");var t=GD(e.storage,e._location,OD());return e.storage.makeRequestWithTokens(t,ox)}(e=ae(e))}function Tx(e,t){return vx(e=ae(e),t)}function Ex(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";var i=r["mockUserToken"];i&&(e._overrideAuthToken="string"==typeof i?i:_(i,e.app.options.projectId))}(e,t,n,r)}function kx(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new _x(n,r,i,t,Ye)}We(new oe("storage",kx,"PUBLIC").setMultipleInstances(!0)),et(wx,"0.11.2",""),et(wx,"0.11.2","esm2017");class Cx{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Sx{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Cx(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new Cx(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new Cx(e,this,this._ref)):{next:t.next?e=>t.next(new Cx(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class Nx{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Ax(e,this._service))}get items(){return this._delegate.items.map(e=>new Ax(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class Ax{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=gx(this._delegate,e);return new Ax(t,this.storage)}get root(){return new Ax(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new Ax(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Sx(bx(this._delegate,e,t),this)}putString(e,t=ID.RAW,n){this._throwIfRoot("putString");var r=ED(t,e);const i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new Sx(new cx(this._delegate,new ND(r.data,!0),i),this)}listAll(){return ux(ae(this._delegate)).then(e=>new Nx(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,hx(t=ae(t),e).then(e=>new Nx(e,this.storage));var t}getMetadata(){return Ix(this._delegate)}updateMetadata(e){return dx(ae(this._delegate),e)}getDownloadURL(){return px(ae(this._delegate))}delete(){return this._throwIfRoot("delete"),fx(ae(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw aD(e)}}class Rx{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Dx(e))throw iD("ref() expected a child path but got a URL, use refFromURL instead.");return new Ax(Tx(this._delegate,e),this)}refFromURL(e){if(!Dx(e))throw iD("refFromURL() expected a full URL but got a child path, use ref() instead.");try{lD.makeFromUrl(e,this._delegate.host)}catch(e){throw iD("refFromUrl() expected a valid full URL but got an invalid one.")}return new Ax(Tx(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){Ex(this._delegate,e,t,n)}}function Dx(e){return/^[A-Za-z]+:\/\//.test(e)}function xx(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new Rx(n,r)}zR=wt,WR={TaskState:nx,TaskEvent:tx,StringFormat:ID,Storage:Rx,Reference:Ax},zR.INTERNAL.registerComponent(new oe("storage-compat",xx,"PUBLIC").setServiceProps(WR).setMultipleInstances(!0)),zR.registerVersion("@firebase/storage-compat","0.3.2");const Px="@firebase/performance",Ox="0.6.4",Mx=Ox,Lx="FB-PERF-TRACE-MEASURE",Fx="@firebase/performance/config",Ux="@firebase/performance/configexpire";var qx,Vx,Bx,jx="Performance";const Kx=new D("performance",jx,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),$x=new me(jx);$x.logLevel=m.INFO;let zx,Wx;class Gx{constructor(e){if(!(this.window=e))throw Kx.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&A()?!!S()||($x.info("IndexedDB is not supported by current browswer"),!1):($x.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===zx&&(zx=new Gx(Wx)),zx}}let Hx;function Qx(e,t){var n=e.length-t.length;if(n<0||1<n)throw Kx.create("invalid String merger input");const r=[];for(let i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}let Yx;class Xx{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=Qx("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=Qx("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===Yx&&(Yx=new Xx),Yx}}(It=qx=qx||{})[It.UNKNOWN=0]="UNKNOWN",It[It.VISIBLE=1]="VISIBLE",It[It.HIDDEN=2]="HIDDEN";const Jx=["firebase_","google_","ga_"],Zx=new RegExp("^[a-zA-Z]\\w*$");function eP(){switch(Gx.getInstance().document.visibilityState){case"visible":return qx.VISIBLE;case"hidden":return qx.HIDDEN;default:return qx.UNKNOWN}}function tP(e){var t=null===(t=e.options)||void 0===t?void 0:t.appId;if(!t)throw Kx.create("no app id");return t}const nP="0.0.1",rP={loggingEnabled:!0},iP="FIREBASE_INSTALLATIONS_AUTH";function sP(e,t){var r,i,n=function(){const e=Gx.getInstance().localStorage;if(e){var t=e.getItem(Ux);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(Fx);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(oP(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!t)throw Kx.create("no project id");return t}(r.app),n=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!t)throw Kx.create("no api key");return t}(r.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${iP} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:tP(r.app),app_version:Mx,sdk_version:nP})});return fetch(n).then(e=>{if(e.ok)return e.json();throw Kx.create("RC response not ok")})}).catch(()=>{$x.info(aP)}).then(oP).then(e=>function(e){const t=Gx.getInstance().localStorage;e&&t&&(t.setItem(Fx,JSON.stringify(e)),t.setItem(Ux,String(Date.now()+60*Xx.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const aP="Could not fetch config, will use default configs";function oP(e){if(!e)return e;const t=Xx.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=rP.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):rP.logSource&&(t.logSource=rP.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:rP.logEndPointUrl&&(t.logEndPointUrl=rP.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:rP.transportKey&&(t.transportKey=rP.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==rP.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=rP.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==rP.tracesSamplingRate&&(t.tracesSamplingRate=rP.tracesSamplingRate),t.logTraceAfterSampling=cP(t.tracesSamplingRate),t.logNetworkAfterSampling=cP(t.networkRequestsSamplingRate),e}function cP(e){return Math.random()<=e}let lP=1,uP;function hP(e){var t;return lP=2,uP=uP||(t=e,function(){const n=Gx.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{Hx=e}),t}(t.installations)).then(e=>sP(t,e)).then(()=>dP(),()=>dP())),uP}function dP(){lP=3}const pP=1e4,fP=3,gP=1e3;let mP=fP,vP=[],yP=!1;function _P(e){setTimeout(()=>{if(0!==mP)return vP.length?void function(){const e=vP.splice(0,gP),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Xx.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=Xx.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||$x.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=pP;isNaN(t)||(n=Math.max(t,n));t=e.logResponseDetails;Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&(vP=[...r,...vP],$x.info("Retry transport request later.")),mP=fP,_P(n)})}(n,e).catch(()=>{vP=[...e,...vP],mP--,$x.info(`Tries left: ${mP}.`),_P(pP)})}():_P(pP)},e)}function wP(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw Kx.create("invalid cc log");vP=[...vP,e]}({message:t(...e),eventTime:Date.now()})}}let bP;function IP(e,t){bP=bP||wP(kP),bP(e,t)}function TP(e){var t=Xx.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&Gx.getInstance().requiredApisAvailable()&&(e.isAuto&&eP()!==qx.VISIBLE||(3===lP?EP(e):hP(e.performanceController).then(()=>EP(e),()=>EP(e))))}function EP(e){var t;!Hx||(t=Xx.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>IP(e,1),0)}function kP(e,t){return 0===t?(n={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:CP(e.performanceController.app),network_request_metric:n},JSON.stringify(n)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);n={application_info:CP(e.performanceController.app),trace_metric:t};return JSON.stringify(n)}(e);var n}function CP(e){return{google_app_id:tP(e),app_instance_id:Hx,web_app_info:{sdk_version:Mx,page_url:Gx.getInstance().getUrl(),service_worker_status:null!=(t=Gx.getInstance().navigator)&&t.serviceWorker?t.serviceWorker.controller?2:3:1,visibility_state:eP(),effective_connection_type:function(){var e=Gx.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}const SP=["_fp","_fcp","_fid"];class NP{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=Gx.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${Lx}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Kx.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Kx.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),TP(this)}record(e,t,n){if(e<=0)throw Kx.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Kx.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));TP(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=e,i=this.name,0===r.length||100<r.length||!(i&&i.startsWith("_wt_")&&-1<SP.indexOf(r))&&r.startsWith("_"))throw Kx.create("invalid custom metric name",{customMetricName:e});var n,r,i;this.counters[e]=(t=null!=t?t:0,(n=Math.floor(t))<t&&$x.info(`Metric value should be an Integer, setting the value as : ${n}.`),n)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!Jx.some(e=>n.startsWith(e))&&!!n.match(Zx)),s=0!==(r=t).length&&r.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw Kx.create("invalid attribute name",{attributeName:e});if(!s)throw Kx.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=Gx.getInstance().getUrl();if(i){const s=new NP(e,"_wt_"+i,!0);i=Math.floor(1e3*Gx.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),TP(s)}}static createUserTimingTrace(e,t){TP(new NP(e,t,!1,t))}}function AP(e,t){const n=t;var r,i,s;n&&void 0!==n.responseStart&&(s=Gx.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+s)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,s=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=Xx.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>IP(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:s}))}const RP=5e3;function DP(e){Hx&&(setTimeout(()=>function(n){const e=Gx.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{NP.createOobTrace(n,r,i),t=void 0},RP);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),NP.createOobTrace(n,r,i,e))})}else NP.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=Gx.getInstance(),n=e.getEntriesByType("resource");for(const r of n)AP(t,r);e.setupObserver("resource",e=>AP(t,e))}(e),0),setTimeout(()=>function(t){const e=Gx.getInstance(),n=e.getEntriesByType("measure");for(const r of n)xP(t,r);e.setupObserver("measure",e=>xP(t,e))}(e),0))}function xP(e,t){const n=t.name;n.substring(0,Lx.length)!==Lx&&NP.createUserTimingTrace(e,n)}class PP{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),Gx.getInstance().requiredApisAvailable()?N().then(e=>{e&&(yP||(_P(5500),yP=!0),hP(this).then(()=>DP(this),()=>DP(this)),this.initialized=!0)}).catch(e=>{$x.info(`Environment doesn't support IndexedDB: ${e}`)}):$x.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){Xx.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return Xx.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){Xx.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return Xx.getInstance().dataCollectionEnabled}}const OP="[DEFAULT]";const MP=(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(n.name!==OP)throw Kx.create("FB not default");if("undefined"==typeof window)throw Kx.create("no window");e=window,Wx=e;const i=new PP(n,r);return i._init(t),i};We(new oe("performance",MP,"PUBLIC")),et(Px,Ox),et(Px,Ox,"esm2017");class LP{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=ae(t),new NP(t,e);var t}}function FP(e){var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("performance").getImmediate();return new LP(t,n)}(Vx=wt).INTERNAL.registerComponent(new oe("performance-compat",FP,"PUBLIC")),Vx.registerVersion("@firebase/performance-compat","0.2.4");const UP="@firebase/remote-config";class qP{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const VP=new D("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});const BP=["1","true","t","yes","y","on"];class jP{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=BP.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function KP(e){const t=ae(e);var[n,r]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==r)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function $P(e){const t=ae(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function zP(t){const n=ae(t),e=new qP;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){var r=(i="fetch-throttle",(t=e)instanceof R&&-1!==t.code.indexOf(i)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var i}function WP(n){const e=ae(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=GP(n,t),e),{});var t,r}function GP(e,t){const n=ae(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");var r=n._storageCache.getActiveConfig();return r&&void 0!==r[t]?new jP("remote",r[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new jP("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new jP("static"))}class HP{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r}.`),r}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class QP{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var e,[t,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:r,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([i,r]),a=await i}catch(e){let t="fetch-client-network";throw"AbortError"===(null==e?void 0:e.name)&&(t="fetch-timeout"),VP.create(t,{originalErrorMessage:null==e?void 0:e.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let c,l;if(200===a.status){let e;try{e=await a.json()}catch(e){throw VP.create("fetch-client-parse",{originalErrorMessage:null==e?void 0:e.message})}c=e.entries,l=e.state}if("INSTANCE_STATE_UNSPECIFIED"===l?o=500:"NO_CHANGE"===l?o=304:"NO_TEMPLATE"!==l&&"EMPTY_CONFIG"!==l||(c={}),304!==o&&200!==o)throw VP.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:c}}}class YP{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(VP.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof R&&e.customData){var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}}(e))throw e;r={throttleEndTimeMillis:Date.now()+se(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(t,r)}}}class XP{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function JP(e,t){var n=e.target.error||void 0;return VP.create(t,{originalErrorMessage:n&&(null==n?void 0:n.message)})}const ZP="app_namespace_store";class eO{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(JP(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(ZP,{keyPath:"compositeKey"})}}catch(e){n(VP.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(a){const o=await this.openDbPromise;return new Promise((n,t)=>{const e=o.transaction([ZP],"readonly"),r=e.objectStore(ZP);var i=this.createCompositeKey(a);try{const s=r.get(i);s.onerror=e=>{t(JP(e,"storage-get"))},s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)}}catch(e){t(VP.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async set(a,o){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([ZP],"readwrite"),r=n.objectStore(ZP);var i=this.createCompositeKey(a);try{const s=r.put({compositeKey:i,value:o});s.onerror=e=>{t(JP(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(VP.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async delete(a){const o=await this.openDbPromise;return new Promise((e,t)=>{const n=o.transaction([ZP],"readwrite"),r=n.objectStore(ZP);var i=this.createCompositeKey(a);try{const s=r.delete(i);s.onerror=e=>{t(JP(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(VP.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class tO{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}async function nO(){if(!S())return!1;try{return await N()}catch(e){return!1}}We(new oe("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw VP.create("registration-window");if(!S())throw VP.create("indexed-db-unavailable");var{projectId:i,apiKey:s,appId:a}=n.options;if(!i)throw VP.create("registration-project-id");if(!s)throw VP.create("registration-api-key");if(!a)throw VP.create("registration-app-id");t=t||"firebase";const o=new eO(a,n.name,t),c=new tO(o),l=new me(UP);l.logLevel=m.ERROR;a=new QP(r,Ye,t,i,s,a),a=new YP(a,o),a=new HP(a,o,c,l),a=new XP(n,a,c,o,l);return $P(a),a},"PUBLIC").setMultipleInstances(!0)),et(UP,"0.4.4"),et(UP,"0.4.4","esm2017");class rO{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return KP(this._delegate)}ensureInitialized(){return $P(this._delegate)}fetch(){return zP(this._delegate)}fetchAndActivate(){return async function(e){return await zP(e=ae(e)),KP(e)}(this._delegate)}getAll(){return WP(this._delegate)}getBoolean(e){return GP(ae(this._delegate),e).asBoolean()}getNumber(e){return GP(ae(this._delegate),e).asNumber()}getString(e){return GP(ae(this._delegate),e).asString()}getValue(e){return GP(this._delegate,e)}setLogLevel(e){!function(e,t){const n=ae(e);switch(t){case"debug":n._logger.logLevel=m.DEBUG;break;case"silent":n._logger.logLevel=m.SILENT;break;default:n._logger.logLevel=m.ERROR}}(this._delegate,e)}}function iO(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("remote-config").getImmediate({identifier:t});return new rO(n,r)}return(Bx=wt).INTERNAL.registerComponent(new oe("remoteConfig-compat",iO,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:nO})),Bx.registerVersion("@firebase/remote-config-compat","0.2.4"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),wt.registerVersion("firebase","9.17.2","compat-cdn"),wt});
//# sourceMappingURL=firebase-compat.js.map
