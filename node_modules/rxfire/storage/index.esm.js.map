{"version":3,"file":"index.esm.js","sources":["../../storage/index.ts"],"sourcesContent":["import { getDownloadURL as _getDownloadURL, getMetadata as _getMetadata, uploadBytesResumable as _uploadBytesResumable, uploadString as _uploadString, } from 'firebase/storage';\nimport { Observable, from } from 'rxjs';\nimport { debounceTime, map, shareReplay } from 'rxjs/operators';\nexport function fromTask(task) {\n    return new Observable(function (subscriber) {\n        var progress = function (snap) { return subscriber.next(snap); };\n        var error = function (e) { return subscriber.error(e); };\n        var complete = function () { return subscriber.complete(); };\n        // emit the current state of the task\n        progress(task.snapshot);\n        // emit progression of the task\n        var unsubscribeFromOnStateChanged = task.on('state_changed', progress);\n        // use the promise form of task, to get the last success snapshot\n        task.then(function (snapshot) {\n            progress(snapshot);\n            setTimeout(function () { return complete(); }, 0);\n        }, function (e) {\n            progress(task.snapshot);\n            setTimeout(function () { return error(e); }, 0);\n        });\n        // the unsubscribe method returns by storage isn't typed in the\n        // way rxjs expects, Function vs () => void, so wrap it\n        return function unsubscribe() {\n            unsubscribeFromOnStateChanged();\n        };\n    }).pipe(\n    // since we're emitting first the current snapshot and then progression\n    // it's possible that we could double fire synchronously; namely when in\n    // a terminal state (success, error, canceled). Debounce to address.\n    debounceTime(0));\n}\nexport function getDownloadURL(ref) {\n    return from(_getDownloadURL(ref));\n}\n// TODO: fix storage typing in firebase, then apply the same fix here\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function getMetadata(ref) {\n    return from(_getMetadata(ref));\n}\n// MARK: Breaking change (renaming put to uploadBytesResumable)\nexport function uploadBytesResumable(ref, data, metadata) {\n    return new Observable(function (subscriber) {\n        var task = _uploadBytesResumable(ref, data, metadata);\n        var subscription = fromTask(task).subscribe(subscriber);\n        return function unsubscribe() {\n            subscription.unsubscribe();\n            task.cancel();\n        };\n    }).pipe(shareReplay({ bufferSize: 1, refCount: true }));\n}\n// MARK: Breaking change (renaming put to uploadString)\nexport function uploadString(ref, data, format, metadata) {\n    return from(_uploadString(ref, data, format, metadata));\n}\nexport function percentage(task) {\n    return fromTask(task).pipe(map(function (snapshot) { return ({\n        progress: (snapshot.bytesTransferred / snapshot.totalBytes) * 100,\n        snapshot: snapshot\n    }); }));\n}\n"],"names":["_getDownloadURL","_getMetadata","_uploadBytesResumable","_uploadString"],"mappings":"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"}