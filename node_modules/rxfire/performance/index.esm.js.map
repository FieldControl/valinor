{"version":3,"file":"index.esm.js","sources":["../../performance/index.ts"],"sourcesContent":["import { EMPTY, from, Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\n/**\n * Lazy loads Firebase Performance monitoring and returns the instance as\n * an observable\n * @param app\n * @returns Observable<FirebasePerformance>\n */\nexport var getPerformance$ = function (app) { return from(import('firebase/performance').then(function (module) { return module.getPerformance(app); })); };\n/**\n * Creates an observable that begins a trace with a given id. The trace is ended\n * when the observable unsubscribes. The measurement is also logged as a performance\n * entry.\n * @param traceId\n * @returns Observable<void>\n */\nvar trace$ = function (traceId) {\n    if (typeof window !== 'undefined' && window.performance) {\n        var entries = window.performance.getEntriesByName(traceId, 'measure') || [];\n        var startMarkName_1 = \"_\" + traceId + \"Start[\" + entries.length + \"]\";\n        var endMarkName_1 = \"_\" + traceId + \"End[\" + entries.length + \"]\";\n        return new Observable(function (emitter) {\n            window.performance.mark(startMarkName_1);\n            emitter.next();\n            return {\n                unsubscribe: function () {\n                    window.performance.mark(endMarkName_1);\n                    window.performance.measure(traceId, startMarkName_1, endMarkName_1);\n                }\n            };\n        });\n    }\n    else {\n        return EMPTY;\n    }\n};\n/**\n * Creates a function that creates an observable that begins a trace with a given id. The trace is ended\n * when the observable unsubscribes. The measurement is also logged as a performance\n * entry.\n * @param name\n * @returns (source$: Observable<T>) => Observable<T>\n */\nexport var trace = function (name) { return function (source$) { return new Observable(function (subscriber) {\n    var traceSubscription = trace$(name).subscribe();\n    return source$.pipe(tap(function () { return traceSubscription.unsubscribe(); }, function () {\n    }, function () { return traceSubscription.unsubscribe(); })).subscribe(subscriber);\n}); }; };\n/**\n * Creates a function that creates an observable that begins a trace with a given name. The trace runs until\n * a condition resolves to true and then the observable unsubscribes and ends the trace.\n * @param name\n * @param test\n * @param options\n * @returns (source$: Observable<T>) => Observable<T>\n */\nexport var traceUntil = function (name, test, options) { return function (source$) { return new Observable(function (subscriber) {\n    var traceSubscription = trace$(name).subscribe();\n    return source$.pipe(tap(function (a) { return test(a) && traceSubscription.unsubscribe(); }, function () {\n    }, function () { return options && options.orComplete && traceSubscription.unsubscribe(); })).subscribe(subscriber);\n}); }; };\n/**\n * Creates a function that creates an observable that begins a trace with a given name. The trace runs while\n * a condition resolves to true. Once the condition fails the observable unsubscribes\n * and ends the trace.\n * @param name\n * @param test\n * @param options\n * @returns (source$: Observable<T>) => Observable<T>\n */\nexport var traceWhile = function (name, test, options) { return function (source$) { return new Observable(function (subscriber) {\n    var traceSubscription;\n    return source$.pipe(tap(function (a) {\n        if (test(a)) {\n            traceSubscription = traceSubscription || trace$(name).subscribe();\n        }\n        else {\n            if (traceSubscription) {\n                traceSubscription.unsubscribe();\n            }\n            traceSubscription = undefined;\n        }\n    }, function () {\n    }, function () { return options && options.orComplete && traceSubscription && traceSubscription.unsubscribe(); })).subscribe(subscriber);\n}); }; };\n/**\n * Creates a function that creates an observable that begins a trace with a given name. The trace runs until the\n * observable fully completes.\n * @param name\n * @returns (source$: Observable<T>) => Observable<T>\n */\nexport var traceUntilComplete = function (name) { return function (source$) { return new Observable(function (subscriber) {\n    var traceSubscription = trace$(name).subscribe();\n    return source$.pipe(tap(function () {\n    }, function () {\n    }, function () { return traceSubscription.unsubscribe(); })).subscribe(subscriber);\n}); }; };\n/**\n * Creates a function that creates an observable that begins a trace with a given name.\n * The trace runs until the first value emits from the provided observable.\n * @param name\n * @returns (source$: Observable<T>) => Observable<T>\n */\nexport var traceUntilFirst = function (name) { return function (source$) { return new Observable(function (subscriber) {\n    var traceSubscription = trace$(name).subscribe();\n    return source$.pipe(tap(function () { return traceSubscription.unsubscribe(); }, function () {\n    }, function () {\n    })).subscribe(subscriber);\n}); }; };\n"],"names":[],"mappings":"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"}