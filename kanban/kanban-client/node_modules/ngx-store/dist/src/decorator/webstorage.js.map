{"version":3,"sources":["../../../src/decorator/webstorage.ts"],"names":[],"mappings":"AAAA,OAAO,EACH,qBAAqB,EACrB,mBAAmB,EACnB,qBAAqB,EAExB,MAAM,YAAY,CAAC;AACpB,OAAO,EAAE,qBAAqB,EAAE,mBAAmB,EAAE,qBAAqB,EAAE,oBAAoB,EAAE,MAAM,YAAY,CAAC;AACrH,OAAO,EAAE,oBAAoB,EAAE,MAAM,mCAAmC,CAAC;AAEzE,OAAO,EAAE,KAAK,EAAE,MAAM,SAAS,CAAC;AAiBhC,MAAM,uBAAuB,WAAkD,EAClD,MAAoC;IAC7D,MAAM,CAAC,UAAU,CAAC,mBAAmB,EAAE,mBAAmB,EAAE,WAAW,EAAE,MAAM,CAAC,CAAC;AACrF,CAAC;AACD,MAAM,yBAAyB,WAAoD,EACpD,MAAsC;IACjE,MAAM,CAAC,UAAU,CAAC,qBAAqB,EAAE,qBAAqB,EAAE,WAAW,EAAE,MAAM,CAAC,CAAC;AACzF,CAAC;AACD,MAAM,wBAAwB,WAAmD,EACnD,MAAqC;IAC/D,MAAM,CAAC,UAAU,CAAC,qBAAqB,EAAE,qBAAqB,EAAE,WAAW,EAAE,MAAM,CAAC,CAAC;AACzF,CAAC;AACD,MAAM,wBAAwB,WAAgD,EAChD,MAAkC;IAC5D,MAAM,CAAC,UAAU,CAAC,oBAAoB,EAAE,oBAAoB,EAAE,WAAW,EAAE,MAAM,CAAC,CAAC;AACvF,CAAC;AAED,oBACI,iBAAoC,EACpC,OAAmC,EACnC,WAAqC,EACrC,MAA4B;IAA5B,uBAAA,EAAA,WAA4B;IAE5B,MAAM,CAAC,UAAC,MAAW,EAAE,YAAoB;QACrC,IAAI,GAAG,CAAC;QACR,EAAE,CAAC,CAAC,OAAO,WAAW,KAAK,QAAQ,CAAC,CAAC,CAAC;YAClC,GAAG,GAAG,WAAW,CAAC,GAAG,CAAC;YACtB,MAAM,GAAG,WAAW,CAAC;QACzB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,WAAW,KAAK,QAAQ,CAAC,CAAC,CAAC;YACzC,GAAG,GAAG,WAAW,CAAC;QACtB,CAAC;QACD,GAAG,GAAG,GAAG,IAAI,MAAM,CAAC,GAAG,IAAI,YAAY,CAAC;QAExC,IAAI,SAAS,GAAG,KAAK,CAAC,WAAW,CAAC;YAC9B,GAAG,EAAE,GAAG;YACR,IAAI,EAAE,YAAY;YAClB,OAAO,EAAE,CAAE,MAAM,CAAE;YACnB,QAAQ,EAAE,CAAE,OAAO,CAAE;YACrB,SAAS,EAAE,CAAE,iBAAiB,CAAE;SACnC,CAAC,CAAC;QAEH,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,YAAY,EAAE;YACxC,GAAG,EAAE;gBACD,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;YACjD,CAAC;YACD,GAAG,EAAE,UAAS,KAAU;gBACpB,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC5B,SAAS,GAAG,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;gBAC7C,CAAC;gBACD,SAAS,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC/B,SAAS,CAAC,aAAa,GAAG,MAAM,CAAC;gBACjC,SAAS,CAAC,SAAS,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;YACvC,CAAC;SACJ,CAAC,CAAC;QACH,MAAM,CAAC,MAAM,CAAC;IAClB,CAAC,CAAA;AACL,CAAC","file":"webstorage.js","sourceRoot":"","sourcesContent":["import {\n    CookiesStorageService,\n    LocalStorageService,\n    SessionStorageService,\n    WebStorageServiceInterface\n} from '../service';\nimport { cookiesStorageUtility, localStorageUtility, sessionStorageUtility, sharedStorageUtility } from '../utility';\nimport { SharedStorageService } from '../service/shared-storage.service';\nimport { WebStorageUtility } from '../utility/webstorage-utility';\nimport { Cache } from './cache';\n\n// TODO: consider adding 'readonly' property\nexport interface WebStorageDecoratorConfig {\n    key?: string;\n}\nexport interface StorageDecoratorConfig extends WebStorageDecoratorConfig {\n    prefix?: string;\n    mutate?: boolean;\n}\nexport interface LocalStorageDecoratorConfig extends StorageDecoratorConfig { }\nexport interface SessionStorageDecoratorConfig extends StorageDecoratorConfig { }\nexport interface CookieStorageDecoratorConfig extends StorageDecoratorConfig {\n    expires?: Date;\n}\nexport type DecoratorConfig = CookieStorageDecoratorConfig; // should contain all fields\n\nexport function LocalStorage(keyOrConfig?: string | LocalStorageDecoratorConfig,\n                             config?: LocalStorageDecoratorConfig) {\n    return WebStorage(localStorageUtility, LocalStorageService, keyOrConfig, config);\n}\nexport function SessionStorage(keyOrConfig?: string | SessionStorageDecoratorConfig,\n                               config?: SessionStorageDecoratorConfig) {\n    return WebStorage(sessionStorageUtility, SessionStorageService, keyOrConfig, config);\n}\nexport function CookieStorage(keyOrConfig?: string | CookieStorageDecoratorConfig,\n                              config?: CookieStorageDecoratorConfig) {\n    return WebStorage(cookiesStorageUtility, CookiesStorageService, keyOrConfig, config);\n}\nexport function SharedStorage(keyOrConfig?: string | WebStorageDecoratorConfig,\n                              config?: WebStorageDecoratorConfig) {\n    return WebStorage(sharedStorageUtility, SharedStorageService, keyOrConfig, config);\n}\n\nfunction WebStorage(\n    webStorageUtility: WebStorageUtility,\n    service: WebStorageServiceInterface,\n    keyOrConfig: string | DecoratorConfig,\n    config: DecoratorConfig = {}\n) {\n    return (target: any, propertyName: string): void => {\n        let key;\n        if (typeof keyOrConfig === 'object') {\n            key = keyOrConfig.key;\n            config = keyOrConfig;\n        } else if (typeof keyOrConfig === 'string') {\n            key = keyOrConfig;\n        }\n        key = key || config.key || propertyName;\n\n        let cacheItem = Cache.getCacheFor({\n            key: key,\n            name: propertyName,\n            targets: [ target ],\n            services: [ service ],\n            utilities: [ webStorageUtility ]\n        });\n\n        Object.defineProperty(target, propertyName, {\n            get: function() {\n                return cacheItem.getProxy(undefined, config);\n            },\n            set: function(value: any) {\n                if (!Cache.get(cacheItem.key)) {\n                    cacheItem = Cache.getCacheFor(cacheItem);\n                }\n                cacheItem.addTargets([target]);\n                cacheItem.currentTarget = target;\n                cacheItem.saveValue(value, config);\n            },\n        });\n        return target;\n    }\n}\n"]}