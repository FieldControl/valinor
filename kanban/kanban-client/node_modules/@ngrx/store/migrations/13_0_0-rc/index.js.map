{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../modules/store/migrations/13_0_0-rc/index.ts"],"names":[],"mappings":"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","sourcesContent":["import * as ts from 'typescript';\nimport { Rule, chain, Tree } from '@angular-devkit/schematics';\nimport {\n  visitTSSourceFiles,\n  RemoveChange,\n  commitChanges,\n  InsertChange,\n} from '../../schematics-core';\n\nfunction updateCreateSelectorGenerics(): Rule {\n  return (tree: Tree) => {\n    visitTSSourceFiles(tree, (sourceFile) => {\n      const runMigration = sourceFile.statements\n        .filter(ts.isImportDeclaration)\n        .filter(\n          (importDeclaration) =>\n            importDeclaration.moduleSpecifier.getText(sourceFile) ===\n              \"'@ngrx/store'\" ||\n            importDeclaration.moduleSpecifier.getText(sourceFile) ===\n              '\"@ngrx/store\"'\n        )\n        .some((importDeclaration) => {\n          return importDeclaration.importClause?.namedBindings\n            ?.getText(sourceFile)\n            .includes('createSelector');\n        });\n\n      if (!runMigration) return;\n\n      const changes: (RemoveChange | InsertChange)[] = [];\n      ts.forEachChild(sourceFile, crawl);\n      return commitChanges(tree, sourceFile.fileName, changes);\n\n      function crawl(node: ts.Node) {\n        ts.forEachChild(node, crawl);\n\n        if (!ts.isCallExpression(node)) return;\n\n        const { typeArguments } = node;\n\n        if (!typeArguments?.length) return;\n        const typeArgumentsLength = typeArguments?.length;\n        if (typeArgumentsLength < 3) return;\n        if (!ts.isIdentifier(node.expression)) return;\n        if (node.expression.text !== 'createSelector') return;\n\n        const lastTypeArgumentIndex = typeArgumentsLength - 1;\n        const slicesTypeArguments = typeArguments.slice(\n          1,\n          lastTypeArgumentIndex\n        );\n        const updatedTypeArguments = [\n          typeArguments[0],\n          slicesTypeArguments,\n          typeArguments[lastTypeArgumentIndex],\n        ];\n\n        const isSelectorWithProps =\n          node.arguments.length === typeArguments.length - 2;\n        if (isSelectorWithProps) return;\n\n        const newTypeArguments = updatedTypeArguments\n          .map((arg) =>\n            Array.isArray(arg)\n              ? `[${arg.map((a) => a.getText(sourceFile)).join(',')}]`\n              : arg.getText(sourceFile)\n          )\n          .join(',');\n\n        changes.push(\n          new RemoveChange(\n            sourceFile.fileName,\n            typeArguments.pos,\n            typeArguments?.end\n          ),\n          new InsertChange(\n            sourceFile.fileName,\n            typeArguments.pos,\n            newTypeArguments\n          )\n        );\n      }\n    });\n  };\n}\n\nexport default function (): Rule {\n  return chain([updateCreateSelectorGenerics]);\n}\n"]}