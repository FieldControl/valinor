import { ENVIRONMENT_INITIALIZER, Inject, inject, InjectionToken, makeEnvironmentProviders, } from '@angular/core';
import { combineReducers, createReducerFactory } from './utils';
import { _ACTION_TYPE_UNIQUENESS_CHECK, _FEATURE_CONFIGS, _FEATURE_REDUCERS, _FEATURE_REDUCERS_TOKEN, _INITIAL_REDUCERS, _INITIAL_STATE, _REDUCER_FACTORY, _RESOLVED_META_REDUCERS, _ROOT_STORE_GUARD, _STORE_FEATURES, _STORE_REDUCERS, FEATURE_REDUCERS, FEATURE_STATE_PROVIDER, INITIAL_REDUCERS, INITIAL_STATE, META_REDUCERS, REDUCER_FACTORY, ROOT_STORE_PROVIDER, STORE_FEATURES, USER_PROVIDED_META_REDUCERS, } from './tokens';
import { ACTIONS_SUBJECT_PROVIDERS, ActionsSubject } from './actions_subject';
import { REDUCER_MANAGER_PROVIDERS, ReducerManager, ReducerObservable, } from './reducer_manager';
import { SCANNED_ACTIONS_SUBJECT_PROVIDERS, ScannedActionsSubject, } from './scanned_actions_subject';
import { STATE_PROVIDERS } from './state';
import { Store, STORE_PROVIDERS } from './store';
import { checkForActionTypeUniqueness, provideRuntimeChecks, } from './runtime_checks';
import { _concatMetaReducers, _createFeatureReducers, _createFeatureStore, _createStoreReducers, _initialStateFactory, _provideForRootGuard, } from './store_config';
/**
 * Provides additional slices of state in the Store.
 * These providers cannot be used at the component level.
 *
 * @usageNotes
 *
 * ### Providing Store Features
 *
 * ```ts
 * const booksRoutes: Route[] = [
 *   {
 *     path: '',
 *     providers: [provideState('books', booksReducer)],
 *     children: [
 *       { path: '', component: BookListComponent },
 *       { path: ':id', component: BookDetailsComponent },
 *     ],
 *   },
 * ];
 * ```
 */
export function provideState(featureNameOrSlice, reducers, config = {}) {
    return makeEnvironmentProviders([
        ..._provideState(featureNameOrSlice, reducers, config),
        ENVIRONMENT_STATE_PROVIDER,
    ]);
}
export function _provideStore(reducers = {}, config = {}) {
    return [
        {
            provide: _ROOT_STORE_GUARD,
            useFactory: _provideForRootGuard,
        },
        { provide: _INITIAL_STATE, useValue: config.initialState },
        {
            provide: INITIAL_STATE,
            useFactory: _initialStateFactory,
            deps: [_INITIAL_STATE],
        },
        { provide: _INITIAL_REDUCERS, useValue: reducers },
        {
            provide: _STORE_REDUCERS,
            useExisting: reducers instanceof InjectionToken ? reducers : _INITIAL_REDUCERS,
        },
        {
            provide: INITIAL_REDUCERS,
            deps: [_INITIAL_REDUCERS, [new Inject(_STORE_REDUCERS)]],
            useFactory: _createStoreReducers,
        },
        {
            provide: USER_PROVIDED_META_REDUCERS,
            useValue: config.metaReducers ? config.metaReducers : [],
        },
        {
            provide: _RESOLVED_META_REDUCERS,
            deps: [META_REDUCERS, USER_PROVIDED_META_REDUCERS],
            useFactory: _concatMetaReducers,
        },
        {
            provide: _REDUCER_FACTORY,
            useValue: config.reducerFactory ? config.reducerFactory : combineReducers,
        },
        {
            provide: REDUCER_FACTORY,
            deps: [_REDUCER_FACTORY, _RESOLVED_META_REDUCERS],
            useFactory: createReducerFactory,
        },
        ACTIONS_SUBJECT_PROVIDERS,
        REDUCER_MANAGER_PROVIDERS,
        SCANNED_ACTIONS_SUBJECT_PROVIDERS,
        STATE_PROVIDERS,
        STORE_PROVIDERS,
        provideRuntimeChecks(config.runtimeChecks),
        checkForActionTypeUniqueness(),
    ];
}
function rootStoreProviderFactory() {
    inject(ActionsSubject);
    inject(ReducerObservable);
    inject(ScannedActionsSubject);
    inject(Store);
    inject(_ROOT_STORE_GUARD, { optional: true });
    inject(_ACTION_TYPE_UNIQUENESS_CHECK, { optional: true });
}
/**
 * Environment Initializer used in the root
 * providers to initialize the Store
 */
const ENVIRONMENT_STORE_PROVIDER = [
    { provide: ROOT_STORE_PROVIDER, useFactory: rootStoreProviderFactory },
    {
        provide: ENVIRONMENT_INITIALIZER,
        multi: true,
        useFactory() {
            return () => inject(ROOT_STORE_PROVIDER);
        },
    },
];
/**
 * Provides the global Store providers and initializes
 * the Store.
 * These providers cannot be used at the component level.
 *
 * @usageNotes
 *
 * ### Providing the Global Store
 *
 * ```ts
 * bootstrapApplication(AppComponent, {
 *   providers: [provideStore()],
 * });
 * ```
 */
export function provideStore(reducers, config) {
    return makeEnvironmentProviders([
        ..._provideStore(reducers, config),
        ENVIRONMENT_STORE_PROVIDER,
    ]);
}
function featureStateProviderFactory() {
    inject(ROOT_STORE_PROVIDER);
    const features = inject(_STORE_FEATURES);
    const featureReducers = inject(FEATURE_REDUCERS);
    const reducerManager = inject(ReducerManager);
    inject(_ACTION_TYPE_UNIQUENESS_CHECK, { optional: true });
    const feats = features.map((feature, index) => {
        const featureReducerCollection = featureReducers.shift();
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        const reducers = featureReducerCollection /*TODO(#823)*/[index];
        return {
            ...feature,
            reducers,
            initialState: _initialStateFactory(feature.initialState),
        };
    });
    reducerManager.addFeatures(feats);
}
/**
 * Environment Initializer used in the feature
 * providers to register state features
 */
const ENVIRONMENT_STATE_PROVIDER = [
    {
        provide: FEATURE_STATE_PROVIDER,
        useFactory: featureStateProviderFactory,
    },
    {
        provide: ENVIRONMENT_INITIALIZER,
        multi: true,
        useFactory() {
            return () => inject(FEATURE_STATE_PROVIDER);
        },
    },
];
export function _provideState(featureNameOrSlice, reducers, config = {}) {
    return [
        {
            provide: _FEATURE_CONFIGS,
            multi: true,
            useValue: featureNameOrSlice instanceof Object ? {} : config,
        },
        {
            provide: STORE_FEATURES,
            multi: true,
            useValue: {
                key: featureNameOrSlice instanceof Object
                    ? featureNameOrSlice.name
                    : featureNameOrSlice,
                reducerFactory: !(config instanceof InjectionToken) && config.reducerFactory
                    ? config.reducerFactory
                    : combineReducers,
                metaReducers: !(config instanceof InjectionToken) && config.metaReducers
                    ? config.metaReducers
                    : [],
                initialState: !(config instanceof InjectionToken) && config.initialState
                    ? config.initialState
                    : undefined,
            },
        },
        {
            provide: _STORE_FEATURES,
            deps: [_FEATURE_CONFIGS, STORE_FEATURES],
            useFactory: _createFeatureStore,
        },
        {
            provide: _FEATURE_REDUCERS,
            multi: true,
            useValue: featureNameOrSlice instanceof Object
                ? featureNameOrSlice.reducer
                : reducers,
        },
        {
            provide: _FEATURE_REDUCERS_TOKEN,
            multi: true,
            useExisting: reducers instanceof InjectionToken ? reducers : _FEATURE_REDUCERS,
        },
        {
            provide: FEATURE_REDUCERS,
            multi: true,
            deps: [_FEATURE_REDUCERS, [new Inject(_FEATURE_REDUCERS_TOKEN)]],
            useFactory: _createFeatureReducers,
        },
        checkForActionTypeUniqueness(),
    ];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvdmlkZV9zdG9yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL21vZHVsZXMvc3RvcmUvc3JjL3Byb3ZpZGVfc3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUV2QixNQUFNLEVBQ04sTUFBTSxFQUNOLGNBQWMsRUFDZCx3QkFBd0IsR0FFekIsTUFBTSxlQUFlLENBQUM7QUFPdkIsT0FBTyxFQUFFLGVBQWUsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNoRSxPQUFPLEVBQ0wsNkJBQTZCLEVBQzdCLGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixjQUFjLEVBQ2QsZ0JBQWdCLEVBQ2hCLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsZUFBZSxFQUNmLGVBQWUsRUFDZixnQkFBZ0IsRUFDaEIsc0JBQXNCLEVBQ3RCLGdCQUFnQixFQUNoQixhQUFhLEVBQ2IsYUFBYSxFQUNiLGVBQWUsRUFDZixtQkFBbUIsRUFDbkIsY0FBYyxFQUNkLDJCQUEyQixHQUM1QixNQUFNLFVBQVUsQ0FBQztBQUNsQixPQUFPLEVBQUUseUJBQXlCLEVBQUUsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDOUUsT0FBTyxFQUNMLHlCQUF5QixFQUN6QixjQUFjLEVBQ2QsaUJBQWlCLEdBQ2xCLE1BQU0sbUJBQW1CLENBQUM7QUFDM0IsT0FBTyxFQUNMLGlDQUFpQyxFQUNqQyxxQkFBcUIsR0FDdEIsTUFBTSwyQkFBMkIsQ0FBQztBQUNuQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ2pELE9BQU8sRUFDTCw0QkFBNEIsRUFDNUIsb0JBQW9CLEdBQ3JCLE1BQU0sa0JBQWtCLENBQUM7QUFDMUIsT0FBTyxFQUNM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QUMsQ0FBQyxNQUFNLENBQUMsWUFBWTtvQkFDckIsQ0FBQyxDQUFDLFNBQVM7YUFDaEI7U0FDRjtRQUNEO1lBQ0UsT0FBTyxFQUFFLGVBQWU7WUFDeEIsSUFBSSxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsY0FBYyxDQUFDO1lBQ3hDLFVBQVUsRUFBRSxtQkFBbUI7U0FDaEM7UUFDRDtZQUNFLE9BQU8sRUFBRSxpQkFBaUI7WUFDMUIsS0FBSyxFQUFFLElBQUk7WUFDWCxRQUFRLEVBQ04sa0JBQWtCLFlBQVksTUFBTTtnQkFDbEMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLE9BQU87Z0JBQzVCLENBQUMsQ0FBQyxRQUFRO1NBQ2Y7UUFDRDtZQUNFLE9BQU8sRUFBRSx1QkFBdUI7WUFDaEMsS0FBSyxFQUFFLElBQUk7WUFDWCxXQUFXLEVBQ1QsUUFBUSxZQUFZLGNBQWMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxpQkFBaUI7U0FDcEU7UUFDRDtZQUNFLE9BQU8sRUFBRSxnQkFBZ0I7WUFDekIsS0FBSyxFQUFFLElBQUk7WUFDWCxJQUFJLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLElBQUksTUFBTSxDQUFDLHVCQUF1QixDQUFDLENBQUMsQ0FBQztZQUNoRSxVQUFVLEVBQUUsc0JBQXNCO1NBQ25DO1FBQ0QsNEJBQTRCLEVBQUU7S0FDL0IsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBFTlZJUk9OTUVOVF9JTklUSUFMSVpFUixcbiAgRW52aXJvbm1lbnRQcm92aWRlcnMsXG4gIEluamVjdCxcbiAgaW5qZWN0LFxuICBJbmplY3Rpb25Ub2tlbixcbiAgbWFrZUVudmlyb25tZW50UHJvdmlkZXJzLFxuICBQcm92aWRlcixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBBY3Rpb24sXG4gIEFjdGlvblJlZHVjZXIsXG4gIEFjdGlvblJlZHVjZXJNYXAsXG4gIFN0b3JlRmVhdHVyZSxcbn0gZnJvbSAnLi9tb2RlbHMnO1xuaW1wb3J0IHsgY29tYmluZVJlZHVjZXJzLCBjcmVhdGVSZWR1Y2VyRmFjdG9yeSB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHtcbiAgX0FDVElPTl9UWVBFX1VOSVFVRU5FU1NfQ0hFQ0ssXG4gIF9GRUFUVVJFX0NPTkZJR1MsXG4gIF9GRUFUVVJFX1JFRFVDRVJTLFxuICBfRkVBVFVSRV9SRURVQ0VSU19UT0tFTixcbiAgX0lOSVRJQUxfUkVEVUNFUlMsXG4gIF9JTklUSUFMX1NUQVRFLFxuICBfUkVEVUNFUl9GQUNUT1JZLFxuICBfUkVTT0xWRURfTUVUQV9SRURVQ0VSUyxcbiAgX1JPT1RfU1RPUkVfR1VBUkQsXG4gIF9TVE9SRV9GRUFUVVJFUyxcbiAgX1NUT1JFX1JFRFVDRVJTLFxuICBGRUFUVVJFX1JFRFVDRVJTLFxuICBGRUFUVVJFX1NUQVRFX1BST1ZJREVSLFxuICBJTklUSUFMX1JFRFVDRVJTLFxuICBJTklUSUFMX1NUQVRFLFxuICBNRVRBX1JFRFVDRVJTLFxuICBSRURVQ0VSX0ZBQ1RPUlksXG4gIFJPT1RfU1RPUkVfUFJPVklERVIsXG4gIFNUT1JFX0ZFQVRVUkVTLFxuICBVU0VSX1BST1ZJREVEX01FVEFfUkVEVUNFUlMsXG59IGZyb20gJy4vdG9rZW5zJztcbmltcG9ydCB7IEFDVElPTlNfU1VCSkVDVF9QUk9WSURFUlMsIEFjdGlvbnNTdWJqZWN0IH0gZnJvbSAnLi9hY3Rpb25zX3N1YmplY3QnO1xuaW1wb3J0IHtcbiAgUkVEVUNFUl9NQU5BR0VSX1BST1ZJREVSUyxcbiAgUmVkdWNlck1hbmFnZXIsXG4gIFJlZHVjZXJPYnNlcnZhYmxlLFxufSBmcm9tICcuL3JlZHVjZXJfbWFuYWdlcic7XG5pbXBvcnQge1xuICBTQ0FOTkVEX0FDVElPTlNfU1VCSkVDVF9QUk9WSURFUlMsXG4gIFNjYW5uZWRBY3Rpb25zU3ViamVjdCxcbn0gZnJvbSAnLi9zY2FubmVkX2FjdGlvbnNfc3ViamVjdCc7XG5pbXBvcnQgeyBTVEFURV9QUk9WSURFUlMgfSBmcm9tICcuL3N0YXRlJztcbmltcG9ydCB7IFN0b3JlLCBTVE9SRV9QUk9WSURFUlMgfSBmcm9tICcuL3N0b3JlJztcbmltcG9ydCB7XG4gIGNoZWNrRm9yQWN0aW9uVHlwZVVuaXF1ZW5lc3MsXG4gIHByb3ZpZGVSdW50aW1lQ2hlY2tzLFxufSBmcm9tICcuL3J1bnRpbWVfY2hlY2tzJztcbmltcG9ydCB7XG4gIF9jb25jYXRNZXRhUmVkdWNlcnMsXG4gIF9jcmVhdGVGZWF0dXJlUmVkdWNlcnMsXG4gIF9jcmVhdGVGZWF0dXJlU3RvcmUsXG4gIF9jcmVhdGVTdG9yZVJlZHVjZXJzLFxuICBfaW5pdGlhbFN0YXRlRmFjdG9yeSxcbiAgX3Byb3ZpZGVGb3JSb290R3VhcmQsXG4gIEZlYXR1cmVTbGljZSxcbiAgUm9vdFN0b3JlQ29uZmlnLFxuICBTdG9yZUNvbmZpZyxcbn0gZnJvbSAnLi9zdG9yZV9jb25maWcnO1xuXG5leHBvcnQgZnVuY3Rpb24gcHJvdmlkZVN0YXRlPFQsIFYgZXh0ZW5kcyBBY3Rpb24gPSBBY3Rpb24+KFxuICBmZWF0dXJlTmFtZTogc3RyaW5nLFxuICByZWR1Y2VyczogQWN0aW9uUmVkdWNlck1hcDxULCBWPiB8IEluamVjdGlvblRva2VuPEFjdGlvblJlZHVjZXJNYXA8VCwgVj4+LFxuICBjb25maWc/OiBTdG9yZUNvbmZpZzxULCBWPiB8IEluamVjdGlvblRva2VuPFN0b3JlQ29uZmlnPFQsIFY+PlxuKTogRW52aXJvbm1lbnRQcm92aWRlcnM7XG5leHBvcnQgZnVuY3Rpb24gcHJvdmlkZVN0YXRlPFQsIFYgZXh0ZW5kcyBBY3Rpb24gPSBBY3Rpb24+KFxuICBmZWF0dXJlTmFtZTogc3RyaW5nLFxuICByZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPFQsIFY+IHwgSW5qZWN0aW9uVG9rZW48QWN0aW9uUmVkdWNlcjxULCBWPj4sXG4gIGNvbmZpZz86IFN0b3JlQ29uZmlnPFQsIFY+IHwgSW5qZWN0aW9uVG9rZW48U3RvcmVDb25maWc8VCwgVj4+XG4pOiBFbnZpcm9ubWVudFByb3ZpZGVycztcbmV4cG9ydCBmdW5jdGlvbiBwcm92aWRlU3RhdGU8VCwgViBleHRlbmRzIEFjdGlvbiA9IEFjdGlvbj4oXG4gIHNsaWNlOiBGZWF0dXJlU2xpY2U8VCwgVj5cbik6IEVudmlyb25tZW50UHJvdmlkZXJzO1xuLyoqXG4gKiBQcm92aWRlcyBhZGRpdGlvbmFsIHNsaWNlcyBvZiBzdGF0ZSBpbiB0aGUgU3RvcmUuXG4gKiBUaGVzZSBwcm92aWRlcnMgY2Fubm90IGJlIHVzZWQgYXQgdGhlIGNvbXBvbmVudCBsZXZlbC5cbiAqXG4gKiBAdXNhZ2VOb3Rlc1xuICpcbiAqICMjIyBQcm92aWRpbmcgU3RvcmUgRmVhdHVyZXNcbiAqXG4gKiBgYGB0c1xuICogY29uc3QgYm9va3NSb3V0ZXM6IFJvdXRlW10gPSBbXG4gKiAgIHtcbiAqICAgICBwYXRoOiAnJyxcbiAqICAgICBwcm92aWRlcnM6IFtwcm92aWRlU3RhdGUoJ2Jvb2tzJywgYm9va3NSZWR1Y2VyKV0sXG4gKiAgICAgY2hpbGRyZW46IFtcbiAqICAgICAgIHsgcGF0aDogJycsIGNvbXBvbmVudDogQm9va0xpc3RDb21wb25lbnQgfSxcbiAqICAgICAgIHsgcGF0aDogJzppZCcsIGNvbXBvbmVudDogQm9va0RldGFpbHNDb21wb25lbnQgfSxcbiAqICAgICBdLFxuICogICB9LFxuICogXTtcbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gcHJvdmlkZVN0YXRlPFQsIFYgZXh0ZW5kcyBBY3Rpb24gPSBBY3Rpb24+KFxuICBmZWF0dXJlTmFtZU9yU2xpY2U6IHN0cmluZyB8IEZlYXR1cmVTbGljZTxULCBWPixcbiAgcmVkdWNlcnM/OlxuICAgIHwgQWN0aW9uUmVkdWNlck1hcDxULCBWPlxuICAgIHwgSW5qZWN0aW9uVG9rZW48QWN0aW9uUmVkdWNlck1hcDxULCBWPj5cbiAgICB8IEFjdGlvblJlZHVjZXI8VCwgVj5cbiAgICB8IEluamVjdGlvblRva2VuPEFjdGlvblJlZHVjZXI8VCwgVj4+LFxuICBjb25maWc6IFN0b3JlQ29uZmlnPFQsIFY+IHwgSW5qZWN0aW9uVG9rZW48U3RvcmVDb25maWc8VCwgVj4+ID0ge31cbik6IEVudmlyb25tZW50UHJvdmlkZXJzIHtcbiAgcmV0dXJuIG1ha2VFbnZpcm9ubWVudFByb3ZpZGVycyhbXG4gICAgLi4uX3Byb3ZpZGVTdGF0ZShmZWF0dXJlTmFtZU9yU2xpY2UsIHJlZHVjZXJzLCBjb25maWcpLFxuICAgIEVOVklST05NRU5UX1NUQVRFX1BST1ZJREVSLFxuICBdKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9wcm92aWRlU3RvcmU8VCwgViBleHRlbmRzIEFjdGlvbiA9IEFjdGlvbj4oXG4gIHJlZHVjZXJzOlxuICAgIHwgQWN0aW9uUmVkdWNlck1hcDxULCBWPlxuICAgIHwgSW5qZWN0aW9uVG9rZW48QWN0aW9uUmVkdWNlck1hcDxULCBWPj5cbiAgICB8IFJlY29yZDxzdHJpbmcsIG5ldmVyPiA9IHt9LFxuICBjb25maWc6IFJvb3RTdG9yZUNvbmZpZzxULCBWPiA9IHt9XG4pOiBQcm92aWRlcltdIHtcbiAgcmV0dXJuIFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBfUk9PVF9TVE9SRV9HVUFSRCxcbiAgICAgIHVzZUZhY3Rvcnk6IF9wcm92aWRlRm9yUm9vdEd1YXJkLFxuICAgIH0sXG4gICAgeyBwcm92aWRlOiBfSU5JVElBTF9TVEFURSwgdXNlVmFsdWU6IGNvbmZpZy5pbml0aWFsU3RhdGUgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBJTklUSUFMX1NUQVRFLFxuICAgICAgdXNlRmFjdG9yeTogX2luaXRpYWxTdGF0ZUZhY3RvcnksXG4gICAgICBkZXBzOiBbX0lOSVRJQUxfU1RBVEVdLFxuICAgIH0sXG4gICAgeyBwcm92aWRlOiBfSU5JVElBTF9SRURVQ0VSUywgdXNlVmFsdWU6IHJlZHVjZXJzIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogX1NUT1JFX1JFRFVDRVJTLFxuICAgICAgdXNlRXhpc3Rpbmc6XG4gICAgICAgIHJlZHVjZXJzIGluc3RhbmNlb2YgSW5qZWN0aW9uVG9rZW4gPyByZWR1Y2VycyA6IF9JTklUSUFMX1JFRFVDRVJTLFxuICAgIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogSU5JVElBTF9SRURVQ0VSUyxcbiAgICAgIGRlcHM6IFtfSU5JVElBTF9SRURVQ0VSUywgW25ldyBJbmplY3QoX1NUT1JFX1JFRFVDRVJTKV1dLFxuICAgICAgdXNlRmFjdG9yeTogX2NyZWF0ZVN0b3JlUmVkdWNlcnMsXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBVU0VSX1BST1ZJREVEX01FVEFfUkVEVUNFUlMsXG4gICAgICB1c2VWYWx1ZTogY29uZmlnLm1ldGFSZWR1Y2VycyA/IGNvbmZpZy5tZXRhUmVkdWNlcnMgOiBbXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHByb3ZpZGU6IF9SRVNPTFZFRF9NRVRBX1JFRFVDRVJTLFxuICAgICAgZGVwczogW01FVEFfUkVEVUNFUlMsIFVTRVJfUFJPVklERURfTUVUQV9SRURVQ0VSU10sXG4gICAgICB1c2VGYWN0b3J5OiBfY29uY2F0TWV0YVJlZHVjZXJzLFxuICAgIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogX1JFRFVDRVJfRkFDVE9SWSxcbiAgICAgIHVzZVZhbHVlOiBjb25maWcucmVkdWNlckZhY3RvcnkgPyBjb25maWcucmVkdWNlckZhY3RvcnkgOiBjb21iaW5lUmVkdWNlcnMsXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBSRURVQ0VSX0ZBQ1RPUlksXG4gICAgICBkZXBzOiBbX1JFRFVDRVJfRkFDVE9SWSwgX1JFU09MVkVEX01FVEFfUkVEVUNFUlNdLFxuICAgICAgdXNlRmFjdG9yeTogY3JlYXRlUmVkdWNlckZhY3RvcnksXG4gICAgfSxcbiAgICBBQ1RJT05TX1NVQkpFQ1RfUFJPVklERVJTLFxuICAgIFJFRFVDRVJfTUFOQUdFUl9QUk9WSURFUlMsXG4gICAgU0NBTk5FRF9BQ1RJT05TX1NVQkpFQ1RfUFJPVklERVJTLFxuICAgIFNUQVRFX1BST1ZJREVSUyxcbiAgICBTVE9SRV9QUk9WSURFUlMsXG4gICAgcHJvdmlkZVJ1bnRpbWVDaGVja3MoY29uZmlnLnJ1bnRpbWVDaGVja3MpLFxuICAgIGNoZWNrRm9yQWN0aW9uVHlwZVVuaXF1ZW5lc3MoKSxcbiAgXTtcbn1cblxuZnVuY3Rpb24gcm9vdFN0b3JlUHJvdmlkZXJGYWN0b3J5KCk6IHZvaWQge1xuICBpbmplY3QoQWN0aW9uc1N1YmplY3QpO1xuICBpbmplY3QoUmVkdWNlck9ic2VydmFibGUpO1xuICBpbmplY3QoU2Nhbm5lZEFjdGlvbnNTdWJqZWN0KTtcbiAgaW5qZWN0KFN0b3JlKTtcbiAgaW5qZWN0KF9ST09UX1NUT1JFX0dVQVJELCB7IG9wdGlvbmFsOiB0cnVlIH0pO1xuICBpbmplY3QoX0FDVElPTl9UWVBFX1VOSVFVRU5FU1NfQ0hFQ0ssIHsgb3B0aW9uYWw6IHRydWUgfSk7XG59XG5cbi8qKlxuICogRW52aXJvbm1lbnQgSW5pdGlhbGl6ZXIgdXNlZCBpbiB0aGUgcm9vdFxuICogcHJvdmlkZXJzIHRvIGluaXRpYWxpemUgdGhlIFN0b3JlXG4gKi9cbmNvbnN0IEVOVklST05NRU5UX1NUT1JFX1BST1ZJREVSOiBQcm92aWRlcltdID0gW1xuICB7IHByb3ZpZGU6IFJPT1RfU1RPUkVfUFJPVklERVIsIHVzZUZhY3Rvcnk6IHJvb3RTdG9yZVByb3ZpZGVyRmFjdG9yeSB9LFxuICB7XG4gICAgcHJvdmlkZTogRU5WSVJPTk1FTlRfSU5JVElBTElaRVIsXG4gICAgbXVsdGk6IHRydWUsXG4gICAgdXNlRmFjdG9yeSgpIHtcbiAgICAgIHJldHVybiAoKSA9PiBpbmplY3QoUk9PVF9TVE9SRV9QUk9WSURFUik7XG4gICAgfSxcbiAgfSxcbl07XG5cbi8qKlxuICogUHJvdmlkZXMgdGhlIGdsb2JhbCBTdG9yZSBwcm92aWRlcnMgYW5kIGluaXRpYWxpemVzXG4gKiB0aGUgU3RvcmUuXG4gKiBUaGVzZSBwcm92aWRlcnMgY2Fubm90IGJlIHVzZWQgYXQgdGhlIGNvbXBvbmVudCBsZXZlbC5cbiAqXG4gKiBAdXNhZ2VOb3Rlc1xuICpcbiAqICMjIyBQcm92aWRpbmcgdGhlIEdsb2JhbCBTdG9yZVxuICpcbiAqIGBgYHRzXG4gKiBib290c3RyYXBBcHBsaWNhdGlvbihBcHBDb21wb25lbnQsIHtcbiAqICAgcHJvdmlkZXJzOiBbcHJvdmlkZVN0b3JlKCldLFxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVTdG9yZTxULCBWIGV4dGVuZHMgQWN0aW9uID0gQWN0aW9uPihcbiAgcmVkdWNlcnM/OiBBY3Rpb25SZWR1Y2VyTWFwPFQsIFY+IHwgSW5qZWN0aW9uVG9rZW48QWN0aW9uUmVkdWNlck1hcDxULCBWPj4sXG4gIGNvbmZpZz86IFJvb3RTdG9yZUNvbmZpZzxULCBWPlxuKTogRW52aXJvbm1lbnRQcm92aWRlcnMge1xuICByZXR1cm4gbWFrZUVudmlyb25tZW50UHJvdmlkZXJzKFtcbiAgICAuLi5fcHJvdmlkZVN0b3JlKHJlZHVjZXJzLCBjb25maWcpLFxuICAgIEVOVklST05NRU5UX1NUT1JFX1BST1ZJREVSLFxuICBdKTtcbn1cblxuZnVuY3Rpb24gZmVhdHVyZVN0YXRlUHJvdmlkZXJGYWN0b3J5KCk6IHZvaWQge1xuICBpbmplY3QoUk9PVF9TVE9SRV9QUk9WSURFUik7XG4gIGNvbnN0IGZlYXR1cmVzID0gaW5qZWN0PFN0b3JlRmVhdHVyZTxhbnksIGFueT5bXT4oX1NUT1JFX0ZFQVRVUkVTKTtcbiAgY29uc3QgZmVhdHVyZVJlZHVjZXJzID0gaW5qZWN0PEFjdGlvblJlZHVjZXJNYXA8YW55PltdPihGRUFUVVJFX1JFRFVDRVJTKTtcbiAgY29uc3QgcmVkdWNlck1hbmFnZXIgPSBpbmplY3QoUmVkdWNlck1hbmFnZXIpO1xuICBpbmplY3QoX0FDVElPTl9UWVBFX1VOSVFVRU5FU1NfQ0hFQ0ssIHsgb3B0aW9uYWw6IHRydWUgfSk7XG5cbiAgY29uc3QgZmVhdHMgPSBmZWF0dXJlcy5tYXAoKGZlYXR1cmUsIGluZGV4KSA9PiB7XG4gICAgY29uc3QgZmVhdHVyZVJlZHVjZXJDb2xsZWN0aW9uID0gZmVhdHVyZVJlZHVjZXJzLnNoaWZ0KCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICBjb25zdCByZWR1Y2VycyA9IGZlYXR1cmVSZWR1Y2VyQ29sbGVjdGlvbiEgLypUT0RPKCM4MjMpKi9baW5kZXhdO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmZlYXR1cmUsXG4gICAgICByZWR1Y2VycyxcbiAgICAgIGluaXRpYWxTdGF0ZTogX2luaXRpYWxTdGF0ZUZhY3RvcnkoZmVhdHVyZS5pbml0aWFsU3RhdGUpLFxuICAgIH07XG4gIH0pO1xuXG4gIHJlZHVjZXJNYW5hZ2VyLmFkZEZlYXR1cmVzKGZlYXRzKTtcbn1cblxuLyoqXG4gKiBFbnZpcm9ubWVudCBJbml0aWFsaXplciB1c2VkIGluIHRoZSBmZWF0dXJlXG4gKiBwcm92aWRlcnMgdG8gcmVnaXN0ZXIgc3RhdGUgZmVhdHVyZXNcbiAqL1xuY29uc3QgRU5WSVJPTk1FTlRfU1RBVEVfUFJPVklERVI6IFByb3ZpZGVyW10gPSBbXG4gIHtcbiAgICBwcm92aWRlOiBGRUFUVVJFX1NUQVRFX1BST1ZJREVSLFxuICAgIHVzZUZhY3Rvcnk6IGZlYXR1cmVTdGF0ZVByb3ZpZGVyRmFjdG9yeSxcbiAgfSxcbiAge1xuICAgIHByb3ZpZGU6IEVOVklST05NRU5UX0lOSVRJQUxJWkVSLFxuICAgIG11bHRpOiB0cnVlLFxuICAgIHVzZUZhY3RvcnkoKSB7XG4gICAgICByZXR1cm4gKCkgPT4gaW5qZWN0KEZFQVRVUkVfU1RBVEVfUFJPVklERVIpO1xuICAgIH0sXG4gIH0sXG5dO1xuXG5leHBvcnQgZnVuY3Rpb24gX3Byb3ZpZGVTdGF0ZTxULCBWIGV4dGVuZHMgQWN0aW9uID0gQWN0aW9uPihcbiAgZmVhdHVyZU5hbWVPclNsaWNlOiBzdHJpbmcgfCBGZWF0dXJlU2xpY2U8VCwgVj4sXG4gIHJlZHVjZXJzPzpcbiAgICB8IEFjdGlvblJlZHVjZXJNYXA8VCwgVj5cbiAgICB8IEluamVjdGlvblRva2VuPEFjdGlvblJlZHVjZXJNYXA8VCwgVj4+XG4gICAgfCBBY3Rpb25SZWR1Y2VyPFQsIFY+XG4gICAgfCBJbmplY3Rpb25Ub2tlbjxBY3Rpb25SZWR1Y2VyPFQsIFY+PixcbiAgY29uZmlnOiBTdG9yZUNvbmZpZzxULCBWPiB8IEluamVjdGlvblRva2VuPFN0b3JlQ29uZmlnPFQsIFY+PiA9IHt9XG4pOiBQcm92aWRlcltdIHtcbiAgcmV0dXJuIFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBfRkVBVFVSRV9DT05GSUdTLFxuICAgICAgbXVsdGk6IHRydWUsXG4gICAgICB1c2VWYWx1ZTogZmVhdHVyZU5hbWVPclNsaWNlIGluc3RhbmNlb2YgT2JqZWN0ID8ge30gOiBjb25maWcsXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBTVE9SRV9GRUFUVVJFUyxcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAga2V5OlxuICAgICAgICAgIGZlYXR1cmVOYW1lT3JTbGljZSBpbnN0YW5jZW9mIE9iamVjdFxuICAgICAgICAgICAgPyBmZWF0dXJlTmFtZU9yU2xpY2UubmFtZVxuICAgICAgICAgICAgOiBmZWF0dXJlTmFtZU9yU2xpY2UsXG4gICAgICAgIHJlZHVjZXJGYWN0b3J5OlxuICAgICAgICAgICEoY29uZmlnIGluc3RhbmNlb2YgSW5qZWN0aW9uVG9rZW4pICYmIGNvbmZpZy5yZWR1Y2VyRmFjdG9yeVxuICAgICAgICAgICAgPyBjb25maWcucmVkdWNlckZhY3RvcnlcbiAgICAgICAgICAgIDogY29tYmluZVJlZHVjZXJzLFxuICAgICAgICBtZXRhUmVkdWNlcnM6XG4gICAgICAgICAgIShjb25maWcgaW5zdGFuY2VvZiBJbmplY3Rpb25Ub2tlbikgJiYgY29uZmlnLm1ldGFSZWR1Y2Vyc1xuICAgICAgICAgICAgPyBjb25maWcubWV0YVJlZHVjZXJzXG4gICAgICAgICAgICA6IFtdLFxuICAgICAgICBpbml0aWFsU3RhdGU6XG4gICAgICAgICAgIShjb25maWcgaW5zdGFuY2VvZiBJbmplY3Rpb25Ub2tlbikgJiYgY29uZmlnLmluaXRpYWxTdGF0ZVxuICAgICAgICAgICAgPyBjb25maWcuaW5pdGlhbFN0YXRlXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBfU1RPUkVfRkVBVFVSRVMsXG4gICAgICBkZXBzOiBbX0ZFQVRVUkVfQ09ORklHUywgU1RPUkVfRkVBVFVSRVNdLFxuICAgICAgdXNlRmFjdG9yeTogX2NyZWF0ZUZlYXR1cmVTdG9yZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHByb3ZpZGU6IF9GRUFUVVJFX1JFRFVDRVJTLFxuICAgICAgbXVsdGk6IHRydWUsXG4gICAgICB1c2VWYWx1ZTpcbiAgICAgICAgZmVhdHVyZU5hbWVPclNsaWNlIGluc3RhbmNlb2YgT2JqZWN0XG4gICAgICAgICAgPyBmZWF0dXJlTmFtZU9yU2xpY2UucmVkdWNlclxuICAgICAgICAgIDogcmVkdWNlcnMsXG4gICAgfSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBfRkVBVFVSRV9SRURVQ0VSU19UT0tFTixcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgICAgdXNlRXhpc3Rpbmc6XG4gICAgICAgIHJlZHVjZXJzIGluc3RhbmNlb2YgSW5qZWN0aW9uVG9rZW4gPyByZWR1Y2VycyA6IF9GRUFUVVJFX1JFRFVDRVJTLFxuICAgIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogRkVBVFVSRV9SRURVQ0VSUyxcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgICAgZGVwczogW19GRUFUVVJFX1JFRFVDRVJTLCBbbmV3IEluamVjdChfRkVBVFVSRV9SRURVQ0VSU19UT0tFTildXSxcbiAgICAgIHVzZUZhY3Rvcnk6IF9jcmVhdGVGZWF0dXJlUmVkdWNlcnMsXG4gICAgfSxcbiAgICBjaGVja0ZvckFjdGlvblR5cGVVbmlxdWVuZXNzKCksXG4gIF07XG59XG4iXX0=