import { capitalize } from './helpers';
import { isPlainObject } from './meta-reducers/utils';
import { createFeatureSelector, createSelector, } from './selector';
/**
 * @description
 * A function that accepts a feature name and a feature reducer, and creates
 * a feature selector and a selector for each feature state property.
 * This function also provides the ability to add extra selectors to
 * the feature object.
 *
 * @param featureConfig An object that contains a feature name and a feature
 * reducer as required, and extra selectors factory as an optional argument.
 * @returns An object that contains a feature name, a feature reducer,
 * a feature selector, a selector for each feature state property, and extra
 * selectors.
 *
 * @usageNotes
 *
 * ```ts
 * interface ProductsState {
 *   products: Product[];
 *   selectedId: string | null;
 * }
 *
 * const initialState: ProductsState = {
 *   products: [],
 *   selectedId: null,
 * };
 *
 * const productsFeature = createFeature({
 *   name: 'products',
 *   reducer: createReducer(
 *     initialState,
 *     on(ProductsApiActions.loadSuccess(state, { products }) => ({
 *       ...state,
 *       products,
 *     }),
 *   ),
 * });
 *
 * const {
 *   name,
 *   reducer,
 *   // feature selector
 *   selectProductsState, // type: MemoizedSelector<Record<string, any>, ProductsState>
 *   // feature state properties selectors
 *   selectProducts, // type: MemoizedSelector<Record<string, any>, Product[]>
 *   selectSelectedId, // type: MemoizedSelector<Record<string, any>, string | null>
 * } = productsFeature;
 * ```
 *
 * **Creating Feature with Extra Selectors**
 *
 * ```ts
 * type CallState = 'init' | 'loading' | 'loaded' | { error: string };
 *
 * interface State extends EntityState<Product> {
 *   callState: CallState;
 * }
 *
 * const adapter = createEntityAdapter<Product>();
 * const initialState: State = adapter.getInitialState({
 *   callState: 'init',
 * });
 *
 * export const productsFeature = createFeature({
 *   name: 'products',
 *   reducer: createReducer(initialState),
 *   extraSelectors: ({ selectProductsState, selectCallState }) => ({
 *     ...adapter.getSelectors(selectProductsState),
 *     ...getCallStateSelectors(selectCallState)
 *   }),
 * });
 *
 * const {
 *   name,
 *   reducer,
 *   // feature selector
 *   selectProductsState,
 *   // feature state properties selectors
 *   selectIds,
 *   selectEntities,
 *   selectCallState,
 *   // selectors returned by `adapter.getSelectors`
 *   selectAll,
 *   selectTotal,
 *   // selectors returned by `getCallStateSelectors`
 *   selectIsLoading,
 *   selectIsLoaded,
 *   selectError,
 * } = productsFeature;
 * ```
 */
export function createFeature(featureConfig) {
    const { name, reducer, extraSelectors: extraSelectorsFactory, } = featureConfig;
    const featureSelector = createFeatureSelector(name);
    const nestedSelectors = createNestedSelectors(featureSelector, reducer);
    const baseSelectors = {
        [`select${capitalize(name)}State`]: featureSelector,
        ...nestedSelectors,
    };
    const extraSelectors = extraSelectorsFactory
        ? extraSelectorsFactory(baseSelectors)
        : {};
    return {
        name,
        reducer,
        ...baseSelectors,
        ...extraSelectors,
    };
}
function createNestedSelectors(featureSelector, reducer) {
    const initialState = getInitialState(reducer);
    const nestedKeys = (isPlainObject(initialState) ? Object.keys(initialState) : []);
    return nestedKeys.reduce((nestedSelectors, nestedKey) => ({
        ...nestedSelectors,
        [`select${capitalize(nestedKey)}`]: createSelector(featureSelector, (parentState) => parentState?.[nestedKey]),
    }), {});
}
function getInitialState(reducer) {
    return reducer(undefined, { type: '@ngrx/feature/init' });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVhdHVyZV9jcmVhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbW9kdWxlcy9zdG9yZS9zcmMvZmVhdHVyZV9jcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFdkMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ3RELE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsY0FBYyxHQUVmLE1BQU0sWUFBWSxDQUFDO0FBdUdwQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5Rkc7QUFDSCxNQUFNLFVBQVUsYUFBYSxDQUszQixhQU1DO0lBRUQsTUFBTSxFQUNKLElBQUksRUFDSixPQUFPLEVBQ1AsY0FBYyxFQUFFLHFCQUFxQixHQUN0QyxHQUFHLGFBQWEsQ0FBQztJQUVsQixNQUFNLGVBQWUsR0FBRyxxQkFBcUIsQ0FBZSxJQUFJLENBQUMsQ0FBQztJQUNsRSxNQUFNLGVBQWUsR0FBRyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDeEUsTUFBTSxhQUFhLEdBQUc7UUFDcEIsQ0FBQyxTQUFTLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsZUFBZTtRQUNuRCxHQUFHLGVBQWU7S0FDeUIsQ0FBQztJQUM5QyxNQUFNLGNBQWMsR0FBRyxxQkFBcUI7UUFDMUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQztRQUN0QyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBRVAsT0FBTztRQUNMLElBQUk7UUFDSixPQUFPO1FBQ1AsR0FBRyxhQUFhO1FBQ2hCLEdBQUcsY0FBYztLQUNxQyxDQUFDO0FBQzNELENBQUM7QUFFRCxTQUFTLHFCQUFxQixDQUM1QixlQUFvRSxFQUNwRSxPQUFvQztJQUVwQyxNQUFNLFlBQVksR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDOUMsTUFBTSxVQUFVLEdBQUcsQ0FDakIsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQ3ZCLENBQUM7SUFFeEMsT0FBTyxVQUFVLENBQUMsTUFBTSxDQUN0QixDQUFDLGVBQWUsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDL0IsR0FBRyxlQUFlO1FBQ2xCLENBQUMsU0FBUyxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLGNBQWMsQ0FDaEQsZUFBZSxFQUNmLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FDMUM7S0FDRixDQUFDLEVBQ0YsRUFBbUMsQ0FDcEMsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FDdEIsT0FBb0M7SUFFcEMsT0FBTyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQztBQUM1RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY2FwaXRhbGl6ZSB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyBBY3Rpb25SZWR1Y2VyLCBQcmV0dGlmeSwgUHJpbWl0aXZlLCBTZWxlY3RvciB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGlzUGxhaW5PYmplY3QgfSBmcm9tICcuL21ldGEtcmVkdWNlcnMvdXRpbHMnO1xuaW1wb3J0IHtcbiAgY3JlYXRlRmVhdHVyZVNlbGVjdG9yLFxuICBjcmVhdGVTZWxlY3RvcixcbiAgTWVtb2l6ZWRTZWxlY3Rvcixcbn0gZnJvbSAnLi9zZWxlY3Rvcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZywgRmVhdHVyZVN0YXRlPiB7XG4gIG5hbWU6IEZlYXR1cmVOYW1lO1xuICByZWR1Y2VyOiBBY3Rpb25SZWR1Y2VyPEZlYXR1cmVTdGF0ZT47XG59XG5cbnR5cGUgRmVhdHVyZTxGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZywgRmVhdHVyZVN0YXRlPiA9IEZlYXR1cmVDb25maWc8XG4gIEZlYXR1cmVOYW1lLFxuICBGZWF0dXJlU3RhdGVcbj4gJlxuICBCYXNlU2VsZWN0b3JzPEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+O1xuXG50eXBlIEZlYXR1cmVXaXRoRXh0cmFTZWxlY3RvcnM8XG4gIEZlYXR1cmVOYW1lIGV4dGVuZHMgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUsXG4gIEV4dHJhU2VsZWN0b3JzIGV4dGVuZHMgU2VsZWN0b3JzRGljdGlvbmFyeVxuPiA9IHN0cmluZyBleHRlbmRzIGtleW9mIEV4dHJhU2VsZWN0b3JzXG4gID8gRmVhdHVyZTxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPlxuICA6IE9taXQ8RmVhdHVyZTxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiwga2V5b2YgRXh0cmFTZWxlY3RvcnM+ICZcbiAgICAgIEV4dHJhU2VsZWN0b3JzO1xuXG50eXBlIEZlYXR1cmVTZWxlY3RvcjxGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZywgRmVhdHVyZVN0YXRlPiA9IHtcbiAgW0sgaW4gRmVhdHVyZU5hbWUgYXMgYHNlbGVjdCR7Q2FwaXRhbGl6ZTxLPn1TdGF0ZWBdOiBNZW1vaXplZFNlbGVjdG9yPFxuICAgIFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICAgRmVhdHVyZVN0YXRlLFxuICAgIChmZWF0dXJlU3RhdGU6IEZlYXR1cmVTdGF0ZSkgPT4gRmVhdHVyZVN0YXRlXG4gID47XG59O1xuXG50eXBlIE5lc3RlZFNlbGVjdG9yczxGZWF0dXJlU3RhdGU+ID0gRmVhdHVyZVN0YXRlIGV4dGVuZHNcbiAgfCBQcmltaXRpdmVcbiAgfCB1bmtub3duW11cbiAgfCBEYXRlXG4gID8ge31cbiAgOiB7XG4gICAgICBbSyBpbiBrZXlvZiBGZWF0dXJlU3RhdGUgJlxuICAgICAgICBzdHJpbmcgYXMgYHNlbGVjdCR7Q2FwaXRhbGl6ZTxLPn1gXTogTWVtb2l6ZWRTZWxlY3RvcjxcbiAgICAgICAgUmVjb3JkPHN0cmluZywgYW55PixcbiAgICAgICAgRmVhdHVyZVN0YXRlW0tdLFxuICAgICAgICAoZmVhdHVyZVN0YXRlOiBGZWF0dXJlU3RhdGUpID0+IEZlYXR1cmVTdGF0ZVtLXVxuICAgICAgPjtcbiAgICB9O1xuXG50eXBlIEJhc2VTZWxlY3RvcnM8RmVhdHVyZU5hbWUgZXh0ZW5kcyBzdHJpbmcsIEZlYXR1cmVTdGF0ZT4gPSBGZWF0dXJlU2VsZWN0b3I8XG4gIEZlYXR1cmVOYW1lLFxuICBGZWF0dXJlU3RhdGVcbj4gJlxuICBOZXN0ZWRTZWxlY3RvcnM8RmVhdHVyZVN0YXRlPjtcblxudHlwZSBTZWxlY3RvcnNEaWN0aW9uYXJ5ID0gUmVjb3JkPFxuICBzdHJpbmcsXG4gIHwgU2VsZWN0b3I8UmVjb3JkPHN0cmluZywgYW55PiwgdW5rbm93bj5cbiAgfCAoKC4uLmFyZ3M6IGFueVtdKSA9PiBTZWxlY3RvcjxSZWNvcmQ8c3RyaW5nLCBhbnk+LCB1bmtub3duPilcbj47XG5cbnR5cGUgRXh0cmFTZWxlY3RvcnNGYWN0b3J5PFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZyxcbiAgRmVhdHVyZVN0YXRlLFxuICBFeHRyYVNlbGVjdG9ycyBleHRlbmRzIFNlbGVjdG9yc0RpY3Rpb25hcnlcbj4gPSAoYmFzZVNlbGVjdG9yczogQmFzZVNlbGVjdG9yczxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPikgPT4gRXh0cmFTZWxlY3RvcnM7XG5cbnR5cGUgTm90QWxsb3dlZEZlYXR1cmVTdGF0ZUNoZWNrPEZlYXR1cmVTdGF0ZT4gPVxuICBGZWF0dXJlU3RhdGUgZXh0ZW5kcyBSZXF1aXJlZDxGZWF0dXJlU3RhdGU+XG4gICAgPyB1bmtub3duXG4gICAgOiAnb3B0aW9uYWwgcHJvcGVydGllcyBhcmUgbm90IGFsbG93ZWQgaW4gdGhlIGZlYXR1cmUgc3RhdGUnO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBmZWF0dXJlIG9iamVjdCB3aXRoIGV4dHJhIHNlbGVjdG9ycy5cbiAqXG4gKiBAcGFyYW0gZmVhdHVyZUNvbmZpZyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSwgYSBmZWF0dXJlXG4gKiByZWR1Y2VyLCBhbmQgZXh0cmEgc2VsZWN0b3JzIGZhY3RvcnkuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSwgYSBmZWF0dXJlIHJlZHVjZXIsXG4gKiBhIGZlYXR1cmUgc2VsZWN0b3IsIGEgc2VsZWN0b3IgZm9yIGVhY2ggZmVhdHVyZSBzdGF0ZSBwcm9wZXJ0eSwgYW5kXG4gKiBleHRyYSBzZWxlY3RvcnMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGZWF0dXJlPFxuICBGZWF0dXJlTmFtZSBleHRlbmRzIHN0cmluZyxcbiAgRmVhdHVyZVN0YXRlLFxuICBFeHRyYVNlbGVjdG9ycyBleHRlbmRzIFNlbGVjdG9yc0RpY3Rpb25hcnlcbj4oXG4gIGZlYXR1cmVDb25maWc6IEZlYXR1cmVDb25maWc8RmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT4gJiB7XG4gICAgZXh0cmFTZWxlY3RvcnM6IEV4dHJhU2VsZWN0b3JzRmFjdG9yeTxcbiAgICAgIEZlYXR1cmVOYW1lLFxuICAgICAgRmVhdHVyZVN0YXRlLFxuICAgICAgRXh0cmFTZWxlY3RvcnNcbiAgICA+O1xuICB9ICYgTm90QWxsb3dlZEZlYXR1cmVTdGF0ZUNoZWNrPEZlYXR1cmVTdGF0ZT5cbik6IFByZXR0aWZ5PFxuICBGZWF0dXJlV2l0aEV4dHJhU2VsZWN0b3JzPEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGUsIEV4dHJhU2VsZWN0b3JzPlxuPjtcbi8qKlxuICogQ3JlYXRlcyBhIGZlYXR1cmUgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSBmZWF0dXJlQ29uZmlnIEFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIGEgZmVhdHVyZSBuYW1lIGFuZCBhIGZlYXR1cmVcbiAqIHJlZHVjZXIuXG4gKiBAcmV0dXJucyBBbiBvYmplY3QgdGhhdCBjb250YWlucyBhIGZlYXR1cmUgbmFtZSwgYSBmZWF0dXJlIHJlZHVjZXIsXG4gKiBhIGZlYXR1cmUgc2VsZWN0b3IsIGFuZCBhIHNlbGVjdG9yIGZvciBlYWNoIGZlYXR1cmUgc3RhdGUgcHJvcGVydHkuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGZWF0dXJlPEZlYXR1cmVOYW1lIGV4dGVuZHMgc3RyaW5nLCBGZWF0dXJlU3RhdGU+KFxuICBmZWF0dXJlQ29uZmlnOiBGZWF0dXJlQ29uZmlnPEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICZcbiAgICBOb3RBbGxvd2VkRmVhdHVyZVN0YXRlQ2hlY2s8RmVhdHVyZVN0YXRlPlxuKTogUHJldHRpZnk8RmVhdHVyZTxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPj47XG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICogQSBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgYSBmZWF0dXJlIG5hbWUgYW5kIGEgZmVhdHVyZSByZWR1Y2VyLCBhbmQgY3JlYXRlc1xuICogYSBmZWF0dXJlIHNlbGVjdG9yIGFuZCBhIHNlbGVjdG9yIGZvciBlYWNoIGZlYXR1cmUgc3RhdGUgcHJvcGVydHkuXG4gKiBUaGlzIGZ1bmN0aW9uIGFsc28gcHJvdmlkZXMgdGhlIGFiaWxpdHkgdG8gYWRkIGV4dHJhIHNlbGVjdG9ycyB0b1xuICogdGhlIGZlYXR1cmUgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSBmZWF0dXJlQ29uZmlnIEFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIGEgZmVhdHVyZSBuYW1lIGFuZCBhIGZlYXR1cmVcbiAqIHJlZHVjZXIgYXMgcmVxdWlyZWQsIGFuZCBleHRyYSBzZWxlY3RvcnMgZmFjdG9yeSBhcyBhbiBvcHRpb25hbCBhcmd1bWVudC5cbiAqIEByZXR1cm5zIEFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIGEgZmVhdHVyZSBuYW1lLCBhIGZlYXR1cmUgcmVkdWNlcixcbiAqIGEgZmVhdHVyZSBzZWxlY3RvciwgYSBzZWxlY3RvciBmb3IgZWFjaCBmZWF0dXJlIHN0YXRlIHByb3BlcnR5LCBhbmQgZXh0cmFcbiAqIHNlbGVjdG9ycy5cbiAqXG4gKiBAdXNhZ2VOb3Rlc1xuICpcbiAqIGBgYHRzXG4gKiBpbnRlcmZhY2UgUHJvZHVjdHNTdGF0ZSB7XG4gKiAgIHByb2R1Y3RzOiBQcm9kdWN0W107XG4gKiAgIHNlbGVjdGVkSWQ6IHN0cmluZyB8IG51bGw7XG4gKiB9XG4gKlxuICogY29uc3QgaW5pdGlhbFN0YXRlOiBQcm9kdWN0c1N0YXRlID0ge1xuICogICBwcm9kdWN0czogW10sXG4gKiAgIHNlbGVjdGVkSWQ6IG51bGwsXG4gKiB9O1xuICpcbiAqIGNvbnN0IHByb2R1Y3RzRmVhdHVyZSA9IGNyZWF0ZUZlYXR1cmUoe1xuICogICBuYW1lOiAncHJvZHVjdHMnLFxuICogICByZWR1Y2VyOiBjcmVhdGVSZWR1Y2VyKFxuICogICAgIGluaXRpYWxTdGF0ZSxcbiAqICAgICBvbihQcm9kdWN0c0FwaUFjdGlvbnMubG9hZFN1Y2Nlc3Moc3RhdGUsIHsgcHJvZHVjdHMgfSkgPT4gKHtcbiAqICAgICAgIC4uLnN0YXRlLFxuICogICAgICAgcHJvZHVjdHMsXG4gKiAgICAgfSksXG4gKiAgICksXG4gKiB9KTtcbiAqXG4gKiBjb25zdCB7XG4gKiAgIG5hbWUsXG4gKiAgIHJlZHVjZXIsXG4gKiAgIC8vIGZlYXR1cmUgc2VsZWN0b3JcbiAqICAgc2VsZWN0UHJvZHVjdHNTdGF0ZSwgLy8gdHlwZTogTWVtb2l6ZWRTZWxlY3RvcjxSZWNvcmQ8c3RyaW5nLCBhbnk+LCBQcm9kdWN0c1N0YXRlPlxuICogICAvLyBmZWF0dXJlIHN0YXRlIHByb3BlcnRpZXMgc2VsZWN0b3JzXG4gKiAgIHNlbGVjdFByb2R1Y3RzLCAvLyB0eXBlOiBNZW1vaXplZFNlbGVjdG9yPFJlY29yZDxzdHJpbmcsIGFueT4sIFByb2R1Y3RbXT5cbiAqICAgc2VsZWN0U2VsZWN0ZWRJZCwgLy8gdHlwZTogTWVtb2l6ZWRTZWxlY3RvcjxSZWNvcmQ8c3RyaW5nLCBhbnk+LCBzdHJpbmcgfCBudWxsPlxuICogfSA9IHByb2R1Y3RzRmVhdHVyZTtcbiAqIGBgYFxuICpcbiAqICoqQ3JlYXRpbmcgRmVhdHVyZSB3aXRoIEV4dHJhIFNlbGVjdG9ycyoqXG4gKlxuICogYGBgdHNcbiAqIHR5cGUgQ2FsbFN0YXRlID0gJ2luaXQnIHwgJ2xvYWRpbmcnIHwgJ2xvYWRlZCcgfCB7IGVycm9yOiBzdHJpbmcgfTtcbiAqXG4gKiBpbnRlcmZhY2UgU3RhdGUgZXh0ZW5kcyBFbnRpdHlTdGF0ZTxQcm9kdWN0PiB7XG4gKiAgIGNhbGxTdGF0ZTogQ2FsbFN0YXRlO1xuICogfVxuICpcbiAqIGNvbnN0IGFkYXB0ZXIgPSBjcmVhdGVFbnRpdHlBZGFwdGVyPFByb2R1Y3Q+KCk7XG4gKiBjb25zdCBpbml0aWFsU3RhdGU6IFN0YXRlID0gYWRhcHRlci5nZXRJbml0aWFsU3RhdGUoe1xuICogICBjYWxsU3RhdGU6ICdpbml0JyxcbiAqIH0pO1xuICpcbiAqIGV4cG9ydCBjb25zdCBwcm9kdWN0c0ZlYXR1cmUgPSBjcmVhdGVGZWF0dXJlKHtcbiAqICAgbmFtZTogJ3Byb2R1Y3RzJyxcbiAqICAgcmVkdWNlcjogY3JlYXRlUmVkdWNlcihpbml0aWFsU3RhdGUpLFxuICogICBleHRyYVNlbGVjdG9yczogKHsgc2VsZWN0UHJvZHVjdHNTdGF0ZSwgc2VsZWN0Q2FsbFN0YXRlIH0pID0+ICh7XG4gKiAgICAgLi4uYWRhcHRlci5nZXRTZWxlY3RvcnMoc2VsZWN0UHJvZHVjdHNTdGF0ZSksXG4gKiAgICAgLi4uZ2V0Q2FsbFN0YXRlU2VsZWN0b3JzKHNlbGVjdENhbGxTdGF0ZSlcbiAqICAgfSksXG4gKiB9KTtcbiAqXG4gKiBjb25zdCB7XG4gKiAgIG5hbWUsXG4gKiAgIHJlZHVjZXIsXG4gKiAgIC8vIGZlYXR1cmUgc2VsZWN0b3JcbiAqICAgc2VsZWN0UHJvZHVjdHNTdGF0ZSxcbiAqICAgLy8gZmVhdHVyZSBzdGF0ZSBwcm9wZXJ0aWVzIHNlbGVjdG9yc1xuICogICBzZWxlY3RJZHMsXG4gKiAgIHNlbGVjdEVudGl0aWVzLFxuICogICBzZWxlY3RDYWxsU3RhdGUsXG4gKiAgIC8vIHNlbGVjdG9ycyByZXR1cm5lZCBieSBgYWRhcHRlci5nZXRTZWxlY3RvcnNgXG4gKiAgIHNlbGVjdEFsbCxcbiAqICAgc2VsZWN0VG90YWwsXG4gKiAgIC8vIHNlbGVjdG9ycyByZXR1cm5lZCBieSBgZ2V0Q2FsbFN0YXRlU2VsZWN0b3JzYFxuICogICBzZWxlY3RJc0xvYWRpbmcsXG4gKiAgIHNlbGVjdElzTG9hZGVkLFxuICogICBzZWxlY3RFcnJvcixcbiAqIH0gPSBwcm9kdWN0c0ZlYXR1cmU7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZlYXR1cmU8XG4gIEZlYXR1cmVOYW1lIGV4dGVuZHMgc3RyaW5nLFxuICBGZWF0dXJlU3RhdGUsXG4gIEV4dHJhU2VsZWN0b3JzIGV4dGVuZHMgU2VsZWN0b3JzRGljdGlvbmFyeVxuPihcbiAgZmVhdHVyZUNvbmZpZzogRmVhdHVyZUNvbmZpZzxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiAmIHtcbiAgICBleHRyYVNlbGVjdG9ycz86IEV4dHJhU2VsZWN0b3JzRmFjdG9yeTxcbiAgICAgIEZlYXR1cmVOYW1lLFxuICAgICAgRmVhdHVyZVN0YXRlLFxuICAgICAgRXh0cmFTZWxlY3RvcnNcbiAgICA+O1xuICB9XG4pOiBGZWF0dXJlPEZlYXR1cmVOYW1lLCBGZWF0dXJlU3RhdGU+ICYgRXh0cmFTZWxlY3RvcnMge1xuICBjb25zdCB7XG4gICAgbmFtZSxcbiAgICByZWR1Y2VyLFxuICAgIGV4dHJhU2VsZWN0b3JzOiBleHRyYVNlbGVjdG9yc0ZhY3RvcnksXG4gIH0gPSBmZWF0dXJlQ29uZmlnO1xuXG4gIGNvbnN0IGZlYXR1cmVTZWxlY3RvciA9IGNyZWF0ZUZlYXR1cmVTZWxlY3RvcjxGZWF0dXJlU3RhdGU+KG5hbWUpO1xuICBjb25zdCBuZXN0ZWRTZWxlY3RvcnMgPSBjcmVhdGVOZXN0ZWRTZWxlY3RvcnMoZmVhdHVyZVNlbGVjdG9yLCByZWR1Y2VyKTtcbiAgY29uc3QgYmFzZVNlbGVjdG9ycyA9IHtcbiAgICBbYHNlbGVjdCR7Y2FwaXRhbGl6ZShuYW1lKX1TdGF0ZWBdOiBmZWF0dXJlU2VsZWN0b3IsXG4gICAgLi4ubmVzdGVkU2VsZWN0b3JzLFxuICB9IGFzIEJhc2VTZWxlY3RvcnM8RmVhdHVyZU5hbWUsIEZlYXR1cmVTdGF0ZT47XG4gIGNvbnN0IGV4dHJhU2VsZWN0b3JzID0gZXh0cmFTZWxlY3RvcnNGYWN0b3J5XG4gICAgPyBleHRyYVNlbGVjdG9yc0ZhY3RvcnkoYmFzZVNlbGVjdG9ycylcbiAgICA6IHt9O1xuXG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICByZWR1Y2VyLFxuICAgIC4uLmJhc2VTZWxlY3RvcnMsXG4gICAgLi4uZXh0cmFTZWxlY3RvcnMsXG4gIH0gYXMgRmVhdHVyZTxGZWF0dXJlTmFtZSwgRmVhdHVyZVN0YXRlPiAmIEV4dHJhU2VsZWN0b3JzO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVOZXN0ZWRTZWxlY3RvcnM8RmVhdHVyZVN0YXRlPihcbiAgZmVhdHVyZVNlbGVjdG9yOiBNZW1vaXplZFNlbGVjdG9yPFJlY29yZDxzdHJpbmcsIGFueT4sIEZlYXR1cmVTdGF0ZT4sXG4gIHJlZHVjZXI6IEFjdGlvblJlZHVjZXI8RmVhdHVyZVN0YXRlPlxuKTogTmVzdGVkU2VsZWN0b3JzPEZlYXR1cmVTdGF0ZT4ge1xuICBjb25zdCBpbml0aWFsU3RhdGUgPSBnZXRJbml0aWFsU3RhdGUocmVkdWNlcik7XG4gIGNvbnN0IG5lc3RlZEtleXMgPSAoXG4gICAgaXNQbGFpbk9iamVjdChpbml0aWFsU3RhdGUpID8gT2JqZWN0LmtleXMoaW5pdGlhbFN0YXRlKSA6IFtdXG4gICkgYXMgQXJyYXk8a2V5b2YgRmVhdHVyZVN0YXRlICYgc3RyaW5nPjtcblxuICByZXR1cm4gbmVzdGVkS2V5cy5yZWR1Y2UoXG4gICAgKG5lc3RlZFNlbGVjdG9ycywgbmVzdGVkS2V5KSA9PiAoe1xuICAgICAgLi4ubmVzdGVkU2VsZWN0b3JzLFxuICAgICAgW2BzZWxlY3Qke2NhcGl0YWxpemUobmVzdGVkS2V5KX1gXTogY3JlYXRlU2VsZWN0b3IoXG4gICAgICAgIGZlYXR1cmVTZWxlY3RvcixcbiAgICAgICAgKHBhcmVudFN0YXRlKSA9PiBwYXJlbnRTdGF0ZT8uW25lc3RlZEtleV1cbiAgICAgICksXG4gICAgfSksXG4gICAge30gYXMgTmVzdGVkU2VsZWN0b3JzPEZlYXR1cmVTdGF0ZT5cbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlPEZlYXR1cmVTdGF0ZT4oXG4gIHJlZHVjZXI6IEFjdGlvblJlZHVjZXI8RmVhdHVyZVN0YXRlPlxuKTogRmVhdHVyZVN0YXRlIHtcbiAgcmV0dXJuIHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6ICdAbmdyeC9mZWF0dXJlL2luaXQnIH0pO1xufVxuIl19